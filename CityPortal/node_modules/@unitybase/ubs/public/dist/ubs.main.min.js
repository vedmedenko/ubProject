!function t(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r(require("lodash")):"function"==typeof define&&define.amd?define(["lodash"],r):"object"==typeof exports?exports["@unitybase/ubs"]=r(require("lodash")):e["@unitybase/ubs"]=r(e._)}(this,function(__WEBPACK_EXTERNAL_MODULE_2__){return function(t){function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var r=window.webpackJsonp_unitybase_ubs;window.webpackJsonp_unitybase_ubs=function e(n,i,a){for(var s,u,p=0,c=[],d;p<n.length;p++)u=n[p],o[u]&&c.push(o[u][0]),o[u]=0;for(s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s]);for(r&&r(n,i,a);c.length;)c.shift()()};var n={},o={2:0};return e.e=function t(r){function n(){u.onerror=u.onload=null,clearTimeout(p);var t=o[r];0!==t&&(t&&t[1](Error("Loading chunk "+r+" failed.")),o[r]=void 0)}var i=o[r];if(0===i)return new Promise(function(t){t()});if(i)return i[2];var a=new Promise(function(t,e){i=o[r]=[t,e]});i[2]=a;var s=document.getElementsByTagName("head")[0],u=document.createElement("script");u.type="text/javascript",u.charset="utf-8",u.async=!0,u.timeout=12e4,e.nc&&u.setAttribute("nonce",e.nc),u.src=e.p+"ubs."+r+".min.js";var p=setTimeout(n,12e4);return u.onerror=u.onload=n,s.appendChild(u),a},e.m=t,e.c=n,e.d=function(t,r,n){e.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var r=t&&t.__esModule?function e(){return t.default}:function e(){return t};return e.d(r,"a",r),r},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/clientRequire/@unitybase/ubs/public/dist/",e.oe=function(t){throw console.error(t),t},e(e.s=3)}([function(t,e,r){(function(e){function n(t,e,r,n){this.reportCode=t,this.reportType=e||"html",this.incomeParams=r||{},this.reportOptions={},this.lang=n,"object"===(void 0===t?"undefined":o(t))&&(this.reportCode=t.code,this.reportType=t.type||"html",this.incomeParams=t.params,this.lang=t.language,this.debug=t.debug)}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=r(12),a=r(13),s=r(2);n.makeReport=function(t,e,r){return new n(t,e,r).makeReport()},n.prototype.init=function(){var t=this;return t.isInited?Promise.resolve(!0):UB.Repository("ubs_report").attrs(["ID","report_code","name","template","code","model"]).where("[report_code]","=",t.reportCode).selectAsObject().then(function(e){return t.reportRW={ID:e[0].ID,name:e[0].name,template:e[0].template,code:e[0].code,model:e[0].model,report_code:t.reportCode},Promise.all([t.getDocument("template"),t.getDocument("code")]).then(function(e){return t.reportRW.templateData=e[0],t.prepareTemplate(),t.reportRW.codeData=e[1],t.prepareCode(),t.isInited=!0,!0})})},n.prototype.prepareTemplate=function(){var t=this,e=/(<!--%\w+?:(.+?)-->)/gi;this.reportRW.templateData=this.reportRW.templateData.replace(/<!--({{.+?}})-->/g,"$1"),this.reportRW.templateData=this.reportRW.templateData.replace(/<!--@\w+?[ ]*?".+?"-->/g,"");var r=this.reportRW.templateData.match(e);r&&r.length&&r.forEach(function(e){var r=e.match(/<!--%(\w+?:.+?)-->/)[1];r=r.split(":"),t.reportOptions[r[0]]=r[1]})},n.prototype.makeReport=function(t){var e=this,r=s.clone(e.incomeParams);return t&&(r=s.assign(r,t)),e.init().then(function(){return e.buildReport(r)}).then(function(t){return e.makeResult(t)})},n.prototype.buildXLSX=function(t,n){var s=this;if(!t||"object"!==(void 0===t?"undefined":o(t))||t instanceof Array)throw Error("reportData must have type Object");return a.addBaseMustacheSysFunction(t),a.addMustacheSysFunction(t,this.lang),r.e(0).then(r.bind(null,17)).then(function(r){n=n||{};var o=void 0;n.disableOptimization?(r.XLSXfromHTML.addMustacheSysFunction(t),o=i.render(s.reportRW.templateData,t)):o=r.XLSXfromHTML.mustacheRenderOptimization(s.reportRW.templateData,t,n.minLenOptimization);var a=new r.XLSXWorkbook({useSharedString:!!n.useSharedString});return new r.XLSXfromHTML(e.DOMParser,a,n.sheetConfig||[{name:"Sheet"}]).writeHtml({html:o,sourceData:t}),a.render()})},n.prototype.buildHTML=function(t){if(!t||"object"!==(void 0===t?"undefined":o(t))||t instanceof Array)throw Error("reportData must have type Object");return a.addBaseMustacheSysFunction(t),a.addMustacheSysFunction(t),i.render(this.reportRW.templateData,t)},n.prototype.transformToPdf=function(t,e){var n=this;return e=e||{},r.e(1).then(r.bind(null,18)).then(function(t){return t.PrintToPdf.requireFonts({fonts:e.fonts?e.fonts:[{fontName:"TimesNewRoman",fontStyle:"Normal"},{fontName:"TimesNewRoman",fontStyle:"Bold"},{fontName:"TimesNewRoman",fontStyle:"Italic"},{fontName:"TimesNewRoman",fontStyle:"BoldItalic"}]}).then(function(){return t})}).then(function(r){var o={orientation:"landscape"===n.reportOptions.pageOrientation?"l":"p",font:{name:"TimesNewRoman",type:"Normal",size:12},margin:{top:5,right:5,bottom:8,left:5}};n.onTransformConfig&&(o=n.onTransformConfig(o));var i=new r.PrintToPdf(o);return i.writeHtml({html:t,orientation:n.reportOptions.pageOrientation,onPositionDetermine:e.onPositionDetermine}),n.pdf=i,!1===e.outputPdf?i:i.output("arrayBuffer").buffer})},n.prototype.makeResult=function(t){if(!t)throw Error("Report "+this.reportCode+" return empty report");return{reportCode:this.reportCode,reportType:this.reportType,incomeParams:this.incomeParams,reportOptions:this.reportOptions,reportData:t}},n.prototype.prepareCode=function(){var t=this,e={};if(!t.reportRW.codeData||!t.reportRW.codeData.length)throw Error("Report code is invalid or empty. You should use code like: exports.reportCode={ prepareData:function }; ");Function("exports","// "+t.reportCode+"\r\n"+t.reportRW.codeData)(e),e.reportCode&&s.forEach(e.reportCode,function(e,r){t[r]=e})},n.prototype.buildReport=function(t){throw new UB.UBError('Function "buildReport" not defined in report code block')},n.prototype.getDocument=function(t){var e=JSON.parse(this.reportRW[t]),r=[$App.connection.baseURL,"getDocument","?entity=ubs_report&attribute=",t,"&ID=",this.reportRW.ID];return e.store&&r.push("&store=",e.store),e.filename&&r.push("&filename=",e.filename),e.origName&&r.push("&origName=",e.origName),e.isDirty&&r.push("&isDirty=",e.isDirty),this.debug&&r.push("&dtrPrm=",(new Date).getTime()),r=r.join(""),this.reportRW[t+"Url"]=r,$App.connection.get.call($App.connection,r,{responseType:"text"}).then(function(t){return t.data})},window.UBS=window.UBS||{},window.UBS.UBReport=n,t.exports=n}).call(e,r(1))},function(t,e){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e){t.exports=__WEBPACK_EXTERNAL_MODULE_2__},function(t,e,r){r(4),r(5),r(6),r(11),r(0),r(15),r(16)},function(module,exports){Ext.define("UBS.dataBinder",{singleton:!0,applyBinding:function applyBinding(frm){var bindedAttr,bindingObj,bindedProp,preparedList,curParsedExpr,curParsedExprForCheck,formAttrName,formAttr,parseRegexp=/\{((\w+)\.?([\.\w]+)?)\}/gi,callStack=[],prepareOne=function prepareOne(val,fullAttr,firstAttr,thAttr){if(formAttrName="attr"+Ext.String.capitalize(firstAttr),!(formAttr=frm.getUBCmp(formAttrName)))throw Error("unexisted attribute ["+firstAttr+"] in dataBinding for "+bindedAttr+"."+bindedProp);if(preparedList[firstAttr]||(preparedList[firstAttr]={}),preparedList[firstAttr][bindedAttr]||(preparedList[firstAttr][bindedAttr]={}),!preparedList[firstAttr][bindedAttr][bindedProp]){try{eval(curParsedExprForCheck)}catch(t){console.error("INVALID expression in binding: "+bindedAttr+"."+bindedProp+"\n parsed expression: "+curParsedExpr+"\n error: "+t.message)}preparedList[firstAttr][bindedAttr][bindedProp]={method:"set"+Ext.String.capitalize(bindedProp),expr:curParsedExpr,forEval:'this.getUBCmp("attr'+Ext.String.capitalize(bindedAttr)+'").set'+Ext.String.capitalize(bindedProp)+"("+curParsedExpr+")"}}},expressionParser=function t(e,r,n,o){var i="";return i=o?"NOT SUPPORTED YET!":'this.getUBCmp("attr'+Ext.String.capitalize(n)+'").getValue()'},expressionForCheckParser=function t(e,r,n,o){var i="";return i=o?"NOT SUPPORTED YET!":'frm.getUBCmp("attr'+Ext.String.capitalize(n)+'").getValue()'},onBindedAttrChange=function onBindedAttrChange(sender,newVal,oldVal){var dependentAttr,dependentProp,curAttrProps,nVal,stackPos,depList=this.dataBind._preparedList[sender.attributeName];callStack.push(sender.attributeName);for(dependentAttr in depList)if(-1===(stackPos=Ext.Array.indexOf(callStack,dependentAttr))){curAttrProps=depList[dependentAttr];for(dependentProp in curAttrProps)nVal=eval(curAttrProps[dependentProp].expr),this.getUBCmp("attr"+Ext.String.capitalize(dependentAttr))[curAttrProps[dependentProp].method](nVal)}(stackPos=callStack.pop())!==sender.attributeName&&console.error("pop %s but expect %s",stackPos,sender.attributeName)};frm.dataBind._preparedList={},preparedList=frm.dataBind._preparedList;for(bindedAttr in frm.dataBind)if("_"!==bindedAttr[0]){bindingObj=frm.dataBind[bindedAttr];for(bindedProp in bindingObj)curParsedExpr=bindingObj[bindedProp].replace(parseRegexp,expressionParser),curParsedExprForCheck=bindingObj[bindedProp].replace(parseRegexp,expressionForCheckParser),bindingObj[bindedProp].replace(parseRegexp,prepareOne)}for(bindedAttr in preparedList)frm.getUBCmp("attr"+Ext.String.capitalize(bindedAttr)).addListener("change",onBindedAttrChange,frm)}})},function(t,e){Ext.define("UBS.cliUtils",{singleton:!0,atLeastOne:!0,ask:function t(e,r,n){Ext.MessageBox.show({title:e,msg:r,buttons:Ext.MessageBox.OKCANCEL,fn:function t(e){Ext.isFunction(n)?n(e):n&&Ext.isFunction(n.focus)&&setTimeout(function(){n.focus(!0)},500)}})},showMessage:function t(e,r,n){Ext.MessageBox.show({title:e,msg:r,buttons:Ext.Msg.OK,fn:function t(e){Ext.isFunction(n)?n(e):n&&Ext.isFunction(n.focus)&&setTimeout(function(){n.focus(!0)},500)}})},clearDirty:function t(e){for(var r=0,n=e.fields.length;r<n;++r)e.fields[r].resetOriginalValue()},closeForm:function t(e){e&&(e.isDirty()&&this.clearDirty(e),e.up("window").close())},browse:function t(e){var r={entity:e.entityName,cmdType:UB.core.UBCommand.commandType.showList,cmdData:{params:[{entity:e.entityName,method:"select",fieldList:e.fieldList||"*",whereList:e.whereList}]},description:$App.domainInfo.get(e.entityName,!0).getEntityDescription(),isModal:!Ext.isDefined(e.isModal)||e.isModal,onItemSelected:e.onItemselected};UB.core.UBCommand.getCommandByEntityAndType(e.entityName,UB.core.UBCommand.commandType.showList),UB.core.UBApp.doCommand(r)},loadEntityByID:function t(e,r,n,o,i){var a=this,s={ID:{expression:"[ID]",condition:"equal",values:{ID:r}}},u=[{entity:e,requestName:"entityByID",method:"select",fieldList:n||"*",whereList:s}];UB.core.UBDataLoader.loadStoresSimple({ubRequests:u,setStoreId:!0,callback:function t(e){var n=e.entityByID.getAt(0);n?o.call(i,n):a.showMessage("cliUtils.loadEntityByID","Не знайдено запис з кодом "+r)},scope:i})},userIsMemberOf:function t(e,r){var n=UB.core.UBApp.getUserData(),o=n.roles.split(","),i=!0;if(!Ext.isArray(e))return-1!=o.indexOf(e);for(var a=0,s=e.length;a<s;++a)if(i=-1!=o.indexOf(e[a]),r){if(i)break}else if(!i)break;return i}})},function(t,e,r){var n=r(7);"string"==typeof n&&(n=[[t.i,n,""]]);var o,i={};i.transform=void 0;var a=r(9)(n,i);n.locals&&(t.exports=n.locals)},function(t,e,r){e=t.exports=r(8)(void 0),e.push([t.i,".history-message-row-actual {\r\n    color: #2a36d3\r\n;\r\n}\r\n\r\n.history-message-cell-accept {\r\n    /*border-left-style: solid;\r\n    border-left-color: #0000C0;\r\n    border-left-width: 3px;*/\r\n    width:  5px;\r\n    background-color: #0000C0;\r\n}\r\n\r\n@keyframes blink-red {\r\n    0% { color: red; }\r\n    50% { color: rgba(255, 255, 255, 0.870588); }\r\n    100% { color: red; }\r\n}\r\n\r\n.message-menu-exists .x-btn-icon-el {\r\n    color: #ff4081 !important;\r\n    animation: blink-red 3s linear infinite;\r\n}\r\n\r\n.history-message-msg-div {\r\n    max-height: 150px;\r\n    overflow-y: hidden;\r\n}\r\n\r\n\r\n\r\n",""])},function(t,e){function r(t,e){var r=t[1]||"",o=t[3];if(!o)return r;if(e&&"function"==typeof btoa){var i=n(o);return[r].concat(o.sources.map(function(t){return"/*# sourceURL="+o.sourceRoot+t+" */"})).concat([i]).join("\n")}return""+r}function n(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}t.exports=function(t){var e=[];return e.toString=function e(){return this.map(function(e){var n=r(e,t);return e[2]?"@media "+e[2]+"{"+n+"}":n}).join("")},e.i=function(t,r){"string"==typeof t&&(t=[[null,t,""]]);for(var n={},o=0;o<this.length;o++){var i=this[o][0];"number"==typeof i&&(n[i]=!0)}for(o=0;o<t.length;o++){var a=t[o];"number"==typeof a[0]&&n[a[0]]||(r&&!a[2]?a[2]=r:r&&(a[2]="("+a[2]+") and ("+r+")"),e.push(a))}},e}},function(t,e,r){function n(t,e){for(var r=0;r<t.length;r++){var n=t[r],o=m[n.id];if(o){o.refs++;for(var i=0;i<o.parts.length;i++)o.parts[i](n.parts[i]);for(;i<n.parts.length;i++)o.parts.push(c(n.parts[i],e))}else{for(var a=[],i=0;i<n.parts.length;i++)a.push(c(n.parts[i],e));m[n.id]={id:n.id,refs:1,parts:a}}}}function o(t,e){for(var r=[],n={},o=0;o<t.length;o++){var i=t[o],a=e.base?i[0]+e.base:i[0],s=i[1],u=i[2],p=i[3],c={css:s,media:u,sourceMap:p};n[a]?n[a].parts.push(c):r.push(n[a]={id:a,parts:[c]})}return r}function i(t,e){var r=y(t.insertInto);if(!r)throw Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var n=x[x.length-1];if("top"===t.insertAt)n?n.nextSibling?r.insertBefore(e,n.nextSibling):r.appendChild(e):r.insertBefore(e,r.firstChild),x.push(e);else{if("bottom"!==t.insertAt)throw Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");r.appendChild(e)}}function a(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=x.indexOf(t);e>=0&&x.splice(e,1)}function s(t){var e=document.createElement("style");return t.attrs.type="text/css",p(e,t.attrs),i(t,e),e}function u(t){var e=document.createElement("link");return t.attrs.type="text/css",t.attrs.rel="stylesheet",p(e,t.attrs),i(t,e),e}function p(t,e){Object.keys(e).forEach(function(r){t.setAttribute(r,e[r])})}function c(t,e){var r,n,o,i;if(e.transform&&t.css){if(!(i=e.transform(t.css)))return function(){};t.css=i}if(e.singleton){var p=v++;r=b||(b=s(e)),n=d.bind(null,r,p,!1),o=d.bind(null,r,p,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(r=u(e),n=f.bind(null,r,e),o=function(){a(r),r.href&&URL.revokeObjectURL(r.href)}):(r=s(e),n=l.bind(null,r),o=function(){a(r)});return n(t),function e(r){if(r){if(r.css===t.css&&r.media===t.media&&r.sourceMap===t.sourceMap)return;n(t=r)}else o()}}function d(t,e,r,n){var o=r?"":n.css;if(t.styleSheet)t.styleSheet.cssText=E(e,o);else{var i=document.createTextNode(o),a=t.childNodes;a[e]&&t.removeChild(a[e]),a.length?t.insertBefore(i,a[e]):t.appendChild(i)}}function l(t,e){var r=e.css,n=e.media;if(n&&t.setAttribute("media",n),t.styleSheet)t.styleSheet.cssText=r;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(r))}}function f(t,e,r){var n=r.css,o=r.sourceMap,i=void 0===e.convertToAbsoluteUrls&&o;(e.convertToAbsoluteUrls||i)&&(n=w(n)),o&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */");var a=new Blob([n],{type:"text/css"}),s=t.href;t.href=URL.createObjectURL(a),s&&URL.revokeObjectURL(s)}var m={},h=function(t){var e;return function(){return void 0===e&&(e=t.apply(this,arguments)),e}},g=h(function(){return window&&document&&document.all&&!window.atob}),y=function(t){var e={};return function(r){return void 0===e[r]&&(e[r]=t.call(this,r)),e[r]}}(function(t){return document.querySelector(t)}),b=null,v=0,x=[],w=r(10);t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw Error("The style-loader cannot be used in a non-browser environment");e=e||{},e.attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||(e.singleton=g()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var r=o(t,e);return n(r,e),function t(i){for(var a=[],s=0;s<r.length;s++){var u=r[s],p=m[u.id];p.refs--,a.push(p)}if(i){n(o(i,e),e)}for(var s=0;s<a.length;s++){var p=a[s];if(0===p.refs){for(var c=0;c<p.parts.length;c++)p.parts[c]();delete m[p.id]}}}};var E=function(){var t=[];return function(e,r){return t[e]=r,t.filter(Boolean).join("\n")}}()},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var r=e.protocol+"//"+e.host,n=r+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,function(t,e){var o=e.trim().replace(/^"(.*)"$/,function(t,e){return e}).replace(/^'(.*)'$/,function(t,e){return e});if(/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/)/i.test(o))return t;var i;return i=0===o.indexOf("//")?o:0===o.indexOf("/")?r+o:n+o.replace(/^\.\//,""),"url("+JSON.stringify(i)+")"})}},function(t,e){UB.ns("UBS.Settings"),function(){var t={};UB.Repository("ubs_settings").attrs(["ID","settingKey","name","description","type","settingValue","defaultValue"]).selectAsObject().done(function(e){t=e,UBS.Settings.findByKey=function(e){var r=_.find(t,{settingKey:e});return void 0===r&&UB.logDebug("value fom UBS.Settings["+e+"] not found"),r}})}()},function(t,e,r){var n,o,i;!function r(a,s){"object"==typeof e&&e&&"string"!=typeof e.nodeName?s(e):(o=[e],n=s,void 0!==(i="function"==typeof n?n.apply(e,o):n)&&(t.exports=i))}(this,function t(e){function r(t){return"function"==typeof t}function n(t){return g(t)?"array":typeof t}function o(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function i(t,e){return null!=t&&"object"==typeof t&&e in t}function a(t,e){return y.call(t,e)}function s(t){return!a(b,t)}function u(t){return(t+"").replace(/[&<>"'`=\/]/g,function t(e){return v[e]})}function p(t,r){function n(){if(f&&!m)for(;p.length;)delete u[p.pop()];else p=[];f=!1,m=!1}function i(t){if("string"==typeof t&&(t=t.split(w,2)),!g(t)||2!==t.length)throw Error("Invalid tags: "+t);h=RegExp(o(t[0])+"\\s*"),y=RegExp("\\s*"+o(t[1])),b=RegExp("\\s*"+o("}"+t[1]))}if(!t)return[];var a=[],u=[],p=[],f=!1,m=!1,h,y,b;i(r||e.tags);for(var v=new l(t),B,D,C,P,A,R;!v.eos();){if(B=v.pos,C=v.scanUntil(h))for(var k=0,T=C.length;k<T;++k)P=C.charAt(k),s(P)?p.push(u.length):m=!0,u.push(["text",P,B,B+1]),B+=1,"\n"===P&&n();if(!v.scan(h))break;if(f=!0,D=v.scan(U)||"name",v.scan(x),"="===D?(C=v.scanUntil(E),v.scan(E),v.scanUntil(y)):"{"===D?(C=v.scanUntil(b),v.scan(S),v.scanUntil(y),D="&"):C=v.scanUntil(y),!v.scan(y))throw Error("Unclosed tag at "+v.pos);if(A=[D,C,B,v.pos],u.push(A),"#"===D||"^"===D)a.push(A);else if("/"===D){if(!(R=a.pop()))throw Error('Unopened section "'+C+'" at '+B);if(R[1]!==C)throw Error('Unclosed section "'+R[1]+'" at '+B)}else"name"===D||"{"===D||"&"===D?m=!0:"="===D&&i(C)}if(R=a.pop())throw Error('Unclosed section "'+R[1]+'" at '+v.pos);return d(c(u))}function c(t){for(var e=[],r,n,o=0,i=t.length;o<i;++o)(r=t[o])&&("text"===r[0]&&n&&"text"===n[0]?(n[1]+=r[1],n[3]=r[3]):(e.push(r),n=r));return e}function d(t){for(var e=[],r=e,n=[],o,i,a=0,s=t.length;a<s;++a)switch(o=t[a],o[0]){case"#":case"^":r.push(o),n.push(o),r=o[4]=[];break;case"/":i=n.pop(),i[5]=o[2],r=n.length>0?n[n.length-1][4]:e;break;default:r.push(o)}return e}function l(t){this.string=t,this.tail=t,this.pos=0}function f(t,e){this.view=t,this.cache={".":this.view},this.parent=e}function m(){this.cache={}}var h=Object.prototype.toString,g=Array.isArray||function t(e){return"[object Array]"===h.call(e)},y=RegExp.prototype.test,b=/\S/,v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"},x=/\s*/,w=/\s+/,E=/\s*=/,S=/\s*\}/,U=/#|\^|\/|>|\{|&|=|!/;l.prototype.eos=function t(){return""===this.tail},l.prototype.scan=function t(e){var r=this.tail.match(e);if(!r||0!==r.index)return"";var n=r[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n},l.prototype.scanUntil=function t(e){var r=this.tail.search(e),n;switch(r){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,r),this.tail=this.tail.substring(r)}return this.pos+=n.length,n},f.prototype.push=function t(e){return new f(e,this)},f.prototype.lookup=function t(e){var n=this.cache,o;if(n.hasOwnProperty(e))o=n[e];else{for(var a=this,s,u,p=!1;a;){if(e.indexOf(".")>0)for(o=a.view,s=e.split("."),u=0;null!=o&&u<s.length;)u===s.length-1&&(p=i(o,s[u])),o=o[s[u++]];else o=a.view[e],p=i(a.view,e);if(p)break;a=a.parent}n[e]=o}return r(o)&&(o=o.call(this.view)),o},m.prototype.clearCache=function t(){this.cache={}},m.prototype.parse=function t(e,r){var n=this.cache,o=n[e];return null==o&&(o=n[e]=p(e,r)),o},m.prototype.render=function t(e,r,n){var o=this.parse(e),i=r instanceof f?r:new f(r);return this.renderTokens(o,i,n,e)},m.prototype.renderTokens=function t(e,r,n,o){for(var i="",a,s,u,p=0,c=e.length;p<c;++p)u=void 0,a=e[p],s=a[0],"#"===s?u=this.renderSection(a,r,n,o):"^"===s?u=this.renderInverted(a,r,n,o):">"===s?u=this.renderPartial(a,r,n,o):"&"===s?u=this.unescapedValue(a,r):"name"===s?u=this.escapedValue(a,r):"text"===s&&(u=this.rawValue(a)),void 0!==u&&(i+=u);return i},m.prototype.renderSection=function t(e,n,o,i){function a(t){return s.render(t,n,o)}var s=this,u="",p=n.lookup(e[1]);if(p){if(g(p))for(var c=0,d=p.length;c<d;++c)u+=this.renderTokens(e[4],n.push(p[c]),o,i);else if("object"==typeof p||"string"==typeof p||"number"==typeof p)u+=this.renderTokens(e[4],n.push(p),o,i);else if(r(p)){if("string"!=typeof i)throw Error("Cannot use higher-order sections without the original template");p=p.call(n.view,i.slice(e[3],e[5]),a),null!=p&&(u+=p)}else u+=this.renderTokens(e[4],n,o,i);return u}},m.prototype.renderInverted=function t(e,r,n,o){var i=r.lookup(e[1]);if(!i||g(i)&&0===i.length)return this.renderTokens(e[4],r,n,o)},m.prototype.renderPartial=function t(e,n,o){if(o){var i=r(o)?o(e[1]):o[e[1]];return null!=i?this.renderTokens(this.parse(i),n,o,i):void 0}},m.prototype.unescapedValue=function t(e,r){var n=r.lookup(e[1]);if(null!=n)return n},m.prototype.escapedValue=function t(r,n){var o=n.lookup(r[1]);if(null!=o)return e.escape(o)},m.prototype.rawValue=function t(e){return e[1]},e.name="mustache.js",e.version="2.3.0",e.tags=["{{","}}"];var B=new m;return e.clearCache=function t(){return B.clearCache()},e.parse=function t(e,r){return B.parse(e,r)},e.render=function t(e,r,o){if("string"!=typeof e)throw new TypeError('Invalid template! Template should be a "string" but "'+n(e)+'" was given as the first argument for mustache#render(template, view, partials)');return B.render(e,r,o)},e.to_html=function t(n,o,i,a){var s=e.render(n,o,i);if(!r(a))return s;a(s)},e.escape=u,e.Scanner=l,e.Context=f,e.Writer=m,e})},function(t,e,r){function n(t,e){var r=t;return e.split(".").forEach(function(t){if(!r)throw Error("Invalid property "+t);r=r[t]}),r}function o(t,e,r){return function(o,i){var a=this,u=i(o);if(!u)return u;var p=JSON.parse("["+u+"]");if(p<1)throw Error('$format function require one or two parameter. {{#$f}}"amount"{{/f}} {{#$f}}"amount","sum"{{/f}} ');var c=n(a,p[0]);return r&&void 0!==c&&null!==c&&("number"===r?c=+c:"date"!==r||c instanceof Date||(c=new Date(c))),"number"==typeof c?s.formatNumber(c,p.length>1?p[1]:e||"sum",t):c&&c instanceof Date?s.formatDate(c,p.length>1?p[1]:e||"date",t):c+""}}function i(t){var e=void 0;t.i18n=function(){return UB.isServer?function(t){return UB.i18n(t,void 0)}:UB.i18n}}function a(t,e){e=e||"en",t.$f=t.$$f=function(){return o(e)},t.$fn=t.$$fn=function(){return o(e,"number","number")},t.$fs=t.$$fs=function(){return o(e,"sum","number")},t.crn=function(){return o(e,"sum","number")},t.$fd=t.$$fd=function(){return o(e,"date","date")},t.$ft=t.$$ft=function(){return o(e,"time","date")},t.$fdt=t.$$fdt=function(){return o(e,"time","date")}}var s=r(14);t.exports={addBaseMustacheSysFunction:i,addMustacheSysFunction:a}},function(t,e){function r(t,e,r){if(t){if(!(t instanceof Date))throw Error("Value must be Date");var n=(r||"en").toLowerCase(),i=n+"-"+n.toUpperCase(),a=o[e];if(!a)throw Error("Unknown date pattern "+e);return t.toLocaleDateString(i,a)}}function n(t,e,r){if(t||0===t){if("number"!=typeof t)throw Error("Value must be Number");if(Number.isNaN(t))return"NaN";var n=(r||"en").toLowerCase(),o=n+"-"+n.toUpperCase(),a=i[e];if(!a)throw Error("Unknown number pattern "+e);return t.toLocaleString(o,a)}}var o={date:{month:"2-digit",day:"2-digit",year:"numeric"},dateFull:{month:"2-digit",day:"2-digit",year:"2-digit"},dateShort:{month:"2-digit",year:"2-digit"},dateFullLong:{month:"long",day:"2-digit",year:"2-digit"},dateMYY:{month:"2-digit",year:"numeric"},dateMYLong:{month:"long",year:"numeric"},time:{hour:"2-digit",minute:"2-digit"},timeFull:{hour:"2-digit",minute:"2-digit",second:"2-digit"},dateTime:{month:"2-digit",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"},dateTimeFull:{month:"2-digit",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}},i={sum:{style:"decimal",useGrouping:!1,maximumFractionDigits:2,minimumFractionDigits:2},numberGroup:{style:"decimal",useGrouping:!0,maximumFractionDigits:0},sumDelim:{style:"decimal",useGrouping:!0,maximumFractionDigits:2,minimumFractionDigits:2},number:{style:"decimal",useGrouping:!1,maximumFractionDigits:0},decimal1:{style:"decimal",useGrouping:!0,maximumFractionDigits:1,minimumFractionDigits:1},decimal2:{style:"decimal",useGrouping:!0,maximumFractionDigits:2,minimumFractionDigits:2},decimal3:{style:"decimal",useGrouping:!0,maximumFractionDigits:3,minimumFractionDigits:3},decimal4:{style:"decimal",useGrouping:!0,maximumFractionDigits:4,minimumFractionDigits:4},decimal5:{style:"decimal",useGrouping:!0,maximumFractionDigits:5,minimumFractionDigits:5},decimal6:{style:"decimal",useGrouping:!0,maximumFractionDigits:6,minimumFractionDigits:6}};t.exports={formatDate:r,formatNumber:n,datePatterns:Object.keys(o),numberPatterns:Object.keys(i)}},function(t,e){Ext.define("UBS.ReportParamForm",{extend:"Ext.form.Panel",layout:{type:"vbox",align:"stretch"},padding:"2 4",initComponent:function t(){var e=this;e.buttons=[{text:UB.i18n("BuildReport"),handler:function t(){var r,n,o;n=e.up("form"),o=n.isValid(),e.validateForm&&(o=e.validateForm()),o&&(e.getParameters&&(r=e.getParameters(e)),e.fireEvent("buildReport",r,e))}}],e.addEvents("buildReport"),e.callParent(arguments)}})},function(t,e,r){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};r(0),Ext.define("UBS.ReportViewer",{extend:"Ext.form.Panel",requires:["UBS.UBReport","UB.ux.PDFComponent","UB.ux.UBTinyMCETextArea"],layout:{type:"vbox",align:"stretch"},width:700,height:500,initComponent:function t(){var e=this,r,n;if(e.report&&!e.reportType&&(e.reportType=e.report.reportType),!e.reportType)throw Error("config parameter reportType is undefined");switch(e.reportType){case"pdf":n=r=Ext.create("UB.ux.PDFComponent",{flex:1});break;case"html":n=Ext.create("UB.ux.UBTinyMCETextArea",{readOnly:!0,hidden:!0,flex:1,tinyMCEConfig:{menubar:!1,contextmenu:!1,toolbar:!1,toolbar1:!1,extended_valid_elements:"a[name|href|target|title|onclick]"}}),r=Ext.create("Ext.panel.Panel",{layout:{type:"vbox",align:"stretch"},flex:1,items:[{flex:1,autoScroll:!0,layout:{type:"hbox",pack:"center",align:"stretch"},bodyCls:"ub-panel-gray",items:[n]},{padding:"3 0 3 0",layout:{type:"hbox"},items:[{flex:1},{xtype:"button",ui:"default-toolbar",text:UB.i18n("Print"),handler:function t(){n.getEditor().getWin().print()}}]}]}),n.on("setup",function(t){t.on("init",function(){t.dom.loadCSS("/models/adminui-pub/css/print-report.css")})},e,{single:!0});break;default:throw Error("Unknown value "+e.reportType+" for reportType.")}e.items=[r],e.reportControl=n,e.report.init().then(function(){if(e.report.onParamPanelConfig){var t=e.report.onParamPanelConfig();return t&&e.addParamForm(t),!0}return!1}).then(function(t){return!t&&e.report.makeReport()}).done(function(t){t&&t.reportData&&e.showReport(t.reportData),e.getEl()&&e.getEl().unmask(),e.reportDone=!0}),e.callParent(arguments)},addParamForm:function t(e){var r=this,n;e instanceof Array&&(n=e,e=Ext.create("UBS.ReportParamForm",{items:e,getParameters:function t(e){var r={},o=e.getForm();return _.forEach(n,function(t){r[t.name]=o.findField(t.name).getValue()}),r}})),r.insert(0,e),e.on("buildReport",function(t,e){r.getEl().mask(UB.i18n("pleaseWait")),r.report.makeReport(t).done(function(t){r.showReport(t.reportData)})})},showReport:function t(e){var r=this,o;switch(r.reportType){case"pdf":if("string"==typeof e){var i=e.length,a=new Uint8Array(new ArrayBuffer(i));for(o=0;o<i;o++)a[o]=e.charCodeAt(o);e=new Blob([a],{type:"application/pdf"})}else"object"===(void 0===e?"undefined":n(e))&&e instanceof ArrayBuffer&&(e=new Blob([e],{type:"application/pdf"}));r.reportControl.setSrc({blobData:e});break;case"html":r.reportControl.show(),r.reportControl.setValue(e);var s=r.reportControl.getEditor();s&&s.dom?"landscape"===r.reportControl.orientation?s.dom.loadCSS("/models/adminui-pub/css/print-landscape.css"):s.dom.loadCSS("/models/adminui-pub/css/print-portrait.css"):r.reportControl.on("setup",function(t){t.on("init",function(){"landscape"===r.reportControl.orientation?t.dom.loadCSS("/models/adminui-pub/css/print-landscape.css"):t.dom.loadCSS("/models/adminui-pub/css/print-portrait.css")})},r,{single:!0})}r.getEl()&&r.getEl().unmask()},afterRender:function t(){this.callParent(),this.reportDone||this.getEl().mask(UB.i18n("pleaseWait"))}})}])});