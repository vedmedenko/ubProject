!function(e){function t(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n=window.webpackJsonp;window.webpackJsonp=function t(i,o,a){for(var s,l,u=0,c=[],d;u<i.length;u++)l=i[u],r[l]&&c.push(r[l][0]),r[l]=0;for(s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s]);for(n&&n(i,o,a);c.length;)c.shift()()};var i={},r={5:0};t.e=function e(n){function i(){l.onerror=l.onload=null,clearTimeout(u);var e=r[n];0!==e&&(e&&e[1](Error("Loading chunk "+n+" failed.")),r[n]=void 0)}var o=r[n];if(0===o)return new Promise(function(e){e()});if(o)return o[2];var a=new Promise(function(e,t){o=r[n]=[e,t]});o[2]=a;var s=document.getElementsByTagName("head")[0],l=document.createElement("script");l.type="text/javascript",l.charset="utf-8",l.async=!0,l.timeout=12e4,t.nc&&l.setAttribute("nonce",t.nc),l.src=t.p+"adminui."+n+".min.js";var u=setTimeout(i,12e4);return l.onerror=l.onload=i,s.appendChild(l),a},t.m=e,t.c=i,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:i})},t.n=function(e){var n=e&&e.__esModule?function t(){return e.default}:function t(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="/clientRequire/@unitybase/adminui-pub/dist/",t.oe=function(e){throw console.error(e),e},t(t.s=50)}([function(e,t,n){"use strict";(function(t,i){function r(){try{var e=D;return D=null,e.apply(this,arguments)}catch(e){return k.e=e,k}}function o(e){return D=e,r}function a(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function s(e){return"function"==typeof e||"object"==typeof e&&null!==e}function l(e){return a(e)?Error(y(e)):e}function u(e,t){var n=e.length,i=Array(n+1),r;for(r=0;r<n;++r)i[r]=e[r];return i[r]=t,i}function c(e,t,n){if(!I.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var i=Object.getOwnPropertyDescriptor(e,t);return null!=i?null==i.get&&null==i.set?i.value:n:void 0}function d(e,t,n){if(a(e))return e;var i={value:n,configurable:!0,enumerable:!1,writable:!0};return I.defineProperty(e,t,i),e}function f(e){throw e}function h(e){try{if("function"==typeof e){var t=I.names(e.prototype),n=I.isES5&&t.length>1,i=t.length>0&&!(1===t.length&&"constructor"===t[0]),r=F.test(e+"")&&I.names(e).length>0;if(n||i||r)return!0}return!1}catch(e){return!1}}function p(e){function t(){}t.prototype=e;for(var n=8;n--;)new t;return e}function m(e){return L.test(e)}function g(e,t,n){for(var i=Array(e),r=0;r<e;++r)i[r]=t+r+n;return i}function y(e){try{return e+""}catch(e){return"[no string representation]"}}function v(e){return null!==e&&"object"==typeof e&&"string"==typeof e.message&&"string"==typeof e.name}function b(e){try{d(e,"isOperational",!0)}catch(e){}}function x(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)}function E(e){return v(e)&&I.propertyIsWritable(e,"stack")}function w(e){return{}.toString.call(e)}function C(e,t,n){for(var i=I.names(e),r=0;r<i.length;++r){var o=i[r];if(n(o))try{I.defineProperty(t,o,I.getDescriptor(e,o))}catch(e){}}}function _(e){return j?i.env[e]:void 0}function B(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}}function U(e,t){return e.bind(t)}var I=n(8),S="undefined"==typeof navigator,k={e:{}},D,A="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:void 0!==this?this:null,T=function(e,t){function n(){this.constructor=e,this.constructor$=t;for(var n in t.prototype)i.call(t.prototype,n)&&"$"!==n.charAt(n.length-1)&&(this[n+"$"]=t.prototype[n])}var i={}.hasOwnProperty;return n.prototype=t.prototype,e.prototype=new n,e.prototype},P=function(){var e=[Array.prototype,Object.prototype,Function.prototype],t=function(t){for(var n=0;n<e.length;++n)if(e[n]===t)return!0;return!1};if(I.isES5){var n=Object.getOwnPropertyNames;return function(e){for(var i=[],r=Object.create(null);null!=e&&!t(e);){var o;try{o=n(e)}catch(e){return i}for(var a=0;a<o.length;++a){var s=o[a];if(!r[s]){r[s]=!0;var l=Object.getOwnPropertyDescriptor(e,s);null!=l&&null==l.get&&null==l.set&&i.push(s)}}e=I.getPrototypeOf(e)}return i}}var i={}.hasOwnProperty;return function(n){if(t(n))return[];var r=[];e:for(var o in n)if(i.call(n,o))r.push(o);else{for(var a=0;a<e.length;++a)if(i.call(e[a],o))continue e;r.push(o)}return r}}(),F=/this\s*\.\s*\S+\s*=/,L=/^[a-z$_][a-z$_0-9]*$/i,M=function(){return"stack"in Error()?function(e){return E(e)?e:Error(y(e))}:function(e){if(E(e))return e;try{throw Error(y(e))}catch(e){return e}}}(),R=function(e){return I.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var O="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t=[],n=e[Symbol.iterator](),i;!(i=n.next()).done;)t.push(i.value);return t};R=function(e){return I.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?O(e):null}}var N=void 0!==i&&"[object process]"===w(i).toLowerCase(),j=void 0!==i&&void 0!==i.env,V={isClass:h,isIdentifier:m,inheritedDataKeys:P,getDataPropertyOrDefault:c,thrower:f,isArray:I.isArray,asArray:R,notEnumerableProp:d,isPrimitive:a,isObject:s,isError:v,canEvaluate:S,errorObj:k,tryCatch:o,inherits:T,withAppended:u,maybeWrapAsError:l,toFastProperties:p,filledRange:g,toString:y,canAttachTrace:E,ensureErrorObject:M,originatesFromRejection:x,markAsOriginatingFromRejection:b,classString:w,copyDescriptors:C,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:N,hasEnvVariables:j,env:_,global:A,getNativePromise:B,domainBind:U};V.isRecentNode=V.isNode&&function(){var e=i.versions.node.split(".").map(Number);return 0===e[0]&&e[1]>10||e[0]>0}(),V.isNode&&V.toFastProperties(i);try{throw Error()}catch(e){V.lastLineError=e}e.exports=V}).call(t,n(7),n(5))},function(e,t,n){(function(e,i){var r;(function(){function o(e,t){return e.set(t[0],t[1]),e}function a(e,t){return e.add(t),e}function s(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function l(e,t,n,i){for(var r=-1,o=null==e?0:e.length;++r<o;){var a=e[r];t(i,a,n(a),e)}return i}function u(e,t){for(var n=-1,i=null==e?0:e.length;++n<i&&!1!==t(e[n],n,e););return e}function c(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function d(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(!t(e[n],n,e))return!1;return!0}function f(e,t){for(var n=-1,i=null==e?0:e.length,r=0,o=[];++n<i;){var a=e[n];t(a,n,e)&&(o[r++]=a)}return o}function h(e,t){return!!(null==e?0:e.length)&&_(e,t,0)>-1}function p(e,t,n){for(var i=-1,r=null==e?0:e.length;++i<r;)if(n(t,e[i]))return!0;return!1}function m(e,t){for(var n=-1,i=null==e?0:e.length,r=Array(i);++n<i;)r[n]=t(e[n],n,e);return r}function g(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}function y(e,t,n,i){var r=-1,o=null==e?0:e.length;for(i&&o&&(n=e[++r]);++r<o;)n=t(n,e[r],r,e);return n}function v(e,t,n,i){var r=null==e?0:e.length;for(i&&r&&(n=e[--r]);r--;)n=t(n,e[r],r,e);return n}function b(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}function x(e){return e.split("")}function E(e){return e.match(Wt)||[]}function w(e,t,n){var i;return n(e,function(e,n,r){if(t(e,n,r))return i=n,!1}),i}function C(e,t,n,i){for(var r=e.length,o=n+(i?1:-1);i?o--:++o<r;)if(t(e[o],o,e))return o;return-1}function _(e,t,n){return t===t?Q(e,t,n):C(e,U,n)}function B(e,t,n,i){for(var r=n-1,o=e.length;++r<o;)if(i(e[r],t))return r;return-1}function U(e){return e!==e}function I(e,t){var n=null==e?0:e.length;return n?T(e,t)/n:Re}function S(e){return function(t){return null==t?re:t[e]}}function k(e){return function(t){return null==e?re:e[t]}}function D(e,t,n,i,r){return r(e,function(e,r,o){n=i?(i=!1,e):t(n,e,r,o)}),n}function A(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}function T(e,t){for(var n,i=-1,r=e.length;++i<r;){var o=t(e[i]);o!==re&&(n=n===re?o:n+o)}return n}function P(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}function F(e,t){return m(t,function(t){return[t,e[t]]})}function L(e){return function(t){return e(t)}}function M(e,t){return m(t,function(t){return e[t]})}function R(e,t){return e.has(t)}function O(e,t){for(var n=-1,i=e.length;++n<i&&_(t,e[n],0)>-1;);return n}function N(e,t){for(var n=e.length;n--&&_(t,e[n],0)>-1;);return n}function j(e,t){for(var n=e.length,i=0;n--;)e[n]===t&&++i;return i}function V(e){return"\\"+ni[e]}function z(e,t){return null==e?re:e[t]}function W(e){return $n.test(e)}function q(e){return Kn.test(e)}function H(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}function G(e){var t=-1,n=Array(e.size);return e.forEach(function(e,i){n[++t]=[i,e]}),n}function $(e,t){return function(n){return e(t(n))}}function K(e,t){for(var n=-1,i=e.length,r=0,o=[];++n<i;){var a=e[n];a!==t&&a!==de||(e[n]=de,o[r++]=n)}return o}function Y(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}function X(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=[e,e]}),n}function Q(e,t,n){for(var i=n-1,r=e.length;++i<r;)if(e[i]===t)return i;return-1}function Z(e,t,n){for(var i=n+1;i--;)if(e[i]===t)return i;return i}function J(e){return W(e)?te(e):bi(e)}function ee(e){return W(e)?ne(e):x(e)}function te(e){for(var t=Hn.lastIndex=0;Hn.test(e);)++t;return t}function ne(e){return e.match(Hn)||[]}function ie(e){return e.match(Gn)||[]}var re,oe="4.17.4",ae=200,se="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",le="Expected a function",ue="__lodash_hash_undefined__",ce=500,de="__lodash_placeholder__",fe=1,he=2,pe=4,me=1,ge=2,ye=1,ve=2,be=4,xe=8,Ee=16,we=32,Ce=64,_e=128,Be=256,Ue=512,Ie=30,Se="...",ke=800,De=16,Ae=1,Te=2,Pe=3,Fe=1/0,Le=9007199254740991,Me=1.7976931348623157e308,Re=NaN,Oe=4294967295,Ne=Oe-1,je=Oe>>>1,Ve=[["ary",_e],["bind",ye],["bindKey",ve],["curry",xe],["curryRight",Ee],["flip",Ue],["partial",we],["partialRight",Ce],["rearg",Be]],ze="[object Arguments]",We="[object Array]",qe="[object AsyncFunction]",He="[object Boolean]",Ge="[object Date]",$e="[object DOMException]",Ke="[object Error]",Ye="[object Function]",Xe="[object GeneratorFunction]",Qe="[object Map]",Ze="[object Number]",Je="[object Null]",et="[object Object]",tt="[object Promise]",nt="[object Proxy]",it="[object RegExp]",rt="[object Set]",ot="[object String]",at="[object Symbol]",st="[object Undefined]",lt="[object WeakMap]",ut="[object WeakSet]",ct="[object ArrayBuffer]",dt="[object DataView]",ft="[object Float32Array]",ht="[object Float64Array]",pt="[object Int8Array]",mt="[object Int16Array]",gt="[object Int32Array]",yt="[object Uint8Array]",vt="[object Uint8ClampedArray]",bt="[object Uint16Array]",xt="[object Uint32Array]",Et=/\b__p \+= '';/g,wt=/\b(__p \+=) '' \+/g,Ct=/(__e\(.*?\)|\b__t\)) \+\n'';/g,_t=/&(?:amp|lt|gt|quot|#39);/g,Bt=/[&<>"']/g,Ut=RegExp(_t.source),It=RegExp(Bt.source),St=/<%-([\s\S]+?)%>/g,kt=/<%([\s\S]+?)%>/g,Dt=/<%=([\s\S]+?)%>/g,At=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Tt=/^\w*$/,Pt=/^\./,Ft=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Lt=/[\\^$.*+?()[\]{}|]/g,Mt=RegExp(Lt.source),Rt=/^\s+|\s+$/g,Ot=/^\s+/,Nt=/\s+$/,jt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Vt=/\{\n\/\* \[wrapped with (.+)\] \*/,zt=/,? & /,Wt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,qt=/\\(\\)?/g,Ht=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Gt=/\w*$/,$t=/^[-+]0x[0-9a-f]+$/i,Kt=/^0b[01]+$/i,Yt=/^\[object .+?Constructor\]$/,Xt=/^0o[0-7]+$/i,Qt=/^(?:0|[1-9]\d*)$/,Zt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Jt=/($^)/,en=/['\n\r\u2028\u2029\\]/g,tn="\\ud800-\\udfff",nn="\\u0300-\\u036f",rn="\\ufe20-\\ufe2f",on="\\u20d0-\\u20ff",an="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",sn="\\u2700-\\u27bf",ln="a-z\\xdf-\\xf6\\xf8-\\xff",un="\\xac\\xb1\\xd7\\xf7",cn="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",dn="\\u2000-\\u206f",fn=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",hn="A-Z\\xc0-\\xd6\\xd8-\\xde",pn="\\ufe0e\\ufe0f",mn=un+cn+"\\u2000-\\u206f"+fn,gn="['\u2019]",yn="[\\ud800-\\udfff]",vn="["+mn+"]",bn="["+an+"]",xn="\\d+",En="[\\u2700-\\u27bf]",wn="["+ln+"]",Cn="[^"+tn+mn+"\\d+"+sn+ln+hn+"]",_n="\\ud83c[\\udffb-\\udfff]",Bn="(?:"+bn+"|"+_n+")",Un="[^\\ud800-\\udfff]",In="(?:\\ud83c[\\udde6-\\uddff]){2}",Sn="[\\ud800-\\udbff][\\udc00-\\udfff]",kn="["+hn+"]",Dn="\\u200d",An="(?:"+wn+"|"+Cn+")",Tn="(?:"+kn+"|"+Cn+")",Pn="(?:['\u2019](?:d|ll|m|re|s|t|ve))?",Fn="(?:['\u2019](?:D|LL|M|RE|S|T|VE))?",Ln=Bn+"?",Mn="[\\ufe0e\\ufe0f]?",Rn="(?:\\u200d(?:[^\\ud800-\\udfff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])"+Mn+Ln+")*",On="\\d*(?:(?:1st|2nd|3rd|(?![123])\\dth)\\b)",Nn="\\d*(?:(?:1ST|2ND|3RD|(?![123])\\dTH)\\b)",jn=Mn+Ln+Rn,Vn="(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])"+jn,zn="(?:[^\\ud800-\\udfff][\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]?|[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff]|[\\ud800-\\udfff])",Wn=RegExp("['\u2019]","g"),qn=RegExp(bn,"g"),Hn=RegExp(_n+"(?="+_n+")|"+zn+jn,"g"),Gn=RegExp("[A-Z\\xc0-\\xd6\\xd8-\\xde]?[a-z\\xdf-\\xf6\\xf8-\\xff]+(?:['\u2019](?:d|ll|m|re|s|t|ve))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde]|$)|(?:[A-Z\\xc0-\\xd6\\xd8-\\xde]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['\u2019](?:D|LL|M|RE|S|T|VE))?(?=[\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000]|[A-Z\\xc0-\\xd6\\xd8-\\xde](?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])|$)|[A-Z\\xc0-\\xd6\\xd8-\\xde]?(?:[a-z\\xdf-\\xf6\\xf8-\\xff]|[^\\ud800-\\udfff\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000\\d+\\u2700-\\u27bfa-z\\xdf-\\xf6\\xf8-\\xffA-Z\\xc0-\\xd6\\xd8-\\xde])+(?:['\u2019](?:d|ll|m|re|s|t|ve))?|[A-Z\\xc0-\\xd6\\xd8-\\xde]+(?:['\u2019](?:D|LL|M|RE|S|T|VE))?|\\d*(?:(?:1ST|2ND|3RD|(?![123])\\dTH)\\b)|\\d*(?:(?:1st|2nd|3rd|(?![123])\\dth)\\b)|\\d+|(?:[\\u2700-\\u27bf]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?(?:\\u200d(?:[^\\ud800-\\udfff]|(?:\\ud83c[\\udde6-\\uddff]){2}|[\\ud800-\\udbff][\\udc00-\\udfff])[\\ufe0e\\ufe0f]?(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?)*","g"),$n=RegExp("["+Dn+tn+an+pn+"]"),Kn=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Yn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Xn=-1,Qn={};Qn[ft]=Qn[ht]=Qn[pt]=Qn[mt]=Qn[gt]=Qn[yt]=Qn[vt]=Qn[bt]=Qn[xt]=!0,Qn[ze]=Qn[We]=Qn[ct]=Qn[He]=Qn[dt]=Qn[Ge]=Qn[Ke]=Qn[Ye]=Qn[Qe]=Qn[Ze]=Qn[et]=Qn[it]=Qn[rt]=Qn[ot]=Qn[lt]=!1;var Zn={};Zn[ze]=Zn[We]=Zn[ct]=Zn[dt]=Zn[He]=Zn[Ge]=Zn[ft]=Zn[ht]=Zn[pt]=Zn[mt]=Zn[gt]=Zn[Qe]=Zn[Ze]=Zn[et]=Zn[it]=Zn[rt]=Zn[ot]=Zn[at]=Zn[yt]=Zn[vt]=Zn[bt]=Zn[xt]=!0,Zn[Ke]=Zn[Ye]=Zn[lt]=!1;var Jn={"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss","\u0100":"A","\u0102":"A","\u0104":"A","\u0101":"a","\u0103":"a","\u0105":"a","\u0106":"C","\u0108":"C","\u010a":"C","\u010c":"C","\u0107":"c","\u0109":"c","\u010b":"c","\u010d":"c","\u010e":"D","\u0110":"D","\u010f":"d","\u0111":"d","\u0112":"E","\u0114":"E","\u0116":"E","\u0118":"E","\u011a":"E","\u0113":"e","\u0115":"e","\u0117":"e","\u0119":"e","\u011b":"e","\u011c":"G","\u011e":"G","\u0120":"G","\u0122":"G","\u011d":"g","\u011f":"g","\u0121":"g","\u0123":"g","\u0124":"H","\u0126":"H","\u0125":"h","\u0127":"h","\u0128":"I","\u012a":"I","\u012c":"I","\u012e":"I","\u0130":"I","\u0129":"i","\u012b":"i","\u012d":"i","\u012f":"i","\u0131":"i","\u0134":"J","\u0135":"j","\u0136":"K","\u0137":"k","\u0138":"k","\u0139":"L","\u013b":"L","\u013d":"L","\u013f":"L","\u0141":"L","\u013a":"l","\u013c":"l","\u013e":"l","\u0140":"l","\u0142":"l","\u0143":"N","\u0145":"N","\u0147":"N","\u014a":"N","\u0144":"n","\u0146":"n","\u0148":"n","\u014b":"n","\u014c":"O","\u014e":"O","\u0150":"O","\u014d":"o","\u014f":"o","\u0151":"o","\u0154":"R","\u0156":"R","\u0158":"R","\u0155":"r","\u0157":"r","\u0159":"r","\u015a":"S","\u015c":"S","\u015e":"S","\u0160":"S","\u015b":"s","\u015d":"s","\u015f":"s","\u0161":"s","\u0162":"T","\u0164":"T","\u0166":"T","\u0163":"t","\u0165":"t","\u0167":"t","\u0168":"U","\u016a":"U","\u016c":"U","\u016e":"U","\u0170":"U","\u0172":"U","\u0169":"u","\u016b":"u","\u016d":"u","\u016f":"u","\u0171":"u","\u0173":"u","\u0174":"W","\u0175":"w","\u0176":"Y","\u0177":"y","\u0178":"Y","\u0179":"Z","\u017b":"Z","\u017d":"Z","\u017a":"z","\u017c":"z","\u017e":"z","\u0132":"IJ","\u0133":"ij","\u0152":"Oe","\u0153":"oe","\u0149":"'n","\u017f":"s"},ei={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},ti={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},ni={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ii=parseFloat,ri=parseInt,oi="object"==typeof e&&e&&e.Object===Object&&e,ai="object"==typeof self&&self&&self.Object===Object&&self,si=oi||ai||Function("return this")(),li="object"==typeof t&&t&&!t.nodeType&&t,ui=li&&"object"==typeof i&&i&&!i.nodeType&&i,ci=ui&&ui.exports===li,di=ci&&oi.process,fi=function(){try{return di&&di.binding&&di.binding("util")}catch(e){}}(),hi=fi&&fi.isArrayBuffer,pi=fi&&fi.isDate,mi=fi&&fi.isMap,gi=fi&&fi.isRegExp,yi=fi&&fi.isSet,vi=fi&&fi.isTypedArray,bi=S("length"),xi=k(Jn),Ei=k(ei),wi=k(ti),Ci=function e(t){function n(e){if(ll(e)&&!xf(e)&&!(e instanceof x)){if(e instanceof r)return e;if(bc.call(e,"__wrapped__"))return oa(e)}return new r(e)}function i(){}function r(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=re}function x(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Oe,this.__views__=[]}function k(){var e=new x(this.__wrapped__);return e.__actions__=Nr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Nr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Nr(this.__views__),e}function Q(){if(this.__filtered__){var e=new x(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function te(){var e=this.__wrapped__.value(),t=this.__dir__,n=xf(e),i=t<0,r=n?e.length:0,o=ko(0,r,this.__views__),a=o.start,s=o.end,l=s-a,u=i?s:a-1,c=this.__iteratees__,d=c.length,f=0,h=Yc(l,this.__takeCount__);if(!n||!i&&r==l&&h==l)return xr(e,this.__actions__);var p=[];e:for(;l--&&f<h;){u+=t;for(var m=-1,g=e[u];++m<d;){var y=c[m],v=y.iteratee,b=y.type,x=v(g);if(b==Te)g=x;else if(!x){if(b==Ae)continue e;break e}}p[f++]=g}return p}function ne(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function Pe(){this.__data__=od?od(null):{},this.size=0}function Wt(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function tn(e){var t=this.__data__;if(od){var n=t[e];return n===ue?re:n}return bc.call(t,e)?t[e]:re}function nn(e){var t=this.__data__;return od?t[e]!==re:bc.call(t,e)}function rn(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=od&&t===re?ue:t,this}function on(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function an(){this.__data__=[],this.size=0}function sn(e){var t=this.__data__,n=Tn(t,e);return!(n<0)&&(n==t.length-1?t.pop():Pc.call(t,n,1),--this.size,!0)}function ln(e){var t=this.__data__,n=Tn(t,e);return n<0?re:t[n][1]}function un(e){return Tn(this.__data__,e)>-1}function cn(e,t){var n=this.__data__,i=Tn(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}function dn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}function fn(){this.size=0,this.__data__={hash:new ne,map:new(td||on),string:new ne}}function hn(e){var t=Bo(this,e).delete(e);return this.size-=t?1:0,t}function pn(e){return Bo(this,e).get(e)}function mn(e){return Bo(this,e).has(e)}function gn(e,t){var n=Bo(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}function yn(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new dn;++t<n;)this.add(e[t])}function vn(e){return this.__data__.set(e,ue),this}function bn(e){return this.__data__.has(e)}function xn(e){var t=this.__data__=new on(e);this.size=t.size}function En(){this.__data__=new on,this.size=0}function wn(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function Cn(e){return this.__data__.get(e)}function _n(e){return this.__data__.has(e)}function Bn(e,t){var n=this.__data__;if(n instanceof on){var i=n.__data__;if(!td||i.length<ae-1)return i.push([e,t]),this.size=++n.size,this;n=this.__data__=new dn(i)}return n.set(e,t),this.size=n.size,this}function Un(e,t){var n=xf(e),i=!n&&bf(e),r=!n&&!i&&wf(e),o=!n&&!i&&!r&&If(e),a=n||i||r||o,s=a?P(e.length,fc):[],l=s.length;for(var u in e)!t&&!bc.call(e,u)||a&&("length"==u||r&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Ro(u,l))||s.push(u);return s}function In(e){var t=e.length;return t?e[tr(0,t-1)]:re}function Sn(e,t){return ta(Nr(e),On(t,0,e.length))}function kn(e){return ta(Nr(e))}function Dn(e,t,n){(n===re||Ks(e[t],n))&&(n!==re||t in e)||Mn(e,t,n)}function An(e,t,n){var i=e[t];bc.call(e,t)&&Ks(i,n)&&(n!==re||t in e)||Mn(e,t,n)}function Tn(e,t){for(var n=e.length;n--;)if(Ks(e[n][0],t))return n;return-1}function Pn(e,t,n,i){return yd(e,function(e,r,o){t(i,e,n(e),o)}),i}function Fn(e,t){return e&&jr(t,Wl(t),e)}function Ln(e,t){return e&&jr(t,ql(t),e)}function Mn(e,t,n){"__proto__"==t&&Rc?Rc(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Rn(e,t){for(var n=-1,i=t.length,r=oc(i),o=null==e;++n<i;)r[n]=o?re:jl(e,t[n]);return r}function On(e,t,n){return e===e&&(n!==re&&(e=e<=n?e:n),t!==re&&(e=e>=t?e:t)),e}function Nn(e,t,n,i,r,o){var a,s=t&fe,l=t&he,c=t&pe;if(n&&(a=r?n(e,i,r,o):n(e)),a!==re)return a;if(!sl(e))return e;var d=xf(e);if(d){if(a=To(e),!s)return Nr(e,a)}else{var f=kd(e),h=f==Ye||f==Xe;if(wf(e))return Ir(e,s);if(f==et||f==ze||h&&!r){if(a=l||h?{}:Po(e),!s)return l?zr(e,Ln(a,e)):Vr(e,Fn(a,e))}else{if(!Zn[f])return r?e:{};a=Fo(e,f,Nn,s)}}o||(o=new xn);var p=o.get(e);if(p)return p;o.set(e,a);var m=c?l?Eo:xo:l?ql:Wl,g=d?re:m(e);return u(g||e,function(i,r){g&&(r=i,i=e[r]),An(a,r,Nn(i,t,n,r,e,o))}),a}function jn(e){var t=Wl(e);return function(n){return Vn(n,e,t)}}function Vn(e,t,n){var i=n.length;if(null==e)return!i;for(e=cc(e);i--;){var r=n[i],o=t[r],a=e[r];if(a===re&&!(r in e)||!o(a))return!1}return!0}function zn(e,t,n){if("function"!=typeof e)throw new hc(le);return Td(function(){e.apply(re,n)},t)}function Hn(e,t,n,i){var r=-1,o=h,a=!0,s=e.length,l=[],u=t.length;if(!s)return l;n&&(t=m(t,L(n))),i?(o=p,a=!1):t.length>=ae&&(o=R,a=!1,t=new yn(t));e:for(;++r<s;){var c=e[r],d=null==n?c:n(c);if(c=i||0!==c?c:0,a&&d===d){for(var f=u;f--;)if(t[f]===d)continue e;l.push(c)}else o(t,d,i)||l.push(c)}return l}function Gn(e,t){var n=!0;return yd(e,function(e,i,r){return n=!!t(e,i,r)}),n}function $n(e,t,n){for(var i=-1,r=e.length;++i<r;){var o=e[i],a=t(o);if(null!=a&&(s===re?a===a&&!bl(a):n(a,s)))var s=a,l=o}return l}function Kn(e,t,n,i){var r=e.length;for(n=Bl(n),n<0&&(n=-n>r?0:r+n),i=i===re||i>r?r:Bl(i),i<0&&(i+=r),i=n>i?0:Ul(i);n<i;)e[n++]=t;return e}function Jn(e,t){var n=[];return yd(e,function(e,i,r){t(e,i,r)&&n.push(e)}),n}function ei(e,t,n,i,r){var o=-1,a=e.length;for(n||(n=Mo),r||(r=[]);++o<a;){var s=e[o];t>0&&n(s)?t>1?ei(s,t-1,n,i,r):g(r,s):i||(r[r.length]=s)}return r}function ti(e,t){return e&&bd(e,t,Wl)}function ni(e,t){return e&&xd(e,t,Wl)}function oi(e,t){return f(t,function(t){return rl(e[t])})}function ai(e,t){t=Br(t,e);for(var n=0,i=t.length;null!=e&&n<i;)e=e[na(t[n++])];return n&&n==i?e:re}function li(e,t,n){var i=t(e);return xf(e)?i:g(i,n(e))}function ui(e){return null==e?e===re?st:Je:Mc&&Mc in cc(e)?So(e):Yo(e)}function di(e,t){return e>t}function fi(e,t){return null!=e&&bc.call(e,t)}function bi(e,t){return null!=e&&t in cc(e)}function Ci(e,t,n){return e>=Yc(t,n)&&e<Kc(t,n)}function Bi(e,t,n){for(var i=n?p:h,r=e[0].length,o=e.length,a=o,s=oc(o),l=1/0,u=[];a--;){var c=e[a];a&&t&&(c=m(c,L(t))),l=Yc(c.length,l),s[a]=!n&&(t||r>=120&&c.length>=120)?new yn(a&&c):re}c=e[0];var d=-1,f=s[0];e:for(;++d<r&&u.length<l;){var g=c[d],y=t?t(g):g;if(g=n||0!==g?g:0,!(f?R(f,y):i(u,y,n))){for(a=o;--a;){var v=s[a];if(!(v?R(v,y):i(e[a],y,n)))continue e}f&&f.push(y),u.push(g)}}return u}function Ui(e,t,n,i){return ti(e,function(e,r,o){t(i,n(e),r,o)}),i}function Ii(e,t,n){t=Br(t,e),e=Qo(e,t);var i=null==e?e:e[na(_a(t))];return null==i?re:s(i,e,n)}function Si(e){return ll(e)&&ui(e)==ze}function ki(e){return ll(e)&&ui(e)==ct}function Di(e){return ll(e)&&ui(e)==Ge}function Ai(e,t,n,i,r){return e===t||(null==e||null==t||!ll(e)&&!ll(t)?e!==e&&t!==t:Ti(e,t,n,i,Ai,r))}function Ti(e,t,n,i,r,o){var a=xf(e),s=xf(t),l=a?We:kd(e),u=s?We:kd(t);l=l==ze?et:l,u=u==ze?et:u;var c=l==et,d=u==et,f=l==u;if(f&&wf(e)){if(!wf(t))return!1;a=!0,c=!1}if(f&&!c)return o||(o=new xn),a||If(e)?go(e,t,n,i,r,o):yo(e,t,l,n,i,r,o);if(!(n&me)){var h=c&&bc.call(e,"__wrapped__"),p=d&&bc.call(t,"__wrapped__");if(h||p){var m=h?e.value():e,g=p?t.value():t;return o||(o=new xn),r(m,g,n,i,o)}}return!!f&&(o||(o=new xn),vo(e,t,n,i,r,o))}function Pi(e){return ll(e)&&kd(e)==Qe}function Fi(e,t,n,i){var r=n.length,o=r,a=!i;if(null==e)return!o;for(e=cc(e);r--;){var s=n[r];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++r<o;){s=n[r];var l=s[0],u=e[l],c=s[1];if(a&&s[2]){if(u===re&&!(l in e))return!1}else{var d=new xn;if(i)var f=i(u,c,l,e,t,d);if(!(f===re?Ai(c,u,me|ge,i,d):f))return!1}}return!0}function Li(e){return!(!sl(e)||zo(e))&&(rl(e)?Bc:Yt).test(ia(e))}function Mi(e){return ll(e)&&ui(e)==it}function Ri(e){return ll(e)&&kd(e)==rt}function Oi(e){return ll(e)&&al(e.length)&&!!Qn[ui(e)]}function Ni(e){return"function"==typeof e?e:null==e?Pu:"object"==typeof e?xf(e)?Hi(e[0],e[1]):qi(e):Vu(e)}function ji(e){if(!Wo(e))return $c(e);var t=[];for(var n in cc(e))bc.call(e,n)&&"constructor"!=n&&t.push(n);return t}function Vi(e){if(!sl(e))return Ko(e);var t=Wo(e),n=[];for(var i in e)("constructor"!=i||!t&&bc.call(e,i))&&n.push(i);return n}function zi(e,t){return e<t}function Wi(e,t){var n=-1,i=Ys(e)?oc(e.length):[];return yd(e,function(e,r,o){i[++n]=t(e,r,o)}),i}function qi(e){var t=Uo(e);return 1==t.length&&t[0][2]?Ho(t[0][0],t[0][1]):function(n){return n===e||Fi(n,e,t)}}function Hi(e,t){return No(e)&&qo(t)?Ho(na(e),t):function(n){var i=jl(n,e);return i===re&&i===t?zl(n,e):Ai(t,i,me|ge)}}function Gi(e,t,n,i,r){e!==t&&bd(t,function(o,a){if(sl(o))r||(r=new xn),$i(e,t,a,n,Gi,i,r);else{var s=i?i(e[a],o,a+"",e,t,r):re;s===re&&(s=o),Dn(e,a,s)}},ql)}function $i(e,t,n,i,r,o,a){var s=e[n],l=t[n],u=a.get(l);if(u)return void Dn(e,n,u);var c=o?o(s,l,n+"",e,t,a):re,d=c===re;if(d){var f=xf(l),h=!f&&wf(l),p=!f&&!h&&If(l);c=l,f||h||p?xf(s)?c=s:Xs(s)?c=Nr(s):h?(d=!1,c=Ir(l,!0)):p?(d=!1,c=Fr(l,!0)):c=[]:gl(l)||bf(l)?(c=s,bf(s)?c=Sl(s):(!sl(s)||i&&rl(s))&&(c=Po(l))):d=!1}d&&(a.set(l,c),r(c,l,i,o,a),a.delete(l)),Dn(e,n,c)}function Ki(e,t){var n=e.length;if(n)return t+=t<0?n:0,Ro(t,n)?e[t]:re}function Yi(e,t,n){var i=-1;return t=m(t.length?t:[Pu],L(_o())),A(Wi(e,function(e,n,r){return{criteria:m(t,function(t){return t(e)}),index:++i,value:e}}),function(e,t){return Mr(e,t,n)})}function Xi(e,t){return Qi(e,t,function(t,n){return zl(e,n)})}function Qi(e,t,n){for(var i=-1,r=t.length,o={};++i<r;){var a=t[i],s=ai(e,a);n(s,a)&&sr(o,Br(a,e),s)}return o}function Zi(e){return function(t){return ai(t,e)}}function Ji(e,t,n,i){var r=i?B:_,o=-1,a=t.length,s=e;for(e===t&&(t=Nr(t)),n&&(s=m(e,L(n)));++o<a;)for(var l=0,u=t[o],c=n?n(u):u;(l=r(s,c,l,i))>-1;)s!==e&&Pc.call(s,l,1),Pc.call(e,l,1);return e}function er(e,t){for(var n=e?t.length:0,i=n-1;n--;){var r=t[n];if(n==i||r!==o){var o=r;Ro(r)?Pc.call(e,r,1):yr(e,r)}}return e}function tr(e,t){return e+zc(Zc()*(t-e+1))}function nr(e,t,n,i){for(var r=-1,o=Kc(Vc((t-e)/(n||1)),0),a=oc(o);o--;)a[i?o:++r]=e,e+=n;return a}function ir(e,t){var n="";if(!e||t<1||t>Le)return n;do{t%2&&(n+=e),(t=zc(t/2))&&(e+=e)}while(t);return n}function rr(e,t){return Pd(Xo(e,t,Pu),e+"")}function or(e){return In(nu(e))}function ar(e,t){var n=nu(e);return ta(n,On(t,0,n.length))}function sr(e,t,n,i){if(!sl(e))return e;t=Br(t,e);for(var r=-1,o=t.length,a=o-1,s=e;null!=s&&++r<o;){var l=na(t[r]),u=n;if(r!=a){var c=s[l];u=i?i(c,l,s):re,u===re&&(u=sl(c)?c:Ro(t[r+1])?[]:{})}An(s,l,u),s=s[l]}return e}function lr(e){return ta(nu(e))}function ur(e,t,n){var i=-1,r=e.length;t<0&&(t=-t>r?0:r+t),n=n>r?r:n,n<0&&(n+=r),r=t>n?0:n-t>>>0,t>>>=0;for(var o=oc(r);++i<r;)o[i]=e[i+t];return o}function cr(e,t){var n;return yd(e,function(e,i,r){return!(n=t(e,i,r))}),!!n}function dr(e,t,n){var i=0,r=null==e?i:e.length;if("number"==typeof t&&t===t&&r<=je){for(;i<r;){var o=i+r>>>1,a=e[o];null!==a&&!bl(a)&&(n?a<=t:a<t)?i=o+1:r=o}return r}return fr(e,t,Pu,n)}function fr(e,t,n,i){t=n(t);for(var r=0,o=null==e?0:e.length,a=t!==t,s=null===t,l=bl(t),u=t===re;r<o;){var c=zc((r+o)/2),d=n(e[c]),f=d!==re,h=null===d,p=d===d,m=bl(d);if(a)var g=i||p;else g=u?p&&(i||f):s?p&&f&&(i||!h):l?p&&f&&!h&&(i||!m):!h&&!m&&(i?d<=t:d<t);g?r=c+1:o=c}return Yc(o,Ne)}function hr(e,t){for(var n=-1,i=e.length,r=0,o=[];++n<i;){var a=e[n],s=t?t(a):a;if(!n||!Ks(s,l)){var l=s;o[r++]=0===a?0:a}}return o}function pr(e){return"number"==typeof e?e:bl(e)?Re:+e}function mr(e){if("string"==typeof e)return e;if(xf(e))return m(e,mr)+"";if(bl(e))return md?md.call(e):"";var t=e+"";return"0"==t&&1/e==-Fe?"-0":t}function gr(e,t,n){var i=-1,r=h,o=e.length,a=!0,s=[],l=s;if(n)a=!1,r=p;else if(o>=ae){var u=t?null:Bd(e);if(u)return Y(u);a=!1,r=R,l=new yn}else l=t?[]:s;e:for(;++i<o;){var c=e[i],d=t?t(c):c;if(c=n||0!==c?c:0,a&&d===d){for(var f=l.length;f--;)if(l[f]===d)continue e;t&&l.push(d),s.push(c)}else r(l,d,n)||(l!==s&&l.push(d),s.push(c))}return s}function yr(e,t){return t=Br(t,e),null==(e=Qo(e,t))||delete e[na(_a(t))]}function vr(e,t,n,i){return sr(e,t,n(ai(e,t)),i)}function br(e,t,n,i){for(var r=e.length,o=i?r:-1;(i?o--:++o<r)&&t(e[o],o,e););return n?ur(e,i?0:o,i?o+1:r):ur(e,i?o+1:0,i?r:o)}function xr(e,t){var n=e;return n instanceof x&&(n=n.value()),y(t,function(e,t){return t.func.apply(t.thisArg,g([e],t.args))},n)}function Er(e,t,n){var i=e.length;if(i<2)return i?gr(e[0]):[];for(var r=-1,o=oc(i);++r<i;)for(var a=e[r],s=-1;++s<i;)s!=r&&(o[r]=Hn(o[r]||a,e[s],t,n));return gr(ei(o,1),t,n)}function wr(e,t,n){for(var i=-1,r=e.length,o=t.length,a={};++i<r;){var s=i<o?t[i]:re;n(a,e[i],s)}return a}function Cr(e){return Xs(e)?e:[]}function _r(e){return"function"==typeof e?e:Pu}function Br(e,t){return xf(e)?e:No(e,t)?[e]:Fd(Dl(e))}function Ur(e,t,n){var i=e.length;return n=n===re?i:n,!t&&n>=i?e:ur(e,t,n)}function Ir(e,t){if(t)return e.slice();var n=e.length,i=kc?kc(n):new e.constructor(n);return e.copy(i),i}function Sr(e){var t=new e.constructor(e.byteLength);return new Sc(t).set(new Sc(e)),t}function kr(e,t){var n=t?Sr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}function Dr(e,t,n){return y(t?n(G(e),fe):G(e),o,new e.constructor)}function Ar(e){var t=new e.constructor(e.source,Gt.exec(e));return t.lastIndex=e.lastIndex,t}function Tr(e,t,n){return y(t?n(Y(e),fe):Y(e),a,new e.constructor)}function Pr(e){return pd?cc(pd.call(e)):{}}function Fr(e,t){var n=t?Sr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Lr(e,t){if(e!==t){var n=e!==re,i=null===e,r=e===e,o=bl(e),a=t!==re,s=null===t,l=t===t,u=bl(t);if(!s&&!u&&!o&&e>t||o&&a&&l&&!s&&!u||i&&a&&l||!n&&l||!r)return 1;if(!i&&!o&&!u&&e<t||u&&n&&r&&!i&&!o||s&&n&&r||!a&&r||!l)return-1}return 0}function Mr(e,t,n){for(var i=-1,r=e.criteria,o=t.criteria,a=r.length,s=n.length;++i<a;){var l=Lr(r[i],o[i]);if(l){if(i>=s)return l;return l*("desc"==n[i]?-1:1)}}return e.index-t.index}function Rr(e,t,n,i){for(var r=-1,o=e.length,a=n.length,s=-1,l=t.length,u=Kc(o-a,0),c=oc(l+u),d=!i;++s<l;)c[s]=t[s];for(;++r<a;)(d||r<o)&&(c[n[r]]=e[r]);for(;u--;)c[s++]=e[r++];return c}function Or(e,t,n,i){for(var r=-1,o=e.length,a=-1,s=n.length,l=-1,u=t.length,c=Kc(o-s,0),d=oc(c+u),f=!i;++r<c;)d[r]=e[r];for(var h=r;++l<u;)d[h+l]=t[l];for(;++a<s;)(f||r<o)&&(d[h+n[a]]=e[r++]);return d}function Nr(e,t){var n=-1,i=e.length;for(t||(t=oc(i));++n<i;)t[n]=e[n];return t}function jr(e,t,n,i){var r=!n;n||(n={});for(var o=-1,a=t.length;++o<a;){var s=t[o],l=i?i(n[s],e[s],s,n,e):re;l===re&&(l=e[s]),r?Mn(n,s,l):An(n,s,l)}return n}function Vr(e,t){return jr(e,Id(e),t)}function zr(e,t){return jr(e,Sd(e),t)}function Wr(e,t){return function(n,i){var r=xf(n)?l:Pn,o=t?t():{};return r(n,e,_o(i,2),o)}}function qr(e){return rr(function(t,n){var i=-1,r=n.length,o=r>1?n[r-1]:re,a=r>2?n[2]:re;for(o=e.length>3&&"function"==typeof o?(r--,o):re,a&&Oo(n[0],n[1],a)&&(o=r<3?re:o,r=1),t=cc(t);++i<r;){var s=n[i];s&&e(t,s,i,o)}return t})}function Hr(e,t){return function(n,i){if(null==n)return n;if(!Ys(n))return e(n,i);for(var r=n.length,o=t?r:-1,a=cc(n);(t?o--:++o<r)&&!1!==i(a[o],o,a););return n}}function Gr(e){return function(t,n,i){for(var r=-1,o=cc(t),a=i(t),s=a.length;s--;){var l=a[e?s:++r];if(!1===n(o[l],l,o))break}return t}}function $r(e,t,n){function i(){return(this&&this!==si&&this instanceof i?o:e).apply(r?n:this,arguments)}var r=t&ye,o=Xr(e);return i}function Kr(e){return function(t){t=Dl(t);var n=W(t)?ee(t):re,i=n?n[0]:t.charAt(0),r=n?Ur(n,1).join(""):t.slice(1);return i[e]()+r}}function Yr(e){return function(t){return y(Su(lu(t).replace(Wn,"")),e,"")}}function Xr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=gd(e.prototype),i=e.apply(n,t);return sl(i)?i:n}}function Qr(e,t,n){function i(){for(var o=arguments.length,a=oc(o),l=o,u=Co(i);l--;)a[l]=arguments[l];var c=o<3&&a[0]!==u&&a[o-1]!==u?[]:K(a,u);return(o-=c.length)<n?lo(e,t,eo,i.placeholder,re,a,c,re,re,n-o):s(this&&this!==si&&this instanceof i?r:e,this,a)}var r=Xr(e);return i}function Zr(e){return function(t,n,i){var r=cc(t);if(!Ys(t)){var o=_o(n,3);t=Wl(t),n=function(e){return o(r[e],e,r)}}var a=e(t,n,i);return a>-1?r[o?t[a]:a]:re}}function Jr(e){return bo(function(t){var n=t.length,i=n,o=r.prototype.thru;for(e&&t.reverse();i--;){var a=t[i];if("function"!=typeof a)throw new hc(le);if(o&&!s&&"wrapper"==wo(a))var s=new r([],!0)}for(i=s?i:n;++i<n;){a=t[i];var l=wo(a),u="wrapper"==l?Ud(a):re;s=u&&Vo(u[0])&&u[1]==(_e|xe|we|Be)&&!u[4].length&&1==u[9]?s[wo(u[0])].apply(s,u[3]):1==a.length&&Vo(a)?s[l]():s.thru(a)}return function(){var e=arguments,i=e[0];if(s&&1==e.length&&xf(i))return s.plant(i).value();for(var r=0,o=n?t[r].apply(this,e):i;++r<n;)o=t[r].call(this,o);return o}})}function eo(e,t,n,i,r,o,a,s,l,u){function c(){for(var y=arguments.length,v=oc(y),b=y;b--;)v[b]=arguments[b];if(p)var x=Co(c),E=j(v,x);if(i&&(v=Rr(v,i,r,p)),o&&(v=Or(v,o,a,p)),y-=E,p&&y<u){var w=K(v,x);return lo(e,t,eo,c.placeholder,n,v,w,s,l,u-y)}var C=f?n:this,_=h?C[e]:e;return y=v.length,s?v=Zo(v,s):m&&y>1&&v.reverse(),d&&l<y&&(v.length=l),this&&this!==si&&this instanceof c&&(_=g||Xr(_)),_.apply(C,v)}var d=t&_e,f=t&ye,h=t&ve,p=t&(xe|Ee),m=t&Ue,g=h?re:Xr(e);return c}function to(e,t){return function(n,i){return Ui(n,e,t(i),{})}}function no(e,t){return function(n,i){var r;if(n===re&&i===re)return t;if(n!==re&&(r=n),i!==re){if(r===re)return i;"string"==typeof n||"string"==typeof i?(n=mr(n),i=mr(i)):(n=pr(n),i=pr(i)),r=e(n,i)}return r}}function io(e){return bo(function(t){return t=m(t,L(_o())),rr(function(n){var i=this;return e(t,function(e){return s(e,i,n)})})})}function ro(e,t){t=t===re?" ":mr(t);var n=t.length;if(n<2)return n?ir(t,e):t;var i=ir(t,Vc(e/J(t)));return W(t)?Ur(ee(i),0,e).join(""):i.slice(0,e)}function oo(e,t,n,i){function r(){for(var t=-1,l=arguments.length,u=-1,c=i.length,d=oc(c+l),f=this&&this!==si&&this instanceof r?a:e;++u<c;)d[u]=i[u];for(;l--;)d[u++]=arguments[++t];return s(f,o?n:this,d)}var o=t&ye,a=Xr(e);return r}function ao(e){return function(t,n,i){return i&&"number"!=typeof i&&Oo(t,n,i)&&(n=i=re),t=_l(t),n===re?(n=t,t=0):n=_l(n),i=i===re?t<n?1:-1:_l(i),nr(t,n,i,e)}}function so(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=Il(t),n=Il(n)),e(t,n)}}function lo(e,t,n,i,r,o,a,s,l,u){var c=t&xe,d=c?a:re,f=c?re:a,h=c?o:re,p=c?re:o;t|=c?we:Ce,(t&=~(c?Ce:we))&be||(t&=~(ye|ve));var m=[e,t,r,h,d,p,f,s,l,u],g=n.apply(re,m);return Vo(e)&&Ad(g,m),g.placeholder=i,Jo(g,e,t)}function uo(e){var t=uc[e];return function(e,n){if(e=Il(e),n=null==n?0:Yc(Bl(n),292)){var i=(Dl(e)+"e").split("e");return i=(Dl(t(i[0]+"e"+(+i[1]+n)))+"e").split("e"),+(i[0]+"e"+(+i[1]-n))}return t(e)}}function co(e){return function(t){var n=kd(t);return n==Qe?G(t):n==rt?X(t):F(t,e(t))}}function fo(e,t,n,i,r,o,a,s){var l=t&ve;if(!l&&"function"!=typeof e)throw new hc(le);var u=i?i.length:0;if(u||(t&=~(we|Ce),i=r=re),a=a===re?a:Kc(Bl(a),0),s=s===re?s:Bl(s),u-=r?r.length:0,t&Ce){var c=i,d=r;i=r=re}var f=l?re:Ud(e),h=[e,t,n,i,r,c,d,o,a,s];if(f&&$o(h,f),e=h[0],t=h[1],n=h[2],i=h[3],r=h[4],s=h[9]=h[9]===re?l?0:e.length:Kc(h[9]-u,0),!s&&t&(xe|Ee)&&(t&=~(xe|Ee)),t&&t!=ye)p=t==xe||t==Ee?Qr(e,t,s):t!=we&&t!=(ye|we)||r.length?eo.apply(re,h):oo(e,t,n,i);else var p=$r(e,t,n);return Jo((f?Ed:Ad)(p,h),e,t)}function ho(e,t,n,i){return e===re||Ks(e,gc[n])&&!bc.call(i,n)?t:e}function po(e,t,n,i,r,o){return sl(e)&&sl(t)&&(o.set(t,e),Gi(e,t,re,po,o),o.delete(t)),e}function mo(e){return gl(e)?re:e}function go(e,t,n,i,r,o){var a=n&me,s=e.length,l=t.length;if(s!=l&&!(a&&l>s))return!1;var u=o.get(e);if(u&&o.get(t))return u==t;var c=-1,d=!0,f=n&ge?new yn:re;for(o.set(e,t),o.set(t,e);++c<s;){var h=e[c],p=t[c];if(i)var m=a?i(p,h,c,t,e,o):i(h,p,c,e,t,o);if(m!==re){if(m)continue;d=!1;break}if(f){if(!b(t,function(e,t){if(!R(f,t)&&(h===e||r(h,e,n,i,o)))return f.push(t)})){d=!1;break}}else if(h!==p&&!r(h,p,n,i,o)){d=!1;break}}return o.delete(e),o.delete(t),d}function yo(e,t,n,i,r,o,a){switch(n){case dt:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case ct:return!(e.byteLength!=t.byteLength||!o(new Sc(e),new Sc(t)));case He:case Ge:case Ze:return Ks(+e,+t);case Ke:return e.name==t.name&&e.message==t.message;case it:case ot:return e==t+"";case Qe:var s=G;case rt:var l=i&me;if(s||(s=Y),e.size!=t.size&&!l)return!1;var u=a.get(e);if(u)return u==t;i|=ge,a.set(e,t);var c=go(s(e),s(t),i,r,o,a);return a.delete(e),c;case at:if(pd)return pd.call(e)==pd.call(t)}return!1}function vo(e,t,n,i,r,o){var a=n&me,s=xo(e),l=s.length;if(l!=xo(t).length&&!a)return!1;for(var u=l;u--;){var c=s[u];if(!(a?c in t:bc.call(t,c)))return!1}var d=o.get(e);if(d&&o.get(t))return d==t;var f=!0;o.set(e,t),o.set(t,e);for(var h=a;++u<l;){c=s[u];var p=e[c],m=t[c];if(i)var g=a?i(m,p,c,t,e,o):i(p,m,c,e,t,o);if(!(g===re?p===m||r(p,m,n,i,o):g)){f=!1;break}h||(h="constructor"==c)}if(f&&!h){var y=e.constructor,v=t.constructor;y!=v&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof v&&v instanceof v)&&(f=!1)}return o.delete(e),o.delete(t),f}function bo(e){return Pd(Xo(e,re,ga),e+"")}function xo(e){return li(e,Wl,Id)}function Eo(e){return li(e,ql,Sd)}function wo(e){for(var t=e.name+"",n=sd[t],i=bc.call(sd,t)?n.length:0;i--;){var r=n[i],o=r.func;if(null==o||o==e)return r.name}return t}function Co(e){return(bc.call(n,"placeholder")?n:e).placeholder}function _o(){var e=n.iteratee||Fu;return e=e===Fu?Ni:e,arguments.length?e(arguments[0],arguments[1]):e}function Bo(e,t){var n=e.__data__;return jo(t)?n["string"==typeof t?"string":"hash"]:n.map}function Uo(e){for(var t=Wl(e),n=t.length;n--;){var i=t[n],r=e[i];t[n]=[i,r,qo(r)]}return t}function Io(e,t){var n=z(e,t);return Li(n)?n:re}function So(e){var t=bc.call(e,Mc),n=e[Mc];try{e[Mc]=re;var i=!0}catch(e){}var r=wc.call(e);return i&&(t?e[Mc]=n:delete e[Mc]),r}function ko(e,t,n){for(var i=-1,r=n.length;++i<r;){var o=n[i],a=o.size;switch(o.type){case"drop":e+=a;break;case"dropRight":t-=a;break;case"take":t=Yc(t,e+a);break;case"takeRight":e=Kc(e,t-a)}}return{start:e,end:t}}function Do(e){var t=e.match(Vt);return t?t[1].split(zt):[]}function Ao(e,t,n){t=Br(t,e);for(var i=-1,r=t.length,o=!1;++i<r;){var a=na(t[i]);if(!(o=null!=e&&n(e,a)))break;e=e[a]}return o||++i!=r?o:!!(r=null==e?0:e.length)&&al(r)&&Ro(a,r)&&(xf(e)||bf(e))}function To(e){var t=e.length,n=e.constructor(t);return t&&"string"==typeof e[0]&&bc.call(e,"index")&&(n.index=e.index,n.input=e.input),n}function Po(e){return"function"!=typeof e.constructor||Wo(e)?{}:gd(Dc(e))}function Fo(e,t,n,i){var r=e.constructor;switch(t){case ct:return Sr(e);case He:case Ge:return new r(+e);case dt:return kr(e,i);case ft:case ht:case pt:case mt:case gt:case yt:case vt:case bt:case xt:return Fr(e,i);case Qe:return Dr(e,i,n);case Ze:case ot:return new r(e);case it:return Ar(e);case rt:return Tr(e,i,n);case at:return Pr(e)}}function Lo(e,t){var n=t.length;if(!n)return e;var i=n-1;return t[i]=(n>1?"& ":"")+t[i],t=t.join(n>2?", ":" "),e.replace(jt,"{\n/* [wrapped with "+t+"] */\n")}function Mo(e){return xf(e)||bf(e)||!!(Fc&&e&&e[Fc])}function Ro(e,t){return!!(t=null==t?Le:t)&&("number"==typeof e||Qt.test(e))&&e>-1&&e%1==0&&e<t}function Oo(e,t,n){if(!sl(n))return!1;var i=typeof t;return!!("number"==i?Ys(n)&&Ro(t,n.length):"string"==i&&t in n)&&Ks(n[t],e)}function No(e,t){if(xf(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!bl(e))||(Tt.test(e)||!At.test(e)||null!=t&&e in cc(t))}function jo(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function Vo(e){var t=wo(e),i=n[t];if("function"!=typeof i||!(t in x.prototype))return!1;if(e===i)return!0;var r=Ud(i);return!!r&&e===r[0]}function zo(e){return!!Ec&&Ec in e}function Wo(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||gc)}function qo(e){return e===e&&!sl(e)}function Ho(e,t){return function(n){return null!=n&&(n[e]===t&&(t!==re||e in cc(n)))}}function Go(e){var t=Fs(e,function(e){return n.size===ce&&n.clear(),e}),n=t.cache;return t}function $o(e,t){var n=e[1],i=t[1],r=n|i,o=r<(ye|ve|_e),a=i==_e&&n==xe||i==_e&&n==Be&&e[7].length<=t[8]||i==(_e|Be)&&t[7].length<=t[8]&&n==xe;if(!o&&!a)return e;i&ye&&(e[2]=t[2],r|=n&ye?0:be);var s=t[3];if(s){var l=e[3];e[3]=l?Rr(l,s,t[4]):s,e[4]=l?K(e[3],de):t[4]}return s=t[5],s&&(l=e[5],e[5]=l?Or(l,s,t[6]):s,e[6]=l?K(e[5],de):t[6]),s=t[7],s&&(e[7]=s),i&_e&&(e[8]=null==e[8]?t[8]:Yc(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=r,e}function Ko(e){var t=[];if(null!=e)for(var n in cc(e))t.push(n);return t}function Yo(e){return wc.call(e)}function Xo(e,t,n){return t=Kc(t===re?e.length-1:t,0),function(){for(var i=arguments,r=-1,o=Kc(i.length-t,0),a=oc(o);++r<o;)a[r]=i[t+r];r=-1;for(var l=oc(t+1);++r<t;)l[r]=i[r];return l[t]=n(a),s(e,this,l)}}function Qo(e,t){return t.length<2?e:ai(e,ur(t,0,-1))}function Zo(e,t){for(var n=e.length,i=Yc(t.length,n),r=Nr(e);i--;){var o=t[i];e[i]=Ro(o,n)?r[o]:re}return e}function Jo(e,t,n){var i=t+"";return Pd(e,Lo(i,ra(Do(i),n)))}function ea(e){var t=0,n=0;return function(){var i=Xc(),r=De-(i-n);if(n=i,r>0){if(++t>=ke)return arguments[0]}else t=0;return e.apply(re,arguments)}}function ta(e,t){var n=-1,i=e.length,r=i-1;for(t=t===re?i:t;++n<t;){var o=tr(n,r),a=e[o];e[o]=e[n],e[n]=a}return e.length=t,e}function na(e){if("string"==typeof e||bl(e))return e;var t=e+"";return"0"==t&&1/e==-Fe?"-0":t}function ia(e){if(null!=e){try{return vc.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function ra(e,t){return u(Ve,function(n){var i="_."+n[0];t&n[1]&&!h(e,i)&&e.push(i)}),e.sort()}function oa(e){if(e instanceof x)return e.clone();var t=new r(e.__wrapped__,e.__chain__);return t.__actions__=Nr(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function aa(e,t,n){t=(n?Oo(e,t,n):t===re)?1:Kc(Bl(t),0);var i=null==e?0:e.length;if(!i||t<1)return[];for(var r=0,o=0,a=oc(Vc(i/t));r<i;)a[o++]=ur(e,r,r+=t);return a}function sa(e){for(var t=-1,n=null==e?0:e.length,i=0,r=[];++t<n;){var o=e[t];o&&(r[i++]=o)}return r}function la(){var e=arguments.length;if(!e)return[];for(var t=oc(e-1),n=arguments[0],i=e;i--;)t[i-1]=arguments[i];return g(xf(n)?Nr(n):[n],ei(t,1))}function ua(e,t,n){var i=null==e?0:e.length;return i?(t=n||t===re?1:Bl(t),ur(e,t<0?0:t,i)):[]}function ca(e,t,n){var i=null==e?0:e.length;return i?(t=n||t===re?1:Bl(t),t=i-t,ur(e,0,t<0?0:t)):[]}function da(e,t){return e&&e.length?br(e,_o(t,3),!0,!0):[]}function fa(e,t){return e&&e.length?br(e,_o(t,3),!0):[]}function ha(e,t,n,i){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&Oo(e,t,n)&&(n=0,i=r),Kn(e,t,n,i)):[]}function pa(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=null==n?0:Bl(n);return r<0&&(r=Kc(i+r,0)),C(e,_o(t,3),r)}function ma(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=i-1;return n!==re&&(r=Bl(n),r=n<0?Kc(i+r,0):Yc(r,i-1)),C(e,_o(t,3),r,!0)}function ga(e){return(null==e?0:e.length)?ei(e,1):[]}function ya(e){return(null==e?0:e.length)?ei(e,Fe):[]}function va(e,t){return(null==e?0:e.length)?(t=t===re?1:Bl(t),ei(e,t)):[]}function ba(e){for(var t=-1,n=null==e?0:e.length,i={};++t<n;){var r=e[t];i[r[0]]=r[1]}return i}function xa(e){return e&&e.length?e[0]:re}function Ea(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=null==n?0:Bl(n);return r<0&&(r=Kc(i+r,0)),_(e,t,r)}function wa(e){return(null==e?0:e.length)?ur(e,0,-1):[]}function Ca(e,t){return null==e?"":Gc.call(e,t)}function _a(e){var t=null==e?0:e.length;return t?e[t-1]:re}function Ba(e,t,n){var i=null==e?0:e.length;if(!i)return-1;var r=i;return n!==re&&(r=Bl(n),r=r<0?Kc(i+r,0):Yc(r,i-1)),t===t?Z(e,t,r):C(e,U,r,!0)}function Ua(e,t){return e&&e.length?Ki(e,Bl(t)):re}function Ia(e,t){return e&&e.length&&t&&t.length?Ji(e,t):e}function Sa(e,t,n){return e&&e.length&&t&&t.length?Ji(e,t,_o(n,2)):e}function ka(e,t,n){return e&&e.length&&t&&t.length?Ji(e,t,re,n):e}function Da(e,t){var n=[];if(!e||!e.length)return n;var i=-1,r=[],o=e.length;for(t=_o(t,3);++i<o;){var a=e[i];t(a,i,e)&&(n.push(a),r.push(i))}return er(e,r),n}function Aa(e){return null==e?e:Jc.call(e)}function Ta(e,t,n){var i=null==e?0:e.length;return i?(n&&"number"!=typeof n&&Oo(e,t,n)?(t=0,n=i):(t=null==t?0:Bl(t),n=n===re?i:Bl(n)),ur(e,t,n)):[]}function Pa(e,t){return dr(e,t)}function Fa(e,t,n){return fr(e,t,_o(n,2))}function La(e,t){var n=null==e?0:e.length;if(n){var i=dr(e,t);if(i<n&&Ks(e[i],t))return i}return-1}function Ma(e,t){return dr(e,t,!0)}function Ra(e,t,n){return fr(e,t,_o(n,2),!0)}function Oa(e,t){if(null==e?0:e.length){var n=dr(e,t,!0)-1;if(Ks(e[n],t))return n}return-1}function Na(e){return e&&e.length?hr(e):[]}function ja(e,t){return e&&e.length?hr(e,_o(t,2)):[]}function Va(e){var t=null==e?0:e.length;return t?ur(e,1,t):[]}function za(e,t,n){return e&&e.length?(t=n||t===re?1:Bl(t),ur(e,0,t<0?0:t)):[]}function Wa(e,t,n){var i=null==e?0:e.length;return i?(t=n||t===re?1:Bl(t),t=i-t,ur(e,t<0?0:t,i)):[]}function qa(e,t){return e&&e.length?br(e,_o(t,3),!1,!0):[]}function Ha(e,t){return e&&e.length?br(e,_o(t,3)):[]}function Ga(e){return e&&e.length?gr(e):[]}function $a(e,t){return e&&e.length?gr(e,_o(t,2)):[]}function Ka(e,t){return t="function"==typeof t?t:re,e&&e.length?gr(e,re,t):[]}function Ya(e){if(!e||!e.length)return[];var t=0;return e=f(e,function(e){if(Xs(e))return t=Kc(e.length,t),!0}),P(t,function(t){return m(e,S(t))})}function Xa(e,t){if(!e||!e.length)return[];var n=Ya(e);return null==t?n:m(n,function(e){return s(t,re,e)})}function Qa(e,t){return wr(e||[],t||[],An)}function Za(e,t){return wr(e||[],t||[],sr)}function Ja(e){var t=n(e);return t.__chain__=!0,t}function es(e,t){return t(e),e}function ts(e,t){return t(e)}function ns(){return Ja(this)}function is(){return new r(this.value(),this.__chain__)}function rs(){this.__values__===re&&(this.__values__=Cl(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?re:this.__values__[this.__index__++]}}function os(){return this}function as(e){for(var t,n=this;n instanceof i;){var r=oa(n);r.__index__=0,r.__values__=re,t?o.__wrapped__=r:t=r;var o=r;n=n.__wrapped__}return o.__wrapped__=e,t}function ss(){var e=this.__wrapped__;if(e instanceof x){var t=e;return this.__actions__.length&&(t=new x(this)),t=t.reverse(),t.__actions__.push({func:ts,args:[Aa],thisArg:re}),new r(t,this.__chain__)}return this.thru(Aa)}function ls(){return xr(this.__wrapped__,this.__actions__)}function us(e,t,n){var i=xf(e)?d:Gn;return n&&Oo(e,t,n)&&(t=re),i(e,_o(t,3))}function cs(e,t){return(xf(e)?f:Jn)(e,_o(t,3))}function ds(e,t){return ei(ys(e,t),1)}function fs(e,t){return ei(ys(e,t),Fe)}function hs(e,t,n){return n=n===re?1:Bl(n),ei(ys(e,t),n)}function ps(e,t){return(xf(e)?u:yd)(e,_o(t,3))}function ms(e,t){return(xf(e)?c:vd)(e,_o(t,3))}function gs(e,t,n,i){e=Ys(e)?e:nu(e),n=n&&!i?Bl(n):0;var r=e.length;return n<0&&(n=Kc(r+n,0)),vl(e)?n<=r&&e.indexOf(t,n)>-1:!!r&&_(e,t,n)>-1}function ys(e,t){return(xf(e)?m:Wi)(e,_o(t,3))}function vs(e,t,n,i){return null==e?[]:(xf(t)||(t=null==t?[]:[t]),n=i?re:n,xf(n)||(n=null==n?[]:[n]),Yi(e,t,n))}function bs(e,t,n){var i=xf(e)?y:D,r=arguments.length<3;return i(e,_o(t,4),n,r,yd)}function xs(e,t,n){var i=xf(e)?v:D,r=arguments.length<3;return i(e,_o(t,4),n,r,vd)}function Es(e,t){return(xf(e)?f:Jn)(e,Ls(_o(t,3)))}function ws(e){return(xf(e)?In:or)(e)}function Cs(e,t,n){return t=(n?Oo(e,t,n):t===re)?1:Bl(t),(xf(e)?Sn:ar)(e,t)}function _s(e){return(xf(e)?kn:lr)(e)}function Bs(e){if(null==e)return 0;if(Ys(e))return vl(e)?J(e):e.length;var t=kd(e);return t==Qe||t==rt?e.size:ji(e).length}function Us(e,t,n){var i=xf(e)?b:cr;return n&&Oo(e,t,n)&&(t=re),i(e,_o(t,3))}function Is(e,t){if("function"!=typeof t)throw new hc(le);return e=Bl(e),function(){if(--e<1)return t.apply(this,arguments)}}function Ss(e,t,n){return t=n?re:t,t=e&&null==t?e.length:t,fo(e,_e,re,re,re,re,t)}function ks(e,t){var n;if("function"!=typeof t)throw new hc(le);return e=Bl(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=re),n}}function Ds(e,t,n){t=n?re:t;var i=fo(e,xe,re,re,re,re,re,t);return i.placeholder=Ds.placeholder,i}function As(e,t,n){t=n?re:t;var i=fo(e,Ee,re,re,re,re,re,t);return i.placeholder=As.placeholder,i}function Ts(e,t,n){function i(t){var n=f,i=h;return f=h=re,v=t,m=e.apply(i,n)}function r(e){return v=e,g=Td(s,t),b?i(e):m}function o(e){var n=e-y,i=e-v,r=t-n;return x?Yc(r,p-i):r}function a(e){var n=e-y,i=e-v;return y===re||n>=t||n<0||x&&i>=p}function s(){var e=lf();if(a(e))return l(e);g=Td(s,o(e))}function l(e){return g=re,E&&f?i(e):(f=h=re,m)}function u(){g!==re&&_d(g),v=0,f=y=h=g=re}function c(){return g===re?m:l(lf())}function d(){var e=lf(),n=a(e);if(f=arguments,h=this,y=e,n){if(g===re)return r(y);if(x)return g=Td(s,t),i(y)}return g===re&&(g=Td(s,t)),m}var f,h,p,m,g,y,v=0,b=!1,x=!1,E=!0;if("function"!=typeof e)throw new hc(le);return t=Il(t)||0,sl(n)&&(b=!!n.leading,x="maxWait"in n,p=x?Kc(Il(n.maxWait)||0,t):p,E="trailing"in n?!!n.trailing:E),d.cancel=u,d.flush=c,d}function Ps(e){return fo(e,Ue)}function Fs(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new hc(le);var n=function(){var i=arguments,r=t?t.apply(this,i):i[0],o=n.cache;if(o.has(r))return o.get(r);var a=e.apply(this,i);return n.cache=o.set(r,a)||o,a};return n.cache=new(Fs.Cache||dn),n}function Ls(e){if("function"!=typeof e)throw new hc(le);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function Ms(e){return ks(2,e)}function Rs(e,t){if("function"!=typeof e)throw new hc(le);return t=t===re?t:Bl(t),rr(e,t)}function Os(e,t){if("function"!=typeof e)throw new hc(le);return t=null==t?0:Kc(Bl(t),0),rr(function(n){var i=n[t],r=Ur(n,0,t);return i&&g(r,i),s(e,this,r)})}function Ns(e,t,n){var i=!0,r=!0;if("function"!=typeof e)throw new hc(le);return sl(n)&&(i="leading"in n?!!n.leading:i,r="trailing"in n?!!n.trailing:r),Ts(e,t,{leading:i,maxWait:t,trailing:r})}function js(e){return Ss(e,1)}function Vs(e,t){return pf(_r(t),e)}function zs(){if(!arguments.length)return[];var e=arguments[0];return xf(e)?e:[e]}function Ws(e){return Nn(e,pe)}function qs(e,t){return t="function"==typeof t?t:re,Nn(e,pe,t)}function Hs(e){return Nn(e,fe|pe)}function Gs(e,t){return t="function"==typeof t?t:re,Nn(e,fe|pe,t)}function $s(e,t){return null==t||Vn(e,t,Wl(t))}function Ks(e,t){return e===t||e!==e&&t!==t}function Ys(e){return null!=e&&al(e.length)&&!rl(e)}function Xs(e){return ll(e)&&Ys(e)}function Qs(e){return!0===e||!1===e||ll(e)&&ui(e)==He}function Zs(e){return ll(e)&&1===e.nodeType&&!gl(e)}function Js(e){if(null==e)return!0;if(Ys(e)&&(xf(e)||"string"==typeof e||"function"==typeof e.splice||wf(e)||If(e)||bf(e)))return!e.length;var t=kd(e);if(t==Qe||t==rt)return!e.size;if(Wo(e))return!ji(e).length;for(var n in e)if(bc.call(e,n))return!1;return!0}function el(e,t){return Ai(e,t)}function tl(e,t,n){n="function"==typeof n?n:re;var i=n?n(e,t):re;return i===re?Ai(e,t,re,n):!!i}function nl(e){if(!ll(e))return!1;var t=ui(e);return t==Ke||t==$e||"string"==typeof e.message&&"string"==typeof e.name&&!gl(e)}function il(e){return"number"==typeof e&&Hc(e)}function rl(e){if(!sl(e))return!1;var t=ui(e);return t==Ye||t==Xe||t==qe||t==nt}function ol(e){return"number"==typeof e&&e==Bl(e)}function al(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=Le}function sl(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function ll(e){return null!=e&&"object"==typeof e}function ul(e,t){return e===t||Fi(e,t,Uo(t))}function cl(e,t,n){return n="function"==typeof n?n:re,Fi(e,t,Uo(t),n)}function dl(e){return ml(e)&&e!=+e}function fl(e){if(Dd(e))throw new sc(se);return Li(e)}function hl(e){return null===e}function pl(e){return null==e}function ml(e){return"number"==typeof e||ll(e)&&ui(e)==Ze}function gl(e){if(!ll(e)||ui(e)!=et)return!1;var t=Dc(e);if(null===t)return!0;var n=bc.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&vc.call(n)==Cc}function yl(e){return ol(e)&&e>=-Le&&e<=Le}function vl(e){return"string"==typeof e||!xf(e)&&ll(e)&&ui(e)==ot}function bl(e){return"symbol"==typeof e||ll(e)&&ui(e)==at}function xl(e){return e===re}function El(e){return ll(e)&&kd(e)==lt}function wl(e){return ll(e)&&ui(e)==ut}function Cl(e){if(!e)return[];if(Ys(e))return vl(e)?ee(e):Nr(e);if(Lc&&e[Lc])return H(e[Lc]());var t=kd(e);return(t==Qe?G:t==rt?Y:nu)(e)}function _l(e){if(!e)return 0===e?e:0;if((e=Il(e))===Fe||e===-Fe){return(e<0?-1:1)*Me}return e===e?e:0}function Bl(e){var t=_l(e),n=t%1;return t===t?n?t-n:t:0}function Ul(e){return e?On(Bl(e),0,Oe):0}function Il(e){if("number"==typeof e)return e;if(bl(e))return Re;if(sl(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=sl(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(Rt,"");var n=Kt.test(e);return n||Xt.test(e)?ri(e.slice(2),n?2:8):$t.test(e)?Re:+e}function Sl(e){return jr(e,ql(e))}function kl(e){return e?On(Bl(e),-Le,Le):0===e?e:0}function Dl(e){return null==e?"":mr(e)}function Al(e,t){var n=gd(e);return null==t?n:Fn(n,t)}function Tl(e,t){return w(e,_o(t,3),ti)}function Pl(e,t){return w(e,_o(t,3),ni)}function Fl(e,t){return null==e?e:bd(e,_o(t,3),ql)}function Ll(e,t){return null==e?e:xd(e,_o(t,3),ql)}function Ml(e,t){return e&&ti(e,_o(t,3))}function Rl(e,t){return e&&ni(e,_o(t,3))}function Ol(e){return null==e?[]:oi(e,Wl(e))}function Nl(e){return null==e?[]:oi(e,ql(e))}function jl(e,t,n){var i=null==e?re:ai(e,t);return i===re?n:i}function Vl(e,t){return null!=e&&Ao(e,t,fi)}function zl(e,t){return null!=e&&Ao(e,t,bi)}function Wl(e){return Ys(e)?Un(e):ji(e)}function ql(e){return Ys(e)?Un(e,!0):Vi(e)}function Hl(e,t){var n={};return t=_o(t,3),ti(e,function(e,i,r){Mn(n,t(e,i,r),e)}),n}function Gl(e,t){var n={};return t=_o(t,3),ti(e,function(e,i,r){Mn(n,i,t(e,i,r))}),n}function $l(e,t){return Kl(e,Ls(_o(t)))}function Kl(e,t){if(null==e)return{};var n=m(Eo(e),function(e){return[e]});return t=_o(t),Qi(e,n,function(e,n){return t(e,n[0])})}function Yl(e,t,n){t=Br(t,e);var i=-1,r=t.length;for(r||(r=1,e=re);++i<r;){var o=null==e?re:e[na(t[i])];o===re&&(i=r,o=n),e=rl(o)?o.call(e):o}return e}function Xl(e,t,n){return null==e?e:sr(e,t,n)}function Ql(e,t,n,i){return i="function"==typeof i?i:re,null==e?e:sr(e,t,n,i)}function Zl(e,t,n){var i=xf(e),r=i||wf(e)||If(e);if(t=_o(t,4),null==n){var o=e&&e.constructor;n=r?i?new o:[]:sl(e)&&rl(o)?gd(Dc(e)):{}}return(r?u:ti)(e,function(e,i,r){return t(n,e,i,r)}),n}function Jl(e,t){return null==e||yr(e,t)}function eu(e,t,n){return null==e?e:vr(e,t,_r(n))}function tu(e,t,n,i){return i="function"==typeof i?i:re,null==e?e:vr(e,t,_r(n),i)}function nu(e){return null==e?[]:M(e,Wl(e))}function iu(e){return null==e?[]:M(e,ql(e))}function ru(e,t,n){return n===re&&(n=t,t=re),n!==re&&(n=Il(n),n=n===n?n:0),t!==re&&(t=Il(t),t=t===t?t:0),On(Il(e),t,n)}function ou(e,t,n){return t=_l(t),n===re?(n=t,t=0):n=_l(n),e=Il(e),Ci(e,t,n)}function au(e,t,n){if(n&&"boolean"!=typeof n&&Oo(e,t,n)&&(t=n=re),n===re&&("boolean"==typeof t?(n=t,t=re):"boolean"==typeof e&&(n=e,e=re)),e===re&&t===re?(e=0,t=1):(e=_l(e),t===re?(t=e,e=0):t=_l(t)),e>t){var i=e;e=t,t=i}if(n||e%1||t%1){var r=Zc();return Yc(e+r*(t-e+ii("1e-"+((r+"").length-1))),t)}return tr(e,t)}function su(e){return Jf(Dl(e).toLowerCase())}function lu(e){return(e=Dl(e))&&e.replace(Zt,xi).replace(qn,"")}function uu(e,t,n){e=Dl(e),t=mr(t);var i=e.length;n=n===re?i:On(Bl(n),0,i);var r=n;return(n-=t.length)>=0&&e.slice(n,r)==t}function cu(e){return e=Dl(e),e&&It.test(e)?e.replace(Bt,Ei):e}function du(e){return e=Dl(e),e&&Mt.test(e)?e.replace(Lt,"\\$&"):e}function fu(e,t,n){e=Dl(e),t=Bl(t);var i=t?J(e):0;if(!t||i>=t)return e;var r=(t-i)/2;return ro(zc(r),n)+e+ro(Vc(r),n)}function hu(e,t,n){e=Dl(e),t=Bl(t);var i=t?J(e):0;return t&&i<t?e+ro(t-i,n):e}function pu(e,t,n){e=Dl(e),t=Bl(t);var i=t?J(e):0;return t&&i<t?ro(t-i,n)+e:e}function mu(e,t,n){return n||null==t?t=0:t&&(t=+t),Qc(Dl(e).replace(Ot,""),t||0)}function gu(e,t,n){return t=(n?Oo(e,t,n):t===re)?1:Bl(t),ir(Dl(e),t)}function yu(){var e=arguments,t=Dl(e[0]);return e.length<3?t:t.replace(e[1],e[2])}function vu(e,t,n){return n&&"number"!=typeof n&&Oo(e,t,n)&&(t=n=re),(n=n===re?Oe:n>>>0)?(e=Dl(e),e&&("string"==typeof t||null!=t&&!Bf(t))&&!(t=mr(t))&&W(e)?Ur(ee(e),0,n):e.split(t,n)):[]}function bu(e,t,n){return e=Dl(e),n=null==n?0:On(Bl(n),0,e.length),t=mr(t),e.slice(n,n+t.length)==t}function xu(e,t,i){var r=n.templateSettings;i&&Oo(e,t,i)&&(t=re),e=Dl(e),t=Tf({},t,r,ho);var o=Tf({},t.imports,r.imports,ho),a=Wl(o),s=M(o,a),l,u,c=0,d=t.interpolate||Jt,f="__p += '",h=dc((t.escape||Jt).source+"|"+d.source+"|"+(d===Dt?Ht:Jt).source+"|"+(t.evaluate||Jt).source+"|$","g"),p="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++Xn+"]")+"\n";e.replace(h,function(t,n,i,r,o,a){return i||(i=r),f+=e.slice(c,a).replace(en,V),n&&(l=!0,f+="' +\n__e("+n+") +\n'"),o&&(u=!0,f+="';\n"+o+";\n__p += '"),i&&(f+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),c=a+t.length,t}),f+="';\n";var m=t.variable;m||(f="with (obj) {\n"+f+"\n}\n"),f=(u?f.replace(Et,""):f).replace(wt,"$1").replace(Ct,"$1;"),f="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(l?", __e = _.escape":"")+(u?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var g=eh(function(){return lc(a,p+"return "+f).apply(re,s)});if(g.source=f,nl(g))throw g;return g}function Eu(e){return Dl(e).toLowerCase()}function wu(e){return Dl(e).toUpperCase()}function Cu(e,t,n){if((e=Dl(e))&&(n||t===re))return e.replace(Rt,"");if(!e||!(t=mr(t)))return e;var i=ee(e),r=ee(t);return Ur(i,O(i,r),N(i,r)+1).join("")}function _u(e,t,n){if((e=Dl(e))&&(n||t===re))return e.replace(Nt,"");if(!e||!(t=mr(t)))return e;var i=ee(e);return Ur(i,0,N(i,ee(t))+1).join("")}function Bu(e,t,n){if((e=Dl(e))&&(n||t===re))return e.replace(Ot,"");if(!e||!(t=mr(t)))return e;var i=ee(e);return Ur(i,O(i,ee(t))).join("")}function Uu(e,t){var n=Ie,i=Se;if(sl(t)){var r="separator"in t?t.separator:r;n="length"in t?Bl(t.length):n,i="omission"in t?mr(t.omission):i}e=Dl(e);var o=e.length;if(W(e)){var a=ee(e);o=a.length}if(n>=o)return e;var s=n-J(i);if(s<1)return i;var l=a?Ur(a,0,s).join(""):e.slice(0,s);if(r===re)return l+i;if(a&&(s+=l.length-s),Bf(r)){if(e.slice(s).search(r)){var u,c=l;for(r.global||(r=dc(r.source,Dl(Gt.exec(r))+"g")),r.lastIndex=0;u=r.exec(c);)var d=u.index;l=l.slice(0,d===re?s:d)}}else if(e.indexOf(mr(r),s)!=s){var f=l.lastIndexOf(r);f>-1&&(l=l.slice(0,f))}return l+i}function Iu(e){return e=Dl(e),e&&Ut.test(e)?e.replace(_t,wi):e}function Su(e,t,n){return e=Dl(e),t=n?re:t,t===re?q(e)?ie(e):E(e):e.match(t)||[]}function ku(e){var t=null==e?0:e.length,n=_o();return e=t?m(e,function(e){if("function"!=typeof e[1])throw new hc(le);return[n(e[0]),e[1]]}):[],rr(function(n){for(var i=-1;++i<t;){var r=e[i];if(s(r[0],this,n))return s(r[1],this,n)}})}function Du(e){return jn(Nn(e,fe))}function Au(e){return function(){return e}}function Tu(e,t){return null==e||e!==e?t:e}function Pu(e){return e}function Fu(e){return Ni("function"==typeof e?e:Nn(e,fe))}function Lu(e){return qi(Nn(e,fe))}function Mu(e,t){return Hi(e,Nn(t,fe))}function Ru(e,t,n){var i=Wl(t),r=oi(t,i);null!=n||sl(t)&&(r.length||!i.length)||(n=t,t=e,e=this,r=oi(t,Wl(t)));var o=!(sl(n)&&"chain"in n&&!n.chain),a=rl(e);return u(r,function(n){var i=t[n];e[n]=i,a&&(e.prototype[n]=function(){var t=this.__chain__;if(o||t){var n=e(this.__wrapped__);return(n.__actions__=Nr(this.__actions__)).push({func:i,args:arguments,thisArg:e}),n.__chain__=t,n}return i.apply(e,g([this.value()],arguments))})}),e}function Ou(){return si._===this&&(si._=_c),this}function Nu(){}function ju(e){return e=Bl(e),rr(function(t){return Ki(t,e)})}function Vu(e){return No(e)?S(na(e)):Zi(e)}function zu(e){return function(t){return null==e?re:ai(e,t)}}function Wu(){return[]}function qu(){return!1}function Hu(){return{}}function Gu(){return""}function $u(){return!0}function Ku(e,t){if((e=Bl(e))<1||e>Le)return[];var n=Oe,i=Yc(e,Oe);t=_o(t),e-=Oe;for(var r=P(i,t);++n<e;)t(n);return r}function Yu(e){return xf(e)?m(e,na):bl(e)?[e]:Nr(Fd(Dl(e)))}function Xu(e){var t=++xc;return Dl(e)+t}function Qu(e){return e&&e.length?$n(e,Pu,di):re}function Zu(e,t){return e&&e.length?$n(e,_o(t,2),di):re}function Ju(e){return I(e,Pu)}function ec(e,t){return I(e,_o(t,2))}function tc(e){return e&&e.length?$n(e,Pu,zi):re}function nc(e,t){return e&&e.length?$n(e,_o(t,2),zi):re}function ic(e){return e&&e.length?T(e,Pu):0}function rc(e,t){return e&&e.length?T(e,_o(t,2)):0}t=null==t?si:_i.defaults(si.Object(),t,_i.pick(si,Yn));var oc=t.Array,ac=t.Date,sc=t.Error,lc=t.Function,uc=t.Math,cc=t.Object,dc=t.RegExp,fc=t.String,hc=t.TypeError,pc=oc.prototype,mc=lc.prototype,gc=cc.prototype,yc=t["__core-js_shared__"],vc=mc.toString,bc=gc.hasOwnProperty,xc=0,Ec=function(){var e=/[^.]+$/.exec(yc&&yc.keys&&yc.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),wc=gc.toString,Cc=vc.call(cc),_c=si._,Bc=dc("^"+vc.call(bc).replace(Lt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Uc=ci?t.Buffer:re,Ic=t.Symbol,Sc=t.Uint8Array,kc=Uc?Uc.allocUnsafe:re,Dc=$(cc.getPrototypeOf,cc),Ac=cc.create,Tc=gc.propertyIsEnumerable,Pc=pc.splice,Fc=Ic?Ic.isConcatSpreadable:re,Lc=Ic?Ic.iterator:re,Mc=Ic?Ic.toStringTag:re,Rc=function(){try{var e=Io(cc,"defineProperty");return e({},"",{}),e}catch(e){}}(),Oc=t.clearTimeout!==si.clearTimeout&&t.clearTimeout,Nc=ac&&ac.now!==si.Date.now&&ac.now,jc=t.setTimeout!==si.setTimeout&&t.setTimeout,Vc=uc.ceil,zc=uc.floor,Wc=cc.getOwnPropertySymbols,qc=Uc?Uc.isBuffer:re,Hc=t.isFinite,Gc=pc.join,$c=$(cc.keys,cc),Kc=uc.max,Yc=uc.min,Xc=ac.now,Qc=t.parseInt,Zc=uc.random,Jc=pc.reverse,ed=Io(t,"DataView"),td=Io(t,"Map"),nd=Io(t,"Promise"),id=Io(t,"Set"),rd=Io(t,"WeakMap"),od=Io(cc,"create"),ad=rd&&new rd,sd={},ld=ia(ed),ud=ia(td),cd=ia(nd),dd=ia(id),fd=ia(rd),hd=Ic?Ic.prototype:re,pd=hd?hd.valueOf:re,md=hd?hd.toString:re,gd=function(){function e(){}return function(t){if(!sl(t))return{};if(Ac)return Ac(t);e.prototype=t;var n=new e;return e.prototype=re,n}}();n.templateSettings={escape:St,evaluate:kt,interpolate:Dt,variable:"",imports:{_:n}},n.prototype=i.prototype,n.prototype.constructor=n,r.prototype=gd(i.prototype),r.prototype.constructor=r,x.prototype=gd(i.prototype),x.prototype.constructor=x,ne.prototype.clear=Pe,ne.prototype.delete=Wt,ne.prototype.get=tn,ne.prototype.has=nn,ne.prototype.set=rn,on.prototype.clear=an,on.prototype.delete=sn,on.prototype.get=ln,on.prototype.has=un,on.prototype.set=cn,dn.prototype.clear=fn,dn.prototype.delete=hn,dn.prototype.get=pn,dn.prototype.has=mn,dn.prototype.set=gn,yn.prototype.add=yn.prototype.push=vn,yn.prototype.has=bn,xn.prototype.clear=En,xn.prototype.delete=wn,xn.prototype.get=Cn,xn.prototype.has=_n,xn.prototype.set=Bn;var yd=Hr(ti),vd=Hr(ni,!0),bd=Gr(),xd=Gr(!0),Ed=ad?function(e,t){return ad.set(e,t),e}:Pu,wd=Rc?function(e,t){return Rc(e,"toString",{configurable:!0,enumerable:!1,value:Au(t),writable:!0})}:Pu,Cd=rr,_d=Oc||function(e){return si.clearTimeout(e)},Bd=id&&1/Y(new id([,-0]))[1]==Fe?function(e){return new id(e)}:Nu,Ud=ad?function(e){return ad.get(e)}:Nu,Id=Wc?function(e){return null==e?[]:(e=cc(e),f(Wc(e),function(t){return Tc.call(e,t)}))}:Wu,Sd=Wc?function(e){for(var t=[];e;)g(t,Id(e)),e=Dc(e);return t}:Wu,kd=ui;(ed&&kd(new ed(new ArrayBuffer(1)))!=dt||td&&kd(new td)!=Qe||nd&&kd(nd.resolve())!=tt||id&&kd(new id)!=rt||rd&&kd(new rd)!=lt)&&(kd=function(e){var t=ui(e),n=t==et?e.constructor:re,i=n?ia(n):"";if(i)switch(i){case ld:return dt;case ud:return Qe;case cd:return tt;case dd:return rt;case fd:return lt}return t});var Dd=yc?rl:qu,Ad=ea(Ed),Td=jc||function(e,t){return si.setTimeout(e,t)},Pd=ea(wd),Fd=Go(function(e){var t=[];return Pt.test(e)&&t.push(""),e.replace(Ft,function(e,n,i,r){t.push(i?r.replace(qt,"$1"):n||e)}),t}),Ld=rr(function(e,t){return Xs(e)?Hn(e,ei(t,1,Xs,!0)):[]}),Md=rr(function(e,t){var n=_a(t);return Xs(n)&&(n=re),Xs(e)?Hn(e,ei(t,1,Xs,!0),_o(n,2)):[]}),Rd=rr(function(e,t){var n=_a(t);return Xs(n)&&(n=re),Xs(e)?Hn(e,ei(t,1,Xs,!0),re,n):[]}),Od=rr(function(e){var t=m(e,Cr);return t.length&&t[0]===e[0]?Bi(t):[]}),Nd=rr(function(e){var t=_a(e),n=m(e,Cr);return t===_a(n)?t=re:n.pop(),n.length&&n[0]===e[0]?Bi(n,_o(t,2)):[]}),jd=rr(function(e){var t=_a(e),n=m(e,Cr);return t="function"==typeof t?t:re,t&&n.pop(),n.length&&n[0]===e[0]?Bi(n,re,t):[]}),Vd=rr(Ia),zd=bo(function(e,t){var n=null==e?0:e.length,i=Rn(e,t);return er(e,m(t,function(e){return Ro(e,n)?+e:e}).sort(Lr)),i}),Wd=rr(function(e){return gr(ei(e,1,Xs,!0))}),qd=rr(function(e){var t=_a(e);return Xs(t)&&(t=re),gr(ei(e,1,Xs,!0),_o(t,2))}),Hd=rr(function(e){var t=_a(e);return t="function"==typeof t?t:re,gr(ei(e,1,Xs,!0),re,t)}),Gd=rr(function(e,t){return Xs(e)?Hn(e,t):[]}),$d=rr(function(e){return Er(f(e,Xs))}),Kd=rr(function(e){var t=_a(e);return Xs(t)&&(t=re),Er(f(e,Xs),_o(t,2))}),Yd=rr(function(e){var t=_a(e);return t="function"==typeof t?t:re,Er(f(e,Xs),re,t)}),Xd=rr(Ya),Qd=rr(function(e){var t=e.length,n=t>1?e[t-1]:re;return n="function"==typeof n?(e.pop(),n):re,Xa(e,n)}),Zd=bo(function(e){var t=e.length,n=t?e[0]:0,i=this.__wrapped__,o=function(t){return Rn(t,e)};return!(t>1||this.__actions__.length)&&i instanceof x&&Ro(n)?(i=i.slice(n,+n+(t?1:0)),i.__actions__.push({func:ts,args:[o],thisArg:re}),new r(i,this.__chain__).thru(function(e){return t&&!e.length&&e.push(re),e})):this.thru(o)}),Jd=Wr(function(e,t,n){bc.call(e,n)?++e[n]:Mn(e,n,1)}),ef=Zr(pa),tf=Zr(ma),nf=Wr(function(e,t,n){bc.call(e,n)?e[n].push(t):Mn(e,n,[t])}),rf=rr(function(e,t,n){var i=-1,r="function"==typeof t,o=Ys(e)?oc(e.length):[];return yd(e,function(e){o[++i]=r?s(t,e,n):Ii(e,t,n)}),o}),of=Wr(function(e,t,n){Mn(e,n,t)}),af=Wr(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]}),sf=rr(function(e,t){if(null==e)return[];var n=t.length;return n>1&&Oo(e,t[0],t[1])?t=[]:n>2&&Oo(t[0],t[1],t[2])&&(t=[t[0]]),Yi(e,ei(t,1),[])}),lf=Nc||function(){return si.Date.now()},uf=rr(function(e,t,n){var i=ye;if(n.length){var r=K(n,Co(uf));i|=we}return fo(e,i,t,n,r)}),cf=rr(function(e,t,n){var i=ye|ve;if(n.length){var r=K(n,Co(cf));i|=we}return fo(t,i,e,n,r)}),df=rr(function(e,t){return zn(e,1,t)}),ff=rr(function(e,t,n){return zn(e,Il(t)||0,n)});Fs.Cache=dn;var hf=Cd(function(e,t){t=1==t.length&&xf(t[0])?m(t[0],L(_o())):m(ei(t,1),L(_o()));var n=t.length;return rr(function(i){for(var r=-1,o=Yc(i.length,n);++r<o;)i[r]=t[r].call(this,i[r]);return s(e,this,i)})}),pf=rr(function(e,t){var n=K(t,Co(pf));return fo(e,we,re,t,n)}),mf=rr(function(e,t){var n=K(t,Co(mf));return fo(e,Ce,re,t,n)}),gf=bo(function(e,t){return fo(e,Be,re,re,re,t)}),yf=so(di),vf=so(function(e,t){return e>=t}),bf=Si(function(){return arguments}())?Si:function(e){return ll(e)&&bc.call(e,"callee")&&!Tc.call(e,"callee")},xf=oc.isArray,Ef=hi?L(hi):ki,wf=qc||qu,Cf=pi?L(pi):Di,_f=mi?L(mi):Pi,Bf=gi?L(gi):Mi,Uf=yi?L(yi):Ri,If=vi?L(vi):Oi,Sf=so(zi),kf=so(function(e,t){return e<=t}),Df=qr(function(e,t){if(Wo(t)||Ys(t))return void jr(t,Wl(t),e);for(var n in t)bc.call(t,n)&&An(e,n,t[n])}),Af=qr(function(e,t){jr(t,ql(t),e)}),Tf=qr(function(e,t,n,i){jr(t,ql(t),e,i)}),Pf=qr(function(e,t,n,i){jr(t,Wl(t),e,i)}),Ff=bo(Rn),Lf=rr(function(e){return e.push(re,ho),s(Tf,re,e)}),Mf=rr(function(e){return e.push(re,po),s(Vf,re,e)}),Rf=to(function(e,t,n){e[t]=n},Au(Pu)),Of=to(function(e,t,n){bc.call(e,t)?e[t].push(n):e[t]=[n]},_o),Nf=rr(Ii),jf=qr(function(e,t,n){Gi(e,t,n)}),Vf=qr(function(e,t,n,i){Gi(e,t,n,i)}),zf=bo(function(e,t){var n={};if(null==e)return n;var i=!1;t=m(t,function(t){return t=Br(t,e),i||(i=t.length>1),t}),jr(e,Eo(e),n),i&&(n=Nn(n,fe|he|pe,mo));for(var r=t.length;r--;)yr(n,t[r]);return n}),Wf=bo(function(e,t){return null==e?{}:Xi(e,t)}),qf=co(Wl),Hf=co(ql),Gf=Yr(function(e,t,n){return t=t.toLowerCase(),e+(n?su(t):t)}),$f=Yr(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),Kf=Yr(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),Yf=Kr("toLowerCase"),Xf=Yr(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}),Qf=Yr(function(e,t,n){return e+(n?" ":"")+Jf(t)}),Zf=Yr(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),Jf=Kr("toUpperCase"),eh=rr(function(e,t){try{return s(e,re,t)}catch(e){return nl(e)?e:new sc(e)}}),th=bo(function(e,t){return u(t,function(t){t=na(t),Mn(e,t,uf(e[t],e))}),e}),nh=Jr(),ih=Jr(!0),rh=rr(function(e,t){return function(n){return Ii(n,e,t)}}),oh=rr(function(e,t){return function(n){return Ii(e,n,t)}}),ah=io(m),sh=io(d),lh=io(b),uh=ao(),ch=ao(!0),dh=no(function(e,t){return e+t},0),fh=uo("ceil"),hh=no(function(e,t){return e/t},1),ph=uo("floor"),mh=no(function(e,t){return e*t},1),gh=uo("round"),yh=no(function(e,t){return e-t},0);return n.after=Is,n.ary=Ss,n.assign=Df,n.assignIn=Af,n.assignInWith=Tf,n.assignWith=Pf,n.at=Ff,n.before=ks,n.bind=uf,n.bindAll=th,n.bindKey=cf,n.castArray=zs,n.chain=Ja,n.chunk=aa,n.compact=sa,n.concat=la,n.cond=ku,n.conforms=Du,n.constant=Au,n.countBy=Jd,n.create=Al,n.curry=Ds,n.curryRight=As,n.debounce=Ts,n.defaults=Lf,n.defaultsDeep=Mf,n.defer=df,n.delay=ff,n.difference=Ld,n.differenceBy=Md,n.differenceWith=Rd,n.drop=ua,n.dropRight=ca,n.dropRightWhile=da,n.dropWhile=fa,n.fill=ha,n.filter=cs,n.flatMap=ds,n.flatMapDeep=fs,n.flatMapDepth=hs,n.flatten=ga,n.flattenDeep=ya,n.flattenDepth=va,n.flip=Ps,n.flow=nh,n.flowRight=ih,n.fromPairs=ba,n.functions=Ol,n.functionsIn=Nl,n.groupBy=nf,n.initial=wa,n.intersection=Od,n.intersectionBy=Nd,n.intersectionWith=jd,n.invert=Rf,n.invertBy=Of,n.invokeMap=rf,n.iteratee=Fu,n.keyBy=of,n.keys=Wl,n.keysIn=ql,n.map=ys,n.mapKeys=Hl,n.mapValues=Gl,n.matches=Lu,n.matchesProperty=Mu,n.memoize=Fs,n.merge=jf,n.mergeWith=Vf,n.method=rh,n.methodOf=oh,n.mixin=Ru,n.negate=Ls,n.nthArg=ju,n.omit=zf,n.omitBy=$l,n.once=Ms,n.orderBy=vs,n.over=ah,n.overArgs=hf,n.overEvery=sh,n.overSome=lh,n.partial=pf,n.partialRight=mf,n.partition=af,n.pick=Wf,n.pickBy=Kl,n.property=Vu,n.propertyOf=zu,n.pull=Vd,n.pullAll=Ia,n.pullAllBy=Sa,n.pullAllWith=ka,n.pullAt=zd,n.range=uh,n.rangeRight=ch,n.rearg=gf,n.reject=Es,n.remove=Da,n.rest=Rs,n.reverse=Aa,n.sampleSize=Cs,n.set=Xl,n.setWith=Ql,n.shuffle=_s,n.slice=Ta,n.sortBy=sf,n.sortedUniq=Na,n.sortedUniqBy=ja,n.split=vu,n.spread=Os,n.tail=Va,n.take=za,n.takeRight=Wa,n.takeRightWhile=qa,n.takeWhile=Ha,n.tap=es,n.throttle=Ns,n.thru=ts,n.toArray=Cl,n.toPairs=qf,n.toPairsIn=Hf,n.toPath=Yu,n.toPlainObject=Sl,n.transform=Zl,n.unary=js,n.union=Wd,n.unionBy=qd,n.unionWith=Hd,n.uniq=Ga,n.uniqBy=$a,n.uniqWith=Ka,n.unset=Jl,n.unzip=Ya,n.unzipWith=Xa,n.update=eu,n.updateWith=tu,n.values=nu,n.valuesIn=iu,n.without=Gd,n.words=Su,n.wrap=Vs,n.xor=$d,n.xorBy=Kd,n.xorWith=Yd,n.zip=Xd,n.zipObject=Qa,n.zipObjectDeep=Za,n.zipWith=Qd,n.entries=qf,n.entriesIn=Hf,n.extend=Af,n.extendWith=Tf,Ru(n,n),n.add=dh,n.attempt=eh,n.camelCase=Gf,n.capitalize=su,n.ceil=fh,n.clamp=ru,n.clone=Ws,n.cloneDeep=Hs,n.cloneDeepWith=Gs,n.cloneWith=qs,n.conformsTo=$s,n.deburr=lu,n.defaultTo=Tu,n.divide=hh,n.endsWith=uu,n.eq=Ks,n.escape=cu,n.escapeRegExp=du,n.every=us,n.find=ef,n.findIndex=pa,n.findKey=Tl,n.findLast=tf,n.findLastIndex=ma,n.findLastKey=Pl,n.floor=ph,n.forEach=ps,n.forEachRight=ms,n.forIn=Fl,n.forInRight=Ll,n.forOwn=Ml,n.forOwnRight=Rl,n.get=jl,n.gt=yf,n.gte=vf,n.has=Vl,n.hasIn=zl,n.head=xa,n.identity=Pu,n.includes=gs,n.indexOf=Ea,n.inRange=ou,n.invoke=Nf,n.isArguments=bf,n.isArray=xf,n.isArrayBuffer=Ef,n.isArrayLike=Ys,n.isArrayLikeObject=Xs,n.isBoolean=Qs,n.isBuffer=wf,n.isDate=Cf,n.isElement=Zs,n.isEmpty=Js,n.isEqual=el,n.isEqualWith=tl,n.isError=nl,n.isFinite=il,n.isFunction=rl,n.isInteger=ol,n.isLength=al,n.isMap=_f,n.isMatch=ul,n.isMatchWith=cl,n.isNaN=dl,n.isNative=fl,n.isNil=pl,n.isNull=hl,n.isNumber=ml,n.isObject=sl,n.isObjectLike=ll,n.isPlainObject=gl,n.isRegExp=Bf,n.isSafeInteger=yl,n.isSet=Uf,n.isString=vl,n.isSymbol=bl,n.isTypedArray=If,n.isUndefined=xl,n.isWeakMap=El,n.isWeakSet=wl,n.join=Ca,n.kebabCase=$f,n.last=_a,n.lastIndexOf=Ba,n.lowerCase=Kf,n.lowerFirst=Yf,n.lt=Sf,n.lte=kf,n.max=Qu,n.maxBy=Zu,n.mean=Ju,n.meanBy=ec,n.min=tc,n.minBy=nc,n.stubArray=Wu,n.stubFalse=qu,n.stubObject=Hu,n.stubString=Gu,n.stubTrue=$u,n.multiply=mh,n.nth=Ua,n.noConflict=Ou,n.noop=Nu,n.now=lf,n.pad=fu,n.padEnd=hu,n.padStart=pu,n.parseInt=mu,n.random=au,n.reduce=bs,n.reduceRight=xs,n.repeat=gu,n.replace=yu,n.result=Yl,n.round=gh,n.runInContext=e,n.sample=ws,n.size=Bs,n.snakeCase=Xf,n.some=Us,n.sortedIndex=Pa,n.sortedIndexBy=Fa,n.sortedIndexOf=La,n.sortedLastIndex=Ma,n.sortedLastIndexBy=Ra,n.sortedLastIndexOf=Oa,n.startCase=Qf,n.startsWith=bu,n.subtract=yh,n.sum=ic,n.sumBy=rc,n.template=xu,n.times=Ku,n.toFinite=_l,n.toInteger=Bl,n.toLength=Ul,n.toLower=Eu,n.toNumber=Il,n.toSafeInteger=kl,n.toString=Dl,n.toUpper=wu,n.trim=Cu,n.trimEnd=_u,n.trimStart=Bu,n.truncate=Uu,n.unescape=Iu,n.uniqueId=Xu,n.upperCase=Zf,n.upperFirst=Jf,n.each=ps,n.eachRight=ms,n.first=xa,Ru(n,function(){var e={};return ti(n,function(t,i){bc.call(n.prototype,i)||(e[i]=t)}),e}(),{chain:!1}),n.VERSION=oe,u(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){n[e].placeholder=n}),u(["drop","take"],function(e,t){x.prototype[e]=function(n){n=n===re?1:Kc(Bl(n),0);var i=this.__filtered__&&!t?new x(this):this.clone();return i.__filtered__?i.__takeCount__=Yc(n,i.__takeCount__):i.__views__.push({size:Yc(n,Oe),type:e+(i.__dir__<0?"Right":"")}),i},x.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),u(["filter","map","takeWhile"],function(e,t){var n=t+1,i=n==Ae||3==n;x.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:_o(e,3),type:n}),t.__filtered__=t.__filtered__||i,t}}),u(["head","last"],function(e,t){var n="take"+(t?"Right":"");x.prototype[e]=function(){return this[n](1).value()[0]}}),u(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");x.prototype[e]=function(){return this.__filtered__?new x(this):this[n](1)}}),x.prototype.compact=function(){return this.filter(Pu)},x.prototype.find=function(e){return this.filter(e).head()},x.prototype.findLast=function(e){return this.reverse().find(e)},x.prototype.invokeMap=rr(function(e,t){return"function"==typeof e?new x(this):this.map(function(n){return Ii(n,e,t)})}),x.prototype.reject=function(e){return this.filter(Ls(_o(e)))},x.prototype.slice=function(e,t){e=Bl(e);var n=this;return n.__filtered__&&(e>0||t<0)?new x(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==re&&(t=Bl(t),n=t<0?n.dropRight(-t):n.take(t-e)),n)},x.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},x.prototype.toArray=function(){return this.take(Oe)},ti(x.prototype,function(e,t){var i=/^(?:filter|find|map|reject)|While$/.test(t),o=/^(?:head|last)$/.test(t),a=n[o?"take"+("last"==t?"Right":""):t],s=o||/^find/.test(t);a&&(n.prototype[t]=function(){var t=this.__wrapped__,l=o?[1]:arguments,u=t instanceof x,c=l[0],d=u||xf(t),f=function(e){var t=a.apply(n,g([e],l));return o&&h?t[0]:t};d&&i&&"function"==typeof c&&1!=c.length&&(u=d=!1);var h=this.__chain__,p=!!this.__actions__.length,m=s&&!h,y=u&&!p;if(!s&&d){t=y?t:new x(this);var v=e.apply(t,l);return v.__actions__.push({func:ts,args:[f],thisArg:re}),new r(v,h)}return m&&y?e.apply(this,l):(v=this.thru(f),m?o?v.value()[0]:v.value():v)})}),u(["pop","push","shift","sort","splice","unshift"],function(e){var t=pc[e],i=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",r=/^(?:pop|shift)$/.test(e);n.prototype[e]=function(){var e=arguments;if(r&&!this.__chain__){var n=this.value();return t.apply(xf(n)?n:[],e)}return this[i](function(n){return t.apply(xf(n)?n:[],e)})}}),ti(x.prototype,function(e,t){var i=n[t];if(i){var r=i.name+"";(sd[r]||(sd[r]=[])).push({name:t,func:i})}}),sd[eo(re,ve).name]=[{name:"wrapper",func:re}],x.prototype.clone=k,x.prototype.reverse=Q,x.prototype.value=te,n.prototype.at=Zd,n.prototype.chain=ns,n.prototype.commit=is,n.prototype.next=rs,n.prototype.plant=as,n.prototype.reverse=ss,n.prototype.toJSON=n.prototype.valueOf=n.prototype.value=ls,n.prototype.first=n.prototype.head,Lc&&(n.prototype[Lc]=os),n},_i=Ci();si._=_i,(r=function(){return _i}.call(t,n,t,i))!==re&&(i.exports=r)}).call(this)}).call(t,n(7),n(48)(e))},function(e,t){Ext.define("UB.core.UBAppConfig",{singleton:!0,systemEntities:{desktop:{name:"ubm_desktop",fields:{caption:"caption",url:"url",isDefault:"isDefault"}},navigationShortcut:{name:"ubm_navshortcut",fields:{code:"code",desktopID:"desktopID",folderID:"parentID",isFolder:"isFolder",caption:"caption",commandCode:"cmdCode",inWindow:"inWindow",isCollapsed:"isCollapsed",displayOrder:"displayOrder",ubTreePath:"mi_treePath"}},form:{name:"ubm_form",fields:{code:"code",description:"description",caption:"caption",formType:"formType",formDef:"formDef",formCode:"formCode",entity:"entity",isDefault:"isDefault"}},_enum_:{name:"ubm_enum",fields:{eGroup:"eGroup",code:"code",name:"name",shortName:"shortName",sortOrder:"sortOrder"}}}})},function(e,t,n){n(2);var i=n(13);Ext.define("UB.core.UBUtil",{singleton:!0,glyphs:{faBars:61641,faFilter:61616,faRefresh:61473,faEdit:61508,faPlusCircle:61525,faTrashO:61460,faEye:61550,faLink:61633,faSitemap:61672,faCheck:61452,faShareSquare:61509,faFloppy:61639,faExternalLink:61582,faUp:61538,faDown:61539,faEllipsish:61761,faSearch:61442,faQuestionCircle:61529,faWrench:61613,faSave:61639,faOpen:61717,faSquare:61590,faBinoculars:61442,faClose:61453,faEraser:61741,faDownload:61465,faUpload:61587,faCalculator:61932,faCaretSquareODown:61776,faLock:61475,faUnLock:61596,faCog:61459,faCogs:61573,faShare:61540,faShareAlt:61920,faUsers:61632,faKey:61572,faLanguage:61867,faDatabase:61888,faSignOut:61579,faPencil:61504,faTable:61646,faEnvelopeO:61443,faEnvelope:61664,faBell:61683,faCaretDown:61655,faFolder:61563,faFileExcelO:61891,faHierarche:61672,faPencilSquareO:61508,faArrowLeft:61536,faTimes:61453},getLocalStorageKeys:function e(){var t=[],n=window.localStorage;if(n)for(var i=0,r=n.length;i<r;++i)t.push(n.key(i));return t},getLocalStorageItem:function e(t){return window.localStorage?window.localStorage.getItem(t):void 0},setLocalStorageItem:function e(t,n){window.localStorage&&window.localStorage.setItem(t,n)},removeLocalStorageItem:function e(t){window.localStorage&&window.localStorage.removeItem(t)},clearLocalStorage:function e(){window.localStorage&&window.localStorage.clear()},extractfromBrackets:function e(t){return Array.isArray(t)&&(t=t.join(",")),"string"==typeof t?t.replace(/\[([^\]]*?)\]/g,"$1"):t},removeWhitespaces:function e(t){return"string"==typeof t?t.replace(/\s/g,""):t},gatherStr:function e(t,n,i){return t=t||"",n=n||"",i=i||"",t.length?i.length?t+n+i:t:i},getWindowHeight:function e(){return(window.innerHeight?window.innerHeight:document.documentElement&&document.documentElement.clientHeight?document.documentElement.clientHeight:document.body.clientHeight?document.body.clientHeight:400)-200},getWindowWidth:function e(){return(window.innerWidth?window.innerWidth:document.documentElement&&document.documentElement.clientWidth?document.documentElement.clientWidth:document.body.clientWidth?document.body.clientWidth:800)-200},allPropsEqual:function e(t,n){for(var i in n)if(n.hasOwnProperty(i)&&t[i]!==n[i])return!1;return!0},getNameMd5:function e(t,n){var i,r="",o;if(0!==arguments.length){t=arguments[0];for(var a=1,s=arguments.length;a<s;++a)i=arguments[a],o=Ext.isArray(i)?i.join(","):Ext.isObject(i)?Ext.JSON.encode(i):i,r=this.gatherStr(r,"_",o);return this.gatherStr(t,"_",r&&r.length?""+UB.MD5(r):"")}},getRegExpGroup:function e(t,n,i){var r=n.exec(t);return r&&r.length>i?r[i]:void 0},getByPropertyValue:function e(t,n,i){throw Error("UBUtils.getByPropertyValue is obsolete. Use _.find(array, [propertyName, propertyValue])")},getProperty:function e(t,n){var i=Ext.isString(t)?Ext.JSON.decode(t,!0):t;return i?i[n]:void 0},isEqual:function e(t,n){return Ext.isDate(t)&&Ext.isDate(n)?Ext.Date.isEqual(t,n):t===n},dateISO8601Parse:function e(t){var n;return Ext.isDate(t)?t:isNaN(n=Date.parse(t))?null:new Date(n)},addPrefix:function e(t,n,i){var r=[];if(!Array.isArray(t))return r;for(var o=0,a=t.length;o<a;++o)r.push(this.gatherStr(n,i,t[o]));return r},isObjectEqual:function e(t,n){throw Error("UBUtils.isObjectEqual is obsolete")},isArrayEqual:function e(t,n){throw Error("UBUtils.isArrayEqual is obsolete")},base64String:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",base64fromArrayBuffer:function e(){throw Error("UB.core.UBUtil.base64fromArrayBuffer deprecated. Use UB.base64fromArrayBuffer")},base64toArrayOfFloats:function e(t){for(var n=this.toArrayBuffer(t),i=new Float32Array(n),r=[],o=0,a=i.length;o<a;o++)r.push(i[o]);return r},truncTimeToUtcNull:function e(t){if(!t)return t;var n=new Date(t.getFullYear(),t.getMonth(),t.getDate());return n.setMinutes(-t.getTimezoneOffset()),n},truncTime:function e(t){return t?new Date(t.getFullYear(),t.getMonth(),t.getDate()):t},addDays:function e(t,n){if(!t)return t;var i=new Date;return i.setTime(t.getTime()),i.setDate(t.getDate()+n),i},convertDate:function e(t,n){return t&&Ext.isDate(t)&&n===i.ubDataTypes.Date?UB.core.UBUtil.truncTimeToUtcNull(t):t},escapeForRegexp:function e(t){return"string"==typeof t?t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):""},convertFieldListToNameList:function e(t,n){var i=[];return _.forEach(t,function(e){"string"==typeof e?i.push(e):(!n||n&&!1!==e.visibility)&&i.push(e.name)}),i},convertFieldListToExtended:function e(t){return t.map(function(e){return"string"==typeof e?{name:e}:e})},attribute2cmpConfig:function e(t,n){var i,r,o;return r="string"==typeof t?$App.domainInfo.get(t):t,o=r.attr(n.attributeName),o&&(i=this.ubDt2Ext(o,n),i.name=n.attributeName,i.fieldLabel=o.caption||n.attributeName,Ext.isDefined(o.isMultiLang)&&(i.isMultiLang=o.isMultiLang),Ext.isDefined(o.allowNull)&&(i.allowBlank=o.allowNull),i.entityName=r.code),i},ubDt2Ext:function e(t,n){var r,o,a=Ext.isArray(n.fieldList)&&n.fieldList.length>0,s=i.ubDataTypes,l,u,c;switch(t.dataType){case s.Enum:r=this.getComponentConfig4Enum(t.enumGroup,n);break;case s.Entity:r=this.getComponentConfig4Entity(t.associatedEntity,n);break;case s.Many:o=a?n.fieldList[0]:$App.domainInfo.get(t.associatedEntity).getDescriptionAttribute(),l=["ID"].concat(a?n.fieldList:[o]),u=n?n.whereList:void 0,l=(n?n.fieldList:null)||l,c=(n?n.orderList:void 0)||{_asc:{expression:o,order:UB.core.UBCommand.order.sqlotAsc}},r={xtype:"ubboxselect",store:Ext.create("UB.ux.data.UBStore",{ubRequest:{entity:t.associatedEntity,method:"select",fieldList:l,orderList:c,whereList:u},autoLoad:!1,autoDestroy:!0}),valueField:"ID",displayField:o,queryMode:"remote",editable:!0,forceSelection:!0,grow:!1};break;case s.Document:r={xtype:"ubdocument"},t.documentMIME&&(r.documentMIME=t.documentMIME);break;case s.Text:r={xtype:"textareafield"};break;case s.Date:r={xtype:"ubdatefield",fieldType:s.Date,format:Ext.util.Format.dateFormat};break;case s.DateTime:r={xtype:"ubdatetimefield",fieldType:s.DateTime};break;case s.Currency:r={xtype:"numberfield",maxLength:17,enforceMaxLength:!0,hideTrigger:!0,keyNavEnabled:!1,mouseWheelEnabled:!1,validator:function e(t){if(+t.replace(/[^0-9]/,"")<8999e12){var n=t.match(/[0-9]*[^0-9]{1}([0-9]+)/);if(n&&n.length>1&&n[1].length<3||!n||1===n.length)return!0}return UB.i18n("numberOfSignificantDigits")},valueToRaw:UB.core.UBUtil.formatAsCurrency,maxValue:8999e12,minValue:-8999e12};break;default:r=this.getComponentConfigByDataType(t.dataType,t.size)}return r},formatAsCurrency:function e(t){return _.isNumber(t)?Ext.util.Format.currency(t,"",this.decimalPrecision||2).replace(/ /g,""):""},getComponentConfigByDataType:function e(t,n){var r={int:{xtype:"numberfield",allowDecimals:!1,hideTrigger:!0},float:{xtype:"numberfield",hideTrigger:!0},date:{xtype:"ubdatefield",format:Ext.util.Format.dateFormat},boolean:{xtype:"checkboxfield"},string:{xtype:"ubtextfield",enforceMaxLength:!0}},o=i.getPhysicalDataType(t),a=r[o]||{xtype:"ubtextfield"};return"string"===o&&(a=n>256?{xtype:"ubtextareafield",rows:3}:{xtype:"ubtextfield"},n&&Ext.apply(a,{maxLength:n,enforceMaxLength:!0})),a},getComponentConfig4Entity:function e(t,n){var i,r,o,a=n?n.whereList:void 0,s=n?n.fieldList:null,l=n?n.orderList:void 0,u=["__mip_ondate ","__mip_recordhistory","__mip_recordhistory_all","__mip_disablecache","__allowSelectSafeDeleted"];return r="string"==typeof t?$App.domainInfo.get(t):t,s=s||[r.getDescriptionAttribute()],s.indexOf("ID")<0&&(s=["ID"].concat(s)),o={entity:r.code,method:UB.core.UBCommand.methodName.SELECT,fieldList:s,whereList:a,orderList:l||{_asc:{expression:s[1],order:UB.core.UBCommand.order.sqlotAsc}}},_.forEach(u,function(e){n&&void 0!==n[e]&&(o[e]=n[e])}),i={xtype:"ubcombobox",store:Ext.create("UB.ux.data.UBStore",{ubRequest:o,autoLoad:!1,autoDestroy:!0}),valueField:"ID",displayField:s[1],fieldList:s,entityName:r.code}},getComponentConfig4Enum:function e(t,n){var i,r=n&&n.whereList?n.whereList:{},o=n&&n.orderList?n.orderList:{byOrder:{expression:"sortOrder",order:"asc"}};return r.enumGroupFilter={expression:"[eGroup]",condition:"equal",values:{eGroup:t}},i=Ext.create("UB.ux.data.UBStore",{ubRequest:{entity:"ubm_enum",method:UB.core.UBCommand.methodName.SELECT,fieldList:n&&n.fieldList?n.fieldList:["eGroup","code","name","shortName","sortOrder"],whereList:r,orderList:o,idProperty:"code"},disablePaging:!0,autoLoad:!1,autoDestroy:!0}),i.load(),{xtype:"ubbasebox",disableContextMenu:!0,store:i,valueField:"code",displayField:"name",queryMode:"local",editable:!1,forceSelection:!0,grow:!1}},getEntityAttributesTree:function e(t){var n=$App.domainInfo.get(t);return n?{leaf:!1,id:t,expanded:!0,text:n.caption||t,children:UB.core.UBUtil.getEntityAttributesTreeData(n,"",1)}:void 0},getEntityAttributesTreeData:function e(t,n,r){var o=[],a,s,l=i.ubDataTypes.Entity;return(s="string"==typeof t?$App.domainInfo.get(t):t)?r>3?o:(s.eachAttribute(function(e,s){a={id:UB.core.UBUtil.gatherStr(n,".",s),text:e.caption?e.caption+"["+s+"]":s,leaf:e.dataType!==i.ubDataTypes.Entity,parentId:n||t},e.allowNull||(a.text="<b>"+a.text+"<b>"),e.dataType===l&&t!==e.associatedEntity&&(a.children=UB.core.UBUtil.getEntityAttributesTreeData(e.associatedEntity,a.id,r+1)),o.push(a)}),o):o}},function(){Ext.ns("UB.Utils"),UB.Utils=UB.core.UBUtil})},function(e,t,n){n(2),n(3),Ext.define("UB.core.UBStoreManager",{singleton:!0,getStore:function e(t,n,i){return Ext.data.StoreManager.lookup(UB.core.UBUtil.getNameMd5(t,n,i))},getSystemEntityStoreGetterName:function e(t){return"get"+Ext.String.capitalize(t)+"Store"},getSystemEntityStore:function e(t){return this[this.getSystemEntityStoreGetterName(t)]()},getDesktopStore:function e(){var t="ubm_desktop";return this.getStore(t,$App.domainInfo.get(t).getAttributeNames())},shortcutCommandCache:{},shortcutAttributes:["ID","desktopID","parentID","code","isFolder","caption","inWindow","isCollapsed","displayOrder","iconCls"],getNavshortcutCommandText:function e(t){var n=UB.core.UBStoreManager.shortcutCommandCache[t],i;return i=n?Promise.resolve(n):UB.Repository("ubm_navshortcut").attrs(["ID","cmdCode"]).where("ID","=",t).selectSingle().then(function(e){var n=Ext.JSON.decode(e.cmdCode);return UB.core.UBStoreManager.shortcutCommandCache[t]=n,n})},getNavigationShortcutStore:function e(){return this.getStore("ubm_navshortcut",this.shortcutAttributes)},getFormStore:function e(){return this.getStore("ubm_form",$App.domainInfo.get("ubm_form").getAttributeNames())},getEnumStore:function e(){return this.getStore("ubm_enum",$App.domainInfo.get("ubm_enum").getAttributeNames())},get_enum_Store:function e(){return this.getEnumStore()}})},function(e,t){function n(){throw Error("setTimeout has not been defined")}function i(){throw Error("clearTimeout has not been defined")}function r(e){if(d===setTimeout)return setTimeout(e,0);if((d===n||!d)&&setTimeout)return d=setTimeout,setTimeout(e,0);try{return d(e,0)}catch(t){try{return d.call(null,e,0)}catch(t){return d.call(this,e,0)}}}function o(e){if(f===clearTimeout)return clearTimeout(e);if((f===i||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function a(){p&&m&&(p=!1,m.length?h=m.concat(h):g=-1,h.length&&s())}function s(){if(!p){var e=r(a);p=!0;for(var t=h.length;t;){for(m=h,h=[];++g<t;)m&&m[g].run();g=-1,t=h.length}m=null,p=!1,o(e)}}function l(e,t){this.fun=e,this.array=t}function u(){}var c=e.exports={},d,f;!function(){try{d="function"==typeof setTimeout?setTimeout:n}catch(e){d=n}try{f="function"==typeof clearTimeout?clearTimeout:i}catch(e){f=i}}();var h=[],p=!1,m,g=-1;c.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];h.push(new l(e,t)),1!==h.length||p||r(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=u,c.addListener=u,c.once=u,c.off=u,c.removeListener=u,c.removeAllListeners=u,c.emit=u,c.prependListener=u,c.prependOnceListener=u,c.listeners=function(e){return[]},c.binding=function(e){throw Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(e){throw Error("process.chdir is not supported")},c.umask=function(){return 0}},function(e,t,n){"use strict";function i(e,t){function n(i){if(!(this instanceof n))return new n(i);u(this,"message","string"==typeof i?i:t),u(this,"name",e),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return l(n,Error),n}function r(e){if(!(this instanceof r))return new r(e);u(this,"name","OperationalError"),u(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(u(this,"message",e.message),u(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var o=n(8),a=o.freeze,s=n(0),l=s.inherits,u=s.notEnumerableProp,c,d,f=i("Warning","warning"),h=i("CancellationError","cancellation error"),p=i("TimeoutError","timeout error"),m=i("AggregateError","aggregate error");try{c=TypeError,d=RangeError}catch(e){c=i("TypeError","type error"),d=i("RangeError","range error")}for(var g="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),y=0;y<g.length;++y)"function"==typeof Array.prototype[g[y]]&&(m.prototype[g[y]]=Array.prototype[g[y]]);o.defineProperty(m.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),m.prototype.isOperational=!0;var v=0;m.prototype.toString=function(){var e=Array(4*v+1).join(" "),t="\n"+e+"AggregateError of:\n";v++,e=Array(4*v+1).join(" ");for(var n=0;n<this.length;++n){for(var i=this[n]===this?"[Circular AggregateError]":this[n]+"",r=i.split("\n"),o=0;o<r.length;++o)r[o]=e+r[o];i=r.join("\n"),t+=i+"\n"}return v--,t},l(r,Error);var b=Error.__BluebirdErrorTypes__;b||(b=a({CancellationError:h,TimeoutError:p,OperationalError:r,RejectionError:r,AggregateError:m}),o.defineProperty(Error,"__BluebirdErrorTypes__",{value:b,writable:!1,enumerable:!1,configurable:!1})),e.exports={Error:Error,TypeError:c,RangeError:d,CancellationError:b.CancellationError,OperationalError:b.OperationalError,TimeoutError:b.TimeoutError,AggregateError:b.AggregateError,Warning:f}},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){var n=function(){"use strict";return void 0===this}();if(n)e.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:n,propertyIsWritable:function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,r={}.toString,o={}.constructor.prototype,a=function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(n);return t},s=function(e,t){return{value:e[t]}},l=function(e,t,n){return e[t]=n.value,e},u=function(e){return e},c=function(e){try{return Object(e).constructor.prototype}catch(e){return o}},d=function(e){try{return"[object Array]"===r.call(e)}catch(e){return!1}};e.exports={isArray:d,keys:a,names:a,defineProperty:l,getDescriptor:s,freeze:u,getPrototypeOf:c,isES5:n,propertyIsWritable:function(){return!0}}}},function(e,t,n){var i,r,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(n,s){"object"===a(t)?e.exports=t=s():(r=[],i=s,void 0!==(o="function"==typeof i?i.apply(t,r):i)&&(e.exports=o))}(void 0,function(){var e=e||function(e,t){var n={},i=n.lib={},r=i.Base=function(){function e(){}return{extend:function t(n){e.prototype=this;var i=new e;return n&&i.mixIn(n),i.hasOwnProperty("init")||(i.init=function(){i.$super.init.apply(this,arguments)}),i.init.prototype=i,i.$super=this,i},create:function e(){var t=this.extend();return t.init.apply(t,arguments),t},init:function e(){},mixIn:function e(t){for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function e(){return this.init.prototype.extend(this)}}}(),o=i.WordArray=r.extend({init:function e(n,i){n=this.words=n||[],this.sigBytes=i!=t?i:4*n.length},toString:function e(t){return(t||s).stringify(this)},concat:function e(t){var n=this.words,i=t.words,r=this.sigBytes,o=t.sigBytes;if(this.clamp(),r%4)for(var a=0;a<o;a++){var s=i[a>>>2]>>>24-a%4*8&255;n[r+a>>>2]|=s<<24-(r+a)%4*8}else if(i.length>65535)for(var a=0;a<o;a+=4)n[r+a>>>2]=i[a>>>2];else n.push.apply(n,i);return this.sigBytes+=o,this},clamp:function t(){var n=this.words,i=this.sigBytes;n[i>>>2]&=4294967295<<32-i%4*8,n.length=e.ceil(i/4)},clone:function e(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function t(n){for(var i=[],r=function t(n){var n=n,i=987654321,r=4294967295;return function(){i=36969*(65535&i)+(i>>16)&r,n=18e3*(65535&n)+(n>>16)&r;var t=(i<<16)+n&r;return t/=4294967296,(t+=.5)*(e.random()>.5?1:-1)}},a=0,s;a<n;a+=4){var l=r(4294967296*(s||e.random()));s=987654071*l(),i.push(4294967296*l()|0)}return new o.init(i,n)}}),a=n.enc={},s=a.Hex={stringify:function e(t){for(var n=t.words,i=t.sigBytes,r=[],o=0;o<i;o++){var a=n[o>>>2]>>>24-o%4*8&255;r.push((a>>>4).toString(16)),r.push((15&a).toString(16))}return r.join("")},parse:function e(t){for(var n=t.length,i=[],r=0;r<n;r+=2)i[r>>>3]|=parseInt(t.substr(r,2),16)<<24-r%8*4;return new o.init(i,n/2)}},l=a.Latin1={stringify:function e(t){for(var n=t.words,i=t.sigBytes,r=[],o=0;o<i;o++){var a=n[o>>>2]>>>24-o%4*8&255;r.push(String.fromCharCode(a))}return r.join("")},parse:function e(t){for(var n=t.length,i=[],r=0;r<n;r++)i[r>>>2]|=(255&t.charCodeAt(r))<<24-r%4*8;return new o.init(i,n)}},u=a.Utf8={stringify:function e(t){try{return decodeURIComponent(escape(l.stringify(t)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function e(t){return l.parse(unescape(encodeURIComponent(t)))}},c=i.BufferedBlockAlgorithm=r.extend({reset:function e(){this._data=new o.init,this._nDataBytes=0},_append:function e(t){"string"==typeof t&&(t=u.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function t(n){var i=this._data,r=i.words,a=i.sigBytes,s=this.blockSize,l=4*s,u=a/l;u=n?e.ceil(u):e.max((0|u)-this._minBufferSize,0);var c=u*s,d=e.min(4*c,a);if(c){for(var f=0;f<c;f+=s)this._doProcessBlock(r,f);var h=r.splice(0,c);i.sigBytes-=d}return new o.init(h,d)},clone:function e(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),d=i.Hasher=c.extend({cfg:r.extend(),init:function e(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function e(){c.reset.call(this),this._doReset()},update:function e(t){return this._append(t),this._process(),this},finalize:function e(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function e(t){return function(e,n){return new t.init(n).finalize(e)}},_createHmacHelper:function e(t){return function(e,n){return new f.HMAC.init(t,n).finalize(e)}}}),f=n.algo={};return n}(Math);return e})},function(e,t,n){var i=n(19),r=n(11),o=n(24),a=n(51),s=n(55),l=n(28),u=n(25),c=n(12),d=n(26),f=n(27),h=n(56);e.exports={i18n:i.i18n,i18nExtend:i.i18nExtend,format:r.format,apply:r.apply,ns:r.ns,booleanParse:r.booleanParse,iso8601Parse:r.iso8601Parse,iso8601ParseAsDate:r.iso8601ParseAsDate,base64FromAny:r.base64FromAny,base64toArrayBuffer:r.base64toArrayBuffer,UBError:r.UBError,UBAbortError:r.UBAbortError,xhr:o.xhr,get:o.get,post:o.post,UBNativeMessage:h,UBConnection:a,UBCache:u,connect:a.connect,ClientRepository:l,LocalDataStore:c,log:r.log,logError:r.logError,logWarn:r.logWarn,logDebug:r.logDebug,userAgent:r.userAgent,isChrome:r.isChrome,isWebKit:r.isWebKit,isGecko:r.isGecko,isOpera:r.isOpera,isMac:r.isMac,isSecureBrowser:r.isSecureBrowser,inject:s.inject,addResourceVersion:s.addResourceVersion,SHA256:d,MD5:f}},function(e,t,n){function i(e,t,n){this.name="UBError",this.detail=t,this.code=n,this.message=e||"UBError",Error.captureStackTrace?Error.captureStackTrace(this,i):this.stack=Error().stack}function r(e,t){this.name="UBAbortError",this.detail=t,this.code="UBAbortError",this.message=e||"UBAbortError",Error.captureStackTrace?Error.captureStackTrace(this,r):this.stack=Error().stack}var o=n(1);e.exports.apply=function(e,t){return Array.prototype.forEach.call(arguments,function(t){t&&t!==e&&Object.keys(t).forEach(function(n){e[n]=t[n]})}),e};var a=/{(\d+)}/g;e.exports.format=function(e,t){var n=o.toArray(arguments).slice(1);return e.replace(a,function(e,t){return n[t]})},e.exports.ns=function(e){var t=window,n=void 0,i=void 0,r=void 0,o=void 0;for(n=e.split("."),r=0,o=n.length;r<o;r++)i=n[r],t[i]||(t[i]={}),t=t[i];return t},e.exports.iso8601Parse=function(e){return e?new Date(e):null},e.exports.iso8601ParseAsDate=function(e){var t=e?new Date(e):null;return t&&t.setTime(t.getTime()+60*t.getTimezoneOffset()*1e3),t},e.exports.booleanParse=function(e){return"boolean"==typeof e?e:void 0===e||null===e||""===e?null:1===e},e.exports.base64FromAny=function(e){return new Promise(function(t,n){var i=new FileReader,r=e instanceof Blob?e:new Blob([e]);i.addEventListener("loadend",function(){t(i.result.split(",",2)[1])}),i.addEventListener("error",function(e){n(e)}),i.readAsDataURL(r)})};var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=[];!function(){for(var e=0,t=s.length-1;e<t;e++)l.push(s[e])}();var u=new Uint8Array(256);!function(){for(var e=0,t=s.length;e<t;e++)u[s[e].charCodeAt(0)]=e}(),e.exports.base64toArrayBuffer=function(e){var t=.75*e.length,n=e.length,i=0,r=void 0,o=void 0,a=void 0,s=void 0;"="===e[e.length-1]&&(t--,"="===e[e.length-2]&&t--);for(var l=new ArrayBuffer(t),c=new Uint8Array(l),d=0;d<n;d+=4)r=u[e.charCodeAt(d)],o=u[e.charCodeAt(d+1)],a=u[e.charCodeAt(d+2)],s=u[e.charCodeAt(d+3)],c[i++]=r<<2|o>>4,c[i++]=(15&o)<<4|a>>2,c[i++]=(3&a)<<6|63&s;return l},i.prototype=Error(),i.prototype.constructor=i,e.exports.UBError=i,r.prototype=Error(),r.prototype.constructor=r,e.exports.UBAbortError=r,e.exports.log=function e(t){console&&console.log.apply(console,arguments)},e.exports.logError=function e(t){console&&console.error.apply(console,arguments)},e.exports.logWarn=function e(t){console&&console.warn.apply(console,arguments)},e.exports.logDebug=console.info.bind(console);var c="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"nodeJS";e.exports.userAgent=c.toLowerCase(),e.exports.isChrome=/\bchrome\b/.test(c),e.exports.isWebKit=/webkit/.test(c),e.exports.isGecko=!/webkit/.test(c)&&/gecko/.test(c),e.exports.isOpera=/opr|opera/.test(c),e.exports.isMac=/macintosh|mac os x/.test(c),e.exports.isSecureBrowser=/\belectron\b/.test(c)},function(e,t,n){function i(e,t){function n(e){var n=e.expression||"";if("custom"===e.condition)throw Error('Condition "custom" is not supported for cached instances.');if(n=(n.replace(/(\[)|(])/gi,"")||"").trim(),-1===(i=t.indexOf(n)))throw Error("Filtering by field "+n+" is not allowed, because it is not in fieldList");o=r.values(e.values)[0],s.push(a(i,e.condition,o))}Object.keys(e);var i=void 0,o=void 0,a=void 0,s=[],l=function e(t){return t?(""+t).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):""},u=e.whereList;a=function e(t,n,i){var r=void 0;switch(n){case"like":return r=RegExp(l(i),"i"),function(e){var n=e[t];return n&&r.test(n)};case"equal":return function(e){return e[t]===i};case"notEqual":return function(e){return e[t]!==i};case"more":return function(e){return e[t]>i};case"moreEqual":return function(e){return e[t]>=i};case"less":return function(e){return e[t]<i};case"lessEqual":return function(e){return e[t]<=i};case"isNull":return function(e){return null===e[t]};case"notIsNull":return function(e){return null!==e[t]};case"notLike":return r=RegExp(l(i),"i"),function(e){var n=e[t];return n&&!r.test(n)};case"startWith":return function(e){var n=e[t];return n&&0===n.indexOf(i)};case"notStartWith":return function(e){var n=e[t];return n&&0!==n.indexOf(i)};case"in":return function(e){var n=e[t];return n&&i.indexOf(n)>=0};case"notIn":return function(e){var n=e[t];return n&&i.indexOf(n)<0};default:throw Error("Unknown whereList condition")}};var c=e.ID;return c&&n({expression:"[ID]",condition:"equal",values:{ID:c}}),r.forEach(u,n),s}var r=n(1);e.exports.doFilterAndSort=function(e,t){var n=void 0,i=this.doFiltration(e,t),r=i.length;return this.doSorting(i,e,t),t.options&&(n=t.options.start||0,i=t.options.limit?i.slice(n,n+t.options.limit):i.slice(n)),{resultData:{data:i,fields:e.fields},total:r}},e.exports.byID=function(e,t){return this.doFilterAndSort(e,{ID:t})},e.exports.doFiltration=function(e,t){var n=void 0,r=void 0,o=e.data,a=!!t.ID,s=i(t,e.fields),l=s.length;if(0===l)return o;for(var u=[],c=o.length,d=-1;++d<c;){for(r=!0,n=-1;++n<l&&!0===r;)r=s[n](o[d]);if(r&&(u.push(o[d]),a))return u}return u},e.exports.doSorting=function(e,t,n){var i=[];if(n.orderList){r.each(n.orderList,function(e){var n=t.fields.indexOf(e.expression);if(n<0)throw Error("Ordering by "+e.expression+" attribute that don't present in fieldList not allowed");i.push({idx:n,modifier:"desc"===e.order?-1:1})});var o=i.length;if(o){var a=function e(t,n){for(var r=0,a=-1;++a<o&&0===r;){var s=i[a].idx;t[s]!==n[s]&&(r=null===t[s]&&null!==n[s]?1:null===n[s]&&null!==t[s]?-1:null===n[s]&&null===t[s]?0:t[s]>n[s]?1:-1,r*=i[a].modifier)}return r};e.sort(a)}}},e.exports.selectResultToArrayOfObjects=function(e,t){var n=e.resultData.data,i=e.resultData.fields,o=n.length,a=o?Array(o):[];t&&r.forEach(t,function(e,t){var n=i.indexOf(t);n>=0&&(i[n]=e)});for(var s=0;s<o;s++)a[s]=r.zipObject(i,n[s]);return a},e.exports.flatten=function(e,t){var n=[],i=t.fields,r=-1,o=-1,a=0,s=[],l=t.data.length,u=void 0,c=void 0,d=void 0;if(!e||!e.length)throw Error("fieldList not exist or empty");for(1===e.length&&"*"===e[0]&&(e=t.fields),e.forEach(function(e){if(-1===(u=i.indexOf(e)))throw Error("Invalid field list. Attribute "+e+" not found in local data store");n.push(u)}),d=e.length,s.length=l*(d+1);++o<d;)s[a]=e[a],a++;for(;++r<l;)for(o=-1,c=t.data[r];++o<d;)s[a++]=c[n[o]];return{fieldCount:d,rowCount:l,values:s}},e.exports.arrayOfObjectsToSelectResult=function(e,t){var n=[];return e.forEach(function(e){var i=[];t.forEach(function(t){i.push(e[t])}),n.push(i)}),n}},function(e,t,n){(function(t){function i(e){var t=this,n=Object.keys(e.domain),i=void 0===e.entityMethods;this.entities={},this.connections=e.connections;for(var o=0,a=n.length;o<a;o++){var l=n[o],u=e.domain[l];if(u.i18n&&u.i18n.attributes&&Array.isArray(u.i18n.attributes)){for(var c=u.i18n.attributes,d={},f=0,h=c.length;f<h;f++){var p=c[f],m=p.name;if(!m)throw Error("Invalid localization JSON for entity "+l);delete p.name,d[m]=p}u.i18n.attributes=d}t.entities[l]=i?new s(u,u.entityMethods||{},u.i18n,l,t):new s(u,e.entityMethods[l]||{},e.i18n[l],l,t)}this.models={},Object.keys(e.models).forEach(function(n){var i=e.models[n];t.models[n]=new r(i,n)}),this.forceMIMEConvertors=e.forceMIMEConvertors}function r(e,t){this.name=t,this.path=e.path,e.needInit&&(this.needInit=e.needInit),e.needLocalize&&(this.needLocalize=e.needLocalize),this.order=e.order,this.moduleName=e.moduleName,this.clientRequirePath=e.moduleSuffix&&e.moduleName?this.moduleName+"/"+e.moduleSuffix:this.moduleName||this.path,e.realPublicPath&&(this.realPublicPath=e.realPublicPath)}function o(){}function a(e){this.selectName=e.selectName||"",this.execName=e.execName||this.selectName,this.pkGenerator=e.pkGenerator}function s(e,t,n,r,s){var l=this,u=this,c=void 0,d=void 0,x=void 0,E=void 0;if(n&&b.merge(e,n),Object.defineProperty(this,"domain",{enumerable:!1,value:s}),this.code=r,this.modelName=e.modelName,this.name=e.name,e.caption&&(this.caption=e.caption),e.description&&(this.description=e.description),e.documentation&&(this.documentation=e.documentation),e.descriptionAttribute&&(this.descriptionAttribute=e.descriptionAttribute),e.cacheType&&(this.cacheType=e.cacheType),e.dsType&&(this.dsType=e.dsType),this.sqlAlias=e.sqlAlias,this.connectionName=e.connectionName,this.isFTSDataTable=!0===e.isFTSDataTable,this.connectionConfig=this.connectionName&&this.domain.connections?b.find(this.domain.connections,{name:this.connectionName}):void 0,this.mapping=void 0,e.mapping){var w=Object.keys(e.mapping);if(w.forEach(function(e){if(!i.dialectsPriority[e])throw Error("Invalid dialect "+e+" in "+l.code+" mapping")}),w.length){var C=this;E=i.dialectsPriority[this.connectionConfig.dialect],b.forEach(E,function(t){if(e.mapping[t])return C.mapping=new a(e.mapping[t]),!1})}}this.dbKeys=e.dbKeys&&Object.keys(e.dbKeys).length?e.dbKeys:void 0,this.dbExtensions=e.dbExtensions&&Object.keys(e.dbExtensions).length?e.dbExtensions:void 0,this.attributes=new o,b.forEach(e.attributes,function(e,t){var n=new f(e,t,u);"mi_dateTo"===n.code&&"undefined"!=typeof window&&(n.allowNull=!0),u.attributes[t]=n}),c=Object.keys(e.mixins||{}),this.mixins={},c.forEach(function(t){switch(d=e.mixins[t],x=n&&n.mixins?n.mixins[t]:null,t){case"mStorage":u.mixins[t]=new p(d,x,t);break;case"dataHistory":u.mixins[t]=new m(d,x,t);break;case"aclRls":u.mixins[t]=new g(d,x,t);break;case"fts":u.mixins[t]=new y(d,x,t);break;case"als":u.mixins[t]=new v(d,x,t);break;default:u.mixins[t]=new h(d,x,t)}}),this.entityMethods=t||{}}function l(e){return e?new Date(e):null}function u(e){var t=e?new Date(e):null;return t&&t.setTime(t.getTime()+60*t.getTimezoneOffset()*1e3),t}function c(e){return"boolean"==typeof e?e:void 0===e||null===e||""===e?null:1===e||"1"===e}function d(e){this.expressionType=e.expressionType,this.expression=e.expression}function f(e,t,n){if(this.code=t,this.name=e.name,Object.defineProperty(this,"entity",{enumerable:!1,value:n}),this.dataType=e.dataType||"String",this.associatedEntity=e.associatedEntity,this.associationAttr=e.associationAttr,this.caption=e.caption||"",this.description=e.description||"",this.documentation=e.documentation||"",this.size=e.size||0,this.allowNull=!1!==e.allowNull,this.allowSort=!1!==e.allowSort,this.isUnique=!0===e.isUnique,this.defaultValue=e.defaultValue,this.readOnly=!0===e.readOnly,this.isMultiLang=!0===e.isMultiLang,this.cascadeDelete=!0===e.cascadeDelete,this.enumGroup=e.enumGroup,this.customSettings=e.customSettings||{},this.associationManyData=e.associationManyData,this.storeName=e.storeName,this.generateFK=!1!==e.generateFK,this.defaultView=!1!==e.defaultView,this.mapping=void 0,e.mapping){var r=this,o=Object.keys(e.mapping);if(o.forEach(function(e){if(!i.dialectsPriority[e])throw Error("Invalid dialect "+e+" in "+n.code+"."+r.code+" mapping")}),o.length){var a=i.dialectsPriority[this.entity.connectionConfig.dialect];b.forEach(a,function(t){if(e.mapping[t])return r.mapping=new d(e.mapping[t]),!1})}}this.physicalDataType=i.getPhysicalDataType(this.dataType||"String")}function h(e,t,n){this.code=n,b.assign(this,e),t&&b.assign(this,t)}function p(e,t,n){h.apply(this,arguments)}function m(e,t,n){h.apply(this,arguments)}function g(e,t,n){h.apply(this,arguments)}function y(e,t,n){h.apply(this,arguments)}function v(e,t,n){h.apply(this,arguments)}var b=n(1);i.prototype.isEntityMethodsAccessible=function(e,t){var n=this.entities[e];return!!n&&(Array.isArray(t)?n.haveAccessToMethods(t):n.haveAccessToMethod(t))},i.prototype.get=function(e,t){var n=this.entities[e];if(!1!==t&&!n)throw Error('Entity with code "'+e+'" does not exists or not accessible');return n},i.prototype.has=function(e){return!!this.entities[e]},i.prototype.eachEntity=function(e){return b.forEach(this.entities,e)},i.prototype.filterEntities=function(e){return b.isFunction(e)?b.filter(this.entities,e):b.filter(this.entities,function(t){var n=!0;for(var i in e)e.hasOwnProperty(i)&&(n=n&&t[i]===e[i]);return n})},i.ubDataTypes={String:"String",Int:"Int",BigInt:"BigInt",Float:"Float",Currency:"Currency",Boolean:"Boolean",DateTime:"DateTime",Text:"Text",ID:"ID",Entity:"Entity",Document:"Document",Many:"Many",TimeLog:"TimeLog",Enum:"Enum",BLOB:"BLOB",Date:"Date"},i.prototype.ubDataTypes=i.ubDataTypes,i.ExpressionType={Field:"Field",Expression:"Expression"},i.ubMixins={dataHistory:"dataHistory",mStorage:"mStorage",unity:"unity",treePath:"treePath"},i.ubServiceFields={dateFrom:"mi_datefrom",dateTo:"mi_dateto"},i.EntityDataSourceType={Normal:"Normal",External:"External",System:"System",Virtual:"Virtual"},i.EntityCacheTypes={None:"None",Entity:"Entity",Session:"Session",SessionEntity:"SessionEntity"},i.dialectsPriority={MSSQL2012:["MSSQL2012","MSSQL","AnsiSQL"],MSSQL2008:["MSSQL2008","MSSQL","AnsiSQL"],MSSQL:["MSSQL","AnsiSQL"],Oracle11:["Oracle11","Oracle","AnsiSQL"],Oracle10:["Oracle10","Oracle","AnsiSQL"],Oracle9:["Oracle9","Oracle","AnsiSQL"],Oracle:["Oracle","AnsiSQL"],PostgreSQL:["PostgreSQL","AnsiSQL"],AnsiSQL:["AnsiSQL"],Firebird:["Firebird","AnsiSQL"],SQLite3:["SQLite3","AnsiSQL"]},i.getPhysicalDataType=function(e){var t=i.ubDataTypes,n={};return this.physicalTypeMap||(n[t.Int]="int",n[t.Entity]="int",n[t.ID]="int",n[t.BigInt]="int",n[t.String]="string",n[t.Text]="string",n[t.Enum]="string",n[t.Float]="float",n[t.Currency]="float",n[t.Boolean]="boolean",n[t.Date]="date",n[t.DateTime]="date",this.physicalTypeMap=n),this.physicalTypeMap[e]||"auto"},r.prototype.needInit=!1,r.prototype.needLocalize=!1,r.prototype.realPublicPath="",o.prototype.asJSON=function(){var e={};return b.forEach(this,function(t,n){t.asJSON?e[n]=t.asJSON():e[n]=t}),e},s.prototype.caption="",s.prototype.description="",s.prototype.documentation="",s.prototype.descriptionAttribute="",s.prototype.cacheType="None",s.prototype.dsType="Normal",s.prototype.getEntityCaption=function(){return this.caption||this.description},s.prototype.attr=function(e,t){var n=this.attributes[e];return n||t||(n=this.getEntityAttribute(e)),n},s.prototype.getAttribute=function(e){var t=this.attributes[e];if(!t)throw Error("Attribute "+this.code+"."+e+" doesn't exist");return t},s.prototype.eachAttribute=function(e){return b.forEach(this.attributes,e)},s.prototype.mixin=function(e){return this.mixins[e]},s.prototype.hasMixin=function(e){var t=this.mixins[e];return"audit"===e?!t||!!t&&t.enabled:!!t&&t.enabled},s.prototype.checkMixin=function(e){if(!this.hasMixin(e))throw Error("Entity "+this.code+" does not have mixin "+e)},s.prototype.asJSON=function(){var e={code:this.code};return b.forEach(this,function(t,n){"domain"!==n&&(t.asJSON?e[n]=t.asJSON():e[n]=t)}),e},s.prototype.haveAccessToMethod=function(e){return UB.isServer&&t.isServer?App.els(this.code,e):1===this.entityMethods[e]},s.prototype.filterAttribute=function(e){return b.isFunction(e)?b.filter(this.attributes,e):b.filter(this.attributes,function(t){var n=!0;for(var i in e)e.hasOwnProperty(i)&&(n=n&&t[i]===e[i]);return n})},s.prototype.haveAccessToAnyMethods=function(e){var n=this,i=e||[],r=!1;return i.forEach(function(e){r=UB.isServer&&t.isServer?r||App.els(n.code,e):r||1===n.entityMethods[e]}),r},s.prototype.haveAccessToMethods=function(e){var n=this,i=!0;return(e||[]).forEach(function(e){i=UB.isServer&&t.isServer?i&&App.els(n.code,e):i&&1===n.entityMethods[e]}),i},s.prototype.getConvertRules=function(e){var t=this,n=[],r=i.ubDataTypes;return e.forEach(function(e,i){var o=t.attr(e);o&&(o.dataType===r.DateTime?n.push({index:i,convertFn:l}):o.dataType===r.Date?n.push({index:i,convertFn:u}):o.dataType===r.Boolean&&n.push({index:i,convertFn:c}))}),n},s.prototype.getDescriptionAttribute=function(){var e=this.descriptionAttribute||"caption";if(!this.attr(e))throw Error("Missing description attribute for entity "+this.code);return e},s.prototype.getEntityAttributeInfo=function(e,t){var n=this,i=e.split("."),r=-(i.length-1),o=[],a=this.code,s=void 0,l=void 0;if(t&&t>0)return{entity:a,attribute:n.attr(i[0]),attributeCode:i[0]};for(;n&&i.length;){if(n&&1===i.length)return o=i[0].split("@"),o.length>1&&(n=this.domain.get(o[1]),e=o[0]),{entity:a,attribute:n.attr(e),attributeCode:e};if(l=i.shift(),o=l.split("@"),o.length>1&&(a=o[1],n=this.domain.get(a),l=o[0]),!(s=n.attr(l)))return;if(r===(t||0))return{entity:a,attribute:s,attributeCode:l};if(e=i[0],"Enum"===s.dataType&&"name"===e)return{entity:a,attribute:s,attributeCode:l};a=s.associatedEntity,n=s.getAssociatedEntity(),r+=1}},s.prototype.getEntityAttribute=function(e,t){var n=this,i=e.split("."),r=-(i.length-1),o=[],a=void 0,s=void 0;if(t&&t>0)return n.attributes[i[0]];for(;n&&i.length;){if(n&&1===i.length)return o=i[0].split("@"),o.length>1&&(n=this.domain.get(o[1]),e=o[0]),n.attributes[e];if(s=i.shift(),o=s.split("@"),o.length>1&&(n=this.domain.get(o[1]),s=o[0]),!(a=n.attributes[s]))return;if(r===(t||0))return a;if(e=i[0],"Enum"===a.dataType){if("name"===e)return a;n=this.domain.get("ubm_enum")}else n=this.domain.get(a.associatedEntity);r+=1}},s.prototype.getAttributeNames=function(e){var t=[];return e?(b.forEach(this.filterAttribute(e),function(e){t.push(e.code)}),t):Object.keys(this.attributes)},s.prototype.getEntityRequirements=function(e){var t=[];e=e||this.getAttributeNames();for(var n=0,i=e.length;n<i;++n){var r=e[n].split("."),o=this.getEntityAttribute(r[0]);if("Entity"===o.dataType)if(r.length>1){var a=[r.slice(1).join(".")];t=b.union(t,o.getAssociatedEntity().getEntityRequirements(a))}else t=b.union(t,[o.associatedEntity])}return t},s.prototype.checkAttributeExist=function(e,t){var n=this;e=b.isArray(e)?e:[e],b.forEach(e,function(e){if(!n.getEntityAttributeInfo(e))throw Error(t+(t?" ":"")+'The entity "'+n.code+'" does not have attribute "'+e+'"')})},s.prototype.getEntityDescription=function(){return this.description||this.caption},f.prototype.getAssociatedEntity=function(){return this.associatedEntity?this.entity.domain.get(this.associatedEntity):null},f.prototype.asJSON=function(){var e={};return b.forEach(this,function(t,n){"entity"!==n&&(t.asJSON?e[n]=t.asJSON():e[n]=t)}),e},h.prototype.enabled=!0,p.prototype=Object.create(h.prototype),p.prototype.constructor=p,p.prototype.simpleAudit=!1,p.prototype.safeDelete=!1,m.prototype=Object.create(h.prototype),m.prototype.constructor=m,m.prototype.historyType="common",g.prototype=Object.create(h.prototype),g.prototype.constructor=g,g.prototype.aclRlsUseUnityName=!1,g.prototype.aclRlsSelectionRule="exists",y.prototype=Object.create(h.prototype),y.prototype.constructor=y,y.prototype.scope="connection",y.prototype.dataProvider="mixin",v.prototype=Object.create(h.prototype),v.prototype.constructor=v,v.prototype.alsOptimistic=!0,i.UBEntity=s,i.UBModel=r,i.UBEntity.UBEntityAttribute=f,e.exports=i}).call(t,n(5))},function(e,t,n){(function(e){n(98),n(32),n(99),n(43),n(168),n(169),n(4);var t=n(1),i=n(10),r=/[A-Za-z\u0410-\u042f\u0430-\u044f\u0401\u0451\u0456\u0406\u0457\u0407\u0491\u0490]/,o=/[A-Za-z]/,a=/[A-Z\u0410-\u042f\u0401\u0406\u0407\u0490]/;Ext.define("UB.core.UBApp",{singleton:!0,requires:["Ext.Loader","UB.view.LoginWindow","UB.view.cryptoUI.ReadPK","Ext.ux.window.Notification"],uses:["UB.core.UBCommand"],mixins:{observable:"Ext.util.Observable"},core:null,constructor:function e(){return this.requireEncription=!1,this.mixins.observable.constructor.call(this),this.connection=null,this.ubNotifier=null,this.domain=null,this.domainInfo=null,window.$App=this,this.addEvents("desktopChanged","appInitialize","applicationReady","getDomainInfo","updateCenterPanel","windowActivated","windowDestroyed","buildMainMenu"),this},passwordKeyUpHandler:function e(t){var n=t.getValue()||"";if(n){var i=n.length,s=n.substr(i-1,1);r.test(s)&&(o.test(s)?t.addClass("ub-pwd-keyboard-en"):t.removeCls("ub-pwd-keyboard-en"),a.test(s)?t.addClass("ub-pwd-keyboard-caps"):t.removeCls("ub-pwd-keyboard-caps"))}else t.removeCls("ub-pwd-keyboard-caps"),t.removeCls("ub-pwd-keyboard-en")},onPasswordChange:function e(t){var n=new Ext.Window({extend:"Ext.form.Panel",layout:"vbox",height:300,width:400,items:[{xtype:"label",width:"100%",text:i.i18n("Your password is expired. Please change password")},{xtype:"textfield",inputType:"password",listeners:{keyup:{fn:$App.passwordKeyUpHandler}},enableKeyEvents:!0,emptyText:i.i18n("EnterOldPassword"),fieldLabel:i.i18n("OldPassword"),labelWidth:100,name:"oldPwd",margins:10,width:"100%",allowBlank:!1},{xtype:"textfield",inputType:"password",listeners:{keyup:{fn:$App.passwordKeyUpHandler}},enableKeyEvents:!0,emptyText:i.i18n("EnterNewPassword"),fieldLabel:i.i18n("NewPassword"),labelWidth:100,name:"newPwd",margins:10,width:"100%",allowBlank:!1,afterLabelTextTpl:['<b data-qtitle="',i.i18n("HowToCreatePassword"),'" data-qtip="',i.i18n("passwordRecommendation"),'" style="color: red;">?</b>']},{xtype:"textfield",inputType:"password",listeners:{keyup:{fn:$App.passwordKeyUpHandler}},enableKeyEvents:!0,emptyText:i.i18n("RetypePassword"),fieldLabel:i.i18n("RetypePassword"),labelWidth:100,name:"newPwdRetyped",margins:10,width:"100%",allowBlank:!1,validator:function e(t){var n=this.up("panel").down("textfield[name=newPwd]").getValue()===t;return this.up("window").down("button[ubID=btnOK]")[n?"enable":"disable"](),n}}],buttons:[{ubID:"btnOK",text:i.i18n("Change"),glyph:i.core.UBUtil.glyphs.faSave,disabled:!0}]});n.down('component[ubID="btnOK"]').handler=function(){t.xhr({url:"changePassword",method:"POST",data:{newPwd:n.down("textfield[name=newPwd]").getValue(),pwd:""+window.UB.SHA256("salt"+n.down("textfield[name=oldPwd]").getValue())}}).then(function(){n.close(),$App.dialogInfo("passwordChangedSuccessfully").then(function(){$App.logout()})})},n.show()},launch:function e(){var n=this;return i.connect({host:window.location.origin,path:window.UB_API_PATH||window.location.pathname,onCredentialRequired:i.view.LoginWindow.DoLogon,onAuthorizationFail:function e(t){i.showErrorWindow(t)},onNeedChangePassword:$App.onPasswordChange.bind($App),onGotApplicationConfig:function e(n){return t.defaultsDeep(n.appConfig,{comboPageSize:30,maxMainWindowTabOpened:10,storeDefaultPageSize:100,gridHeightDefault:400,gridWidthDefault:600,gridParentChangeEventTimeout:200,gridDefaultDetailViewHeight:150,formMinHeight:100,formMinWidth:300,formDefaultAutoFormWidth:300,formSaveMaskDelay:100,scanRecognizeProgressInterval:1e3,maxSearchLength:62,uiSettings:{adminUI:{defaultPasswordForDebugOnly:""}}}),i.appConfig=n.appConfig,i.inject("models/adminui-pub/locale/lang-"+n.preferredLocale+".js").then(function(){if(n.trafficEncryption||-1!==n.authMethods.indexOf("CERT")){var e=i.appConfig.uiSettings.adminUI.encryptionImplementation||"clientRequire/@ub-d/nm-dstu/injectEncription.js",t=e.split("/")[2],r={getPkParam:i.view.cryptoUI.ReadPK.getPkParam,getCertificates:i.view.cryptoUI.SelectCert.getCertificates};return i.inject(e).then(function(){window[t].addEncryptionToConnection(n,r)})}return!0})}}).then(function(e){var r=[],o=[],a,s;return n.connection=e,n.ubNotifier=e.ubNotifier,a=e.preferredLocale,n.domainInfo=e.domain,s=n.domainInfo.models,i.Repository=function(t){return new i.ClientRepository(e,t)},t.forEach(s,function(e,t){e.key=t}),s=t.sortBy(s,"order"),t.forEach(s,function(e){e.path&&"UB"!==e.key&&Ext.Loader.setPath(e.key,e.path),e.needLocalize&&r.push(i.inject(e.path+"/locale/lang-"+a+".js")),e.needInit&&o.push(e.clientRequirePath+"/initModel.js")}),Promise.all(r).then(function(){var e=Promise.resolve(!0);return o.forEach(function(t){e=e.then(function(){return window.System.import(t)})}),e})}).then(function(){n.fireEvent("appInitialize",n)}).then(function(){return i.core.UBDataLoader.loadStores({ubRequests:["ubm_desktop","ubm_form","ubm_enum"].map(function(e){var t={entity:e,method:"select",fieldList:n.domainInfo.get(e).getAttributeNames()};return"ubm_desktop"===e&&(t.orderList={ord:{expression:"caption",order:"asc"}}),t}),setStoreId:!0}).then(function(){return i.core.UBDataLoader.loadStores({ubRequests:[i.Repository("ubm_navshortcut").attrs(i.core.UBStoreManager.shortcutAttributes).orderBy("desktopID").orderBy("parentID").orderBy("displayOrder").orderBy("caption").ubql()],setStoreId:!0})})}).then(function(){var e=n.connection.cacheKeyCalculate("ubm_form",$App.domainInfo.get("ubm_form").getAttributeNames()),t=n.connection.cachedSessionEntityRequested[e];if(t){+window.localStorage.getItem("ubm_form_cache_version")!==t&&(i.core.UBFormLoader.clearFormCache(),window.localStorage.setItem("ubm_form_cache_version",t))}return!0}).then(function(){n.setLocalStorageProviderPrefix(n.connection.userLogin()),n.viewport=Ext.create("UB.view.Viewport"),n.viewport.show(),n.fireEvent("desktopChanged",i.core.UBAppConfig.desktop),n.fireEvent("applicationReady"),n.checkQueryString(),n.hideLogo()}).catch(function(e){throw n.hideLogo(),i.logError("Got error from getAppInfo %o",e),e})},getImagePath:function e(t){return"models/adminui-pub/themes/"+i.appConfig.uiSettings.adminUI.themeName+"/ubimages/"+t},dialog:function e(t,n,r){var o;switch(r=r||{},r.icon||"QUESTION"){case"QUESTION":o=Ext.window.MessageBox.QUESTION;break;case"ERROR":o=Ext.window.MessageBox.ERROR;break;case"WARNING":o=Ext.window.MessageBox.WARNING;break;case"INFO":o=Ext.window.MessageBox.INFO}return new Promise(function(e,a){Ext.MessageBox.show({modal:!0,title:i.i18n(t),msg:i.i18n(n),buttons:r.buttons||Ext.MessageBox.YESNOCANCEL,icon:o,fn:function t(n){e(n)}})})},dialogYesNo:function e(t,n){return new Promise(function(e){Ext.MessageBox.show({modal:!0,title:i.i18n(t),msg:i.i18n(n),buttons:Ext.MessageBox.YESNO,icon:Ext.MessageBox.QUESTION,fn:function t(n){e("yes"===n)}})})},dialogInfo:function e(t,n){return new Promise(function(e,r){Ext.MessageBox.show({modal:!0,title:i.i18n(n||"info"),msg:i.i18n(t),icon:Ext.MessageBox.INFO,buttons:Ext.MessageBox.OK,fn:function t(n){e("ok"===n)}})})},notify:function e(t,n,r){Ext.create("widget.uxNotification",{title:i.i18n(n),position:"t",slideInDuration:r||800,useXAxis:!0,autoShow:!0,cls:"ux-notification-light",bodyPadding:5,items:[{xtype:"component",autoEl:{tag:"div",html:i.i18n(t)}}]})},dialogError:function e(t,n){return new Promise(function(e){Ext.MessageBox.show({modal:!0,title:i.i18n(n||"error"),msg:i.i18n(t),icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK,fn:function t(){e(!0)}})})},pdfSigner:function t(){var n="";return e.import("").then(function(e){return e.connect()})},docEdit:function t(){var n="";return e.import("").then(function(e){return e.connect()})},editDocument:function e(t){return this.docEdit().then(function(e){return e.editDocument(t)})},scanService:function t(){var n="";return e.import("").then(function(e){return e.connect()})},scannerSettings:function e(){$App.scanService().then(function(e){return e.getDefaultSettings()}).then(function(e){$App.showModal({formCode:"ubm_desktop-scanerSettings",description:i.i18n("nastroykiSkanera"),isClosable:!0,customParams:e}).then(function(e){"ok"===e.action&&$App.scanService().then(function(t){t.setDefaultSettings(e.params)})})})},scan:function e(n,r,o){var a={"image/jpeg":"JPEG","application/jpg":"JPEG"},s=a[o];return $App.scanService().then(function(e){function o(e){e&&"scan"===e.action&&e.pageNum>=0?f.setStatus(i.format(i.i18n("doScanPages"),e.pageNum+1)):e&&"recognize"===e.action&&e.pageNum>=0&&f.setStatus(i.format(i.i18n("doRecognizePages"),e.pageNum+1))}function a(t){return t>0?(f.setStatus(i.format(i.i18n("doScanPages"),t)),d?c():(f.setStatus(i.i18n("doFinishScan")),e.finishScan().then(null,null,o))):u()}function l(){return f.setStatus(i.i18n("doStartScan")),e.continueScan().then(a,null,o)}function u(){return $App.dialog("scan","noPaperInScanner",{buttons:9,icon:"INFO"}).then(function(e){if("ok"===e)return l();if("cancel"===e)throw new i.UBAbortError})}function c(){return $App.dialog("scan","doYouWantResume",{buttons:14}).then(function(t){if("yes"===t)return l();if("no"===t)return f.setStatus(i.i18n("doFinishScan")),e.finishScan().then(null,null,o);if("cancel"===t)throw new i.UBAbortError})}var d=!1,f=Ext.create("UB.view.StatusWindow",{title:n});return e.getDefaultSettings().then(function(n){var o=t.merge(n,r||{});if(!o)throw new i.UBError(i.format(i.i18n("setScannerSettings"),"$App.scannerSettings(); "));return"UnityBase"!==o.CurrentScanType&&o.FRScan&&o.FRScan.LastUsedScanner&&(s?(o.CurrentScanType="UnityBase",o.UBScan.LastUsedScanner=o.FRScan.LastUsedScanner):t.forEach(o.FRScan.ScanSettings,function(e){e.Source===o.FRScan.LastUsedScanner&&(d=!!e.AllowAddPages)})),"UnityBase"===o.CurrentScanType&&o.UBScan&&o.UBScan.LastUsedScanner&&(t.forEach(o.UBScan.ScanSettings,function(e){e.Source===o.UBScan.LastUsedScanner&&(d=!!e.AllowAddPages)}),s&&(o.UBScan.OutputFormat=s)),f.setStatus(i.i18n("doStartScan")),e.lastScanedFormat=o.UBScan.OutputFormat,e.startScan(o)}).then(a,null,o).fin(function(){f.close()}).catch(function(t){return e.cancelScan().then(function(){throw f.close(),t})})})},getViewport:function e(){return this.viewport},getLogin:function e(){return i.logDebug("UB.core.UBApp.getLogin is deprecated. Use $App.connection.userLogin() instead)"),this.connection.userLogin()},getDesktop:function e(){var t=i.core.UBAppConfig,n=i.core.UBLocalStorageManager.getItem("desktop",!0);return t.desktop||(t.desktop=i.core.UBStoreManager.getDesktopStore().getById(n)?n:this.getDefaultDesktop()),t.desktop},getDefaultDesktop:function e(){var t=i.core.UBStoreManager.getDesktopStore(),n=t.findRecord("isDefault",!0)||t.getAt(0);return n?n.get("ID"):null},setDesktop:function e(t){i.core.UBLocalStorageManager.setItem("desktop",i.core.UBAppConfig.desktop=t),this.fireEvent("desktopChanged",t)},checkQueryString:function e(){this.runLink(window.location.search)},runLink:function e(t){var n=Ext.isString(t)?Ext.Object.fromQueryString(t.toLowerCase()):t;n&&(n.command&&n.command.length||n.cmdData)&&this.doCommand({commandCode:n.command,cmdData:n.cmdData,instanceID:parseInt(n.id,10),onDesktop:n.ondesktop,parent:n.parent,parentID:n.parentid})},doCommand:function e(t){if(Ext.isString(t)&&(t=Ext.JSON.decode(t)),!Ext.isObject(t))throw Error("invalid config passed to UBApp.doCommand");Ext.create("UB.core.UBCommand",t)},runShortcutCommand:function e(n,r){var o=n;if("number"!=typeof n){var a=i.core.UBStoreManager.getNavigationShortcutStore(),s=a.findExact("code",n);if(-1===s)throw Error("Shortcut with code "+n+" not found");o=a.getAt(s).get("ID")}i.core.UBStoreManager.getNavshortcutCommandText(o).then(function(e){var n=t.clone(e);r||(n.tabId="navigator"+o,n.target=$App.viewport.centralPanel),$App.doCommand(n)})},showModal:function e(t){var n=this;return new Promise(function(e,i){var r={cmdType:"showForm",isModal:!0,isResizable:!1,isMaximizable:!1,isMinimizable:!1,isClosable:!!t.isClosable,description:t.description,formCode:t.formCode,customParams:t.customParams,deferred:{resolve:e,reject:i}};r.formCode||i(Error("invalid config for showModal. formCode if undefined")),n.doCommand(r)})},setLocalStorageProviderPrefix:function e(t){var n=Ext.state.Manager.getProvider();t+=i.core.UBLocalStorageManager.separator,n&&n.prefix!==t&&(n.prefix=t,n.state=n.readLocalStorage())},getUserData:function e(){return i.logDebug("UB.core.UBApp.getUserData is deprecated. Use connection.userData() instead"),this.connection.userData()},getUiLanguage:function e(){return i.logDebug("$App.getUiLanguage is DEPRECATED. Use $App.connection.userLang()"),this.connection.userLang()},logout:function e(){(this.connection?this.connection.logout():Promise.resolve(!0)).catch(function(e){return!0}).then(function(){document.location&&document.location.href&&document.location.href.indexOf("#")>0?document.location.href=document.location.href.split("#")[0]:document.location.href=document.location.href})},locationHashChanged:function e(){if(window.location.href&&window.location.href.indexOf("#")>0){if(!window.location.href.split("#")[1])return;i.core.UBApp.doCommand(i.core.UBCommand.getCommandByUrl(window.location.href,$App.getViewport().centralPanel))}},hideLogo:function e(){document.getElementById("UBLogo").style.display="none"}})}).call(t,n(97))},function(e,t,n){n(2),n(3),Ext.define("UB.core.UBLocalStorageManager",{singleton:!0,uses:["UB.core.UBApp"],separator:":",getKey:function e(t,n){return UB.core.UBUtil.gatherStr(t,"_",n)},getKeyUI:function e(t){return this.getKey(t,"UI")},getFullKey:function e(t){var n=$App.connection.userLogin();return n&&n.length?n+this.separator+t:void 0},getItem:function e(t,n,i,r){var o=this.getFullKey(t),a=o?UB.core.UBUtil.getLocalStorageItem(o):void 0;return(r||n)&&(a=Ext.JSON.decode(a,!0)),Ext.callback(n,i||this,[a]),a},setItem:function e(t,n,i,r){var o=this.getFullKey(t);Ext.isObject(n)&&(n=Ext.JSON.encode(n)),o&&UB.core.UBUtil.setLocalStorageItem(o,n),Ext.callback(i,r||this)},removeItem:function e(t,n,i){var r;(r=this.getFullKey(t))&&UB.core.UBUtil.removeLocalStorageItem(r),Ext.callback(n,i||this)},clear:function e(t,n){UB.core.UBUtil.clearLocalStorage(),Ext.callback(t,n||this)},getUserKeys:function e(t,n,i){var r=[],o=UB.core.UBUtil.getLocalStorageKeys(),a,s;t=t||$App.connection.userLogin(),a=RegExp(Ext.util.Format.format("(?:{0}{1})(.*)",t,this.separator));for(var l=0,u=o.length;l<u;++l)(s=UB.core.UBUtil.getRegExpGroup(o[l],a,1))&&r.push(s);return Ext.callback(n,i||this,[r]),r},getKeys:function e(t,n){var i=UB.core.UBUtil.getLocalStorageKeys();return Ext.callback(t,n||Ext.global,[i]),i},removeUserItemsRegExp:function e(t,n,i){var r=this.getUserKeys();n=n||this.removeItem,i=i||this;for(var o=0,a=r.length;o<a;++o)t.test(r[o])&&n.call(i,r[o])},removeUserDataUI:function e(){var t=/_UI$/;this.getKeys().forEach(function(e){t.test(e)&&localStorage.removeItem(e)})}})},function(e,t,n){n(2),n(4),n(3),n(17),n(105),n(160),n(38);var i=n(1);Ext.define("UB.core.UBCommand",{uses:["UB.core.UBApp","UB.view.ErrorWindow","UB.core.UBFormLoader","UB.view.BasePanel","UB.view.EntityGridPanel"],statics:{ubComponentNamePrefix:"attr",whereListParentID:"__parent",whereListInstanceID:"__parent",allPublicAttributesMask:"*",commandType:{showList:"showList",showForm:"showForm",showReport:"showReport"},errCode:{MODIFIED_BY_ANOTHER_USER:25},methodName:{SELECT:"select",INSERT:"insert",UPDATE:"update",DELETE:"delete",ADDNEW:"addnew",UNLOCK:"unlock",NEWVERSION:"newversion"},condition:{sqlecEqual:"equal",sqlecNotEqual:"notEqual",sqlecMore:"more",sqlecMoreEqual:"moreEqual",sqlecLess:"less",sqlecLessEqual:"lessEqual",sqlecIn:"in",sqlecNotIn:"notIn",sqlecIsNull:"isNull",sqlecNotIsNull:"notIsNull",sqlecLike:"like",sqlecNotLike:"notLike",sqlecStartWith:"startWith",sqlecNotStartWith:"notStartWith",sqlecCustom:"custom"},order:{sqlotAsc:"asc",sqlotDesc:"desc"},createDefaultItems:function e(t,n){var r=[],o,a=$App.domainInfo.get(t);if(o=/^ID|^mi_/,!a)throw Error("invalid entity "+t);return i.forEach(a.attributes,function(e,t){!1===e.defaultView||o.test(t)||n&&n.hasOwnProperty(t)||r.push({attributeName:t,anchor:"100%"})}),{items:r}},getUBCmpUBName:function e(t){return UB.core.UBCommand.ubComponentNamePrefix+Ext.String.capitalize(t)},getCommandByEntityAndType:function e(t,n,i){return i&&n===UB.core.UBCommand.commandType.showList?{params:[{entity:t,method:UB.core.UBCommand.methodName.SELECT,fieldList:"*"}]}:null},addWhereListItemSelect:function e(t,n,i,r,o){return t=t||{},r=r||"c"+(Ext.Object.getSize(t)+1),o=o||UB.core.UBCommand.condition.sqlecEqual,t[r]={expression:"["+n+"]",condition:o,values:{}},t[r].values[n]=i,t},resultDataRow2Object:function e(t,n,i){var r=-1,o,a,s,l={};for(a=t.resultData.data[n||0],s=t.resultData.fields,o=s.length;++r<o;)(!i||i.indexOf(s[r])>=0)&&(l[s[r]]=a[r]);return l},addMasterDetailRelation:function e(t,n,i,r){var o=t||{},a,s,l,u,c;if(Object.keys(o).forEach(function(e){"__MD"===e.substring(0,4)&&delete o[e]}),n&&i)for(a=0,s=Math.min(n.length,i.length);a<s;++a)c=i[a],c&&c.indexOf("[")<0&&(c="["+c+"]"),l=o["__MD"+a]={expression:c,condition:"equal",values:{}},u=r?r.get(n[a]):0,l.values[i[a]]=u;return o},getCommandByUrl:function e(t,n){function r(e){var t={};return i.forEach(e,function(e){var n,i,a;e||o(),n=e.split("="),2!==n.length&&o(),i=n[0],a=window.decodeURIComponent(n[1]),a&&a.indexOf("&")>=0?a=r(a.split("&")):a&&a.indexOf("=")>=0&&(a=r([a])),t[i]=a}),t}var o=function e(){throw Error("Incorect parametr for getCommandByUrl")},a;if((!t||t.indexOf("#")<0)&&o(),t=t.split("#")[1])return a=r(t.split("&")),a.params&&(a.cmdData={params:[JSON.parse(a.params)]},delete a.params),n&&!a.tabId&&(a.target=n,a.tabId=Ext.id()),a}},initialFieldValues:{},customParams:{},constructor:function e(t){var n,r=this;if(r.commandConfig=t,r.commandType=t.cmdType||r.commandType,r.commandData=t.cmdData,r.commandCode=t.cmdCode,r.formCode=t.formCode,r.entity=t.entity,r.commandContext=t.commandContext,r.instanceID=t.instanceID,Ext.isDefined(r.instanceID)&&Ext.isString(r.instanceID))try{r.instanceID=parseFloat(r.instanceID)}catch(e){}switch(r.callback=t.callback,r.eventHandler=t.eventHandler,r.scope=t.scope,r.store=t.store,r.requestStore=t.requestStore,r.addByCurrent=t.addByCurrent,r.__mip_ondate=t.__mip_ondate,r.target=t.target,r.openInBackgroundTab=t.openInBackgroundTab,r.__mip_recordhistory=t.__mip_recordhistory,r.detailAttribute=t.detailAttribute,r.parentID=t.parentID,r.description=t.description,r.title=t.title,r.stateId=t.stateId,r.createOnly=t.createOnly,r.columns=t.columns,r.scriptCode=t.scriptCode,r.hideHeaders=t.hideHeaders||!1,r.summary=t.summary,r.isModal=t.isModal||!1,r.isModalDialog=t.isModalDialog||!1,r.isResizable=void 0===t.isResizable||t.isResizable,r.isMaximizable=void 0===t.isMaximizable||t.isMaximizable,r.isClosable=void 0===t.isClosable||t.isClosable,r.onItemSelected=t.onItemSelected||Ext.emptyFn,r.initValue=t.initValue,r.applyValues=t.applyValues,r.initialFieldValues=t.initialFieldValues,r.customParams=t.customParams||{},r.isDetail=t.isDetail,r.parentContext=t.parentContext,r.filters=t.filters,r.autoFilter=t.autoFilter,r.details=t.details,r.selectedInstanceID=t.selectedInstanceID,r.tabId=t.tabId,r.customActions=t.customActions,r.sender=t.sender,r.onClose=t.onClose,r.pageSize=t.pageSize||UB.appConfig.storeDefaultPageSize,i.isFunction(t.cmpInitConfig)&&(t.cmpInitConfig=t.cmpInitConfig()),r.cmpInitConfig=Ext.clone(t.cmpInitConfig||{}),r.focusOnUpdate=t.focusOnUpdate,r.hideActions=t.hideActions,Ext.isDefined(r.commandData)?(Ext.isString(r.commandData)&&(r.commandData=Ext.JSON.decode(r.commandData)),r.entity=r.entity||r.commandData.entity||(r.commandData.params?r.commandData.params[0].entity:null),r.commandConfig.entity=r.entity):r.commandData={params:[{entity:r.entity,method:UB.core.UBCommand.methodName.SELECT,fieldList:"*"}]},r.commandType){case"showList":r.showList();break;case"showForm":r.showForm();break;case"showReport":r.showReport();break;default:throw n=UB.format('{0}: "{1}"',UB.i18n("unknownCommandType"),r.commandType),Error(n)}},getFormParamFromCommandData:function e(t){var n={};return t&&(t.formCode&&(n.formCode=t.formCode),t.formTitle&&(n.description=t.formTitle)),0===Object.keys(n).length?null:n},getFormParam:function e(){var t=this,n,i,r;if(this.formParam)return this.formParam;if(this.commandData&&(this.formParam=this.getFormParamFromCommandData(this.commandData)))return this.formParam;if(t.formCode){if(r=UB.core.UBStoreManager.getFormStore(),!(i=r.findRecord("code",t.formCode,0,!1,!0,!0)))throw Error('Unknown form code "'+t.formCode+'"');return this.formParam={formCode:t.formCode,caption:i.get("caption")?UB.i18n(""+i.get("caption")):"",description:i.get("description")?UB.i18n(""+i.get("description")):""},this.formParam}return n=UB.core.UBFormLoader.getFormByEntity(this.entity),n?(this.formCode=n.get("code"),this.formParam={formCode:this.formCode,caption:n.get("caption")?UB.i18n(""+n.get("caption")):"",description:n.get("description")?UB.i18n(""+n.get("description")):""},this.formParam):void 0},showList:function e(){var t=this,n=i.find(t.commandData.params,["entity",t.entity]),r,o;if(t.showListParam=n,!n)throw r=UB.format(UB.i18n("neizvestnnajaSushhnost"),"showList",t.entity),new UB.UBError(r);if(("*"===n.fieldList||Array.isArray(n.fieldList)&&1===n.fieldList.length&&"*"===n.fieldList[0])&&(n.fieldList=$App.domainInfo.get(t.entity).getAttributeNames({defaultView:!0})),t.windowCommandCode=t.commandCode||UB.core.UBUtil.getNameMd5(t.entity+Ext.String.capitalize(t.commandType),n.fieldList),this.detailAttribute&&this.parentID&&-1===n.fieldList.indexOf(this.detailAttribute)&&n.fieldList.push(this.detailAttribute),t.instanceID&&(n.ID=t.instanceID,n.whereList=n.whereList||{},UB.core.UBCommand.addWhereListItemSelect(n.whereList,"ID",t.instanceID,UB.core.UBCommand.whereListInstanceID)),n.__mip_recordhistory=t.__mip_recordhistory,o=t.cmpInitConfig||{},Ext.applyIf(o,{entityConfig:n,loadStoreImmediately:!0,filters:t.filters,store:t.requestStore,summary:t.summary,commandContext:t.commandContext,commandConfig:t.commandConfig,commandCode:t.commandCode,commandData:t.commandData,openInBackgroundTab:t.openInBackgroundTab,autoFilter:t.autoFilter,details:t.details,target:t.target,parentContext:t.parentContext,detailAttribute:t.detailAttribute,parentID:t.parentID,stateful:!0,stateId:t.stateId||UB.core.UBLocalStorageManager.getKeyUI(UB.core.UBUtil.gatherStr(t.windowCommandCode,"_","grid")),columns:t.columns,hideHeaders:t.hideHeaders,isModal:t.isModal,isModalDialog:t.isModalDialog,onClose:t.onClose,onItemSelected:t.onItemSelected,isDetail:t.isDetail,customActions:t.customActions,selectedRecordID:t.selectedInstanceID,focusOnUpdate:t.focusOnUpdate,hideActions:t.hideActions}),t.isDetail&&(o.height=UB.appConfig.gridDefaultDetailViewHeight),t.tabId){var a=Ext.getCmp(t.tabId);if(a&&a.activateByCommand&&a.activateByCommand(o),a=a&&a.getMainContainer?a.getMainContainer():a)return void a.ownerCt.setActiveTab(a);o.id=t.tabId,o.closable=!0}var s=Ext.create("UB.view.EntityGridPanel",o);t.bindFocus(s),i.isFunction(s.customInit)&&(console.error("Function customInit is deprecated. You should use callback function initComponentStart in script file."),s.customInit()),t.showCommandResult(s,{isGrid:!0})},showForm:function e(){var t=this,n;t.formCode=t.formCode||(t.formParam?t.formParam.formCode:void 0),i.isFunction(t.formCode)?(t.windowCommandCode=UB.core.UBUtil.getNameMd5(t.entity+Ext.String.capitalize(t.commandType),""+t.formCode),t.formCode(t.entity,t.instanceID,t.onFormCodeRun,t)):(t.formParam=t.getFormParam(),t.caption=t.caption||(t.formParam?t.formParam.caption:void 0),Ext.isDefined(t.formCode)?(t.windowCommandCode=t.formCode,UB.core.UBFormLoader.getFormViewAndController({formCode:t.formCode}).then(function(e){t.onShowFormRun(e.formView,e.formController)})):(t.windowCommandCode=UB.core.UBUtil.getNameMd5(t.entity+Ext.String.capitalize(t.commandType),n=UB.core.UBCommand.createDefaultItems(t.entity,t.parentContext)),t.description=$App.domainInfo.get(t.entity).caption,t.isDefaultForm=!0,t.onShowFormRun(n)))},onFormCodeRun:function e(){var t=this;UB.core.UBFormLoader.getFormViewAndController({formCode:t.formCode}).then(function(e){t.onShowFormRun(e.formView,e.formController)})},showReport:function e(){var t=this,n,r,o;n=t.commandData,o=t.reportOptions||n.reportOptions||{},r=Ext.create("UBS.UBReport",i.defaults(o,{code:n.reportCode,type:n.reportType,params:n.reportParams,language:$App.connection.userLang()})),r.init().then(function(){var e=Ext.create("UBS.ReportViewer",{report:r});e.target=t.target,t.showCommandResult(e,{stateId:n.code+(n.params?JSON.stringify(n.params):""),title:r.reportRW.name})})},onShowFormRun:function e(t,n){var i=this,r=i.cmpInitConfig||{},o;if(i.entity=i.entity||t.entity,Ext.apply(r,{formCode:i.formCode,entityName:i.entity,instanceID:i.instanceID,commandContext:i.commandContext,commandConfig:i.commandConfig,sender:i.sender,store:i.store,addByCurrent:i.addByCurrent,__mip_ondate:i.__mip_ondate,commandCode:i.commandCode,commandData:i.commandData,target:i.target,openInBackgroundTab:i.openInBackgroundTab,parentContext:i.parentContext,isDetail:i.isDetail,initValue:i.initValue,applyValues:i.applyValues,initialFieldValues:i.initialFieldValues,customParams:i.customParams,eventHandler:i.eventHandler,isModal:i.isModal,onClose:i.onClose,tabID:i.tabId,hideActions:i.hideActions}),i.isDetail&&(r.height=UB.appConfig.gridDefaultDetailViewHeight),i.tabId){var a=Ext.getCmp(i.tabId);if(!a&&i.instanceID&&(a=$App.viewport.centralPanel.down("basepanel[instanceID="+i.instanceID+"]")),a)return void a.ownerCt.setActiveTab(a);r.id=i.tabId,r.closable=!0}"function"!=typeof t?(r.dfm=t,r.functions=n,o=Ext.create("UB.view.BasePanel",r)):o=Ext.create(t,r),i.bindFocus(o),i.showCommandResult(o)},bindFocus:function e(t){var n=this;n.sender&&t.on("destroy",function(){n.sender&&Ext.callback(n.sender.focus,n.sender,[],10)})},showCommandResult:function e(t,n){var i=this,r=i.detailAttribute?UB.format(" ({0}: {1})",UB.i18n("filtr"),$App.domainInfo.get(i.entity).attr(i.detailAttribute).caption):"",o=i.__mip_recordhistory?" ("+UB.i18n("istorijaIzmenenij")+")":"",a,s,l=t.disableAutoShow;if(n=n||{},a=n.title||(i.caption||(i.formParam?i.formParam.caption||i.formParam.description:null)||$App.domainInfo.get(i.entity).caption)+r+o,!i.createOnly)if(t.target)t.target instanceof Ext.grid.Panel?(t.dock="bottom",t.height||(t.height=Math.round(t.target.getHeight()/3)),i.title&&(t.title=i.title),t.target.addDocked(t)):(t.title=i.title||a,t.tooltip=t.title,t.isBasePanel&&t.setTitle(t.title),Ext.isDefined(i.tabId)||t.target.removeAll(),t.target.setActiveTab?(t.closable=!0,this.checkTabsCount(t.target)?(t.target.add(t),i.openInBackgroundTab||t.target.setActiveTab(t)):t.destroy()):t.target.add(t));else{if(s={title:a,autoScroll:!0,border:0,layout:"fit",autoDestroy:!0,items:[t],dfm:t.dfm,isGrid:n.isGrid,stateful:!0,stateId:n.stateId||UB.core.UBLocalStorageManager.getKeyUI(UB.core.UBUtil.gatherStr(i.windowCommandCode,"_","window"))},!n.isGrid){var u=i.entity,c=i.instanceID||"new-"+(new Date).getTime(),d=UB.format("ub-wnd-{0}-{1}",i.entity,c),f=Ext.WindowManager.get(d);if(f&&Ext.WindowManager.each(function(e){return e.entity!==u||!e.newInstance||(f=e,!1)}),f&&f.destroying&&(f.destroy(),f=null),f)return Ext.WindowManager.bringToFront(f),void f.getHeader().body.highlight("#FF9933");i.instanceID||(s.newInstance=!0,s.entity=i.entity),s.id=d}i.isDefaultForm&&(s.width=UB.appConfig.formDefaultAutoFormWidth),s.modal=!0,s.resizable=i.isResizable,s.maximizable=i.isMaximizable,s.closable=i.isClosable,s.minWidth||(s.minWidth=300),s.minHeight||(s.minHeight=200),t.window=Ext.create("UB.view.BaseWindow",s),i.isModal&&(t.window.onItemSelect=s.onItemSelect)}t.window&&!l&&t.window.show(),Ext.callback(i.callback,i.scope||i,[t])},checkTabsCount:function e(t){return!(t.items.getCount()>=UB.appConfig.maxMainWindowTabOpened&&(Ext.create("widget.uxNotification",{title:UB.i18n("error"),position:"t",slideInDuration:800,slideBackDuration:1500,slideInAnimation:"elasticIn",slideBackAnimation:"elasticIn",useXAxis:!0,autoShow:!0,cls:"ux-notification-light",iconCls:"ux-notification-icon-error",bodyPadding:5,items:[{html:UB.i18n("tabsCountLimitExceeded")}]}),1))}})},function(e,t,n){n(3),n(15),n(2),Ext.define("UB.view.BaseWindow",{extend:"Ext.window.Window",alias:"widget.basewindow",uses:["UB.core.UBApp"],constrain:!0,maximizable:!0,initComponent:function e(){var t=this,n=this.commandCode?UB.core.UBLocalStorageManager.getItem(this.windowLocalStoreKey=UB.core.UBLocalStorageManager.getKeyUI(this.commandCode),!0):void 0;n&&n.window&&n.window.position?(n.window.position.x&&(this.x=n.window.position.x),n.window.position.y&&(this.y=n.window.position.y)):this.dfm&&this.dfm.position&&(this.dfm.position.x&&(this.x=this.dfm.position.x),this.dfm.position.y&&(this.y=this.dfm.position.y)),n&&n.window?(n.window.height&&(this.height=n.window.height),n.window.width&&(this.width=n.window.width)):this.dfm&&this.dfm.size?(this.dfm.size.height&&(this.height=this.dfm.size.height),this.dfm.size.width&&(this.width=this.dfm.size.width)):this.isGrid&&(this.height=UB.appConfig.gridHeightDefault,this.width=UB.appConfig.gridWidthDefault),Ext.apply(this,{minHeight:UB.appConfig.formMinHeight,minWidth:UB.appConfig.formMinWidth}),t.modal=!0,this.callParent(arguments),this.addListener("activate",this.onActivated,this)},onActivated:function e(){$App.fireEvent("windowActivated",this)},beforeDestroy:function e(){var t;this.commandCode&&(t=UB.core.UBLocalStorageManager.getItem(this.windowLocalStoreKey,!0)||{},t.window={position:{x:this.x,y:this.y}},this.height&&(t.window.height=this.height),this.width&&(t.window.width=this.width),UB.core.UBLocalStorageManager.setItem(this.windowLocalStoreKey,t)),this.callParent(arguments),$App.fireEvent("windowDestroyed",this)}})},function(e,t,n){n(115),Ext.define("UB.ux.UBTinyMCETextArea",{extend:"Ext.ux.form.TinyMCETextArea",alias:"widget.ubtinymcetextarea",initComponent:function e(){this.tinyMCEConfig&&(this.userSetup=this.tinyMCEConfig.setup),this.ensureTinyMCELoaded(),this.tinyMCEConfig=Ext.apply({language_url:$App.connection.baseURL+"models/adminui-pub/locale/tinymce/"+$App.connection.userLang()+".js",table_default_attributes:{cellpadding:"3px",cellspacing:"0",border:"1px",width:this.pageWidth&&this.pageWidth>20?this.pageWidth-20:20,style:{wordBreak:"break-all"}},browser_spellcheck:!0,toolbar1:"undo redo | bold italic underline | alignleft aligncenter alignright alignjustify | styleselect formatselect fontselect fontsizeselect | print",plugins:["advlist autolink lists charmap print preview hr anchor pagebreak","searchreplace wordcount visualblocks visualchars code ","insertdatetime nonbreaking table contextmenu directionality","emoticons template textcolor colorpicker image imagetools"],contextmenu:"link image inserttable | cell row column deletetable",paste_data_images:!0,statusbar:!1,menubar:"edit insert view format table tools",toolbar_items_size:"small",automatic_uploads:!1,file_picker_types:"image",file_picker_callback:function e(t,n,i){var r=document.createElement("input");r.setAttribute("type","file"),r.setAttribute("accept","image/*"),r.onchange=function(){var e=this.files[0],n=new window.FileReader,i=new window.Blob([e],{type:e.type});n.addEventListener("loadend",function(){var r="blobid"+(new Date).getTime(),o=tinymce.activeEditor.editorUpload.blobCache,a=n.result.split(",",2)[1],s=o.create(r,i,a);o.add(s),t(s.blobUri(),{title:e.name})}),n.addEventListener("error",function(e){throw Error(e)}),n.readAsDataURL(i)},r.click()}},this.tinyMCEConfig),this.tinyMCEConfig.setup=this.onStartSetup.bind(this),this.addEvents("setup","setOriginalValue"),this.callParent(arguments)},afterRender:function e(){this.callParent(arguments),this.wysiwygIntialized||this.updateLayout()},onStartSetup:function e(t){var n=this;tinymce.baseURL=$App.connection.baseURL+"clientRequire/tinymce/",this.fireEvent("setup",t),this.userSetup&&this.userSetup(t),t.on("init",function(){n.ownerLayout&&n.ownerLayout.onContentChange()})},isFocusableField:!0,isFocusable:function e(){return!this.readOnly},setSrc:function e(t){function n(e){return i.suspendCheckChange=!0,i.setValue(e),t.resetOriginalValue&&(i.resetOriginalValue(),i.fireEvent("setOriginalValue",e,i)),i.suspendCheckChange=!1,e}var i=this,r=t.blobData;return r?new Promise(function(e,t){var i=new window.FileReader;i.addEventListener("loadend",function(){e(n(i.result))}),i.addEventListener("error",function(){t(n(i.error))}),i.readAsText(r)}):t.params?UB.core.UBService.getDocument(t.params).then(function(e){return n(e)}):Promise.resolve(n(t.rawValue))}})},function(e,t,n){function i(e){var t=a[e];if(void 0!==t||null==e)return t;if("undefined"==typeof $App)return e;if(null==$App.domainInfo)return e;var n=e.split(".");if(n.length>2)return e;var i=$App.domainInfo.entities[n[0]];if(!i)return e;if(1===n.length)return a[e]=i.caption,i.caption;var r=i.attributes[n[1]];return r?(a[e]=r.caption,r.caption):e}function r(e){o.merge(a,e)}var o=n(1),a={monkeyRequestsDetected:"Your request has been processed, but we found that it is repeated several times. Maybe you key fuse?"};e.exports={i18n:i,i18nExtend:r}},function(e,t){function n(){n.init.call(this)}function i(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function r(e,t,n){if(t)e.call(n);else for(var i=e.length,r=d(e,i),o=0;o<i;++o)r[o].call(n)}function o(e,t,n,i){if(t)e.call(n,i);else for(var r=e.length,o=d(e,r),a=0;a<r;++a)o[a].call(n,i)}function a(e,t,n,i,r){if(t)e.call(n,i,r);else for(var o=e.length,a=d(e,o),s=0;s<o;++s)a[s].call(n,i,r)}function s(e,t,n,i,r,o){if(t)e.call(n,i,r,o);else for(var a=e.length,s=d(e,a),l=0;l<a;++l)s[l].call(n,i,r,o)}function l(e,t,n,i){if(t)e.apply(n,i);else for(var r=e.length,o=d(e,r),a=0;a<r;++a)o[a].apply(n,i)}function u(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function c(e,t){for(var n=t,i=n+1,r=e.length;i<r;n+=1,i+=1)e[n]=e[i];e.pop()}function d(e,t){for(var n=Array(t);t--;)n[t]=e[t];return n}n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.init=function(){this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events={},this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function e(t){if("number"!=typeof t||t<0||isNaN(t))throw new TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.getMaxListeners=function e(){return i(this)},n.prototype.emit=function e(t){var n,i,u,c,d,f,h="error"===t;if(f=this._events)h=h&&null==f.error;else if(!h)return!1;if(h){if((n=arguments[1])instanceof Error)throw n;var p=Error('Uncaught, unspecified "error" event. ('+n+")");throw p.context=n,p}if(!(i=f[t]))return!1;var m="function"==typeof i;switch(u=arguments.length){case 1:r(i,m,this);break;case 2:o(i,m,this,arguments[1]);break;case 3:a(i,m,this,arguments[1],arguments[2]);break;case 4:s(i,m,this,arguments[1],arguments[2],arguments[3]);break;default:for(c=Array(u-1),d=1;d<u;d++)c[d-1]=arguments[d];l(i,m,this,c)}return!0},n.prototype.addListener=function e(t,n){var r,o,a;if("function"!=typeof n)throw new TypeError("listener must be a function");return o=this._events,o?(o.newListener&&(this.emit("newListener",t,n.listener?n.listener:n),o=this._events),a=o[t]):(o=this._events={},this._eventsCount=0),a?("function"==typeof a?a=o[t]=[a,n]:a.push(n),a.warned||(r=i(this))&&r>0&&a.length>r&&(a.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d %s listeners added. Use emitter.setMaxListeners() to increase limit.",a.length,t),console.trace())):(a=o[t]=n,++this._eventsCount),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function e(t,n){function i(){this.removeListener(t,i),r||(r=!0,n.apply(this,arguments))}if("function"!=typeof n)throw new TypeError("listener must be a function");var r=!1;return i.listener=n,this.on(t,i),this},n.prototype.removeListener=function e(t,n){var i,r,o,a;if("function"!=typeof n)throw new TypeError("listener must be a function");if(!(r=this._events))return this;if(!(i=r[t]))return this;if(i===n||i.listener&&i.listener===n)0==--this._eventsCount?this._events={}:(delete r[t],r.removeListener&&this.emit("removeListener",t,n));else if("function"!=typeof i){for(o=-1,a=i.length;a-- >0;)if(i[a]===n||i[a].listener&&i[a].listener===n){o=a;break}if(o<0)return this;if(1===i.length){if(i[0]=void 0,0==--this._eventsCount)return this._events={},this;delete r[t]}else c(i,o);r.removeListener&&this.emit("removeListener",t,n)}return this},n.prototype.removeAllListeners=function e(t){var n,i;if(!(i=this._events))return this;if(!i.removeListener)return 0===arguments.length?(this._events={},this._eventsCount=0):i[t]&&(0==--this._eventsCount?this._events={}:delete i[t]),this;if(0===arguments.length){for(var r=Object.keys(i),o=0,a;o<r.length;++o)"removeListener"!==(a=r[o])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events={},this._eventsCount=0,this}if("function"==typeof(n=i[t]))this.removeListener(t,n);else if(n)do{this.removeListener(t,n[n.length-1])}while(n[0]);return this},n.prototype.listeners=function e(t){var n,i,r=this._events;return r?(n=r[t],i=n?"function"==typeof n?[n]:d(n,n.length):[]):i=[],i},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):u.call(e,t)},n.prototype.listenerCount=u,e.exports=n},function(e,t){Ext.define("UB.view.ToolbarWidget",{extend:"Ext.toolbar.Toolbar",alias:"widget.toolbarwidget",cls:"ub-header-menu-item",border:0,margin:0,padding:0,requires:[],initComponent:function e(){this.callParent(arguments)}})},function(e,t,n){n(14),n(2),Ext.define("UB.core.UBService",{singleton:!0,TRANSACTION_ID:0,method:{runList:"runList",getDocument:"getDocument"},enableBuffer:20,callTask:null,callBuffer:[],getUrl:function e(){throw Error("deprecated. Use methods from $App.connection \r\n $App.connection.authorize().then(function(session){\r\n me.dom.href = Ext.String.urlAppend( me.href, 'session_signature='+session.signature())\r\n})\r\n")},runList:function e(t,n,i){UB.logDebug("UBService.runList is deprecated. Use $App.connection.run({entity:...}).then(..) or runTrans([{entity:...}])");var r=this,o=r.enableBuffer;Ext.isArray(t)||(t=[t]),o&&1===t.length?(r.callBuffer.push({transactionId:++UB.core.UBService.TRANSACTION_ID,params:t[0],callback:n,scope:i}),r.callTask||(r.callTask=new Ext.util.DelayedTask(r.combineAndSend,r)),r.callTask.delay(Ext.isNumber(o)?o:10)):r.sendRequest(t,n,i)},combineAndSend:function e(){var t=this;t.callBuffer.length>0&&(t.sendRequest(),t.callBuffer=[])},sendRequest:function e(t,n,i){var r=this,o=[],a={};t?o=t:Ext.each(r.callBuffer,function(e){a[e.transactionId]={fn:e.callback,scope:e.scope},e.params.transactionId=e.transactionId,o.push(e.params)}),$App.connection.post("ubql",o).then(function(e){var r=e.data,o=e.config.data;t?Ext.callback(n,i,[r,o]):Ext.each(r,function(e,t){var n=a[e.transactionId];Ext.callback(n.fn,n.scope,[[e],o[t]],0)})},function(e){throw t?Ext.callback(n,i,[{serverFailure:!0}]):Ext.Object.each(a,function(e,t){Ext.callback(t.fn,t.scope,[{serverFailure:!0}],0)}),e.data&&e.data.errMsg?Error(e.data.errMsg):e})},getDocument:function e(t,n,i,r){var o=this,a,s=Ext.apply({},r),l=["entity","attribute","ID","id","isDirty","forceMime","fileName","store","revision"],u={url:"getDocument",method:s.usePostMethod?"POST":"GET"};return r&&r.binary&&(u.responseType="arraybuffer"),s.usePostMethod?(u.data=_.clone(t),Object.keys(u.data).forEach(function(e){-1===l.indexOf(e)&&(delete u.data[e],UB.logDebug('invalid parameter "'+e+'" passed to getDocument request'))})):u.params=t,a=$App.connection.xhr(u).then(function(e){return n&&Ext.callback(n,i||o,[e.data,t]),e.data}).catch(function(){UB.showErrorWindow('<span style="color: red">'+UB.i18n("documentNotFound")+"<span/>")}),n?null:a},setDocument:function e(){throw Error("UBService.setDocument is deprecated!!")},setUserData:function e(){throw Error("deprecated. Use uba_user.changeLanguage")}})},function(e,t){Ext.define("UB.ux.form.field.UBBaseComboBox",{extend:"Ext.form.field.ComboBox",alias:"widget.ubbasebox",queryCaching:!0,getEntity:function e(){return(this.ubRequest||(this.store?this.store.ubRequest:null)).entity},initComponent:function e(){var t=this,n=t.getStore();if(t.callParent(arguments),t.on("afterrender",t.onAfterRender,t),t.on("change",t.onValueChange,t),n&&n.on("load",function(e,n,i){i&&(t.dataLoaded=!0)},t,{single:!0}),n&&n.ubRequest&&n.ubRequest.entity){var i=$App.domainInfo.get(n.ubRequest.entity,!0).cacheType;"Session"!==i&&"SessionEntity"!==i||(t.queryDelay=200)}},setRawValue:function e(t){var n=this;n.callParent(arguments),n.inputEl&&n.readOnly&&t&&t.length>50&&n.inputEl.set({"data-qtip":t})},onDataLoaded:function e(t,n){var i=this,r=this.getStore();this.dataLoaded?Ext.callback(t,n||i,[i]):r.on("load",function(e,r,o){i.dataLoaded=!0,o&&Ext.callback(t,n||i,[i])},i,{single:!0})},onAfterRender:function e(){var t=this,n;t.disableContextMenu||t.initContextMenu(),t.inputCell.on("contextmenu",function(e,n){e.stopEvent(),t.disabled||t.disableContextMenu||!t.contextMenu||(t.onShowContextMenu(),t.contextMenu.showAt(e.getXY()))},t),t.inputEl&&t.readOnly&&(n=t.inputEl.getValue())&&n.length>50&&t.inputEl.set({"data-qtip":n}),!t.disableLimitSearchLength&&UB.appConfig.maxSearchLength&&t.inputEl.set({maxlength:UB.appConfig.maxSearchLength})},onShowContextMenu:function e(){var t=this;t.editItemButton&&(t.getValue()?t.editItemButton.autoDisable&&(t.disabled||t.disableModifyEntity||t.editItemButton.setDisabled(!1)):(t.editItemButton.autoDisable=!0,t.editItemButton.setDisabled(!0)))},onValueChange:function e(){var t=this,n=t.disabled||t.disableModifyEntity||!t.getStore().getById(t.getValue());t.editItemButton&&t.editItemButton.setDisabled(n)},onKeyDown:function e(t){var n=this;n.editable||t.getKey()!==t.BACKSPACE?t.ctrlKey||n.callParent(arguments):(t.stopEvent(),n.clearValue())},onKeyUp:function e(t){var n=this;n.editedByUser=!0,!n.editable&&t.BACKSPACE?t.stopEvent():t.ctrlKey||n.callParent(arguments)},beforeDestroy:function e(t){var n=this;n.contextMenu&&(Ext.destroy(n.contextMenu),n.contextMenu=null),n.keyMap&&(Ext.destroy(n.keyMap),n.keyMap=null),this.callParent()},setReadOnly:function e(t){var n=this,i;n.callParent(arguments),n.showLookupButton&&n.showLookupButton.setDisabled(t),n.addItemButton&&n.addItemButton.setDisabled(t),n.clearValueButton&&n.clearValueButton.setDisabled(t),n.inputEl&&(t&&(i=n.inputEl.getValue())&&i.length>50?n.inputEl.set({"data-qtip":i}):n.inputEl.set({"data-qtip":void 0}))},disableModifyEntity:!1,hideEntityItemInContext:!1,initContextMenu:function e(){var t=this,n,i,r,o=UB.core.UBCommand.methodName;i=t.getStore(),n=[],r=(i.ubRequest?i.ubRequest.entity:null)||i.entityName,$App.domainInfo.has(r)&&(n.push({text:UB.i18n("editSelItem")+" (Ctrl+E)",glyph:UB.core.UBUtil.glyphs.faEdit,itemID:"editItem",handler:t.editItem,hidden:!!t.hideEntityItemInContext||t.disableModifyEntity,disabled:t.disabled||t.disableModifyEntity,scope:t}),n.push({text:UB.i18n("selectFromDictionary")+" (F9)",glyph:UB.core.UBUtil.glyphs.faTable,itemID:"showLookup",handler:t.showLookup,hidden:!!t.hideEntityItemInContext,disabled:t.disabled||t.readOnly,scope:t}),n.push({text:UB.i18n("addNewItem"),glyph:UB.core.UBUtil.glyphs.faPlusCircle,itemID:"addItem",handler:t.addItem,hidden:!!t.hideEntityItemInContext||t.disableModifyEntity,disabled:t.disableModifyEntity||t.disabled||t.readOnly||!$App.domainInfo.isEntityMethodsAccessible(r,[o.ADDNEW,o.INSERT]),scope:t})),n.push({text:UB.i18n("clearSelection")+" (Ctrl+BackSpace)",glyph:UB.core.UBUtil.glyphs.faEraser,itemID:"clearValue",handler:t.clearValue,disabled:t.disabled||t.readOnly,scope:t}),t.contextMenu=Ext.create("Ext.menu.Menu",{items:n}),t.editItemButton=t.contextMenu.items.getAt(0),t.showLookupButton=t.contextMenu.items.getAt(1),t.addItemButton=t.contextMenu.items.getAt(2),t.clearValueButton=t.contextMenu.items.getAt(3),t.keyMap=new Ext.util.KeyMap({target:t.getEl(),binding:[{ctrl:!0,shift:!1,alt:!1,key:Ext.EventObject.E,handler:function e(n,i){return t.disabled||t.readOnly||t.hideEntityItemInContext||t.disableModifyEntity||(i.stopEvent(),t.editItem()),!0}},{ctrl:!1,shift:!1,alt:!1,key:120,handler:function e(n,i){return t.disabled||t.readOnly||t.hideEntityItemInContext||(i.stopEvent(),t.showLookup()),!0}},{ctrl:!0,shift:!1,alt:!1,key:8,handler:function e(n,i){return t.disabled||t.readOnly||(i.stopEvent(),t.clearValue()),!0}},{ctrl:!0,shift:!1,alt:!1,key:65,handler:function e(n,i){return t.ctrlCDown=!0,!0}},{ctrl:!0,shift:!1,alt:!1,key:67,handler:function e(){return t.ctrlCDown=!0,!0}}]})},doRawQuery:function e(){var t=this,n=this.getRawValue();t.ctrlCDown||!n&&t.editedByUser||t.getDisplayValue()===n||t.callParent(arguments),t.deleteWasPressed=!1,t.ctrlCDown=!1},addItem:function e(){var t=this,n=t.getStore(),i=n.entityName,r=t.displayField,o=t.getValue(),a=n.getById(o),s={cmdType:UB.core.UBCommand.commandType.showForm,entity:i,store:n,isModal:!0,sender:t,onClose:function e(n){n&&t.setValueById&&(t.setIsActualValue=!0,t.setValueById(n))}};s.initValue={},s.initValue[r]=a?a.get(r):o,UB.core.UBApp.doCommand(s)},editItem:function e(t){var n=this,i,r,o,a;i=n.getStore(),(r=i.entityName)&&(o=n.getValue(),a={cmdType:UB.core.UBCommand.commandType.showForm,entity:r,instanceID:o,initValue:t,store:i,isModal:!0,sender:n,onClose:function e(t,i,r){!n.readOnly&&r&&(n.setValue(null),n.getStore().clearData(),n.setValueById(t||o),n.enable())}},o&&UB.core.UBApp.doCommand(a))},showLookup:function e(){var t=this,n,i,r,o,a;if(n=t.getStore(),i=n.entityName){r=t.getValue(),a=t.gridFieldList?t.gridFieldList:"*",o={entity:i,cmdType:UB.core.UBCommand.commandType.showList,description:$App.domainInfo.get(i,!0).getEntityDescription(),isModal:!0,sender:t,selectedInstanceID:r,onItemSelected:function e(n){t.setValueById&&(t.getStore().clearData(),t.setValueById(n.get(t.valueField||"ID")))},cmdData:{params:[{entity:i,method:"select",fieldList:a,whereList:n.ubRequest.whereList}]}};var s=n.filters.clone();s.removeAtKey(t.userFilterId),o.filters=s,UB.core.UBApp.doCommand(o)}},onExpand:function e(){var t=this,n=t.selectOnTab,i=t.getPicker();t.listKeyNav=new Ext.view.BoundListKeyNav(this.inputEl,{boundList:i,forceKeyDown:!0,tab:function e(i){return n&&(this.selectHighlighted(i),t.triggerBlur()),!0},enter:function e(n){var r=i.getSelectionModel(),o=r.getCount();this.selectHighlighted(n),t.multiSelect||o!==r.getCount()||t.collapse()},home:null,end:null}),t.callParent(arguments)},getErrors:function e(t){var n=this,i,r;return i=n.callParent(arguments),r=n.getValue(),r||0===r||n.allowBlank||(0===i.length||i.indexOf(n.blankText)<0)&&i.push(n.blankText),i},onDestroy:function e(){this.contextMenu&&this.contextMenu.destroy(),this.callParent(arguments)}})},function(e,t,n){function i(e){return(e||"").toLowerCase()}function r(e){var t={},n=void 0,r=void 0,o=void 0;return e?(e.split("\n").forEach(function(e){o=e.indexOf(":"),n=i(e.substr(0,o).trim()),r=e.substr(o+1).trim(),n&&(t[n]?t[n]+=", "+r:t[n]=r)}),t):t}function o(e){var t="object"===(void 0===e?"undefined":g(e))?e:void 0;return function(n){return t||(t=r(e)),n?t[i(n)]:t}}function a(e,t,n){return"function"==typeof n?n(e,t):(n.forEach(function(n){e=n(e,t)}),e)}function s(e,t,n){var i=Promise.resolve(e);return"function"==typeof n?i.then(function(e){return n(e,t)}):(n.forEach(function(e){i=i.then(function(n){return e(n,t)})}),i)}function l(e){return e>=200&&e<300}function u(e,t,n){var i=Object.keys(e);return i.forEach(function(i){t.call(n,e[i],i)}),i}function c(e,t,n){var i=Object.keys(e).sort();return i.forEach(function(i){t.call(n,e[i],i)}),i}function d(e,t){if(!t)return e;var n=[];return c(t,function(e,t){null!=e&&(Array.isArray(e)||(e=[e]),e.forEach(function(e){"object"===(void 0===e?"undefined":g(e))&&(e=JSON.stringify(e)),n.push(encodeURIComponent(t)+"="+encodeURIComponent(e))}))}),e+(-1===e.indexOf("?")?"?":"&")+n.join("&")}function f(e){var t=w,n={transformRequest:t.transformRequest,transformResponse:t.transformResponse},r=function e(n){var r=t.headers,o=y.apply({},n.headers),a=void 0,s=void 0,l=void 0,c=function e(t){u(t,function(e,n){if("function"==typeof e){var i=e();i?t[n]=i:delete t[n]}})};r=y.apply({},r.common,r[i(n.method)]),c(r),c(o);e:for(a in r){s=i(a);for(l in o)if(i(l)===s)continue e;o[a]=r[a]}return o},c=r(e);y.apply(n,e),n.headers=c,n.method=n.method?n.method.toUpperCase():"GET";var d=void 0,f=void 0,p=void 0;return d=function e(t){return s(t.data,t.headers,n.transformResponse).then(function(e){return t.data=e,l(t.status)?t:Promise.reject(t)})},f=function e(n){c=n.headers;var r=a(n.data,o(c),n.transformRequest),s=b;if(b=Date.now(),n.data){if(x===n.url&&"string"==typeof r&&v===r&&b-s<100)throw new y.UBError("monkeyRequestsDetected");v=r,x=n.url}else u(c,function(e,t){"content-type"===i(t)&&delete c[t]});return!n.withCredentials&&t.withCredentials&&(n.withCredentials=t.withCredentials),!n.timeout&&t.timeout&&(n.timeout=t.timeout),h(n,r,c).then(d,d)},p=Promise.resolve(n),C.filter(function(e){return!!e.request||!!e.requestError}).map(function(e){return{success:e.request,failure:e.requestError}}).concat({success:f}).concat(C.filter(function(e){return!!e.response||!!e.responseError}).map(function(e){return{success:e.response,failure:e.responseError}})).forEach(function(e){p=p.then(e.success,e.failure)}),p}function h(e,t,n){var i=d(e.url,e.params);return new Promise(function(r,a){var s=new B,c=-1,d=void 0,f=void 0;_.push(e),s.open(e.method,i,!0),u(n,function(e,t){e&&s.setRequestHeader(t,e)}),s.onreadystatechange=function(){if(4===s.readyState){var t=void 0,n=void 0;-1!==d&&(n=s.getAllResponseHeaders(),t=s.responseType?s.response:s.responseText),f&&clearTimeout(f),d=d||s.status,s=null,d=Math.max(1223===d?204:d,0);var i=_.indexOf(e);-1!==i&&_.splice(i,1),(l(d)?r:a)({data:t,status:d,headers:o(n),config:e})}},e.onProgress&&(s.upload?s.upload.onprogress=e.onProgress:s.onprogress=e.onProgress),e.withCredentials&&(s.withCredentials=!0),e.responseType&&(s.responseType=e.responseType),s.send(t||null),e.timeout>0&&(f=setTimeout(function(){d=-1,s&&s.abort()},e.timeout))})}function p(e,t){return f(y.apply(t||{},{method:"GET",url:e}))}function m(e,t,n){return f(y.apply(n||{},{method:"POST",url:e,data:t}))}var g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y=n(11),v=void 0,b=Date.now(),x=void 0;f.allowRequestReiteration=function(){v=null};var E={"Content-Type":"application/json;charset=utf-8"},w={transformRequest:[function(e){return e&&"object"===(void 0===e?"undefined":g(e))&&""+e!="[object File]"&&""+e!="[object ArrayBuffer]"?JSON.stringify(e):e}],transformResponse:[function(e,t){return"string"==typeof e&&(t("content-type")||"").indexOf("json")>=0&&(e=JSON.parse(e)),e}],headers:{common:{Accept:"application/json, text/plain, */*"},post:E,put:E,patch:E},timeout:12e4},C=[],_=[],B=XMLHttpRequest;e.exports={interceptors:C,pendingRequests:_,xhrDefaults:w,xhr:f,get:p,post:m}},function(e,t){function n(e,t){var n=this;if(this.dbName=e.toLowerCase(),!r)return this.__inMemoryCache={},this;var o=new Promise(function(e,o){var a=r.open(n.dbName,t||1);a.onerror=function e(t){o(t)},a.onblocked=function(){o({errMsg:"databaseIsBlocked",errDetails:"we need to upgrade database, but some other browser tab also open it"})},a.onsuccess=function t(){e(a.result)},a.onupgradeneeded=function e(t){var n=t.target.result,r=t.target.transaction;console.debug('upgrading database "'+n.name+'" from version '+t.oldVersion+" to version "+t.newVersion+"..."),i.stores.forEach(function(e){n.objectStoreNames.contains(e)?r.objectStore(e).clear():n.createObjectStore(e)})}});this.ready=function(){return o}}var i={name:"UB",stores:["permanent","session","userData"],version:1},r="undefined"!=typeof window&&window.indexedDB;n.SESSION="session",n.PERMANENT="permanent",n.cacheTypes={None:"None",Entity:"Entity",Session:"Session",SessionEntity:"SessionEntity"},n.prototype.onTransactionComplete=function(e){},n.prototype.onTransactionAbort=function(e){window.console&&window.console.error("IDB transaction aborted: "+(e.target.error.message||e.target.errorCode))},n.prototype.onTransactionError=function(e){window.console&&window.console.error("IDB transaction failed: "+e.target.errorCode)},n.prototype.get=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"userData";if(!r){var n=this.__inMemoryCache[t];return Promise.resolve(n?n[e]:void 0)}var i=this;return this.ready().then(function(n){var r=n.transaction([t],"readwrite");return r.oncomplete=i.onTransactionComplete,r.onabort=i.onTransactionAbort,r.onerror=i.onTransactionError,new Promise(function(n,i){var o=r.objectStore(t).get(e);o.onsuccess=function e(){n(o.result)},o.onerror=function e(){i({errMsg:o.error.name})}})})},n.prototype.getAllKeys=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"userData";if(!r){var t=this.__inMemoryCache[e],n=[];if(t)for(var i in t)n.push(t[i]);return Promise.resolve(n)}var o=this;return this.ready().then(function(t){var n=t.transaction([e],"readwrite");return n.oncomplete=o.onTransactionComplete,n.onabort=o.onTransactionAbort,n.onerror=o.onTransactionError,new Promise(function(t,i){var r=[],o=n.objectStore(e).openCursor();o.onsuccess=function(e){var n=e.target.result;n?(r.push(n.key),n.continue()):t(r)},o.onerror=function(e){i(e.target.result)}})})},n.prototype.put=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"userData";if(!r){var n=this.__inMemoryCache[t];return n||(n=this.__inMemoryCache[t]={}),Array.isArray(e)||(e=[e]),e.forEach(function(e){n[e.key]=void 0===e.value?null:e.value}),Promise.resolve(!0)}var i=this;return this.ready().then(function(n){var r=n.transaction([t],"readwrite");return r.oncomplete=i.onTransactionComplete,r.onabort=i.onTransactionAbort,r.onerror=i.onTransactionError,new Promise(function(n,i){var o=void 0;Array.isArray(e)?e.forEach(function(a,s){o=r.objectStore(t).put(void 0===a.value?null:a.value,a.key),o.onerror=function(e){i(e.target.result)},o.onsuccess=function(t){s===e.length-1&&n(t.target.result)}}):(o=r.objectStore(t).put(void 0===e.value?null:e.value,e.key),o.onsuccess=o.onerror=function(e){n(e.target.result)})})})},n.prototype.clear=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"userData";if(!r)return this.__inMemoryCache[e]={},Promise.resolve(!0);var t=this;return this.ready().then(function(n){var i=n.transaction([e],"readwrite");return i.oncomplete=t.onTransactionComplete,i.onabort=t.onTransactionAbort,i.onerror=t.onTransactionError,new Promise(function(t,n){var r=i.objectStore(e).clear();r.onsuccess=function(e){t(e.target.result)},r.onerror=function(e){n(e.target.result)}})})},n.prototype.remove=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"userData";if(!r){var n=this.__inMemoryCache[t];return n&&(Array.isArray(e)?delete n[e]:e.forEach(function(e){delete n[e]})),Promise.resolve(!0)}var i=this;return this.ready().then(function(n){var r=n.transaction([t],"readwrite");return r.oncomplete=i.onTransactionComplete,r.onabort=i.onTransactionAbort,r.onerror=i.onTransactionError,new Promise(function(n,i){var o=void 0;"string"==typeof e?(o=r.objectStore(t).delete(e),o.onsuccess=o.onerror=function(e){n(e.target.result)}):Array.isArray(e)?e.length?e.forEach(function(a,s){o=r.objectStore(t).delete(a),o.onerror=function(e){i(e.target.result)},o.onsuccess=function(t){s===e.length-1&&n(t.target.result)}}):n(!0):i({errMsg:"invalid key for UBCache.remove call"})})})},n.prototype.removeIfMach=function(e,t){var n=this;return n.getAllKeys(t).then(function(i){var r=i.filter(function(t){return e.test(t)});return n.remove(r,t)})},e.exports=n},function(e,t,n){var i,r,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(s,l){"object"===a(t)?e.exports=t=l(n(9)):(r=[n(9)],i=l,void 0!==(o="function"==typeof i?i.apply(t,r):i)&&(e.exports=o))}(void 0,function(e){return function(t){var n=e,i=n.lib,r=i.WordArray,o=i.Hasher,a=n.algo,s=[],l=[];!function(){function e(e){for(var n=t.sqrt(e),i=2;i<=n;i++)if(!(e%i))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var i=2,r=0;r<64;)e(i)&&(r<8&&(s[r]=n(t.pow(i,.5))),l[r]=n(t.pow(i,1/3)),r++),i++}();var u=[],c=a.SHA256=o.extend({_doReset:function e(){this._hash=new r.init(s.slice(0))},_doProcessBlock:function e(t,n){for(var i=this._hash.words,r=i[0],o=i[1],a=i[2],s=i[3],c=i[4],d=i[5],f=i[6],h=i[7],p=0;p<64;p++){if(p<16)u[p]=0|t[n+p];else{var m=u[p-15],g=(m<<25|m>>>7)^(m<<14|m>>>18)^m>>>3,y=u[p-2],v=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;u[p]=g+u[p-7]+v+u[p-16]}var b=c&d^~c&f,x=r&o^r&a^o&a,E=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),w=(c<<26|c>>>6)^(c<<21|c>>>11)^(c<<7|c>>>25),C=h+w+b+l[p]+u[p],_=E+x;h=f,f=d,d=c,c=s+C|0,s=a,a=o,o=r,r=C+_|0}i[0]=i[0]+r|0,i[1]=i[1]+o|0,i[2]=i[2]+a|0,i[3]=i[3]+s|0,i[4]=i[4]+c|0,i[5]=i[5]+d|0,i[6]=i[6]+f|0,i[7]=i[7]+h|0},_doFinalize:function e(){var n=this._data,i=n.words,r=8*this._nDataBytes,o=8*n.sigBytes;return i[o>>>5]|=128<<24-o%32,i[14+(o+64>>>9<<4)]=t.floor(r/4294967296),i[15+(o+64>>>9<<4)]=r,n.sigBytes=4*i.length,this._process(),this._hash},clone:function e(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});n.SHA256=o._createHelper(c),n.HmacSHA256=o._createHmacHelper(c)}(Math),e.SHA256})},function(e,t,n){var i,r,o,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(s,l){"object"===a(t)?e.exports=t=l(n(9)):(r=[n(9)],i=l,void 0!==(o="function"==typeof i?i.apply(t,r):i)&&(e.exports=o))}(void 0,function(e){return function(t){function n(e,t,n,i,r,o,a){var s=e+(t&n|~t&i)+r+a;return(s<<o|s>>>32-o)+t}function i(e,t,n,i,r,o,a){var s=e+(t&i|n&~i)+r+a;return(s<<o|s>>>32-o)+t}function r(e,t,n,i,r,o,a){var s=e+(t^n^i)+r+a;return(s<<o|s>>>32-o)+t}function o(e,t,n,i,r,o,a){var s=e+(n^(t|~i))+r+a;return(s<<o|s>>>32-o)+t}var a=e,s=a.lib,l=s.WordArray,u=s.Hasher,c=a.algo,d=[];!function(){for(var e=0;e<64;e++)d[e]=4294967296*t.abs(t.sin(e+1))|0}();var f=c.MD5=u.extend({_doReset:function e(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function e(t,a){for(var s=0;s<16;s++){var l=a+s,u=t[l];t[l]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}var c=this._hash.words,f=t[a+0],h=t[a+1],p=t[a+2],m=t[a+3],g=t[a+4],y=t[a+5],v=t[a+6],b=t[a+7],x=t[a+8],E=t[a+9],w=t[a+10],C=t[a+11],_=t[a+12],B=t[a+13],U=t[a+14],I=t[a+15],S=c[0],k=c[1],D=c[2],A=c[3];S=n(S,k,D,A,f,7,d[0]),A=n(A,S,k,D,h,12,d[1]),D=n(D,A,S,k,p,17,d[2]),k=n(k,D,A,S,m,22,d[3]),S=n(S,k,D,A,g,7,d[4]),A=n(A,S,k,D,y,12,d[5]),D=n(D,A,S,k,v,17,d[6]),k=n(k,D,A,S,b,22,d[7]),S=n(S,k,D,A,x,7,d[8]),A=n(A,S,k,D,E,12,d[9]),D=n(D,A,S,k,w,17,d[10]),k=n(k,D,A,S,C,22,d[11]),S=n(S,k,D,A,_,7,d[12]),A=n(A,S,k,D,B,12,d[13]),D=n(D,A,S,k,U,17,d[14]),k=n(k,D,A,S,I,22,d[15]),S=i(S,k,D,A,h,5,d[16]),A=i(A,S,k,D,v,9,d[17]),D=i(D,A,S,k,C,14,d[18]),k=i(k,D,A,S,f,20,d[19]),S=i(S,k,D,A,y,5,d[20]),A=i(A,S,k,D,w,9,d[21]),D=i(D,A,S,k,I,14,d[22]),k=i(k,D,A,S,g,20,d[23]),S=i(S,k,D,A,E,5,d[24]),A=i(A,S,k,D,U,9,d[25]),D=i(D,A,S,k,m,14,d[26]),k=i(k,D,A,S,x,20,d[27]),S=i(S,k,D,A,B,5,d[28]),A=i(A,S,k,D,p,9,d[29]),D=i(D,A,S,k,b,14,d[30]),k=i(k,D,A,S,_,20,d[31]),S=r(S,k,D,A,y,4,d[32]),A=r(A,S,k,D,x,11,d[33]),D=r(D,A,S,k,C,16,d[34]),k=r(k,D,A,S,U,23,d[35]),S=r(S,k,D,A,h,4,d[36]),A=r(A,S,k,D,g,11,d[37]),D=r(D,A,S,k,b,16,d[38]),k=r(k,D,A,S,w,23,d[39]),S=r(S,k,D,A,B,4,d[40]),A=r(A,S,k,D,f,11,d[41]),D=r(D,A,S,k,m,16,d[42]),k=r(k,D,A,S,v,23,d[43]),S=r(S,k,D,A,E,4,d[44]),A=r(A,S,k,D,_,11,d[45]),D=r(D,A,S,k,I,16,d[46]),k=r(k,D,A,S,p,23,d[47]),S=o(S,k,D,A,f,6,d[48]),A=o(A,S,k,D,b,10,d[49]),D=o(D,A,S,k,U,15,d[50]),k=o(k,D,A,S,y,21,d[51]),S=o(S,k,D,A,_,6,d[52]),A=o(A,S,k,D,m,10,d[53]),D=o(D,A,S,k,w,15,d[54]),k=o(k,D,A,S,h,21,d[55]),S=o(S,k,D,A,x,6,d[56]),A=o(A,S,k,D,I,10,d[57]),D=o(D,A,S,k,v,15,d[58]),k=o(k,D,A,S,B,21,d[59]),S=o(S,k,D,A,g,6,d[60]),A=o(A,S,k,D,C,10,d[61]),D=o(D,A,S,k,p,15,d[62]),k=o(k,D,A,S,E,21,d[63]),c[0]=c[0]+S|0,c[1]=c[1]+k|0,c[2]=c[2]+D|0,c[3]=c[3]+A|0},_doFinalize:function e(){var n=this._data,i=n.words,r=8*this._nDataBytes,o=8*n.sigBytes;i[o>>>5]|=128<<24-o%32;var a=t.floor(r/4294967296),s=r;i[15+(o+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),i[14+(o+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n.sigBytes=4*(i.length+1),this._process();for(var l=this._hash,u=l.words,c=0;c<4;c++){var d=u[c];u[c]=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8)}return l},clone:function e(){var e=u.clone.call(this);return e._hash=this._hash.clone(),e}});a.MD5=u._createHelper(f),a.HmacMD5=u._createHmacHelper(f)}(Math),e.MD5})},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(12),l=n(54),u=function(e){function t(e,n){i(this,t);var o=r(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return o.connection=e,o}return o(t,e),a(t,[{key:"selectAsObject",value:function e(t){return this.connection.select(this.ubql()).then(function(e){return s.selectResultToArrayOfObjects(e,t)})}},{key:"selectAsArray",value:function e(){return this.connection.select(this.ubql())}},{key:"selectAsStore",value:function e(t){return this.selectAsObject(t)}},{key:"select",value:function e(t){return this.selectAsObject(t)}},{key:"selectSingle",value:function e(t){return this.selectAsObject(t).then(function(e){return e[0]})}},{key:"selectScalar",value:function e(){return this.selectAsArray().then(function(e){return e.resultData.rowCount>0?e.resultData.data[0][0]:void 0})}},{key:"selectById",value:function e(t,n){return this.where("[ID]","=",t).selectSingle()}}]),t}(l);e.exports=u},function(e,t,n){"use strict";(function(t,i,r){var o=n(0),a,s=function(){throw Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")},l=o.getNativePromise();if(o.isNode&&"undefined"==typeof MutationObserver){var u=t.setImmediate,c=i.nextTick;a=o.isRecentNode?function(e){u.call(t,e)}:function(e){c.call(i,e)}}else if("function"==typeof l&&"function"==typeof l.resolve){var d=l.resolve();a=function(e){d.then(e)}}else a="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?void 0!==r?function(e){r(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:s:function(){var e=document.createElement("div"),t={attributes:!0},n=!1,i=document.createElement("div");new MutationObserver(function(){e.classList.toggle("foo"),n=!1}).observe(i,t);var r=function(){n||(n=!0,i.classList.toggle("foo"))};return function n(i){var o=new MutationObserver(function(){o.disconnect(),i()});o.observe(e,t),r()}}();e.exports=a}).call(t,n(7),n(5),n(49).setImmediate)},function(e,t,n){"use strict";e.exports=function(e){function t(t,n,s){return function(l){var u=s._boundValue();e:for(var c=0;c<t.length;++c){var d=t[c];if(d===Error||null!=d&&d.prototype instanceof Error){if(l instanceof d)return o(n).call(u,l)}else if("function"==typeof d){var f=o(d).call(u,l);if(f===a)return f;if(f)return o(n).call(u,l)}else if(i.isObject(l)){for(var h=r(d),p=0;p<h.length;++p){var m=h[p];if(d[m]!=l[m])continue e}return o(n).call(u,l)}}return e}}var i=n(0),r=n(8).keys,o=i.tryCatch,a=i.errorObj;return t}},function(e,t,n){"use strict";function i(e){return e instanceof Error&&c.getPrototypeOf(e)===Error.prototype}function r(e){var t;if(i(e)){t=new u(e),t.name=e.name,t.message=e.message,t.stack=e.stack;for(var n=c.keys(e),r=0;r<n.length;++r){var o=n[r];d.test(o)||(t[o]=e[o])}return t}return a.markAsOriginatingFromRejection(e),e}function o(e,t){return function(n,i){if(null!==e){if(n){var o=r(s(n));e._attachExtraTrace(o),e._reject(o)}else if(t){for(var a=arguments.length,l=Array(Math.max(a-1,0)),u=1;u<a;++u)l[u-1]=arguments[u];e._fulfill(l)}else e._fulfill(i);e=null}}}var a=n(0),s=a.maybeWrapAsError,l=n(6),u=l.OperationalError,c=n(8),d=/^(?:name|message|stack|cause)$/;e.exports=o},function(e,t){Ext.define("Ext.ux.window.Notification",{extend:"Ext.window.Window",alias:"widget.uxNotification",cls:"ux-notification-window",autoClose:!0,autoHeight:!0,plain:!1,draggable:!1,shadow:!1,focus:Ext.emptyFn,manager:null,useXAxis:!1,position:"br",spacing:6,paddingX:30,paddingY:10,slideInAnimation:"easeIn",slideBackAnimation:"bounceOut",slideInDuration:1500,slideBackDuration:1e3,hideDuration:500,autoCloseDelay:7e3,stickOnClick:!0,stickWhileHover:!0,isHiding:!1,readyToHide:!1,destroyAfterHide:!1,closeOnMouseOut:!1,xPos:0,yPos:0,statics:{defaultManager:{el:null}},initComponent:function e(){var t=this;Ext.isDefined(t.corner)&&(t.position=t.corner),Ext.isDefined(t.slideDownAnimation)&&(t.slideBackAnimation=t.slideDownAnimation),Ext.isDefined(t.autoDestroyDelay)&&(t.autoCloseDelay=t.autoDestroyDelay),Ext.isDefined(t.autoHideDelay)&&(t.autoCloseDelay=t.autoHideDelay),Ext.isDefined(t.autoHide)&&(t.autoClose=t.autoHide),Ext.isDefined(t.slideInDelay)&&(t.slideInDuration=t.slideInDelay),Ext.isDefined(t.slideDownDelay)&&(t.slideBackDuration=t.slideDownDelay),Ext.isDefined(t.fadeDelay)&&(t.hideDuration=t.fadeDelay),t.position=t.position.replace(/c/,""),t.updateAlignment(t.position),t.setManager(t.manager),t.callParent(arguments)},onRender:function e(){var t=this;t.el.hover(function(){t.mouseIsOver=!0},function(){t.mouseIsOver=!1,t.closeOnMouseOut&&(t.closeOnMouseOut=!1,t.close())},t),this.callParent(arguments)},updateAlignment:function e(t){var n=this;switch(t){case"br":n.paddingFactorX=-1,n.paddingFactorY=-1,n.siblingAlignment="br-br",n.useXAxis?n.managerAlignment="bl-br":n.managerAlignment="tr-br";break;case"bl":n.paddingFactorX=1,n.paddingFactorY=-1,n.siblingAlignment="bl-bl",n.useXAxis?n.managerAlignment="br-bl":n.managerAlignment="tl-bl";break;case"tr":n.paddingFactorX=-1,n.paddingFactorY=1,n.siblingAlignment="tr-tr",n.useXAxis?n.managerAlignment="tl-tr":n.managerAlignment="br-tr";break;case"tl":n.paddingFactorX=1,n.paddingFactorY=1,n.siblingAlignment="tl-tl",n.useXAxis?n.managerAlignment="tr-tl":n.managerAlignment="bl-tl";break;case"b":n.paddingFactorX=0,n.paddingFactorY=-1,n.siblingAlignment="b-b",n.useXAxis=0,n.managerAlignment="t-b";break;case"t":n.paddingFactorX=0,n.paddingFactorY=1,n.siblingAlignment="t-t",n.useXAxis=0,n.managerAlignment="b-t";break;case"l":n.paddingFactorX=1,n.paddingFactorY=0,n.siblingAlignment="l-l",n.useXAxis=1,n.managerAlignment="r-l";break;case"r":n.paddingFactorX=-1,n.paddingFactorY=0,n.siblingAlignment="r-r",n.useXAxis=1,n.managerAlignment="l-r"}},getXposAlignedToManager:function e(){var t=this,n=0;if(t.manager&&t.manager.el&&t.manager.el.dom){if(!t.useXAxis)return t.el.getLeft();"br"==t.position||"tr"==t.position||"r"==t.position?(n+=t.manager.el.getAnchorXY("r")[0],n-=t.el.getWidth()+t.paddingX):(n+=t.manager.el.getAnchorXY("l")[0],n+=t.paddingX)}return n},getYposAlignedToManager:function e(){var t=this,n=0;if(t.manager&&t.manager.el&&t.manager.el.dom){if(t.useXAxis)return t.el.getTop();"br"==t.position||"bl"==t.position||"b"==t.position?(n+=t.manager.el.getAnchorXY("b")[1],n-=t.el.getHeight()+t.paddingY):(n+=t.manager.el.getAnchorXY("t")[1],n+=t.paddingY)}return n},getXposAlignedToSibling:function e(t){var n=this;return n.useXAxis?"tl"==n.position||"bl"==n.position||"l"==n.position?t.xPos+t.el.getWidth()+t.spacing:t.xPos-n.el.getWidth()-n.spacing:n.el.getLeft()},getYposAlignedToSibling:function e(t){var n=this;return n.useXAxis?n.el.getTop():"tr"==n.position||"tl"==n.position||"t"==n.position?t.yPos+t.el.getHeight()+t.spacing:t.yPos-n.el.getHeight()-t.spacing},getNotifications:function e(t){var n=this;return n.manager.notifications[t]||(n.manager.notifications[t]=[]),n.manager.notifications[t]},setManager:function e(t){var n=this;n.manager=t,"string"==typeof n.manager&&(n.manager=Ext.getCmp(n.manager)),n.manager||(n.manager=n.statics().defaultManager,n.manager.el||(n.manager.el=Ext.getBody())),void 0===n.manager.notifications&&(n.manager.notifications={})},beforeShow:function e(){var t=this;t.stickOnClick&&t.body&&t.body.dom&&Ext.fly(t.body.dom).on("click",function(){t.cancelAutoClose(),t.addCls("notification-fixed")},t),t.autoClose&&(t.task=new Ext.util.DelayedTask(t.doAutoClose,t),t.task.delay(t.autoCloseDelay)),t.el.setX(-1e4),t.el.setOpacity(1)},afterShow:function e(){var t=this,n=t.getNotifications(t.managerAlignment);n.length?(t.el.alignTo(n[n.length-1].el,t.siblingAlignment,[0,0]),t.xPos=t.getXposAlignedToSibling(n[n.length-1]),t.yPos=t.getYposAlignedToSibling(n[n.length-1])):(t.el.alignTo(t.manager.el,t.managerAlignment,[t.paddingX*t.paddingFactorX,t.paddingY*t.paddingFactorY],!1),t.xPos=t.getXposAlignedToManager(),t.yPos=t.getYposAlignedToManager()),Ext.Array.include(n,t),t.el.animate({to:{x:t.xPos,y:t.yPos,opacity:1},easing:t.slideInAnimation,duration:t.slideInDuration,dynamic:!0}),this.callParent(arguments)},slideBack:function e(){var t=this,n=t.getNotifications(t.managerAlignment),i=Ext.Array.indexOf(n,t);!t.isHiding&&t.el&&t.manager&&t.manager.el&&t.manager.el.dom&&t.manager.el.isVisible()&&(i?(t.xPos=t.getXposAlignedToSibling(n[i-1]),t.yPos=t.getYposAlignedToSibling(n[i-1])):(t.xPos=t.getXposAlignedToManager(),t.yPos=t.getYposAlignedToManager()),t.stopAnimation(),t.el.animate({to:{x:t.xPos,y:t.yPos},easing:t.slideBackAnimation,duration:t.slideBackDuration,dynamic:!0}))},cancelAutoClose:function e(){var t=this;t.autoClose&&t.task.cancel()},doAutoClose:function e(){var t=this;t.stickWhileHover&&t.mouseIsOver?t.closeOnMouseOut=!0:t.close()},removeFromManager:function e(){var t=this;if(t.manager){var n=t.getNotifications(t.managerAlignment),i=Ext.Array.indexOf(n,t);if(-1!=i)for(Ext.Array.erase(n,i,1);i<n.length;i++)n[i].slideBack()}},hide:function e(){var t=this;!t.isHiding&&t.el&&(t.isHiding=!0,t.cancelAutoClose(),t.stopAnimation(),t.el.animate({to:{opacity:0},easing:"easeIn",duration:t.hideDuration,dynamic:!1,listeners:{afteranimate:function e(){t.removeFromManager(),t.readyToHide=!0,t.hide(t.animateTarget,t.doClose,t)}}})),t.readyToHide&&(t.isHiding=!1,t.readyToHide=!1,t.removeCls("notification-fixed"),t.callParent(arguments),t.destroyAfterHide&&t.destroy())},destroy:function e(){var t=this;t.hidden?t.callParent(arguments):(t.destroyAfterHide=!0,t.hide(t.animateTarget,t.doClose,t))}})},function(e,t){Ext.define("UB.view.OverflowSelect",{extend:"Ext.layout.container.boxOverflow.None",requires:["Ext.toolbar.Separator","Ext.button.Button"],mixins:{observable:"Ext.util.Observable"},noItemsMenuText:'<div class="'+Ext.baseCSSPrefix+'toolbar-no-items" role="menuitem">(None)</div>',constructor:function e(t){var n=this;n.layout=t,n.callParent(arguments),n.triggerButtonCls=n.triggerButtonCls||Ext.baseCSSPrefix+"box-menu-after",n.menuItems=[],n.mixins.observable.constructor.call(n),n.scrollPosition=0,n.scrollSize=0},beginLayout:function e(t){this.callParent(arguments),t.innerCtScrollPos=this.getScrollPosition(),this.clearOverflow(t)},completeLayout:function e(t){var n=this,i=t.state.boxPlan,r=n.layout.names,o;i&&i.tooNarrow&&(o=t.childItems[t.childItems.length-1],n.scrollSize=o.props[r.x]+o.props[r.width],n.updateScrollButtons(),n.updateActivePosition(t)),this.callParent(arguments)},finishedLayout:function e(t){var n=this,i=n.layout,r=Math.min(n.getMaxScrollPosition(),t.innerCtScrollPos);i.innerCt[i.names.setScrollLeft](r)},beginLayoutCycle:function e(t,n){this.callParent(arguments),n||(this.clearOverflow(t),this.layout.cacheChildItems(t))},updateActivePosition:function e(t){for(var n=this,i,r=1;r<t.childItems.length;r++)if(t.childItems[r]&&t.childItems[r].target&&(i=t.childItems[r].target,i.active)){n.scrollToItem(i,!0);break}},onRemove:function e(t){Ext.Array.remove(this.menuItems,t)},getSuffixConfig:function e(){var t=this,n=t.layout,i=n.owner,r=i.id;return t.menu=new Ext.menu.Menu({listeners:{scope:t,beforeshow:t.beforeMenuShow}}),t.menuTrigger=new Ext.button.Button({id:r+"-menu-trigger",cls:Ext.layout.container.Box.prototype.innerCls+" "+t.triggerButtonCls+" "+Ext.baseCSSPrefix+"toolbar-item ub-overflow-button",plain:i.usePlainButtons,ownerCt:i,ownerLayout:n,iconCls:Ext.baseCSSPrefix+t.getOwnerType(i)+"-more-icon",ui:i instanceof Ext.toolbar.Toolbar?"default-toolbar":"default",menu:t.menu,showEmptyMenu:!0,getSplitCls:function e(){return""}}),t.menuTrigger.getRenderTree()},getOverflowCls:function e(){return Ext.baseCSSPrefix+this.layout.direction+"-box-overflow-body"},handleOverflow:function e(t){var n=this,i=n.layout,r=i.names,o=t.state.boxPlan,a=[null,null];return n.showTrigger(t),"vertical"!==n.layout.direction&&(a[r.heightIndex]=(o.maxSize-n.menuTrigger[r.getHeight]())/2,n.menuTrigger.setPosition.apply(n.menuTrigger,a)),{reservedSpace:n.triggerTotalWidth}},captureChildElements:function e(){var t=this,n=t.menuTrigger,i=t.layout.names;n.rendering&&(n.finishRender(),t.triggerTotalWidth=n[i.getWidth]()+n.el.getMargin(i.parallelMargins))},_asLayoutRoot:{isRoot:!0},clearOverflow:function e(t){var n=this,i=n.menuItems,r=n.layout.owner;r.suspendLayouts(),n.captureChildElements(),n.hideTrigger(),r.resumeLayouts(),i.length=0},showTrigger:function e(t){var n=this,i=n.layout,r=i.owner,o=i.names,a=o.x,s=o.width,l=t.state.boxPlan,u=l.targetSize[s],c=t.childItems,d=c.length,f=n.menuTrigger,h,p,m,g,y,v;for(n.ownerContext=t,f.suspendLayouts(),f.show(),f.resumeLayouts(n._asLayoutRoot),u-=n.triggerTotalWidth,r.suspendLayouts(),n.menuItems.length=0,g=0;g<d;g++)h=c[g],m=h.target,y=h.props,v=y[a]+y[s]>u,p=Ext.create("Ext.Button",{text:m.text,targetTab:m,childContext:h,handler:n.onMenuItemClick,scope:n}),n.menuItems.push(p);r.resumeLayouts()},updateItemsState:function e(t){var n=this,i=t.childContext.props,r=t.targetTab,o=n.layout.names,a=o.x,s=o.width,l=n.ownerContext.state.boxPlan,u=l.targetSize[s],c;i=t.childContext.props,u-=n.triggerTotalWidth,c=i[a]+i[s]>u,t.initialConfig.cls="",r.active&&(t.initialConfig.cls+="ub-overflow-menu-item-active")},onMenuItemClick:function e(t){this.scrollToItem(t.targetTab),t.targetTab.tabBar.tabPanel.setActiveTab(t.targetTab.card)},scrollToItem:function e(t,n){var i=this,r=i.layout,o=r.owner,a=r.names,s,l,u,c,d,f,h;if(!i.isScrollingProcess&&void 0!==(t=i.getItem(t))){if(t===o.items.first())l=0;else if(t===o.items.last())l=i.getMaxScrollPosition();else{for(u=0;u<o.items.length;u++)if(o.items.getAt(u)===t){c=o.items.getAt(u+1),c=i.getItemVisibility(c),d=o.items.getAt(u-1),d=i.getItemVisibility(d);break}s=i.getItemVisibility(t),s.fullyVisible&&c.fullyVisible&&d.fullyVisible||(h=i.layout.innerCt[a.getWidth](),f=d.hiddenStart?s.width+c.width+d.width<h?c.itemEnd-h:s.itemStart+s.width/2-h/2:s.width+c.width+d.width<h?d.itemStart:s.itemStart+s.width/2-h/2,l=f)}void 0!==l&&i.scrollTo(l,n)}},scrollTo:function e(t,n){var i=this,r=i.layout,o=r.names,a=i.getScrollPosition(),s=Ext.Number.constrain(t,0,i.getMaxScrollPosition());i.isScrollingProcess||s===a||i.scrolling||(i.scrollPosition=NaN,void 0===n&&(n=i.animateScroll),i.isScrollingProcess=!0,r.innerCt[o.scrollTo](o.beforeScrollX,s,!!n&&i.getScrollAnim()),n?i.scrolling=!0:i.updateScrollButtons(),i.fireEvent("scroll",i,s,!!n&&i.getScrollAnim()),i.isScrollingProcess=!1)},getScrollAnim:function e(){return{duration:this.scrollDuration,callback:this.updateScrollButtons,scope:this}},updateScrollButtons:function e(){this.scrolling=!1},getItemVisibility:function e(t){var n=this,i=n.getItem(t).getBox(!0,!0),r=n.layout,o=r.names,a=i[o.x],s=a+i[o.width],l=n.getScrollPosition(),u=l+r.innerCt[o.getWidth]();return{hiddenStart:a<l,hiddenEnd:s>u,fullyVisible:a>l&&s<u,scrollStart:l,scrollEnd:u,itemStart:a,itemEnd:s,width:i[o.width]}},getScrollPosition:function e(){var t=this,n=t.layout,i;return i=isNaN(t.scrollPosition)?n.innerCt[n.names.getScrollLeft]():t.scrollPosition},getMaxScrollPosition:function e(){var t=this,n=t.layout,i=t.scrollSize-n.innerCt[n.names.getWidth]();return i<0?0:i},hideTrigger:function e(){var t=this.menuTrigger;t&&t.hide()},beforeMenuShow:function e(t){var n=this,i=n.menuItems,r=0,o=i.length,a,s;for(t.suspendLayouts(),n.clearMenu(),t.removeAll();r<o;r++)a=i[r],n.updateItemsState(a),n.addComponentToMenu(t,a),s=a;t.items.length<1&&t.add(n.noItemsMenuText),t.resumeLayouts()},createMenuConfig:function e(t,n){var i=this,r=Ext.apply({},t.initialConfig),o=t.toggleGroup;return Ext.copyTo(r,t,["iconCls","icon","itemId","disabled","handler","scope","menu","tabIndex"]),Ext.apply(r,{text:t.overflowText||t.text,hideOnClick:n,destroyMenu:!1,listeners:{}}),t.isFormField?(r.value=t.getValue(),r.listeners.change=function(e,n,i){t.setValue(n)}):(o||t.enableToggle)&&Ext.apply(r,{hideOnClick:!1,group:o,checked:t.pressed,handler:function e(n,i){t.onClick(i)}}),t.isButton&&!t.changeListenersAdded&&(t.on({textchange:i.onButtonAttrChange,iconchange:i.onButtonAttrChange,toggle:i.onButtonToggle}),t.changeListenersAdded=!0),delete r.margin,delete r.ownerCt,delete r.xtype,delete r.id,delete r.itemId,r},onButtonAttrChange:function e(t){var n=t.overflowClone;n.suspendLayouts(),n.setText(t.text),n.setIcon(t.icon),n.setIconCls(t.iconCls),n.resumeLayouts(!0)},onButtonToggle:function e(t,n){t.overflowClone.checked!==n&&t.overflowClone.setChecked(n)},addComponentToMenu:function e(t,n){var i=this,r,o,a;if(n instanceof Ext.toolbar.Separator)t.add("-");else if(n.isComponent)if(n.isXType("splitbutton"))n.overflowClone=t.add(i.createMenuConfig(n,!0));else if(n.isXType("button"))n.overflowClone=t.add(i.createMenuConfig(n,!n.menu));else if(n.isXType("buttongroup"))for(o=n.items.items,a=o.length,r=0;r<a;r++)i.addComponentToMenu(t,o[r]);else n.overflowClone=t.add(Ext.create(Ext.getClassName(n),i.createMenuConfig(n)))},clearMenu:function e(){var t=this.menu,n,i,r,o;if(t&&t.items)for(n=t.items.items,r=n.length,i=0;i<r;i++)o=n[i],o.setMenu&&o.setMenu(null)},destroy:function e(){var t=this.menuTrigger;t&&!this.layout.owner.items.contains(t)&&delete t.ownerCt,Ext.destroy(this.menu,t)}})},function(e,t){Ext.define("UB.ux.form.field.UBText",{extend:"Ext.form.field.Trigger",alias:"widget.ubtextfield",triggerCls:"ub-multilang-trigger",initComponent:function e(){var t=this,n=[];t.hideTrigger=!t.isMultiLang,t.hideTrigger&&(t.componentLayout="field"),n.push({text:UB.i18n("editMultiLang"),handler:t.showMultiLangForm,scope:t}),t.contextMenu=Ext.create("Ext.menu.Menu",{items:n}),t.callParent(arguments)},getSubTplMarkup:function e(t){var n=this;return n.hideTrigger?n.getTpl("fieldSubTpl").apply(this.getSubTplData()):n.callParent(arguments)},initTrigger:function e(){var t=this;t.hideTrigger||t.callParent(arguments)},onTriggerClick:function e(){this.showMultiLangForm()},setAllowBlank:function e(t){this.callParent(arguments)},afterRender:function e(){var t=this;t.callParent(arguments),t.isMultiLang&&(t.triggerEl&&t.triggerEl.set({"data-qtip":UB.i18n("isMultilangTip")}),t.getEl().on("contextmenu",t.showContextMenu,t))},showContextMenu:function e(t){t.stopEvent(),this.contextMenu.showAt(t.getXY())},showMultiLangForm:function e(){function t(){_.forEach(UB.appConfig.supportedLanguages,function(e){$App.connection.userLang()!==e&&u.hasOwnProperty(i.attributeName+"_"+e+"^")&&(a[e].setValue(u[i.attributeName+"_"+e+"^"]),a[e].resetOriginalValue())})}function n(){var e={};l.down("form").isValid()&&(_.forEach(UB.appConfig.supportedLanguages,function(t){$App.connection.userLang()!==t&&a[t].isDirty()&&(e[i.attributeName+"_"+t+"^"]=a[t].getValue())}),r.addExtendedDataForSave(e),i.nationalFieldEdited=!0,l.close())}var i=this,r,o=["ID"],a={},s=[],l,u;(r=i.up("basepanel"))&&i.attributeName&&(_.forEach(UB.appConfig.supportedLanguages,function(e){$App.connection.userLang()!==e&&(o.push(i.attributeName+"_"+e+"^"),a[e]=Ext.create(Ext.getClassName(i),{fieldLabel:UB.i18n(e),allowBlank:i.allowBlank,readOnly:i.readOnly||i.disabled,labelStyle:"word-break: 'break-all'; word-wrap: 'break-word';",labelWidth:120,rows:i.rows}),s.push(a[e]))}),u=r.getExtendedDataForSave(),r.instanceID?$App.connection.select({entity:r.entityName,method:"select",fieldList:o,ID:r.instanceID}).then(UB.LocalDataStore.selectResultToArrayOfObjects).done(function(e){var n=e&&e.length>0?e[0]:{};_.forEach(UB.appConfig.supportedLanguages,function(e){$App.connection.userLang()!==e&&(a[e].setValue(n[i.attributeName+"_"+e+"^"]),a[e].resetOriginalValue())}),t()}):t(),l=Ext.create("UB.view.BaseWindow",{title:i.fieldLabel,height:250,width:500,modal:!0,stateful:!0,stateId:"ubLangForm_"+r.entityCode+"_"+i.attributeName,layout:{type:"fit"},items:[{overflowX:"auto",overflowY:"auto",xtype:"form",padding:5,layout:{type:"vbox",align:"stretch"},items:s}],buttons:[{text:UB.i18n("Change"),glyph:UB.core.UBUtil.glyphs.faSave,hidden:i.readOnly||i.disabled,handler:n,scope:i},{text:UB.i18n("cancel"),glyph:UB.core.UBUtil.glyphs.faTimes,handler:function e(){l.close()}}]}),l.on("boxready",function(){l.actionsKeyMap={},l.actionsKeyMap.saveAndClode=new Ext.util.KeyMap({target:l.getEl(),binding:[{key:Ext.EventObject.ENTER,ctrl:!0,shift:!1,fn:function e(){n()}}]})}),l.show())}})},function(e,t,n){n(107),Ext.define("UB.ux.form.field.UBBoxSelect",{extend:"Ext.ux.form.field.BoxSelect",userFilterId:"userFilterId",alias:"widget.ubboxselect",queryCaching:!1,queryDelay:300,minChars:1,dataLoadDelay:!0,componentLayout:"triggerfield",cls:"ub-box-select",requires:["UB.core.UBUtil"],selectOnFocus:!1,highlightSearch:!0,minCharsForQuery:0,matchCls:"combo-search-match",disableGrow:!1,growMax:100,initComponent:function e(){var t=this,n,i;t.grow=!t.disableGrow,t.tpl||(t.tpl=new Ext.XTemplate('<ul class="'+Ext.plainListCls+'"><tpl for=".">','<li role="option" unselectable="on" class="','boundlist-{[xindex % 2 === 0 ? "even" : "odd"]}  '+Ext.baseCSSPrefix+'boundlist-item " ',">{[values['"+t.displayField+"']]}</li>","</tpl></ul>")),t.disablePaging?delete t.pageSize:t.pageSize||(t.pageSize=UB.appConfig.comboPageSize),i=t.getStore(),!i&&t.ubRequest&&(i=t.store=Ext.create("UB.ux.data.UBStore",{ubRequest:t.ubRequest,autoLoad:!1,autoDestroy:!0})),i.pageSize=t.pageSize,n=function e(n){return'<span class="'+t.matchCls+'">'+n+"</span>"},t.listConfig={pageSize:t.pageSize,minWidth:t.listMinWidth,selModel:{mode:t.multiSelect?"SIMPLE":"SINGLE",preventFocus:!0},listeners:{refresh:{fn:function e(i){if(t.highlightSearch&&t.searchRegExp){var r=i.getEl();if(r){var o=r.down(".x-list-plain");if(o)for(var a=o.down(".x-boundlist-item");a;)a.dom.innerHTML&&(a.dom.innerHTML=a.dom.innerHTML.replace(t.searchRegExp,n)),a=a.next()}}}}},tpl:t.tpl,getInnerTpl:function e(t){return"{[values['"+t+"']]}"},createPagingToolbar:function e(){var n=Ext.create("Ext.toolbar.Toolbar",{id:this.id+"-paging-toolbar",pageSize:t.pageSize,border:!1,minHeight:0,ownerCt:this,cls:"ub_combo-bound-toolbar",ownerLayout:this.getComponentLayout(),bindStore:Ext.emptyFn,items:[{xtype:"tbspacer",flex:1},{xtype:"tbseparator"},{xtype:"button",text:UB.i18n("more"),handler:t.readMoreData,scope:t}]});return t.pagingToolbar=n,n}},t.on({beforedestroy:t.onBeforedestroy,scope:t}),t.callParent(arguments),t.editable&&t.on({beforequery:t.beforequery,scope:t}),t.getStore()&&t.getStore().on("load",t.onDataLoaded,t)},onBeforedestroy:function e(){var t=this;t.getStore()&&t.getStore().un("load",t.onDataLoaded,t)},fieldSubTpl:['<div id="{cmpId}-listWrapper" class="x-boxselect {fieldCls} {typeCls} {requiredCls}','<tpl if="readOnly"> readonly="readonly"</tpl>','">','<ul id="{cmpId}-itemList" class="x-boxselect-list" ','<tpl if="componentHeight">style=" height:"{componentHeight}px;"</tpl>',">",'<li id="{cmpId}-inputElCt" class="x-boxselect-input" style="width: 100%;" >','<div id="{cmpId}-emptyEl" class="{emptyCls}">{emptyText}</div>','<input id="{cmpId}-inputEl" type="{type}" ','<tpl if="name">name="{name}" </tpl>','<tpl if="value"> value="{[Ext.util.Format.htmlEncode(values.value)]}"</tpl>','<tpl if="size">size="{size}" </tpl>','<tpl if="tabIdx">tabIndex="{tabIdx}" </tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','<tpl if="readOnly"> readonly="readonly"</tpl>','class="x-boxselect-input-field {inputElCls}" autocomplete="off">',"</li>","</ul>","</div>",{compiled:!0,disableFormats:!0}],setAllowBlank:function e(t){var n;this.allowBlank=t,(n=Ext.get(this.id+"-listWrapper"))&&(t?n.removeCls(this.requiredCls):n.addCls(this.requiredCls))},setValue:function e(t,n,i){Ext.isString(t)&&(t=Ext.JSON.decode("["+t+"]")),this.callParent([t,n,i]),this.updateLayout()},getValue:function e(t){var n=this.callParent(arguments);return t?n:n?UB.core.UBUtil.extractfromBrackets(Ext.JSON.encode(n)):n},getValueArray:function e(){var t=this.getValue(!0),n=[];return _.forEach(t,function(e){n.push(e)}),n},isDirty:function e(){var t=this;return!t.disabled&&!t.isEqual(t.getValue(),t.originalValue)},isEqual:function e(t,n){return!t&&!n||this.callParent(arguments)},setValueById:function e(t,n,i,r){var o=this,a,s;if(!t)return o.setValue(t),n&&o.resetOriginalValue(),void(i&&Ext.callback(i,r||o,[o]));a=o.store.ubRequest,"string"!=typeof t&&(t+=""),s="ID"===this.valueField?t.split(",").map(function(e){return parseInt(e,10)}):t.replace(/"/g,"").split(",");var l=UB.Repository(a.entity).attrs(a.fieldList);l=s.length>1?l.where("["+this.valueField+"]","in",s):l.where("["+this.valueField+"]","=",s[0]),this.enumGroupFilter&&(l=l.where("[eGroup]","=",this.enumGroupFilter)),l.selectAsStore().then(function(e){var t=[];e.each(function(e){t.push(e)}),o.store&&(o.setValue(t),n&&o.resetOriginalValue(),i&&Ext.callback(i,r||o,[o]))})},beforequery:function e(t){var n=this;if(n.minCharsForQuery&&n.minCharsForQuery>0&&n.minCharsForQuery>(t.query||"").length)return t.cancel=!0,void n.showToolTipMinQuery();var i=UB.Utils.escapeForRegexp(t.query);if(n.searchRegExp=null,Ext.isEmpty(i)||(n.searchRegExp=RegExp(i,"gi")),"local"!==t.combo.queryMode){var r=n.store,o=t.query||"",a=n.displayField;o?r.filters.add(new Ext.util.Filter({id:n.userFilterId,root:"data",property:a,caseSensitive:!1,anyMatch:!0,value:o})):(r.filters.removeAtKey(n.userFilterId),t.forceAll=!0)}},showToolTipMinQuery:function e(){var t=this.getPicker(),n;this.expand(),this.pagingToolbar.setHeight(0),n=t.getTargetEl(),t.clearViewEl(),Ext.core.DomHelper.insertHtml("beforeEnd",n.dom,UB.format(UB.i18n("startSearchMinCharacters"),this.minCharsForQuery))},onItemListClick:function e(t,n,i){var r=this,o=t.getTarget(".x-boxselect-item"),a=!!o&&t.getTarget(".x-boxselect-item-close");r.readOnly||r.disabled||(t.stopPropagation(),o?(a?(r.removeByListItemNode(o),r.valueStore.getCount()>0&&r.fireEvent("select",r,r.valueStore.getRange())):r.toggleSelectionByListItemNode(o,t.shiftKey),r.inputEl.focus()):r.selectionModel.getCount()>0&&(r.selectionModel.setLastFocused(null),r.selectionModel.deselectAll()))},alignPicker:function e(){var t=this,n=t.picker,i=n.getTargetEl().dom.scrollTop;t.callSuper(arguments),t.isExpanded&&(t.matchFieldWidth&&n.setWidth(t.bodyEl.getWidth()),n.getTargetEl().dom.scrollTop=i)},onDataLoaded:function e(){var t=this,n=t.store.getCount(),i;t.pagingToolbar&&(t.pageSize>n||t.lastRowIndex&&t.lastRowIndex+1+t.pageSize>n?t.pagingToolbar.setHeight(0):t.pagingToolbar.setHeight(36)),t.onDataRefreshed(),t.inputEl&&t.inputEl.getValue()&&(i=t.inputEl.getValue().length,t.inputEl.dom.setSelectionRange(i,i))},onDataRefreshed:function e(){var t=this,n=this.getStore(),i=n.getCount(),r=t.getPicker(),o=t.lastRowIndex;o&&(t.lastRowIndex=null,i>o+8&&(o+=8),(o=n.getAt(o))&&r.focusNode(o))},readMoreData:function e(){var t=this,n=this.getStore(),i=n.getCount();t.lastRowIndex=null,i>0&&(t.lastRowIndex=i-1),t.inputEl.focus(),n.loadPage((n.currentPage||0)+1,{params:this.getParams(this.lastQuery),addRecords:!0})},getMultiSelectItemMarkup:function e(){var t=this;return t.multiSelectItemTpl||(t.labelTpl?(Ext.isString(t.labelTpl)||Ext.isArray(t.labelTpl))&&(t.labelTpl=Ext.create("Ext.XTemplate",t.labelTpl)):t.labelTpl=Ext.create("Ext.XTemplate",'{[values["'+t.displayField+'"]]}'),t.multiSelectItemTpl=['<tpl for=".">','<li class="x-tab-default x-boxselect-item ','<tpl if="this.isSelected(values.'+t.valueField+')">'," selected","</tpl>",'" qtip="{[typeof values === "string" ? values : ["'+t.displayField+'"]]}">','<div class="x-boxselect-item-text this.getItemCls(values.'+t.valueField+')">{[typeof values === "string" ? values : this.getItemLabel(values)]}</div>','<div class="x-tab-close-btn x-boxselect-item-close"></div>',"</li>","</tpl>",{compile:!0,disableFormats:!0,getItemCls:function e(n){return t.deletedItems&&t.deletedItems.length>0&&t.deletedItems.indexof(n)>=0?"boxselect-item-deleted":""},isSelected:function e(n){var i=t.valueStore.findExact(t.valueField,n);return i>=0&&t.selectionModel.isSelected(t.valueStore.getAt(i))},getItemLabel:function e(n){return t.getTpl("labelTpl").apply(n)}}]),this.getTpl("multiSelectItemTpl").apply(Ext.Array.pluck(this.valueStore.getRange(),"data"))}})},function(e,t){Ext.define("UB.ux.UBObject",{extend:"Ext.Component",alias:"widget.ubobject",type:"",width:"100%",height:"100%",getElConfig:function e(){var t=this.callParent(),n;return"object"===this.autoEl?n=t:t.cn=[n={tag:"object",id:this.id+"-object"}],n.type=this.type,n.data=this.data,n.width=this.width,n.height=this.height,t},onRender:function e(){var t;this.callParent(arguments),t=this.el,this.objEl="object"===this.autoEl?t:t.getById(this.id+"-object")},onDestroy:function e(){Ext.destroy(this.objEl),this.objEl=null,this.callParent()},setSrc:function e(t){var n=this.objEl;return this.type=t.contentType,this.data=t.url+(this.forceMIME?"&forceMIME="+encodeURIComponent(this.forceMIME):""),n&&(n.dom.type=this.type,n.dom.data=this.data),Q.resolve(!0)},setXSize:function e(t){this.width=t.width,this.height=t.height,this.objEl&&(this.objEl.dom.width="100%",this.objEl.dom.height="100%")}})},function(e,t,n){e.exports={initAndCall:function e(){return window.mxImageBasePath="models/adminui-pub/resources/images",window.mxBasePath="models/adminui-pub/resources",n.e(1).then(n.bind(null,174)).then(function(e){return window.mxGraph?e:(window.mxGraph=e.mxGraph,window.mxShape=e.mxShape,window.mxConnectionConstraint=e.mxConnectionConstraint,window.mxPoint=e.mxPoint,window.mxPolyline=e.mxPolyline,window.mxEvent=e.mxEvent,window.mxRubberband=e.mxRubberband,window.mxCellState=e.mxCellState,window.mxClient=e.mxClient,window.mxUtils=e.mxUtils,window.mxConstants=e.mxConstants,window.mxPopupMenu=e.mxPopupMenu,window.mxDefaultPopupMenu=e.mxDefaultPopupMenu,window.mxEditor=e.mxEditor,window.mxGraphModel=e.mxGraphModel,window.mxGraphView=e.mxGraphView,window.mxToolbar=e.mxToolbar,window.mxDefaultToolbar=e.mxDefaultToolbar,window.mxGeometry=e.mxGeometry,window.mxKeyHandler=e.mxKeyHandler,window.mxDefaultKeyHandler=e.mxDefaultKeyHandler,window.mxVertexHandler=e.mxVertexHandler,window.mxStylesheet=e.mxStylesheet,window.mxCellRenderer=e.mxCellRenderer,window.mxCell=e.mxCell,window.mxCodec=e.mxCodec,window.mxDivResizer=e.mxDivResizer,window.mxOutline=e.mxOutline,window.mxUndoManager=e.mxUndoManager,window.mxEdgeStyle=e.mxEdgeStyle,window.mxCompactTreeLayout=e.mxCompactTreeLayout,window.mxLabel=e.mxLabel,window.mxRectangle=e.mxRectangle,window.mxCellOverlay=e.mxCellOverlay,window.mxImage=e.mxImage,window.mxPrintPreview=e.mxPrintPreview,e)})}}},function(e,t,n){var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n(4),n(122),n(123),n(125),n(126),n(131),n(132),n(133),n(134),n(135),n(40);var r=n(1);Ext.define("UB.view.EntityGridPanel",{extend:"Ext.grid.Panel",alias:"widget.entitygridpanel",cls:"ub-entity-grid",selModel:{mode:"MULTI",pruneRemoved:!1},selType:"cellmodel",disableSearchBar:!1,rowHeight:28,uses:["UB.core.UBCommand","UB.view.BaseWindow","UB.view.InputDateWindow","UB.core.UBFormLoader","UB.ux.UBPreFilter"],statics:{actionId:{addNew:"addNew",addNewByCurrent:"addNewByCurrent",prefilter:"prefilter",edit:"edit",del:"del",newVersion:"newVersion",refresh:"refresh",history:"history",accessRight:"accessRight",audit:"audit",itemSelect:"itemSelect",exportXls:"exportXls",exportCsv:"exportCsv",exportHtml:"exportHtml",showPreview:"showPreview",lock:"lock",unLock:"unLock",itemLink:"itemLink",optimizeWidth:"optimizeWidth"},eventId:{addnew:"addnew",addnewbycurrent:"addnewbycurrent",prefilter:"prefilter",edit:"edit",del:"del",filtered:"filtered",newversion:"newversion",accessRight:"accessRight",audit:"audit",refresh:"refresh",history:"history",itemselect:"itemselect",exportXls:"exportXls",exportCsv:"exportCsv",exportHtml:"exportHtml",showPreview:"showPreview",lock:"lock",unLock:"unLock",itemLink:"itemLink",optimizeWidth:"optimizeWidth"},comboBoxAttributesStoreField:{idProperty:"id",dataIndex:"dataIndex",header:"header"},hotKeys:{edit:{key:Ext.EventObject.E,ctrl:!0,shift:!1,text:" (Ctrl+E)"},del:{key:Ext.EventObject.DELETE,ctrl:!0,shift:!1,text:" (Ctrl+Delete)"},addNew:{key:Ext.EventObject.INSERT,ctrl:!0,shift:!1,text:" (Ctrl+Ins)"},refresh:{ctrl:!0,key:Ext.EventObject.R,shift:!1,text:" (Ctrl+R)"},itemSelect:{key:Ext.EventObject.ENTER,shift:!1,ctrl:!1,text:" (ENTER)"},prefilter:{ctrl:!0,key:Ext.EventObject.F,shift:!0,text:" (Ctrl+Shift+F)"}},columnParams:{String:{minSize:20,maxSize:80},Text:{minSize:20,maxSize:80},Date:{minSize:13,maxSize:20},DateTime:{minSize:17,maxSize:20},Int:{minSize:13,maxSize:20},Enum:{minSize:20,maxSize:30},Float:{minSize:16,maxSize:20},Currency:{minSize:16,maxSize:20},Boolean:{minSize:8,maxSize:20}},getGridCharWidth:function e(){if(!this.gridCharWidth){var t=document.createElement("div");t.style.width="auto",t.style.height="auto",t.style.border=0,t.style.padding=0,t.style.margin=0,t.className="x-grid-cell",t.innerHTML="pppppppppp",t.style.position="absolute",t.style.float="left",t.style.whiteSpace="nowrap",t.style.visibility="hidden",document.body.appendChild(t),this.gridCharWidth=t.clientWidth/10,document.body.removeChild(t)}return this.gridCharWidth},getGridHeaderCharWidth:function e(){if(!this.gridHeaderCharWidth){var t=document.createElement("div");t.style.width="auto",t.style.height="auto",t.style.border=0,t.style.padding=0,t.style.margin=0,t.className="x-column-header",t.innerHTML="pppppppppp",t.style.position="absolute",t.style.float="left",t.style.whiteSpace="nowrap",t.style.visibility="hidden",document.body.appendChild(t),this.gridHeaderCharWidth=t.clientWidth/10,document.body.removeChild(t)}return this.gridHeaderCharWidth},getEntityColumns:function e(t,n,i,o,a){var s=[],l=$App.domainInfo.get(t);n=n||UB.Utils.convertFieldListToExtended(l.filterAttribute({defaultView:!0}));for(var u=0,c=n.length;u<c;++u){var d=l.getEntityAttributeInfo(n[u].name,-1);if(d.attribute&&d.attribute.customSettings&&d.attribute.customSettings.UIGridColumnClass)s.push({xtype:"column"+d.attribute.customSettings.UIGridColumnClass.toLowerCase(),header:"",menuText:UB.i18n(d.attribute.customSettings.UIGridColumnClass.toLowerCase()),dataIndex:n[u].name,stateId:d.attribute.customSettings.UIGridColumnClass.toLowerCase()+n[u].name,fieldName:n[u].name});else{var f=UB.view.EntityGridPanel.getEntityColumn(t,n[u],i,a);if(f){if(o){var h=n[u].name.indexOf(".")+1?n[u].name.substring(0,n[u].name.indexOf(".")):n[u].name,p=l.attributes[h],m={};r.includes([UBDomain.ubDataTypes.Entity],p.dataType)?(n[u].editor&&n[u].editor.fieldList?m.fieldList=n[u].editor.fieldList:n[u].name.indexOf(".")+1?m.fieldList=["ID",n[u].name.substring(n[u].name.indexOf(".")+1)]:m.fieldList=["ID",$App.domainInfo.get(p.associatedEntity).getDescriptionAttribute()],f.editor=UB.core.UBUtil.ubDt2Ext(p,m),f.editor.valueField=f.editor.displayField,f.editor.storeAttributeValueField=h,!1===p.allowNull&&(f.editor.allowBlank=!1)):(f.editor=UB.core.UBUtil.ubDt2Ext(p,m),!1===p.allowNull&&(f.editor.allowBlank=!1)),f.editor.margin="0 1 0 1",n[u].editor&&r.extend(f.editor,n[u].editor)}s.push(f)}}}return s.length<3&&s.forEach(function(e){e.flex||(e.flex=1,delete e.stateId)}),s},getEntityColumn:function e(t,n,i,o){var a=$App.domainInfo,s=n.name,l=n.format&&!r.isFunction(n.format)?n.format:null,u=a.get(t),c=u.getEntityAttributeInfo(s);if(!u||!c||!c.attribute)return null;c=c.attribute;var d=s.split("."),f=t,h="";if(r.forEach(d,function(e,t){var n=a.get(f);if(n){var i=n.attributes[e];i&&(f=i.associatedEntity,h+=(h?".":"")+i.caption)}}),1===d.length&&!1===n.visibility)return null;var p={stateId:s,fieldName:s};p.dataIndex=s,p.header=n.description||h||UB.i18n(c.code),p.tooltip=n.tooltip||n.description||h,p.sortable=!1===o?o:n.hasOwnProperty("sortable")?n.sortable&&"Text"!==c.dataType:"Text"!==c.dataType&&c.allowSort,p.simpleFilter=n.simpleFilter,p.filterCaption=n.filterCaption;var m=a.ubDataTypes;switch(c.dataType){case m.Enum:var g=UB.core.UBEnumManager.getDictionary(c.enumGroup,"name");p.renderer=function(e){return g[e]};break;case m.Entity:var y=a.get(c.associatedEntity).descriptionAttribute||"caption",v=i[UB.core.UBUtil.getNameMd5(c.associatedEntity,["ID",y])];p.renderer=function(e){var t=v.getById(e);return t?t.get(y):""};break;case m.Date:p.renderer=Ext.util.Format.dateRenderer(l||Ext.util.Format.dateFormat||"d.m.Y"),p.filter={type:"date",dataIndex:p.dataIndex,dateFormat:Ext.util.Format.dateFormat};break;case m.DateTime:p.renderer=Ext.util.Format.dateRenderer(l||Ext.util.Format.datetimeFormat||"d.m.Y G:i"),p.filter={type:"date",dataIndex:p.dataIndex,dateFormat:Ext.util.Format.dateFormat};break;case m.Float:p.align="right",p.renderer=Ext.util.Format.numberRenderer(l||"0,000.0000");break;case m.Currency:p.align="right",p.renderer=Ext.util.Format.numberRenderer(l||"0.00");break;case m.Int:p.renderer=Ext.util.Format.numberRenderer(l||"0,000"),p.align="right";break;case m.Boolean:p.xtype="booleancolumn",p.trueText=UB.i18n("da"),p.falseText=UB.i18n("net");break;case m.String:case m.Text:p.renderer=function(e,t){var n=Ext.String.htmlEncode(e);return t&&Ext.isString(e)&&e.length>15&&(t.tdAttr='data-qtip="'+Ext.String.htmlEncode(n)+'"'),n}}return p.filterable=!1!==n.filterable,n.format&&r.isFunction(n.format)&&(p.renderer=n.format),n.summaryType&&(p.summaryType=n.summaryType),n.config?r.defaults(r.clone(n.config),p):p},loadRunListParamsRequirementsStores:function e(t){for(var n={},i=$App.domainInfo.get(t.entity).getEntityRequirements(UB.core.UBUtil.convertFieldListToNameList(t.fieldList,!0)),r=0,o=i.length;r<o;++r){var a=$App.domainInfo.get(i[r]),s=a.descriptionAttribute,l=["ID"];"ID"!==s&&l.push(s);var u=UB.core.UBUtil.getNameMd5(i[r],l);if(!n[u]){var c=Ext.create("UB.ux.data.UBStore",{ubRequest:{entity:i[r],method:"select",fieldList:l},autoLoad:!1,disablePaging:!0,autoDestroy:!0,createIndexByID:!0});c.lookUpEntity=t.entity,c.lookUpField=i[r],c.on("load",function(e,t,n){n&&t&&t.length>1e3&&console.error('Too large look up field for entity "'+e.lookUpField+'". Look up entity '+e.ubRequest.entity+" Record count ="+t.length)},c,{single:!0}),n[u]=c}}return n}},mixins:{ubPanelMixin:"UB.core.UBPanelMixin"},selectedRecordID:null,viewType:"ubtableview",customActions:[],hidePagingBar:!1,hideMenuAllActions:!1,minRowsPagingBarVisibled:11,hideActionToolbar:!1,toolbarActionList:null,readOnly:!1,notWriteChanges:!1,rowEditing:!1,summaryDataOnClient:!1,menuAllActionsActionList:null,applyState:function e(){this.callParent(arguments),this.stateLoadedFromStore=!0},onOptimizeWidth:function e(){this.optimizeColumnWidth(!0)},getData:function e(){var t=this,n=[];return t.getStore().data.items.forEach(function(e){n.push(e.getData())}),n},getAttributeData:function e(){var t=this,n={insert:[],update:[],del:[]};return t.getStore().data.items.forEach(function(e){var t=e.getData();if(Object.keys(t).forEach(function(e){e.indexOf(".")+1&&delete t[e]}),t.ID){if(e.dirty){var i=e.getChanges(),r={ID:t.ID};t.mi_modifyDate&&(r.mi_modifyDate=t.mi_modifyDate),Object.keys(i).forEach(function(e){e.indexOf(".")+1||(r[e]=t[e])}),n.update.push(r)}}else n.insert.push(t)}),t.getStore().getRemovedRecords().forEach(function(e){e.getData().ID&&n.del.push(e.getData())}),n},optimizeColumnWidth:function e(t){function n(){var e=0;return r.forEach(u,function(t){e+=t.size||t.minSize}),e}var i=this,o={},a=0,s=0,l=0,u={},c=0,d=void 0,f=void 0,h=void 0,p=void 0,m=void 0,g=UB.view.EntityGridPanel.columnParams,y=i.getEl().getWidth();if(!i.stateLoadedFromStore||t){r.forEach(i.store.model.getFields(),function(e){o[e.name]=e});var v=$App.domainInfo.get(i.entityName);r.forEach(i.columns,function(e){if(f={},e.dataIndex){var t=v.attr(e.dataIndex);if(t||o[e.dataIndex]){if(t)f.type=t.dataType,f.size=t.size;else{switch(f.type=o[e.dataIndex].type.type,f.type){case"string":f.type="String";break;case"int":f.type="Int";break;case"float":f.type="Float";break;case"boolean":f.type="Boolean";break;case"date":f.type="Date"}f.size=g[f.type]?g[f.type].minSize||20:20}f.minSize=e.minWidthChar||(g[f.type]?g[f.type].minSize||20:20),f.maxSize=e.maxWidthChar||(g[f.type]?g[f.type].maxSize||80:80),f.size&&f.size<f.maxSize&&(f.maxSize=f.size<20?20:f.size),f.size||(f.size=f.minSize),f.size>f.maxSize&&(f.size=f.maxSize),a+=f.size,c+=f.size<f.minWidth?f.size:f.minSize,f.column=e,u[e.dataIndex]=f}}}),d=UB.view.EntityGridPanel.getGridCharWidth(),y-=i.columns.length+1,y-=8*i.columns.length,y-=12,p=y/d,a>p&&(l=0,p>c&&(l=p-c),m=i.columns.length,r.forEachRight(i.columns,function(e){(f=u[e.dataIndex])&&(s=l>0?Math.round(l/m)||1:0,f.size>f.minSize&&(f.minSize+s>f.maxSize?(f.size=f.maxSize,l-=f.maxSize-f.minSize):(f.size=f.minSize+s,l-=s)),m-=1)})),a=n(),a<p&&(h=UB.view.EntityGridPanel.getGridHeaderCharWidth(),l=p-a,m=i.columns.length,r.forEach(i.columns,function(e){(f=u[e.dataIndex])&&(s=Math.round(l/m)||1,f.headerWidth=(e.text.length>20?20:e.text.length)*h/d,f.headerWidth>f.size+s?(l-=f.headerWidth-f.size,f.size=f.headerWidth):f.size+s>f.maxSize?(l-=f.maxSize-f.size,f.size=f.maxSize):(l-=s,f.size+=s),m-=1)})),a=0,r.forEach(u,function(e){a+=e.size*d,e.column.setWidth(e.size*d+8)})}},createStoreByConfig:function e(){var t=this,n=Ext.clone(t.entityConfig),i=void 0;t.stores=i=UB.view.EntityGridPanel.loadRunListParamsRequirementsStores(n),n.fieldList=UB.core.UBUtil.convertFieldListToNameList(n.fieldList),t.rowEditing&&n.fieldList.forEach(function(e){var t=$App.domainInfo.get(n.entity),i=e.indexOf(".")+1?e.substring(0,e.indexOf(".")):e,o=t.attributes[i];r.includes([UBDomain.ubDataTypes.Entity],o.dataType)&&e.indexOf(".")+1&&n.fieldList.push(i)}),t.store=Ext.create("UB.ux.data.UBStore",{ubRequest:n,autoLoad:!1,linkedItemsLoadList:i,pageSize:t.pageSize||UB.appConfig.storeDefaultPageSize,autoDestroy:!0}),t.store.on("load",t.onLoadStore,t),t.filters&&(t.filters instanceof Ext.util.MixedCollection&&(t.filters=t.filters.items),t.store.filters.addAll(t.filters)),t.entityName=n.entity,t.loadStoreImmediately&&(!t.autoFilter||t.autoFilter&&t.autoFilter.notShowBefore)&&!t.disableAutoLoadStore&&t.store.load()},createAutoFilter:function e(){var t=this;t.autoFilterActive=!0,t.disableAutoShow=!0,t.preFilterForm=UB.ux.UBPreFilter.makeFilters({options:t.autoFilter,entityCode:t.entityName,filters:t.baseFilters,onFilterReady:function e(n,i){t.preFilterForm=null,n&&n.length>0&&t.store.addFilter(n,!1),i&&(t.store.filterFormId=i),t.autoFilterActive=!1,(t.rendered||t.store.isLoading())&&t.store.load();var r=t.up("window");r&&r.show()},onCancel:function e(){t.preFilterForm=null,t.close()},scope:t})},createSystemConditions:function e(){var t=this;t.entityConfig&&t.entityConfig.fieldList&&r.forEach(t.entityConfig.fieldList,function(e){var n="object"===(void 0===e?"undefined":i(e))?e.name:e,r=$App.domainInfo.get(t.entityConfig.entity).getEntityAttributeInfo(n,-1),o=r.attribute&&r.attribute.customSettings&&r.attribute.customSettings.UIGridColumnClass?r.attribute.customSettings.UIGridColumnClass:null;o&&UB.view["Column"+o]&&UB.view["Column"+o].prepareConditions&&UB.view["Column"+o].prepareConditions(t.entityConfig,n,r)})},onLoadStore:function e(t,n,i){i&&0!==n.length?(this.enableAction("edit"),this.enableAction("del"),this.enableAction("showPreview"),this.enableAction("lock"),this.enableAction("unLock"),this.enableAction("itemLink")):(this.disableAction("edit"),this.disableAction("del"),this.disableAction("showPreview"),this.disableAction("lock"),this.disableAction("unLock"),this.disableAction("itemLink"))},createPopupMenu:function e(){var t=this,n=UB.view.EntityGridPanel.actionId,i=[t.actions[n.edit],t.actions[n.addNewByCurrent],t.actions[n.del]];t.hasDataHistoryMixin&&!t.isHistory&&(i.push("-"),i.push(t.actions[n.newVersion]),i.push(t.actions[n.history])),t.hasAuditMixin&&(i.push("-"),i.push(t.actions[n.audit])),t.hasHardSecurityMixin&&(i.push("-"),i.push(t.actions[n.accessRight])),t.entityDetails.length&&!t.disableMenuItemDetails&&(i.push("-"),i.push(t.createMenuItemDetails())),i.push("-"),i.push(t.actions[n.itemLink]),t.menu=Ext.create("Ext.menu.Menu",{items:i}),t.popupMenuItems=i},initComponent:function e(){var t=this;if(!t.extendedFieldList&&t.entityConfig&&(t.extendedFieldList=UB.core.UBUtil.convertFieldListToExtended(t.entityConfig.fieldList)),t.createSystemConditions(),!t.store&&t.entityConfig?t.createStoreByConfig():(t.entityConfig&&(t.entityName=t.entityConfig.entity),t.store&&(t.store.on("load",t.onLoadStore,t),t.store.ubRequest&&t.store.ubRequest.entity&&(t.entityName=t.store.ubRequest.entity)),t.store&&t.loadStoreImmediately&&(!t.autoFilter||t.autoFilter&&t.autoFilter.notShowBefore)&&!t.disableAutoLoadStore&&t.store.load()),t.entity=$App.domainInfo.get(t.entityName),!t.entity)throw Error("You must specify entity");if(t.isHistory=t.store&&t.store.ubRequest&&t.store.ubRequest.__mip_recordhistory,t.isHistory&&(t.miDataID=t.store.ubRequest.id||t.store.ubRequest.ID),t.autoFilter&&!t.autoFilter.notShowBefore&&t.createAutoFilter(),t.columns=t.columns||UB.view.EntityGridPanel.getEntityColumns(t.entityName,t.getVisibleColumns(),t.stores,t.rowEditing,t.hasOwnProperty("sortableColumns")?t.sortableColumns:void 0),t.extendedColumns){var n={};r.forEach(t.columns,function(e){e.dataIndex&&(n[e.dataIndex]=e)}),r.forEach(t.extendedColumns,function(e){e.dataIndex&&n[e.dataIndex]?r.merge(n[e.dataIndex],e):t.columns.push(e)})}if(t.getRowClass=t.getRowClass||Ext.emptyFn,Ext.apply(t,{viewConfig:{enableTextSelection:!0,blockRefresh:!1,listeners:{itemcontextmenu:{fn:t.onItemContextMenu,scope:t},refresh:{fn:t.onViewRefreshed,scope:t}},getRowClass:t.getRowClass}}),t.rowEditing){var i=Ext.create("Ext.grid.plugin.RowEditing",{clicksToEdit:1,clicksToMoveEditor:2,saveBtnText:UB.i18n("save"),cancelBtnText:UB.i18n("actionCancel"),autoCancel:!1,errorSummary:!1});i.on("canceledit",function(e,n){(!n.record.get("ID")&&!t.notWriteChanges||t.notWriteChanges&&n.record.phantom&&null!==n.record.dirtySave)&&n.store.remove(n.record)}),i.on("beforeedit",function(e,n){if(t.editingPlugin.editing||t.readOnly||!t.entity.haveAccessToMethod(UB.core.UBCommand.methodName.UPDATE))return!1;if(n.grid.columns.forEach(function(e){if(e.field&&e.field.setWidth(e.width-2),t.GridSummary){r.find(t.GridSummary.items.items,{baseColumn:e}).setWidth(e.width-2)}e.field&&(r.has(e.field,"events.change")&&"function"==typeof e.field.events.change.clearListeners&&e.field.events.change.clearListeners(),e.field.xtype.indexOf("combobox")+1&&e.field.setValue())}),t.lineNumberColumn&&!n.record.get(t.lineNumberColumn)){var i=r.find(n.grid.columns,{dataIndex:t.lineNumberColumn});i&&(i.field.setValue(),n.record.set(t.lineNumberColumn,n.grid.getStore().max(t.lineNumberColumn)+1))}if(r.isFunction(t.onBeforeEdit)){if(!1===t.onBeforeEdit(e,n))return!1}r.filter(n.grid.columns,function(e){return e.getEditor()&&e.getEditor().xtype.indexOf("combobox")>=0}).forEach(function(e){if(!e.field.gridFieldList){var t=$App.domainInfo.get(e.field.getStore().entityName).getAttributeNames({defaultView:!0});r.includes(t,e.field.displayField)||t.push(e.field.displayField),r.includes(t,e.field.valueField)||t.push(e.field.valueField),e.field.gridFieldList=t}e.field.disableModifyEntity=!0,e.field.useForGridEdit=!0})}),i.on("validateedit",function(e,n){if(r.isFunction(t.onValidateEdit)){if(!1===t.onValidateEdit(e,n))return!1}}),t.plugins?t.plugins.push(i):t.plugins=[i]}t.plugins||(t.plugins=[]),t.dockedItems||(t.dockedItems=[]),t.summary&&(Ext.isObject(t.summary)&&r.forEach(t.summary,function(e,n){r.forEach(t.columns,function(t){if(t.fieldName===n)return t.summaryType=e,!1})}),t.GridSummary=new UB.view.GridSummary({grid:t}),t.dockedItems.push(t.GridSummary),t.store&&t.store.on("clear",function(){t.GridSummary&&t.GridSummary.dataBind()})),t.disableSearchBar||t.plugins.push({ptype:"multifilter"}),t.isDetail&&(t.target.ownerCt.mainEntityGridPanel.on("parentchange",t.onParentChange,t),t.mainEntityGridPanel=t.target.ownerCt.mainEntityGridPanel,t.on("close",function(){var e=t.up("tabpanel");e&&1===e.items.getCount()&&(e.relatedSplitter.hide(),e.hide(),e.ownerCt.doLayout()),e.mainPanel.mainEntityGridPanel.onDetailClose(t.entityName)},t)),t.hasDataHistoryMixin=t.entity.hasMixin("dataHistory"),t.hasAuditMixin=t.entity.hasMixin("audit"),t.hasHardSecurityMixin=t.entity.hasMixin("aclRls"),t.isEntityLockable=t.entity.hasMixin("softLock"),t.createComboBoxAttributesStore(),t.preprocessPanel(),t.hideActions&&t.hideActions.length&&r.forEach(t.hideActions,function(e){"showDetail"===e&&(t.disableMenuItemDetails=!0)}),t.createPopupMenu(),t.on({selectionchange:t.onSelectionChange,viewready:t.onViewReady,boxready:function e(){t.optimizeColumnWidth(),t.disableAutoSelectRow&&!t.selectedRecordID||t.selectDefaultRow(),t.setupActions(),t.initPagingToolbar(),t.store.isLoading()||t.autoFilterActive||t.store.load(),t.notWriteChanges&&t.GridSummary&&t.GridSummary.dataBind();var n=t.getFormWin();n&&t.mon(n,"close",t.onPanelClose,t)},deselect:function e(n,i,r){t.getView().removeRowCls(r,"ub-grid-row-selected")},select:function e(n,i,r){t.getView().addRowCls(r,"ub-grid-row-selected")},scope:t}),t.addEvents("parentchange"),t.on("afterlayout",function(){t.realignFloatPanel()},t),t.on("sortchange",function(){t.store.currentPage=1}),t.bBar=Ext.widget("toolbar",{dock:"top",border:"1 0 0 0",cls:"ub-grid-info-panel",style:"border-top-width: 1px !important;",hidden:!0,items:[t.filterBar=Ext.create("Ext.toolbar.Toolbar",{cls:"ub-grid-info-panel",border:0,margin:0,padding:0,flex:1})]}),t.store.on({load:function e(){t.updateVisibleBBar()}}),t.details&&t.store.on("load",function(){t.details.forEach(function(e){e&&e.autoShow&&t.doShowDetail(e)})},t,{single:!0}),t.on("close",t.onPanelClose,t),t.dockedItems.push(t.bBar),t.callParent(arguments),r.isFunction(this.afterInit)&&this.afterInit()},initPagingToolbar:function e(){var t=this,n=t.getEl(),i=n.getSize();t.floatToolbarEl=Ext.DomHelper.append(n,{tag:"div",cls:"ub-float-toolbar",style:"top: "+(i.height-30-20)+"px; left: "+(i.width-300-20)+"px; "},!0),t.hidePagingBar||(t.pagingBar=Ext.create("UB.view.PagingToolbar",{renderTo:t.floatToolbarEl,isPagingBar:!0,cls:"ub-grid-info-panel-tb",padding:"0 0 0 5",autoCalcTotal:t.autoCalcTotal,store:t.store}),t.on("activate",function(){t.on("afterlayout",function(){!t.isDestroyed&&t.pagingBar&&(t.pagingBar.updateTotal(),t.realignFloatPanel())},t,{single:!0})}),t.store.on("refresh",function(){1===t.store.currentPage&&t.store.getCount()<t.minRowsPagingBarVisibled?t.floatToolbarEl.hide():t.floatToolbarEl.isVisible()||t.floatToolbarEl.show()}),t.pagingBar.on("totalChanged",function(){t.realignFloatPanel()}),t.realignFloatPanel())},getFormWin:function e(){return this.formWin||(this.formWin=this.up("window")),this.formWin},onPanelClose:function e(){var t=this;t.onClose&&"function"==typeof t.onClose&&(t.isDeleted?t.onClose(null,t.store):t.onClose(t.isNewInstance?null:t.instanceID,t.store)),t.fireEvent("beforeClose",t)},realignFloatPanel:function e(){if(this.floatToolbarEl){var t=this.floatToolbarEl.getSize(),n=this.down(this.viewType),i=n.getXY(),r=this.getXY();this.floatToolbarEl.dom.style.left=n.el.dom.clientWidth+(i[0]-r[0])-t.width+"px",this.floatToolbarEl.dom.style.top=n.el.dom.clientHeight+(i[1]-r[1])-t.height+"px"}},updateVisibleBBar:function e(){var t=this.bBar.isVisible(),n=0===this.filterBar.items.length||!this.filterBar.items.getAt(0).mustBeVisibled;n&&t?this.bBar.setVisible(!1):t||n||this.bBar.setVisible(!0)},onViewRefreshed:function e(t){var n=this.getStore();if((null===this.focusOnUpdate||void 0===this.focusOnUpdate||this.focusOnUpdate)&&n.getCount()>0&&!this.disableAutoSelectRow&&t.focusRow(n.getAt(0)),this.mainEntityGridPanel){var i=this.mainEntityGridPanel.getView();i&&i.focus()}},clearBBar:function e(){for(var t=this.bBar.items.getCount()-1;t>=0;t--){var n=this.bBar.items.getAt(t);this.bBar.remove(n,!n.isPagingBar)}},getVisibleColumns:function e(){var t=this;return this.extendedFieldList.filter(function(e){return e.name!==t.detailAttribute&&!1!==e.visibility})},initState:function e(){var t=this.stateful&&this.getStateId(),n=void 0;t&&(n=Ext.state.Manager.get(t))&&(delete n.sort,delete n.storeState,Ext.state.Manager.set(t,n)),this.callParent(arguments)},createComboBoxAttributesStore:function e(){for(var t=UB.view.EntityGridPanel.comboBoxAttributesStoreField,n=t.idProperty,i=t.header,r=t.dataIndex,o=[],a=0,s=this.columns.length;a<s;++a){var l=this.columns[a],u={};u[n]=l[r],u[i]=l[i],o.push(u)}this.comboBoxAttributesStore=Ext.create("Ext.data.Store",{fields:[n,i],data:o})},addBaseActions:function e(){var t=this,n=UB.view.EntityGridPanel.actionId,i=UB.view.EntityGridPanel.eventId,r=UB.view.EntityGridPanel.hotKeys,o=UB.core.UBCommand.methodName;t.actions[n.addNew]=new Ext.Action({actionId:n.addNew,scale:"medium",glyph:UB.core.UBUtil.glyphs.faPlusCircle,cls:"add-new-action",text:UB.i18n("dobavit")+r[n.addNew].text,eventId:i.addnew,handler:t.onAction,disabled:!t.entity.haveAccessToMethods([o.ADDNEW,o.INSERT]),scope:t}),t.actions[n.addNewByCurrent]=new Ext.Action({actionId:n.addNewByCurrent,scale:"medium",glyph:UB.core.UBUtil.glyphs.faPlusCircle,cls:"add-currect-action",text:UB.i18n("dobavitKak"),eventId:i.addnewbycurrent,handler:t.onAction,disabled:!t.entity.haveAccessToMethod(o.ADDNEW),scope:t}),t.rowEditing||(t.actions[n.edit]=new Ext.Action({actionId:n.edit,scale:"medium",glyph:UB.core.UBUtil.glyphs.faEdit,cls:"edit-action",text:UB.i18n("redaktirovat")+r[n.edit].text,eventId:i.edit,handler:t.onAction,disabled:!t.entity.haveAccessToMethod(o.UPDATE),scope:t})),t.actions[n.del]=new Ext.Action({actionId:n.del,scale:"medium",glyph:UB.core.UBUtil.glyphs.faTrashO,cls:"delete-action",text:UB.i18n("Delete")+r[n.del].text,eventId:i.del,handler:t.onAction,disabled:!t.entity.haveAccessToMethod(o.DELETE),scope:t}),t.actions[n.showPreview]=new Ext.Action({actionId:n.showPreview,scale:"medium",glyph:UB.core.UBUtil.glyphs.faEye,text:UB.i18n("pokazatPrevu"),eventId:i.showPreview,handler:t.onAction,disabled:!1,scope:t}),t.hasDataHistoryMixin&&(t.actions[n.newVersion]=new Ext.Action({actionId:n.newVersion,iconCls:"iconNewVersion",text:UB.i18n("novajaVersija"),eventId:i.newversion,handler:t.onAction,disabled:!t.entity.haveAccessToMethod(o.NEWVERSION),scope:t}),t.actions[n.history]=new Ext.Action({actionId:n.history,iconCls:"iconHistory",text:UB.i18n("istorijaIzmenenij"),eventId:i.history,handler:t.onAction,scope:t})),t.hasAuditMixin&&(t.actions[n.audit]=new Ext.Action({actionId:n.audit,text:UB.i18n("showAudit"),eventId:i.audit,handler:t.onAction,disabled:!$App.domainInfo.isEntityMethodsAccessible("uba_auditTrail","select"),scope:t})),t.hasHardSecurityMixin&&(t.actions[n.accessRight]=new Ext.Action({actionId:n.accessRight,text:UB.i18n("accessRight"),eventId:i.accessRight,handler:t.onAction,disabled:!t.entity.haveAccessToMethod("select"),scope:t})),t.actions[n.refresh]=new Ext.Action({actionId:n.refresh,scale:"medium",glyph:UB.core.UBUtil.glyphs.faRefresh,cls:"refresh-action",text:UB.i18n("obnovit")+r[n.refresh].text,eventId:i.refresh,handler:t.onAction,scope:t}),t.isModal&&(t.actions[n.itemSelect]=new Ext.Action({actionId:n.itemSelect,scale:"medium",glyph:UB.core.UBUtil.glyphs.faCheck,text:UB.i18n("vybrat"),eventId:i.itemselect,handler:t.onAction,scope:t})),t.autoFilter&&(t.actions[n.prefilter]=new Ext.Action({actionId:n.prefilter,scale:"medium",glyph:UB.core.UBUtil.glyphs.faFilter,text:UB.i18n("showPreFilter")+r[n.prefilter].text,eventId:i.prefilter,handler:t.onAction,scope:t})),t.actions[n.lock]=new Ext.Action({actionId:n.lock,scale:"medium",glyph:UB.core.UBUtil.glyphs.faLock,text:UB.i18n("lockBtn"),eventId:i.lock,handler:t.onAction,scope:t}),t.actions[n.unLock]=new Ext.Action({actionId:n.unLock,scale:"medium",glyph:UB.core.UBUtil.glyphs.faUnLock,text:UB.i18n("unLockBtn"),eventId:i.unLock,handler:t.onAction,scope:t}),t.actions[n.exportXls]=new Ext.Action({actionId:n.exportXls,glyph:UB.core.UBUtil.glyphs.faFileExcelO,text:UB.i18n("exportXls"),eventId:i.exportXls,handler:t.onAction,scope:t}),t.actions[n.exportCsv]=new Ext.Action({actionId:n.exportCsv,text:UB.i18n("exportCsv"),eventId:i.exportCsv,handler:t.onAction,scope:t}),t.actions[n.exportHtml]=new Ext.Action({actionId:n.exportHtml,glyph:UB.core.UBUtil.glyphs.faTable,text:UB.i18n("exportHtml"),eventId:i.exportHtml,handler:t.onAction,scope:t}),t.actions[n.itemLink]=new Ext.Action({actionId:n.itemLink,text:UB.i18n("gridItemLink"),eventId:i.itemLink,handler:t.onAction,scope:t}),t.actions[n.optimizeWidth]=new Ext.Action({actionId:n.optimizeWidth,text:UB.i18n("gridPptimizeWidth"),eventId:i.optimizeWidth,handler:t.onAction,scope:t})},addBaseDockedItems:function e(){var t=this,n=UB.view.EntityGridPanel.actionId,i=Ext.isArray(t.customActions)&&t.customActions.length,o=Ext.isArray(t.toolbarActionList)&&0===t.toolbarActionList.length&&!i,a=t.hideMenuAllActions,s=t.menuAllActionsActionList||[n.itemSelect,n.refresh,n.edit,n.addNew,n.addNewByCurrent,n.del,n.showPreview,n.prefilter,"-",t.createMenuItemLink()],l=[];if(Ext.Array.each(s,function(e){var n=t.actions[e];n&&l.push(n)}),l.push("-"),l.push(t.createMenuItemLink()),l.push(t.actions[n.itemLink]),this.hasDataHistoryMixin&&!this.isHistory&&(l.push("-"),l.push(t.actions[n.newVersion]),l.push(t.actions[n.history])),t.hasAuditMixin&&(l.push("-"),l.push(t.actions[n.audit])),t.hasHardSecurityMixin&&(l.push("-"),l.push(t.actions[n.accessRight])),t.isEntityLockable&&(l.push("-"),l.push(t.actions[n.lock]),l.push(t.actions[n.unLock])),l.push(t.actions[n.optimizeWidth]),i){l.push("-");for(var u=t.customActions,c=0,d=u.length;c<d;++c)l.push(new Ext.Action(u[c]))}t.hideActions&&r.includes(t.hideActions,n.exportXls)&&r.includes(t.hideActions,n.exportCsv)&&r.includes(t.hideActions,n.exportCsv)||(l.push("-"),l.push(t.createMenuExport())),t.entityDetails.length&&!t.disableMenuItemDetails&&(l.push("-"),t.menuItemDetails=t.createMenuItemDetails(),l.push(t.menuItemDetails));var f=t.toolbarActionList||[n.refresh,n.addNew],h=[];Ext.Array.each(f,function(e){h.push(t.createButtonWOText(t.actions[e]))}),Ext.Array.each(t.customActions,function(e){h.push(t.createButtonWOText(new Ext.Action(e)))}),t.isModal&&h.push(t.createButtonWOText(t.actions[n.itemSelect])),h.push("->",{menuId:"AllActions",scale:"medium",glyph:UB.core.UBUtil.glyphs.faCog,arrowCls:"",tooltip:UB.i18n("vseDeystviya"),menu:l,hidden:a}),t.dockedItems||(t.dockedItems=[]),t.dockedItems.unshift({xtype:"toolbar",dock:"top",items:h,hidden:o||t.hideActionToolbar}),t.menuAllActions=l},createMenuExport:function e(){var t=[],n=UB.view.EntityGridPanel.actionId;return t.push(this.actions[n.exportXls]),t.push(this.actions[n.exportCsv]),t.push(this.actions[n.exportHtml]),Ext.create("Ext.menu.Item",{text:UB.i18n("export"),hideOnClick:!1,glyph:UB.core.UBUtil.glyphs.faShareSquare,menu:{items:t}})},addBaseListeners:function e(){var t=this,n=UB.view.EntityGridPanel.eventId;t.on(n.exportXls,t.onExportXls,t),t.on(n.exportCsv,t.onExportCsv,t),t.on(n.exportHtml,t.onExportHtml,t),t.rowEditing||t.on("itemdblclick",t.onItemDblClick,t),t.on(n.addnew,t.onAddNew,t),t.on(n.addnewbycurrent,t.onAddNewByCurrent,t),t.on(n.edit,t.onEdit,t),t.on(n.del,t.onDel,t),t.on(n.showPreview,t.onShowPreview,t),t.on(n.filtered,t.onFiltered,t),t.on(n.lock,t.onLock,t),t.on(n.unLock,t.onUnLock,t),t.on(n.itemLink,t.onItemLink,t),t.on(n.optimizeWidth,t.onOptimizeWidth,t),t.autoFilter&&t.on(n.prefilter,t.onPrefilter,t),t.hasDataHistoryMixin&&(t.on(n.newversion,t.onNewVersionDataRequest,t),t.on(n.history,t.onHistory,t)),t.hasAuditMixin&&t.on(n.audit,t.onAudit,t),t.hasHardSecurityMixin&&t.on(n.accessRight,t.onAccessRight,t),t.isModal&&t.on(n.itemselect,t.onItemSelect,t),t.on(n.refresh,t.onRefresh,t),t.entityDetails.length&&t.on(UB.core.UBPanelMixin.eventId.showdetail,t.onShowDetail,t)},hideAction:function e(t,n){var i=this.actions[t];i&&(i.blocked=!0,i.disable(),i.hide(),i.forceHidden=i.forceHidden||!!n),this.actionsKeyMap&&(i=this.actionsKeyMap[t])&&i.disable()},showAction:function e(t,n){var i=this.actions[t];if(i){if(i.forceHidden&&!n)return;i.blocked=!1,i.setDisabled(!1),i.show(),i.forceHidden=!1}this.actionsKeyMap&&(i=this.actionsKeyMap[t])&&i.setDisabled(!1)},disableAction:function e(t){var n=this.actions[t];if(n){if(n.forceHidden)return;n.disable()}this.actionsKeyMap&&(n=this.actionsKeyMap[t])&&n.disable()},enableAction:function e(t){var n=this,i=n.actions[t];if(i){if(i.forceHidden)return;i.setDisabled(!1),i.forceHidden=!1}n.actionsKeyMap&&(i=n.actionsKeyMap[t])&&i.setDisabled(!1)},setReadOnly:function e(t){this.readOnly=t,this.rendered&&this.setReadOnlyInner(t)},setReadOnlyInner:function e(t){t?(this.hideAction("addNew"),this.hideAction("addNewByCurrent"),this.hideAction("del"),this.hideAction("edit"),this.hideAction("newVersion")):(this.showAction("addNew"),this.showAction("addNewByCurrent"),this.showAction("del"),this.showAction("edit"),this.showAction("newVersion"))},afterRender:function e(){this.callParent(),this.bindHotkeys(),this.readOnly&&this.setReadOnlyInner(!0)},openForm:function e(t){var n=this,i=void 0,r=n.up("basepanel");if(r){if(!(i=r.saveForm()))return}else i=Promise.resolve(0);i.done(function(e){if(-1!==e){var i=n.parentContext?Ext.clone(n.parentContext):{};n.detailAttribute&&n.parentID&&(i[n.detailAttribute]=n.parentID);var o=n.getStore(),a=n.up("window"),s=!!a&&a.modal,l=n.getFormParam(),u={cmdType:"showForm",formCode:l?l.formCode:l,description:l?l.description:l,entity:l&&l.entityName?l.entityName:n.entityName,instanceID:l&&l.instanceID?l.instanceID:t&&t.instanceID,isModal:!(!r&&!n.isModal),store:o,isModalDialog:s,addByCurrent:t&&t.addByCurrent,__mip_ondate:t&&t.__mip_ondate,parentContext:i,detailAttribute:n.detailAttribute,parentID:n.parentID,sender:n.getView()||n};u.isModal||s||(u.target=$App.viewport.centralPanel,u.tabId=((l?l.entityName:null)||n.entityName)+(u.instanceID||"ext"+Ext.id(null,"addNew"))),l&&l.cmpInitConfig&&(u.cmpInitConfig=l.cmpInitConfig),$App.doCommand(u)}})},onItemDblClick:function e(t,n,i,r,o,a){this.isModal?this.onItemSelect():this.doOnEdit(a)},insertRecord:function e(t){var n=this,i=[];t.grid.columns.forEach(function(e){e.field&&e.field.storeAttributeValueField&&t.record.set(e.field.storeAttributeValueField,e.field.getValue()&&e.field.lastSelection?e.field.lastSelection[0].get("ID"):null),e.field&&r.includes(["textareafield","ubtextfield","ubtextareafield"],e.field.xtype)&&void 0!==t.record.modified[e.dataIndex]&&""===t.record.get(e.dataIndex)&&t.record.set(e.dataIndex,null)});var o=t.record.getData();Object.keys(o).forEach(function(e){e.indexOf(".")+1||r.includes(["ID","mi_modifyDate"],e)?delete o[e]:i.push(e)}),t.grid.detailFields&&t.grid.detailFields.length&&t.grid.detailFields.forEach(function(e){i.push(e),o[e]=t.grid.parentContext[e]}),n.notWriteChanges?(!r.includes(n.hideActions,"del")&&n.entity.haveAccessToMethod(UB.core.UBCommand.methodName.DELETE)&&n.enableAction("del"),n.GridSummary&&n.GridSummary.dataBind(),n.fireEvent("changeData",n,"insert")):$App.connection.run({entity:this.entityName,method:"insert",fieldList:i,execParams:o}).then(function(e){t.record.set("ID",e.execParams.ID),e.execParams.mi_modifyDate&&t.record.set("mi_modifyDate",new Date(e.execParams.mi_modifyDate)),t.record.commit(),n.GridSummary&&n.GridSummary.dataBind(),n.fireEvent("changeData",n,"insert")})},updateRecord:function e(t){var n=this,i=[];t.grid.columns.forEach(function(e){e.field&&e.field.storeAttributeValueField&&(!e.field.getValue()||r.get(e.field,"lastSelection[0]"))&&t.record.set(e.field.storeAttributeValueField,e.field.getValue()&&e.field.lastSelection?e.field.lastSelection[0].get("ID"):null),e.field&&r.includes(["textareafield","ubtextfield","ubtextareafield"],e.field.xtype)&&void 0!==t.record.modified[e.dataIndex]&&""===t.record.get(e.dataIndex)&&t.record.set(e.dataIndex,null)});var o=t.record.getData();Object.keys(o).forEach(function(e){(e.indexOf(".")+1||void 0===t.record.modified[e])&&!r.includes(["ID","mi_modifyDate"],e)?delete o[e]:i.push(e)}),n.notWriteChanges?(n.GridSummary&&n.GridSummary.dataBind(),n.fireEvent("changeData",n,"update")):$App.connection.run({entity:n.entityName,method:"update",fieldList:i,execParams:o}).then(function(e){e.execParams.mi_modifyDate&&t.record.set("mi_modifyDate",new Date(e.execParams.mi_modifyDate)),t.record.commit(),n.GridSummary&&n.GridSummary.dataBind(),n.fireEvent("changeData",n,"update")})},addNewRecord:function e(t,n){var i={},r=this.store.data.length;if(this.store.ubRequest.fieldList.forEach(function(e){i[e]=null}),this.store.insert(r,i),t){delete t.ID,delete t.mi_modifyDate,this.lineNumberColumn&&n&&delete t[this.lineNumberColumn];var o=this.store.getAt(r);Object.keys(t).forEach(function(e){o.set(e,t[e])})}if(n)this.editingPlugin.startEdit(r,0);else{this.store.getAt(r).dirtySave=null,this.enableAction("del")}},getFormParam:function e(){var t=this;if(r.isFunction(t.onDeterminateForm))return t.formParam=t.onDeterminateForm(t),t.formParam;if(t.formParam)return t.formParam;if(Ext.isDefined(t.commandData)&&(t.formParam=t.getFormParamFromCommandData(t.commandData),Ext.isDefined(t.formParam)))return t.formParam;var n=UB.core.UBFormLoader.getFormByEntity(t.entityName);return n?(t.formParam={formCode:n.get("code"),description:UB.i18n(n.get("description"))},t.formParam):void 0},getFormParamFromCommandData:function e(t){var n=void 0;return Ext.isObject(t)&&(Ext.isDefined(t.formCode)&&(n={formCode:t.formCode}),Ext.isDefined(t.formTitle)&&(Ext.isObject(n)||(n={}),n.description=t.formTitle)),n},onAddNew:function e(){var t=this;if(t.rowEditing)if(t.editingPlugin.editing)$App.dialogInfo("rowEditing");else{var n=t.up("basepanel");n&&(n.isDirty()||n.isNewInstance)&&!t.notWriteChanges?n.saveForm().then(function(e){-1!==e&&t.addNewRecord(null,!0)}):t.addNewRecord(null,!0)}else this.isHistory?Ext.create("UB.view.InputDateWindow",{callback:function e(n){t.openForm({__mip_ondate:n,instanceID:t.miDataID})},scope:t}):t.openForm()},onAddNewByCurrent:function e(){var t=this,n=t.getSelectionModel().getSelection();if(n.length<1)return void $App.dialogInfo("selectRowFirst");if(t.rowEditing)if(t.editingPlugin.editing)$App.dialogInfo("rowEditing");else{var i=t.up("basepanel");i&&(i.isDirty()||i.isNewInstance)&&!t.notWriteChanges?i.saveForm().then(function(e){-1!==e&&t.addNewRecord(n[0].getData(),!0)}):t.addNewRecord(n[0].getData(),!0)}else{var r={addByCurrent:!0,instanceID:n[0].get("ID")};t.openForm(r)}},onEdit:function e(t,n){this.rowEditing?n.record.get("ID")?this.updateRecord(n):this.insertRecord(n):this.doOnEdit()},doOnEdit:function e(t){var n=this.getSelectionModel().getSelection();n.length<1||(t=t||{},t.instanceID=n[0].get("ID"),this.openForm(t))},getFormTitle:function e(){var t=this.placeholder;return this.title||(t?t.title:null)||((t=this.up(""))?t.title:null)||this.entity.caption},onDel:function e(){var t=this.getSelectionModel().getSelection();if(!(t.length<1)){var n=this,i="";if(n.rowEditing&&n.editingPlugin.editing)return void $App.dialogInfo("rowEditing");if(1===t.length&&n.entity.descriptionAttribute){try{i=t[0].get(n.entity.descriptionAttribute)}catch(e){}i=i?"["+i+"]":""}$App.dialogYesNo("deletionDialogConfirmCaption",UB.format(UB.i18n("deleteConfirmationWithCaption"),n.getFormTitle(),i)).then(function(e){if(e){var i=[],o=t.length&&t[0].get("mi_unityEntity"),a=void 0;if(n.notWriteChanges){for(var s=n.store,l=null,u=0,c=t.length;u<c;++u)l=s.indexOf(t[u]),s.remove(t[u]);null!==l&&n.getView().on("itemremove",function(){n.GridSummary&&n.GridSummary.dataBind(),n.fireEvent("afterdel"),n.fireEvent("changeData",n,"delete"),n.pagingBar&&n.pagingBar.decreaseTotal(),s.getCount()<=l&&(l=s.getCount()-1),n.getSelectionModel().select(s.getAt(l))},n,{single:!0})}else{for(var d=0,f=t.length;d<f;++d)a=o?t[d].get("mi_unityEntity"):n.entityName,i.push({entity:a,method:"delete",execParams:{ID:t[d].get("ID")}});$App.connection.runTrans(i).then(function(e){var t=[];return r.forEach(e,function(e){t.push($App.connection.invalidateCache(e))}),Q.all(t).then(function(){return e})}).done(function(e){var t=n.store,o=null;r.forEach(e,function(e){var n=t.getById(e.ID);if(o=t.indexOf(n),t.remove(n),UB.core.UBAppConfig.systemEntities.hasOwnProperty(a)){var i=UB.core.UBStoreManager.getSystemEntityStore(UB.core.UBAppConfig.systemEntities[a].name);i.remove(i.getById(e.ID))}}),n.store&&n.store.fireModifyEvent&&n.store.fireModifyEvent(i,e),null!==o&&n.getView().on("itemremove",function(){t.getCount()<=o&&(o=t.getCount()-1),n.getSelectionModel().select(t.getAt(o))},n,{single:!0}),n.GridSummary&&n.GridSummary.dataBind(),n.fireEvent("afterdel"),n.fireEvent("changeData",n,"delete"),n.pagingBar&&n.pagingBar.decreaseTotal()})}}})}},onPrefilter:function e(){var t=this;t.autoFilter&&UB.ux.UBPreFilter.makeFilters({options:t.autoFilter,entityCode:t.entityName,store:t.getStore(),onFilterReady:function e(){t.filtersDescription&&t.filtersDescription()}})},showFilter:function e(t){var n=this;UB.ux.UBPreFilter.makeFilters({options:n.autoFilter||t||{},entityCode:n.entityName,store:n.getStore(),onFilterReady:function e(){n.filtersDescription&&n.filtersDescription()}})},onItemContextMenu:function e(t,n,i,r,o){if(o.stopEvent(),t&&n){var a=t.getSelectionModel();a&&(this.rowEditing&&this.editingPlugin.editing||(this.forbidSelectOnContextMenu||a.select(n),this.menu.showAt(o.xy)))}},onNewVersionDataRequest:function e(){var t=this,n=t.getSelectionModel().getSelection();n.length<1||Ext.create("UB.view.InputDateWindow",{callback:function e(i){t.onItemDblClick(t,n[0],null,null,null,{__mip_ondate:i})},scope:this})},onToolsClick:function e(){$App.dialogError("Not Implemented")},onRefresh:function e(){var t=this,n=t.actions[UB.view.EntityGridPanel.actionId.refresh],i=t.store,r=[];n.disable(),Ext.iterate(t.stores,function(e,t){t!==i&&t.ubRequest&&r.push(t.reload())}),Q.all(r).then(function(){return i.reload()}).fin(function(){n.enable(),t.down(t.viewType).focus()})},onHistory:function e(){function t(e){r.findIndex(o,{name:e})<0&&(i=[e].concat(i),o=[{name:e,visibility:!0,description:UB.i18n(e)}].concat(o))}var n=this,i=n.entityConfig.fieldList.concat(),o=n.extendedFieldList.concat();t("mi_dateTo"),t("mi_dateFrom");var a=this.getSelectionModel().getSelection();!n.isInHistory&&a.length<1||$App.connection.select({entity:n.entityName,fieldList:["ID","mi_data_id"],ID:n.isInHistory?n.miDataID:a[0].get("ID")}).done(function(e){var t=UB.core.UBCommand.resultDataRow2Object(e);$App.doCommand({cmdType:"showList",cmdData:{params:[{entity:n.entityName,method:UB.core.UBCommand.methodName.SELECT,fieldList:i}]},cmpInitConfig:{extendedFieldList:o},isModalDialog:!0,instanceID:t.mi_data_id,__mip_recordhistory:!0})})},onAccessRight:function e(){var t=this.getSelectionModel().getSelection();if(!(t.length<1)){var n=this,i=n.entityName+"_acl",o=n.entity;if(o&&o.mixins&&o.mixins.aclRls){o.mixins.aclRls.useUnityName&&(i=o.mixins.unity.entity+"_acl");var a=[];r.forEach(o.mixins.aclRls.onEntities,function(e){var t=$App.domainInfo.get(e);a.push(t.sqlAlias+"ID"+(t.descriptionAttribute?"."+t.descriptionAttribute:""))}),$App.doCommand({cmdType:"showList",cmdData:{params:[{entity:i,method:"select",fieldList:a,whereList:{parentExpr:{expression:"[instanceID]",condition:"equal",values:{instanceID:t[0].get("ID")}}}}]},isModalDialog:!0,parentContext:{instanceID:t[0].get("ID")},hideActions:["addNewByCurrent"]})}}},onAudit:function e(){var t=this,n=this.getSelectionModel().getSelection(),i=["actionTime","actionType","actionUser","remoteIP"];if(!(n.length<1)){var o={entityExpr:{expression:"[entity]",condition:"equal",values:{entity:t.entityName}},parentExpr:{expression:"[entityinfo_id]",condition:"equal",values:{entityinfo_id:n[0].get("ID")}}};$App.doCommand({cmdType:"showList",isModalDialog:!0,hideActions:["addNew","addNewByCurrent","edit","del","newVersion"],cmdData:{params:[{entity:"uba_auditTrail",method:UB.core.UBCommand.methodName.SELECT,fieldList:i,whereList:o}]},cmpInitConfig:{onItemDblClick:function e(t,n,i,r,o,a){this.doOnEdit(a)},afterInit:function e(){var t=this,n=void 0;t.store.sort("actionTime","DESC"),t.store.oldGroup=t.store.group,t.store.group=function(e,t,i){var o=this;o.groupOptions||o.oldGroup(e,t,i);var a;Ext.isArray(e)?a=e:Ext.isObject(e)?a=[e]:Ext.isString(e)&&(n=o.groupers.get(e),n?void 0===t?n.toggle():n.setDirection(t):(n={property:e,direction:t||"ASC"},a=[n])),r.forEeach(a,function(e){var t=o.groupOptions[e.property];t&&(e.getGroupString=t.getGroupString)}),o.oldGroup(a,t,i)},function e(t,n,i,o){t&&t.columns&&n&&i&&r.forEach(t.columns,function(e){if(e.dataIndex===n){e.format=i,e.renderer=Ext.util.Format.dateRenderer(i);var r=t.store;r.groupOptions||(r.groupOptions={}),r.groupOptions[n]||(r.groupOptions[n]={});r.groupOptions[n].getGroupString=function(e){return Ext.Date.format(e.get(n),o)}}})}(t,"actionTime","d.m.Y H:i:s","d.m.Y")}}})}},getPreviewForm:function e(){var t=this,n=null,i=UB.core.UBFormLoader.getFormByEntity(t.entityName,!0);return r.forEach(i,function(e){if(-1!==e.get("code").toLowerCase().indexOf("preview"))return n=e,!1}),n||i[0]},onShowPreview:function e(t){var n=this.getPreviewForm();if(!n)return void UB.logError("No preview form");var i=this.getSelectionModel().getSelection();if(i.length<1)return void $App.dialogInfo("selectRowFirst");var r={instanceID:i[0].get("ID")},o={formCode:n.get("code"),description:UB.i18n(n.get(UB.core.UBAppConfig.systemEntities.form.fields.description))},a=RegExp("(.*?)(_grid_UI)"),s=this.stateId?this.stateId.replace(a,UB.format("$1_{0}_{0}$2",this.entityName)):void 0;this.setMainPanel(s);var l={cmdType:"showForm",formCode:o?o.formCode:o,description:o?o.description:o,entity:this.entityName,instanceID:r&&r.instanceID,store:this.getStore(),addByCurrent:!1,__mip_ondate:!1,detailAttribute:this.detailAttribute,parentID:this.parentID,sender:this.getView()||this,target:this.detailTabPanel,tabId:Ext.id(),isDetail:!0};UB.core.UBApp.doCommand(l),t.disable()},getMainContainer:function e(){return this.mainPanel||this},activateByCommand:function e(t){this.autoFilter&&!this.autoFilter.notShowBefore&&this.onPrefilter()},setMainPanel:function e(t){var n=this;if(!n.mainPanel){var i=Ext.create("Ext.resizer.Splitter"),r=Ext.create("Ext.tab.Panel",{stateful:!0,border:!1,layout:"fit",stateId:t}),o=n.ownerCt,a=!!n.closable;o.remove(n,!1),n.mainPanel=Ext.create("Ext.panel.Panel",{xtype:"panel",flex:1,border:!1,layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",layout:"fit",border:!1,flex:1,items:n},i,r]}),n.mainPanel.closable=a,o.add(n.mainPanel),o.setActiveTab&&o.setActiveTab(n.mainPanel),n.mainPanel.mainEntityGridPanel=n,r.mainPanel=n.mainPanel,r.relatedSplitter=i,n.detailTabPanel=r,n.up("window")||n.mainPanel.setTitle(n.title)}n.detailTabPanel.relatedSplitter.show(),n.detailTabPanel.show(),n.mainPanel.show(),n.show(),n.ownerCt&&n.ownerCt.doLayout()},onShowDetail:function e(t){var n=UB.core.UBCommand.commandType.showList,i=UB.core.UBCommand.getCommandByEntityAndType(t.entityName,n,!0);if(this.getSelectionModel().getSelection().length<1)return void $App.dialogInfo("selectRowFirst");if(!i)throw Error(UB.format('Can\'t get command with type "{0}" for entity "{1}"',n,t.entityName));this.doShowDetail(t),t.disable()},doShowDetail:function e(t){var n=this,i=n.up("window"),o=UB.core.UBCommand.commandType.showList,a=UB.core.UBCommand.getCommandByEntityAndType(t.entityName,o,!0),s=RegExp("(.*?)(_grid_UI)"),l=n.stateId.replace(s,UB.format("$1_{0}_{1}$2",t.entityName,t.attribute));n.setMainPanel(l);var u=this.getSelectionModel().getSelection(),c=u.length>0?u[0].get("ID"):null,d=new Ext.util.MixedCollection;d.add(UB.core.UBCommand.whereListParentID,new Ext.util.Filter({id:UB.core.UBCommand.whereListParentID,property:t.attribute,exactMatch:!0,root:"data",value:c})),UB.core.UBApp.doCommand(r.assign({cmdType:UB.core.UBCommand.commandType.showList,cmdData:a,entity:t.entityName,detailAttribute:t.attribute,parentID:c,target:n.detailTabPanel,isDetail:!0,filters:d,tabId:Ext.id(),title:(i||n).title+"->"+$App.domainInfo.get(t.entityName).caption},t.command||{})),i&&i.doLayout()},onSelectionChange:function e(t,n,i){var r=this,o;0!==n.length&&(o=n[0].get("ID"),r.selectedRecordID!==o&&(r.selectedRecordID=o,this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=null),this.timeoutID=setTimeout(function(){r.fireEvent("parentchange",o)},UB.appConfig.gridParentChangeEventTimeout)))},onParentChange:function e(t){this.parentID=t,this.store.filters.removeAtKey(UB.core.UBCommand.whereListParentID),this.store.filter(new Ext.util.Filter({id:UB.core.UBCommand.whereListParentID,root:"data",property:this.detailAttribute,exactMatch:!0,value:t}))},onViewReady:function e(){var t=this.getView(),n=t?t.getStore():null;n&&t&&t.storeListeners&&t.storeListeners.update&&n.on("update",t.storeListeners.update,t)},setupActions:function e(){var t=this,n=t.up("form");(r.isFunction(t.isEditable)?!t.isEditable():!(!n||!r.isFunction(n.isEditable))&&!n.isEditable())&&(t.actions[UB.view.EntityGridPanel.actionId.addNew].setDisabled(!0),t.actions[UB.view.EntityGridPanel.actionId.addNewByCurrent].setDisabled(!0),t.actions[UB.view.EntityGridPanel.actionId.del].setDisabled(!0)),t.hideActions&&t.hideActions.length&&r.forEach(t.hideActions,function(e){t.hideAction(e,!0),"showDetail"===e&&(t.disableMenuItemDetails=!0,t.menuItemDetails&&(t.menuItemDetails.disable(),t.menuItemDetails.hide()))}),t.readOnly&&t.setReadOnly(t.readOnly)},bindHotkeys:function e(){var t=this,n=UB.view.EntityGridPanel.actionId,i=UB.view.EntityGridPanel.hotKeys;t.actionsKeyMap={},t.actionsKeyMap[n.edit]=new Ext.util.KeyMap({target:t.getEl(),binding:[{key:i[n.edit].key,ctrl:i[n.edit].ctrl,shift:i[n.edit].shift,fn:function e(n,i){i.stopEvent(),t.onEdit()}}]}),t.actionsKeyMap[n.del]=new Ext.util.KeyMap({target:t.getEl(),binding:[{key:i[n.del].key,ctrl:i[n.del].ctrl,shift:i[n.del].shift,fn:function e(n,i){i.stopEvent(),t.onDel()}}]}),t.actionsKeyMap[n.addNew]=new Ext.util.KeyMap({target:t.getEl(),binding:[{key:i[n.addNew].key,ctrl:i[n.addNew].ctrl,shift:i[n.addNew].shift,fn:function e(n,i){i.stopEvent(),t.onAddNew()}}]}),t.actionsKeyMap[n.refresh]=new Ext.util.KeyMap({target:t.getEl(),binding:[{key:i[n.refresh].key,ctrl:i[n.refresh].ctrl,shift:i[n.refresh].shift,fn:function e(n,i){i.stopEvent(),t.onRefresh()}}]}),t.actionsKeyMap[n.itemSelect]=new Ext.util.KeyMap({target:t.getEl(),binding:[{key:i[n.itemSelect].key,ctrl:i[n.itemSelect].ctrl,shift:i[n.itemSelect].shift,fn:function e(n,i){i.stopEvent(),t.isModal?t.onItemSelect():t.onEdit()}}]}),t.actionsKeyMap[n.prefilter]=new Ext.util.KeyMap({target:t.getEl(),binding:[{key:i[n.prefilter].key,ctrl:i[n.prefilter].ctrl,shift:i[n.prefilter].shift,fn:function e(n,i){i.stopEvent(),t.onPrefilter()}}]}),t.actionsKeyMap["ctrl+0"]=new Ext.util.KeyMap({target:t.getEl(),binding:[{ctrl:!0,key:Ext.EventObject.Q,fn:function e(n,i){i.stopEvent();var r=t.up("tabpanel");if(i.shiftKey){if(r){var o=r.up("form");o.frameControl(o.focusFirst(o))}}else if(r){var a=r.getActiveTab(),s=r.items.indexOf(a)+1;if(s>=r.items.length&&(s=0),r.setActiveTab(s),a=r.getActiveTab()){var l=a.up("form");l.frameControl(l.focusFirst(a)||a)}}}}]})},selectDefaultRow:function e(){if(this.getStore().getCount()){var t=this,n=void 0;n=t.selectedRecordID?t.store.getById(t.selectedRecordID):t.store.getAt(0);try{var i=t.getSelectionModel(),r=t.getView();r.focus(),i.setCurrentPosition?i.setCurrentPosition({view:r,row:n.index,column:0}):i.select(n),r.focusRow(n.index)}catch(e){}}},getExportTitle:function e(t){var n=void 0,i=this.entity;if(Ext.isDefined(i)&&(n=i.description||i.caption),!Ext.isDefined(n)){var r=this.up("window");Ext.isDefined(r)&&(n=r.title)}return(n=n||this.title||t)+" "+Ext.Date.format(new Date,"Y m d  H:i:s")},onExportXls:function e(){var t=this,n=this.getExportTitle("export to excel");Ext.ux.exporter.Exporter.exportAny(this,"xlsx",{stripeRows:!0,title:n,entityName:this.entityName,metaobject:t.entity,scope:t,callback:function e(t){var i=new Blob([t],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"});saveAs(i,n+".xlsx")}})},onExportCsv:function e(){var t=this,n=this.getExportTitle("export to CSV");Ext.ux.exporter.Exporter.exportAny(this,"csv",{stripeRows:!0,title:n,entityName:this.entityName,metaobject:t.entity,scope:t,callback:function e(t){var i=new Blob([t],{type:"text/csv"});saveAs(i,n+".csv")}})},onExportHtml:function e(){var t=this,n=this.getExportTitle("export to html");Ext.ux.exporter.Exporter.exportAny(this,"html",{stripeRows:!0,title:n,entityName:this.entityName,metaobject:t.entity,scope:t,callback:function e(t){var i=new Blob([t],{type:"text/html"});saveAs(i,n+".html")}})},beforeDestroy:function e(t,n){var i=this;i.mainEntityGridPanel&&i.mainEntityGridPanel.un("parentchange",i.onParentChange,i);var r=i.getStore();r&&(r.un("load",i.onLoadStore,i),r.groupers&&r.groupers.length>0&&r.clearGrouping(),r.clearListeners()),i.callParent(arguments)},onItemSelect:function e(){var t=this.getSelectionModel().getSelection();t.length<1||(this.onItemSelected(t[0]),this.up("window").close())},onDetailClose:function e(t){function n(e){e&&e.actionId===r&&e.menu.items.each(function(e){e.actionId===r&&e.entityName===t&&e.enable()})}var i=this,r=UB.core.UBPanelMixin.actionId.showDetail;Ext.Array.each(i.popupMenuItems,n),Ext.Array.each(i.menuAllActions,n)},onLock:function e(){if(this.isEntityLockable){var t=this.getSelectionModel().getSelection(),n=void 0;if(t.length&&t[0]&&(n=t[0].get("ID")),n){var i=this.entityName;$App.connection.query({method:"isLocked",entity:i,ID:n}).then(function(e){if("Temp"===e.lockInfo.lockType)throw e.lockInfo.lockUser!==$App.connection.userLogin()?new UB.UBError("recordLockedByTempLock"):new UB.UBError("recordLockedThisUserByTempLock");if("Persist"===e.lockInfo.lockType)throw e.lockInfo.lockUser!==$App.connection.userLogin()?new UB.UBError("recordLockedOtherUser"):new UB.UBError("recordLockedThisUser");return $App.connection.query({method:"lock",lockType:"ltPersist",entity:i,ID:n})}).done(function(e){e.resultLock&&e.resultLock.success&&$App.dialogInfo("lockSuccessCreated")})}}},onItemLink:function e(){var t=this.getSelectionModel().getSelection();if(t.length<1)return void $App.dialogInfo("gridEmptySelection");var n=this,i=n.getFormParam(),o=i&&i.instanceID||t[0].get("ID"),a=["cmdType=showForm"];a.push("entity="+(i&&i.entityName?i.entityName:n.entityName));var s=i&&i.formCode?i.formCode:i;s&&a.push("formCode="+s),a.push("instanceID="+o);var l=[];r.forEach(n.parentContext,function(e,t){e&&l.push(t+"="+e)}),l.length>0&&a.push("parentContext="+window.encodeURIComponent(l.join("&"))),n.detailAttribute&&n.parentID&&(a.push("detailAttribute="+n.detailAttribute),a.push("parentID="+n.parentID));var u=a.join("&");Ext.Msg.show({prompt:!0,minWidth:400,msg:UB.i18n("gridItemLink"),buttons:Ext.Msg.OK,multiline:!1,value:window.location.origin+window.location.pathname+"#"+u}).textField.selectOnFocus=!0},onUnLock:function e(){if(this.isEntityLockable){var t=this.getSelectionModel().getSelection(),n=void 0;if(t.length&&t[0]&&(n=t[0].get("ID")),n){var i=this.entityName;$App.connection.query({method:"isLocked",entity:i,ID:n}).then(function(e){if("None"===e.lockInfo.lockType)throw new UB.UBError("recordNotLocked");if(e.lockInfo.lockUser!==$App.connection.userLogin())throw new UB.UBError("recordLockedOtherUser");if("Temp"===e.lockInfo.lockType)throw new UB.UBError("recordLockedByTempLock");return $App.connection.query({method:"unlock",lockType:"ltPersist",entity:i,ID:n})}).done(function(e){e.resultLock&&e.resultLock.success&&$App.dialogInfo("lockSuccessDeleted")})}}}})},function(e,t,n){n(23),Ext.define("UB.ux.form.field.UBBoolBox",{extend:"UB.ux.form.field.UBBaseComboBox",alias:"widget.ubboolbox",editable:!1,forceSelection:!0,queryMode:"local",addEmptyValue:!1,addnoFilterValue:!1,initComponent:function e(){var t=this,n;t.displayField="name",t.valueField="value",n=[{value:1,name:UB.i18n("da")},{value:0,name:UB.i18n("net")}],t.addEmptyValue&&n.unshift({value:"isNull",name:UB.i18n("isNull")}),t.addnoFilterValue&&n.unshift({value:"no_filter",name:UB.i18n("no_filter")}),t.store=Ext.create("Ext.data.Store",{fields:["value","name"],data:n}),t.callParent(arguments)},setValueById:null})},function(e,t,n){n(3),Ext.define("UB.core.UBPanelMixin",{statics:{orderIdAttributeName:"orderId",menuIdAttributeName:"menuId",actionIdAttributeName:"actionId",actionsArrayName:"actions",addBaseActionsMethodName:"addBaseActions",addBaseDockedItemsMethodName:"addBaseDockedItems",addBaseListenersMethodName:"addBaseListeners",actionId:{showDetail:"showDetail"},eventId:{showdetail:"showdetail"}},buildDetailList:function e(){var t=[],n=this.entityName,i=this.details||[],r=/^ID|mi_/;return i.length>0?t=i:$App.domainInfo.eachEntity(function(e,i){i!==n&&e.eachAttribute(function(e,o){e.associatedEntity!==n||r.test(o)||t.push({entityName:i,attribute:o})})}),t},preprocessPanel:function e(){var t=this,n=UB.core.UBPanelMixin;t.entityDetails=t.buildDetailList(),t.addFunctions(),Ext.isDefined(t[n.actionsArrayName])||(t[n.actionsArrayName]=[]),Ext.callback(t[n.addBaseActionsMethodName],t),Ext.callback(t[n.addBaseDockedItemsMethodName],t),t.createActions(),t.mergeDockedItems(),Ext.callback(t[n.addBaseListenersMethodName],t),t.addAdditionalListeners()},addFunctions:function e(){var t=this,n;if(t.functions){Ext.isString(t.functions)&&(t.functions=Ext.decode(t.functions)),n=t.functions;for(var i in n)t.functions.hasOwnProperty(i)&&(_.isFunction(t[i])&&(n[i].$previous=t[i]),t[i]=n[i])}},createActions:function e(){var t=this,n,i;if(t.dfm&&t.dfm.actions)for(var r=0,o=t.dfm.actions.length;r<o;++r)i=t.dfm.actions[r],n=new Ext.Action({actionId:i.actionId,eventId:i.eventId,handler:t.onAction,scope:t}),i.iconCls&&n.setIconCls(i.iconCls),i.text&&n.setText(i.text),t.actions[i.actionId]=n},getDockedItemsByFilter:function e(t){var n=[],i;if(!this.dockedItems)return n;i=Ext.isArray(this.dockedItems)?this.dockedItems:this.dockedItems.items;for(var r=0,o=i.length;r<o;++r)UB.core.UBUtil.allPropsEqual(i[r],t)&&n.push(i[r]);return n},prepareMenu:function e(t){for(var n=this,i=UB.core.UBPanelMixin,r,o,a=0,s=t.length;a<s;++a)o=t[a][i.orderIdAttributeName],r=t[a][i.actionIdAttributeName],r&&n.actions[r]&&(t[a]=n.actions[r],void 0!==o&&(t[a][i.orderIdAttributeName]=o)),t[a].menu&&n.prepareMenu(t[a].menu)},getMenu:function e(t,n,i){var r,o;t=Ext.isArray(t)?t:t.menu?Ext.isArray(t.menu)?t.menu:t.menu.items.items:t.items.items,i=i||UB.core.UBPanelMixin.menuIdAttributeName;for(var a=0,s=t.length;a<s;++a)if(o=t[a],o.menu){if(o[i]===n){r=o;break}if(r=this.getMenu(o,n,i))break}return r},mergeDockedItems:function e(){var t,n,i,r;if(this.dfm&&this.dfm.dockedItems)for(var o=0,a=this.dfm.dockedItems.length;o<a;++o){var s=this.dfm.dockedItems[o];if(i={xtype:s.xtype,dock:s.dock},s.ui&&(i.ui=s.ui),(t=this.getDockedItemsByFilter(i)).length>0)for(var l=0,u=t.length;l<u;++l)for(var c=0,d=s.items.length;c<d;++c)if((n=s.items[c]).menu)if(this.prepareMenu(n.menu),n[UB.core.UBPanelMixin.menuIdAttributeName])if(r=this.getMenu(t[l].items,n[UB.core.UBPanelMixin.menuIdAttributeName])){n.text&&(r.text=n.text);for(var f=0,h=n.menu.length;f<h;++f)r.menu.splice(n.menu[f][UB.core.UBPanelMixin.orderIdAttributeName]<r.menu.length?n.menu[f][UB.core.UBPanelMixin.orderIdAttributeName]:r.menu.length,0,n.menu[f])}else t[l].items.push(n);else t[l].items.push(n);else t[l].items.splice(n[UB.core.UBPanelMixin.orderIdAttributeName]<t[l].items.length?n[UB.core.UBPanelMixin.orderIdAttributeName]:t[l].items.length,0,n[UB.core.UBPanelMixin.actionIdAttributeName]&&this.actions[n[UB.core.UBPanelMixin.actionIdAttributeName]]?this.createButtonAction(this.actions[n[UB.core.UBPanelMixin.actionIdAttributeName]]):n)}},onAction:function e(t,n){Ext.callback(this.eventHandler,this,[this,t.eventId]),this.fireEvent(t.eventId,t)},addAdditionalListeners:function e(){var t=this;t.dfm&&t.dfm.listeners&&Ext.Object.each(t.dfm.listeners,function(e,n){"function"==typeof n&&t.addListener(e,n,t)})},createButtonsWOText:function e(t){for(var n=[],i=0,r=t.length;i<r;++i)n.push(this.createButtonWOText(t[i]));return n},createButtonAction:function e(t){return Ext.apply(Ext.create("Ext.button.Button",t),{text:t.initialConfig.actionText||"",tooltip:t.getText()})},createButtonWOText:function e(t){return Ext.apply(Ext.create("Ext.button.Button",t),{text:t.initialConfig.showText?t.initialConfig.actionText:"",tooltip:t.getText()})},createMenuItemLink:function e(){return this.actions.commandLink=new Ext.Action({actionId:"commandLink",text:UB.i18n("ssylka"),hideOnClick:!1,glyph:UB.core.UBUtil.glyphs.faShare,menu:{showSeparator:!1,items:[{xtype:"textfield",isFormField:!1,selectOnFocus:!0,readOnly:!0,minWidth:200,fieldLabel:UB.i18n("vneshnaja")}]},listeners:{activate:function e(t){t.menu.items.getAt(0).setValue(UB.format("{0}//{1}{2}#{3}",location.protocol,location.host,location.pathname,this.createCommandLink()))},scope:this}}),Ext.create("Ext.menu.Item",this.actions.commandLink)},createCommandLink:function e(){var t=this,n=[],i=t.commandConfig,r,o;return t.commandConfig&&(n.push("cmdType="+t.commandConfig.cmdType),t.commandConfig.entity&&n.push("entity="+t.commandConfig.entity),t.commandConfig.formCode&&n.push("formCode="+t.commandConfig.formCode),t.instanceID&&n.push("instanceID="+t.instanceID),i.cmdData&&i.cmdData.params&&i.cmdData.params.length>0&&(r=i.cmdData.params[0],o=_.clone(r),n.push("params="+encodeURIComponent(JSON.stringify(o))))),n.join("&")},createMenuItemDetails:function e(){for(var t=[],n=this.entityDetails,i,r,o=0,a=n.length;o<a;++o)r=n[o],i=$App.domainInfo.get(r.entityName),t.push(new Ext.Action({actionId:UB.core.UBPanelMixin.actionId.showDetail,glyph:UB.core.UBUtil.glyphs.faCaretSquareODown,text:r.caption||UB.format("{0} ({1})",i.caption,i.attr(r.attribute).caption),entityName:r.entityName,attribute:r.attribute,eventId:UB.core.UBPanelMixin.eventId.showdetail,handler:this.onAction,scope:this}));return Ext.create("Ext.menu.Item",{text:UB.i18n("detali"),hideOnClick:!1,glyph:UB.core.UBUtil.glyphs.faCaretSquareODown,actionId:UB.core.UBPanelMixin.actionId.showDetail,menu:{items:t}})}})},function(e,t,n){n(23),Ext.define("UB.ux.form.field.UBComboBox",{extend:"UB.ux.form.field.UBBaseComboBox",alias:"widget.ubcombobox",uses:["Ext.grid.plugin.BufferedRenderer"],queryCaching:!0,editable:!0,minChars:0,grow:!1,queryMode:"remote",userFilterId:"_userInput",matchFieldWidth:!0,matchCls:"combo-search-match",highlightSearch:!0,disablePaging:!1,minCharsForQuery:0,allowCustomText:!1,dataLoadDelay:!0,sendQueryAsParam:!1,queryParamName:"query",autoCompleteText:!1,initComponent:function e(){var t=this,n,i;t.addEvents("beforeQuerySend"),t.disablePaging?delete t.pageSize:t.pageSize||(t.pageSize=UB.appConfig.comboPageSize),i=t.getStore(),!i&&t.ubRequest&&(i=t.store=Ext.create("UB.ux.data.UBStore",{ubRequest:t.ubRequest,autoLoad:!1,autoDestroy:!0})),"text"===t.displayField&&(t.displayField=i.ubRequest.fieldList[1]),t.valueField||(t.valueField=i.ubRequest.fieldList[0]),i.pageSize=t.pageSize,n=function e(n){return'<span class="'+t.matchCls+'">'+n+"</span>"},t.tpl||(t.tpl=new Ext.XTemplate('<ul class="'+Ext.plainListCls+'"><tpl for=".">','<li role="option" unselectable="on" class="','boundlist-{[xindex % 2 === 0 ? "even" : "odd"]}  '+Ext.baseCSSPrefix+'boundlist-item " ',">{[values['"+this.displayField+"']]}</li>","</tpl></ul>")),t.listConfig=Ext.apply({pageSize:t.pageSize,minWidth:t.listMinWidth,listeners:{refresh:{fn:function e(i){if(t.highlightSearch&&t.searchRegExp){var r=i.getEl(),o,a;if(r&&(o=r.down(".x-list-plain")))for(a=o.down(".x-boundlist-item");a;)a.dom.innerHTML&&(a.dom.innerHTML=a.dom.innerHTML.replace(t.searchRegExp,n)),a=a.next()}}}},getInnerTpl:function e(t){return"{[values['"+t+"']]}"},createPagingToolbar:function e(){var n=Ext.create("Ext.toolbar.Toolbar",{id:this.id+"-paging-toolbar",pageSize:t.pageSize,border:!1,minHeight:0,ownerCt:this,cls:"ub_combo-bound-toolbar",ownerLayout:this.getComponentLayout(),bindStore:Ext.emptyFn,items:[{xtype:"tbspacer",flex:1},{xtype:"tbseparator"},{xtype:"button",text:UB.i18n("more"),handler:t.readMoreData,scope:t}]});return t.pagingToolbar=n,n}},t.listConfig||{}),t.editable&&t.on({beforequery:t.beforequery,scope:t}),t.on({beforedestroy:t.onBeforedestroy,scope:t}),t.callParent(arguments),t.getStore()&&t.getStore().on("load",t.onDataLoaded,t)},onBeforedestroy:function e(){var t=this;t.getStore()&&t.getStore().un("load",t.onDataLoaded,t)},onDataRefreshed:function e(){var t=this,n=this.getStore(),i=n.getCount(),r=t.getPicker(),o=t.lastRowIndex;o&&(t.lastRowIndex=null,i>o+8&&(o+=8),(o=n.getAt(o))&&r.focusNode(o))},readMoreData:function e(){var t=this,n=this.getStore(),i;i=n.getCount(),t.lastRowIndex=null,i>0&&(t.lastRowIndex=i-1),t.inputEl.focus(),n.loadPage((n.currentPage||0)+1,{params:this.getParams(this.lastQuery),addRecords:!0})},createPicker:function e(){var t=this.callParent(arguments);return t.mon({blur:this.onPickerBlur,scope:this}),t},onPickerBlur:function e(t){var n=this,i=n.inputEl,r=n.getPicker(),o,a;if(t.relatedTarget){if(t.relatedTarget!==i.dom){if(r&&r.el)for(o=0,a=t.relatedTarget;o<11&&a;){if(r.el.dom===a)return;a=a.parentElement,o++}n.onExitCombo()}}else n.inputEl.focus()},onBlur:function e(t){var n=this,i,r,o=n.getPicker();if(!n.allowCustomText){if(o&&o.el&&t.relatedTarget)for(i=0,r=t.relatedTarget;i<11&&r;){if(o.el.dom===r)return r=Ext.dom.Element.get(t.relatedTarget),r.un({blur:this.onPickerBlur,scope:n}),void r.on({blur:this.onPickerBlur,scope:n});r=r.parentElement,i++}n.onExitCombo()}},onExitCombo:function e(){var t=this,n=t.getRawValue(),i,r=null,o;if(!t.valueModels||0===t.valueModels.length)return void t.setRawValue(null);for(o=!1,i=0;i<t.valueModels.length;i++)if(r=t.valueModels[i],(r=r.get(t.displayField))===n){o=!0;break}o||t.setRawValue(r)},onDataLoaded:function e(t,n,i,r){var o=this,a=o.store.getCount();o.pagingToolbar&&(o.pageSize>a||o.lastRowIndex&&o.lastRowIndex+1+o.pageSize>a?o.pagingToolbar.setHeight(0):o.pagingToolbar.setHeight(36)),o.onDataRefreshed()},onKeyDown:function e(t){var n=this;t.ctrlKey&&t.getKey()===Ext.EventObject.Q?n.stopKeyHandlers=!0:t.ctrlKey||n.callParent(arguments)},onKeyUp:function e(t){var n=this;t.ctrlKey&&t.getKey()===Ext.EventObject.Q?n.stopKeyHandlers=!1:t.ctrlKey||n.callParent(arguments)},onKeyPress:function e(t){var n=this;n.stopKeyHandlers?n.up("form").switchTabs(n,t.shiftKey):t.ctrlKey||n.callParent(arguments)},showToolTipMinQuery:function e(){var t=this,n=t.getPicker(),i;t.expand(),t.pagingToolbar.setHeight(0),i=n.getTargetEl(),n.clearViewEl(),Ext.core.DomHelper.insertHtml("beforeEnd",i.dom,UB.format(UB.i18n("startSearchMinCharacters"),t.minCharsForQuery))},afterQuery:function e(t){var n=this,i,r,o;n.autoCompleteText&&n.store.getCount()&&(i=n.store.getAt(0),r=n.inputEl.dom.value,n.userInputText=r,o=i.get(n.displayField),n.inputEl.dom.value=o,n.inputEl.dom.setSelectionRange(r.length,o.length)),n.callParent(arguments)},beforequery:function e(t,n){var i=this,r,o=i.getStore();if(i.minCharsForQuery&&i.minCharsForQuery>0&&i.minCharsForQuery>(t.query||"").length)return t.cancel=!0,void i.showToolTipMinQuery();if(r=UB.Utils.escapeForRegexp(t.query),i.searchRegExp=null,Ext.isEmpty(r)||(i.searchRegExp=RegExp(r,"gi")),i.fireEvent("beforeQuerySend",t),"local"!==t.combo.queryMode){var a=t.query||"",s=i.displayField;if(i.sendQueryAsParam)return o.ubRequest||(o.ubRequest={}),void(o.ubRequest[i.queryParamName]=a);a?o.filters.add(new Ext.util.Filter({id:i.userFilterId,root:"data",property:s,caseSensitive:!1,anyMatch:!0,value:a})):(o.filters.removeAtKey(i.userFilterId),i.useForGridEdit&&o.totalCount<=1&&o.reload(),t.forceAll=!0)}},setValue:function e(t){var n=this,i,r,o,a,s;if(i=Ext.Array.from(t),!n.allowCustomText&&n.valueModels&&n.valueModels.length>0&&i.length===n.valueModels.length){for(s=!0,r=0;r<n.valueModels.length;r++)if(o=n.valueModels[r],o=o.get(n.valueField),a=i[r],Ext.isObject(a)&&a.isModel&&(a=a.get(n.valueField)),o!==a){s=!1;break}if(s)return}n.clearIsPhantom(),n.callParent(arguments);var l=n.getStore();!n.useForGridEdit||!t||_.isArray(t)||_.isObject(t)||l.filters.get(n.userFilterId)&&l.filters.get(n.userFilterId).value===t||(l.suspendEvent("clear"),l.filter(new Ext.util.Filter({id:n.userFilterId,root:"data",property:this.valueField||"ID",condition:t&&_.isArray(t)?"in":"equal",value:t})))},getValue:function e(t){var n=this,i;return i=n.callParent(arguments),i===n.value?i:null},getVal:function e(t){var n=this,i,r=n.getStore(),o=n.getValue();return o&&t?(r&&(i=r.getById(o)),i?i.get(t):null):null},clearValue:function e(){var t=this,n=t.store;t.callParent(),t.rawValue=null,n&&n.filters.removeAtKey(t.userFilterId)},getEntity:function e(){var t=this,n;return n=t.ubRequest||(t.store?t.store.ubRequest:null),n.entity},getSubTplData:function e(){var t=this,n;return n=t.callParent(arguments)},setRawValue:function e(t){var n=this;n.callParent(arguments),n.clearIsPhantom()},clearIsPhantom:function e(){var t=this;if(t.rendered&&t.phantomSelectedElement){Ext.get(t.getInputId()).removeCls("ub-combo-deleted")}t.phantomSelectedElement=!1,t.tipPhantomElement&&(t.tipPhantomElement.setDisabled(!0),t.tipPhantomElement=null)},setValueById:function e(t,n,i,r){function o(e,o){(o||e||a.store.getById(t))&&a.setValue(o?null:e||t),n&&a.resetOriginalValue(),s.resumeEvent("clear"),a.lastQuery=null,i&&Ext.callback(i,r||a,[a])}var a=this;if(Ext.isEmpty(t))return a.setValue(t),n&&a.resetOriginalValue(),void(i&&Ext.callback(i,r||a,[a]));var s=a.getStore();s.on({load:{fn:function e(){if(0===s.getCount()){var n=$App.domainInfo.get(a.getEntity(),!0);!a.setIsActualValue&&(n.hasMixin("mStorage")&&n.mixin("mStorage").safeDelete||n.hasMixin("dataHistory"))?$App.connection.select({entity:a.getEntity(),fieldList:s.ubRequest.fieldList,__allowSelectSafeDeleted:!0,ID:t}).done(function(e){if(!s.isDestroyed){var t=Ext.create(s.model);if(!UB.ux.data.UBStore.resultDataRow2Record(e,t))return void o(null,!0);if(UB.ux.data.UBStore.resetRecord(t),s.add(t,!0),o(t),a.fieldCls+=" ub-combo-deleted",a.rendered){Ext.get(a.getInputId()).addCls("ub-combo-deleted")}a.phantomSelectedElement=!0,a.tipPhantomElement=Ext.create("Ext.tip.ToolTip",{target:a.getInputId(),html:UB.i18n("elementIsNotActual")})}}):o(null,!0)}else 1===s.getCount()?o(s.getAt(0)):o();a.setIsActualValue=!1},single:!0}}),s.suspendEvent("clear"),s.filter(new Ext.util.Filter({id:a.userFilterId,root:"data",property:this.valueField||"ID",condition:t&&_.isArray(t)?"in":"equal",value:t}))},getFieldValue:function e(t){return this.getValue()&&this.lastSelection.length?this.lastSelection[0].get(t):null}})},function(e,t){Ext.define("UB.ux.form.field.UBDate",{extend:"Ext.form.field.Date",alias:"widget.ubdatefield",format:"d.m.Y",labelAlign:"left",fieldCls:"ub-date-input",minWidth:120,startDay:1,minValue:new Date(1901,1,1),validator:function e(t){if(!t)return!0;var n=/^\d{2}([.\/\-])\d{2}\1\d{4}$/;return!!t.match(n)||" "},constructor:function e(t){var n=this;t=t||{},t.width||(t.width=(t.fieldLabel?t.labelWidth||n.labelWidth||100:0)+120),t.fieldLabel&&(n.minWidth=t.width),n.maxWidth=t.maxWidth||t.width,n.callParent([t])},initComponent:function e(){var t=this;t.fieldType=t.fieldType||"DateTime",t.callParent(arguments)},rawToValue:function e(t){var n=this.callParent(arguments);return this.fieldType===UBDomain.ubDataTypes.Date&&Ext.isDate(n)&&(n=UB.core.UBUtil.truncTimeToUtcNull(n)),n}})},function(e,t,n){n(44),n(16),n(2),n(3),Ext.define("UB.core.UBDataLoader",{singleton:!0,loadInstance:function e(t){var n={entity:t.entityName,method:UB.core.UBCommand.methodName.SELECT,fieldList:t.fieldList,alsNeed:t.alsNeed,ID:t.id};return t.lockType&&(n.lockType=t.lockType),Ext.create("UB.ux.data.UBStore",{ubRequest:n,autoDestroy:!0,autoLoad:!1}).load().then(function(e){var n;return e.getCount()>0&&(n=e.getAt(0),n.resultLock=e.resultLock,n.resultAls=e.resultAls),t.callback&&(UB.logDebug("UBDataLoader.loadInstance with callback is DEPRECATED. Use UBDataLoader.loadInstance(..).then(..).catch(..) style"),Ext.callback(t.callback,t.scope,[n])),n})},loadStores:function e(t){var n,i,r={},o=[],a=t.ubRequests;if(_.isArray(a)&&a.length){for(var s=0,l=a.length;s<l;++s)n={ubRequest:a[s],autoLoad:!1,disablePaging:!0},i=n.ubRequest.requestName||UB.core.UBUtil.getNameMd5(n.ubRequest.entity,n.ubRequest.fieldList,n.ubRequest.whereList),t.setStoreId&&(n.storeId=i),r[i]=Ext.create("UB.ux.data.UBStore",n),o.push(r[i].load());return Promise.all(o).then(function(e){if(!t.callback)return e;UB.logDebug("callback style of UBDataLoader.loadStores is deprecated. loadStores().then(...) or UBConnection methods or store.load().then(...)"),Ext.callback(t.callback,t.scope||this,[r])})}throw Error("Non-empty array must be passed to loadStores")},loadStoresSimple:function e(t){var n,i,r,o;for(r=0,o=t.ubRequests.length;r<o;++r)n=t.ubRequests[r],i=n.requestName?n.requestName:"req"+ ++UB.core.UBService.TRANSACTION_ID,n.model||(n.model=Ext.define(i,{extend:"Ext.data.Model",idProperty:"ID",fields:n.fieldList}));return UB.core.UBDataLoader.loadStores(t)}})},function(e,t,n){n(16),n(146);var i=n(13);Ext.define("UB.ux.data.UBStore",{extend:"Ext.data.Store",alias:"store.ubstore",totalRequired:!1,uses:["UB.core.UBStoreManager","UB.core.UBEnumManager"],statics:{copyRecord:function e(t,n){t.getFields().forEach(function(e){n.set(e.name,t.get(e.name))})},resetRecord:function e(t){t.modified=[],t.reject(!0)},resultDataRow2Record:function e(t,n,i){var r=t.resultData.data[i||0];if(!r)return null;for(var o=t.resultData.fields,a=o.length,s=-1;++s<a;)n.set(o[s],r[s]);return n},createRecord:function e(t,n,i){var r=UB.ux.data.UBStore.getEntityModel(t,n),o=Ext.create(r);if(!1!==i){Ext.create("Ext.data.Store",{model:r}).add(o)}return o.fields.eachKey(function(e){o.set(e,null)}),UB.ux.data.UBStore.resetRecord(o),o},normalizeFieldList:function e(t,n){var i=void 0;if(!(i="string"==typeof t?$App.domainInfo.get(t):t))throw Error("Invalid entity code ="+t);var r=i.mixins.mStorage,o=!1,a=!1,s=[];return n.forEach(function(e){s.push(e),o=o||"ID"===e||"ID"===e.name,a=a||"mi_modifyDate"===e||"mi_modifyDate"===e.name}),o||s.push("ID"),r&&r.simpleAudit&&!a&&s.push("mi_modifyDate"),s},entityModelName:function e(t){return"UB.model."+t},getEntityModel:function e(t,n,i){var r=this.getEntityModelFields(t,n),o=this.entityModelName(UB.core.UBUtil.getNameMd5(t,n));return Ext.ModelManager.getModel(o)||Ext.define(o,{extend:"Ext.data.Model",entityName:t,idProperty:i||"ID",fields:r}),o},getEntityModelFields:function e(t,n){var r=$App.domainInfo.get(t);if(!Ext.isDefined(r))throw Error(UB.format('Entity "{0}" not found in Domain',t));var o=[];return n.forEach(function(e,t){var n=r.attr(e);n&&o.push({name:e,convert:null,type:i.getPhysicalDataType(n.dataType),useNull:!0,mapping:t})}),o}},constructor:function e(t){var n=this,i=Ext.clone(t),r=i.ubRequest,o=r.entity;r.fieldList=UB.ux.data.UBStore.normalizeFieldList(o,r.fieldList),Ext.apply(n,{ubRequest:r,model:r.model||UB.ux.data.UBStore.getEntityModel(o,r.fieldList,i.idProperty),proxy:{type:"ubproxy"},entityName:o,autoLoad:!1!==n.autoLoad,remoteSort:!0,remoteFilter:!0,remoteGroup:!0}),t.disablePaging?n.pageSize=0:n.pageSize=n.pageSize?n.pageSize:UB.appConfig.storeDefaultPageSize,n.addEvents("beforereload","entityModified"),n.callParent([i]),n.on({beforeload:n.onBeforeLoad,beforeprefetch:n.onBeforePrefetch})},fireModifyEvent:function e(t,n){this.fireEvent("entityModified",t,n)},clearCache:function e(){this.clearProxyCache();var t=$App.domainInfo.get(this.entityName).cacheType;return $App.connection.cacheOccurrenceRefresh(this.entityName,t)},setWhereList:function e(t,n){this.ubRequest.whereList=t,n||this.reload()},load:function e(t){var n=this,i=Q.defer(),r="function"==typeof t,o=void 0,a=void 0,s=[],l=n.throwLoadError;if(n.isDestroyed)return Q.resolve(n);o=function e(t,n,i){i?Q.all(s).done(function(){a(t,n,i)}):a(t,n,i)},a=function e(o,a,s){if(s)a.resultSet&&a.resultSet.resultLock&&(n.resultLock=a.resultSet.resultLock),a.resultSet&&a.resultSet.resultAls&&(n.resultAls=a.resultSet.resultAls),i.resolve(n);else{if(l)throw a.getError();i.reject(a.getError())}if(r||t&&t.callback){if(UB.logDebug("UBStore.load(callback) is DEPRECATED. Use Promise style: UBStore.load().then(...)"),!s)throw Error(a.getError());r?Ext.callback(t,null,[o,a,s]):Ext.callback(t.callback,t.scope,[o,a,s])}},n.indexByID=null,n.linkedItemsLoadList&&_.forEach(n.linkedItemsLoadList,function(e){e&&e instanceof UB.ux.data.UBStore?s.push(e.load()):"function"==typeof e?s.push(e()):e&&Q.isPromise(e)&&s.push(e)});var u={};return!r&&t&&UB.apply(u,t),this.disablePaging&&!u.limit&&(u.limit=-1,u.start=0),u.callback=o,delete u.scope,this.callParent([u]),i.promise},reload:function e(t){var n=this,i=Q.defer(),r=UB.apply({},t),o=function e(r,o,a){a?i.resolve(n):i.reject("TODO pass here rejection reason"),t&&t.callback&&(UB.logDebug("UBStore.reload(callback) is DEPRECATED. Use Promise style: UBStore.reload().then(...)"),Ext.callback(t.callback,t.scope,[r,o,a]))};return n.fireEvent("beforereload"),n.loading=!0,n.indexByID=null,n.clearCache().done(function(){n.isDestroyed||(r.callback=o,delete r.scope,n.superclass.reload.call(n,r))}),i.promise},clearProxyCache:function e(){var t=this.getProxy();t&&(delete t.totalRecCount,delete t.data)},filter:function e(t){if(!this.isDestroyed){this.clearProxyCache();try{this.throwLoadError=!0,this.callParent(arguments)}finally{this.throwLoadError=!1}}},clearFilter:function e(){this.isDestroyed||(this.clearProxyCache(),this.callParent(arguments))},onBeforeLoad:function e(t,n){return n.ubRequest=this.ubRequest,!0},onBeforePrefetch:function e(t,n){return n.ubRequest=this.ubRequest,!0},remove:function e(t){var n=this;n.clearCache().done(function(){n.isDestroyed||n.superclass.remove.call(n,t)})},add:function e(t,n){var i=this;if(n)return this.callParent(arguments);i.clearCache().done(function(){i.isDestroyed||i.superclass.add.call(i,t)})},getById:function e(t){var n=this;return t&&t.getId&&(t=t.getId()),!n.indexByID&&n.createIndexByID&&(n.indexByID={},n.each(function(e){n.indexByID[e.getId()]=e},n)),n.indexByID?n.indexByID[t]:n.callParent([t])}}),UB.ClientRepository.prototype.selectAsStore=function(e){return e=e||{},e.ubRequest=this.ubql(),Ext.create("UB.ux.data.UBStore",e).load()}},function(e,t){UB.view||(UB.view={}),UB.view.ErrorWindow={errList:[],showError:function e(t){var n=this;t.errMsg=UB.i18n(t.errMsg),n.isInited||n.init(),n.inProcessInit?n.errList.push(t):n.renderErr(t)},renderErr:function e(t){var n=this,i,r,o,a,s,l,u=!1;n.lastError&&n.lastError.errMsg===t.errMsg&&n.lastError.detail===t.detail||(n.lastError=t,n.mask.style.display="inline",n.main.style.display="inline",i=document.createElement("div"),i.className="ub-error-win-c-item",r=document.createElement("div"),r.style.width="100%",r.style.padding="5px",r.style.display="table-cell",r.innerHTML=t.errMsg,i.appendChild(r),r.oncontextmenu=function(e){var t=function e(){n.removeEvent(document.body,"click",s),document.body.removeChild(r),u=!1};u&&t(),r=document.createElement("button"),r.className="ub-error-win-detail-btn",r.innerHTML=UB.i18n("showDeveloperDetail"),r.style.position="absolute",r.style.left=e.clientX+"px",r.style.top=e.clientY+"px",r.onclick=function(e){a(arguments),t()},document.body.appendChild(r),s=function e(n){n.target!==r&&t()},n.addEvent(document.body,"click",s),u=!0},o=document.createElement("div"),o.className="ub-error-win-c-detail",o.style.width="100%",o.style.display="none",i.appendChild(o),r=document.createElement("div"),r.style.padding="5px",r.innerHTML=t.detail||t.errMsg,r.style.display="table-cell",r.style.width="100%",o.appendChild(r),r=document.createElement("div"),r.style.padding="5px",r.style.width="auto",r.style.display="table-cell",r.style.cursor="pointer",l=document.createElement("a"),l.className="ub-error-win-btn-detail-close fa fa-times",l.onclick=function(e){a(arguments)},r.appendChild(l),o.appendChild(r),n.content.appendChild(i),n.mask.focus(),n.main.focus(),n.main.click(),n.mask.click(),a=function e(){"none"===o.style.display?o.style.display="inline-block":o.style.display="none"})},closeWindow:function e(){var t=this;t.mask.style.display="none",t.main.style.display="none",t.clearContent()},clearContent:function e(){var t=this;delete t.lastError;for(var n=t.content.childNodes.length-1;n>=0;n--)t.content.removeChild(t.content.childNodes[n])},addEvent:function e(t,n,i){t.addEventListener?t.addEventListener(n,i,!1):t.attachEvent("on"+n,i)},removeEvent:function e(t,n,i){t.removeEventListener?t.removeEventListener(n,i,!1):t.detachEvent("on"+n,i)},init:function e(){function t(e){return o.focus(),!1}var n=this,i,r,o,a,s;if(!n.inProcessInit){n.inProcessInit=!0,n.main=i=document.createElement("div"),i.className="ub-error-win",i.style.display="none",i.style.left=(window.innerWidth-600)/2+"px",i.style.top=(window.innerHeight-400)/2+"px",i.tabindex="5",document.body.appendChild(i),i.setAttribute("tabindex","5"),i.innerHTML='<div class="ub-error-win-inner"><table collspan="0" rowspam="0" style="border-spacing: 0px;" width="100%" height="100%" ><tr><td ><div class="ub-error-win-header"><i class="fa fa-2x fa-exclamation-triangle"></i> </div></td></tr><tr><td class="ub-error-win-content"><div class="ub-error-win-contentT" style="width:600px; min-height: 80px; max-height: 350px;"></div></td></tr><tr><td><div class="ub-error-win-footer"><button class="ub-error-win-btn ub-error-win-btn-ok" tabindex="1" >'+UB.i18n("ok")+"</button></div></td></tr></table></div>",n.mask=r=document.createElement("div"),r.className="ub-mask",r.style.display="none",document.body.appendChild(r),n.content=i.querySelector('[class="ub-error-win-contentT"]'),s=i.querySelector('[class="ub-error-win-header"]');var l=function e(t){i.moveWin=!1,n.removeEvent(document.body,"mouseup",e),n.removeEvent(document.body,"mousemove",u)},u=function e(t){i.moveWin&&(i.style.left=t.x-i.moveWin.x+i.offsetLeft+document.body.scrollLeft+"px",i.style.top=t.y-i.moveWin.y+i.offsetTop+document.body.scrollTop+"px",i.moveWin.x=t.x,i.moveWin.y=t.y)};s.onmousedown=function(e){i.moveWin={x:e.x,y:e.y},n.addEvent(document.body,"mouseup",l),n.addEvent(document.body,"mousemove",u)},o=i.querySelector('[class*="ub-error-win-btn-ok"]'),o.focus(),o.tabindex=1,o.onkeypress=t,o.onkeyup=t,o.onkeydown=function(e){13!==e.keyCode&&27!==e.keyCode||a();var t=17,n=45,i=67;if(17!==e.keyCode&&45!==e.keyCode&&67!==e.keyCode)return!1},i.onkeypress=t,i.onkeyup=t,i.onkeydown=o.onkeydown,a=function e(){n.closeWindow()},o.attachEvent?o.attachEvent("onclick",a):o.onclick=a,n.isInited=!0,n.inProcessInit=!1,n.errList.forEach(function(e){n.renderErr(e)}),n.errList=[],n.mask.setAttribute("tabindex","5"),n.mask.onkeypress=t,n.mask.onkeyup=t,n.mask.onkeydown=o.onkeydown}}},UB.showErrorWindow=function(e,t,n,i){var r=i||"";e&&e instanceof UB.UBError?(t=e.code,r=e.detail,e.stack&&(r+="<BR/>stackTrace:"+e.stack),e=e.message):e instanceof Error?(e.stack&&(r+="<BR/>stackTrace:"+e.stack),e=""+e):Ext.isObject(e)&&(t=e.errCode,n=e.entity,e=e.errMsg?e.errMsg:JSON.stringify(e),r=e.detail||r),UB.view.ErrorWindow.showError({errMsg:e,errCode:t,entityCode:n,detail:r})},UB.showResponseError=function(e){if(e.errCode===UB.core.UBCommand.errCode.MODIFIED_BY_ANOTHER_USER){var t=e.resultData,n=_.find(t.fields,"mi_modifyDate"),i=_.find(t.fields,"mi_modifyUser"),r=t.data[0][i],o=Ext.Date.format(Ext.Date.parse(t.data[n],"c"),Ext.util.Format.datetimeFormat);UB.core.UBDataLoader.loadInstance({entityName:"uba_user",fieldList:["name"],id:r,callback:function t(n){var i=UB.format("UB.core.UBApp.runLink(&quot;command=ShowFormUser&amp;id={2}&quot;); Ext.fly(this).up(&quot;div.x-window&quot;).hide();",r);Ext.Msg.show({title:UB.i18n("error"),msg:UB.format('{0} <a href="#" onclick="{1}">{2}</a> {3}',e.errMsg,i,n.get("name"),o),buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})},scope:this})}else UB.showErrorWindow(e.errMsg,e.errCode,e.entity);throw Error(e.errMsg)},UB.toast=function(e){var t=Ext.create("widget.uxNotification",{title:UB.i18n("error"),position:"t",slideInDuration:800,slideBackDuration:1500,slideInAnimation:"elasticIn",slideBackAnimation:"elasticIn",useXAxis:!0,autoShow:!0,cls:"ux-notification-light",iconCls:"ux-notification-icon-error",bodyPadding:5,items:[{html:UB.format(UB.i18n("oshibkaVvoda"),e.entityTitle),border:!1},{xtype:"box",autoEl:{tag:"a",href:"#",onclick:"return false;",html:e.fieldLabel},listeners:{boxready:function n(i){i.getEl().on({click:function n(){return t.close(),Ext.callback(e.callback),!1}})}}}]})}},function(e,t,n){n(14),n(2),n(4),n(47),n(164),Ext.define("UB.view.NavigationPanel",{extend:"Ext.tree.Panel",alias:"widget.navigationpanel",uses:["UB.core.UBApp","UB.view.Viewport"],cls:"tree_wrap",viewConfig:{showTreeLines:!1},hideHeaders:!0,folderSort:!1,initComponent:function e(){var t=this;t.desktopID||$App.addListener("desktopChanged",t.onDesktopChanged,t),t.storeNavigationShortcut=UB.core.UBStoreManager.getNavigationShortcutStore(),t.viewConfig={toggleOnDblClick:!1},t.columns=[{xtype:"ubtreecolumn",text:"Name",width:"100%",dataIndex:t.displayField}],Ext.apply(t,{store:Ext.create("Ext.data.TreeStore",{root:UB.core.UBUtilTree.arrayToTreeRootNode(t.getData($App.getDesktop())),sortOnLoad:!1}),rootVisible:!1,useArrows:!0,cls:"no_expand_icon no-leaf-icons no-parent-icons nav-shortcut leftMenu"}),UB.core.UBStoreManager.getDesktopStore().each(function(e){t.store.setRootNode(UB.core.UBUtilTree.arrayToTreeRootNode(t.getData(e.get("ID")))),_.forEach(t.store.tree.root.childNodes,function(e,t){t>0&&e.isExpanded()&&e.collapse(!1)})}),t.store.on("expand",function(e,t){e.parentNode&&e.parentNode.eachChild(function(t){t!==e&&t.isExpanded()&&t.childNodes.length>0&&t.collapse(!1)})}),t.callParent(arguments),t.addListener("itemclick",t.onItemClick,t),t.addEvents("itemclickstart"),t.initContextMenu(),t.on("afterrender",function(){t.getEl().addListener("contextmenu",function(e,n,i){return e.stopEvent(),t.contextMenu.currentRecord=null,t.contextMenu.showAt(e.getXY()),!1})}),t.desktopID?t.onDesktopChanged(t.desktopID):t.onDesktopChanged(UB.core.UBApp.getDesktop())},initContextMenu:function e(){var t=this,n=t.storeNavigationShortcut.ubRequest.entity,i=function e(n,i,r){if(r===Ext.data.Model.COMMIT&&(UB.core.UBStoreManager.shortcutCommandCache[i.get("ID")]=void 0),t.desktopID&&(!r||Ext.data.Model.COMMIT===r))return void t.onDesktopChanged(t.desktopID);!t.currentDesktop||r&&Ext.data.Model.COMMIT!==r||t.onDesktopChanged(t.currentDesktop)},r=$App.domainInfo.get("ubm_navshortcut");t.storeNavigationShortcut.on({datachanged:i,update:i});var o=new Ext.Action({glyph:UB.core.UBUtil.glyphs.faEdit,actionID:"Edit",text:UB.i18n("Edit"),disabled:!r.haveAccessToMethod("update"),handler:function e(){if(!t.contextMenu.currentRecord)return void $App.dialogError('Right click on item and when select "Edit"');var n=t.contextMenu.currentRecord,i={cmdType:UB.core.UBCommand.commandType.showForm,entity:t.storeNavigationShortcut.ubRequest.entity,instanceID:n.get("ID"),store:t.storeNavigationShortcut};UB.core.UBApp.doCommand(i)},scope:this}),a=new Ext.Action({glyph:UB.core.UBUtil.glyphs.faLink,actionID:"addShortcut",text:UB.i18n("dobavitYarlik"),disabled:!r.haveAccessToMethod("insert"),handler:function e(){var i=t.contextMenu.currentRecord,r={cmdType:UB.core.UBCommand.commandType.showForm,entity:n,store:t.storeNavigationShortcut};i&&(r.parentID=i.get("isFolder")?i.get("ID"):i.get("parentID"),r.desktopID=i.get("desktopID")),UB.core.UBApp.doCommand(r)},scope:this}),s=new Ext.Action({glyph:UB.core.UBUtil.glyphs.faFolder,actionID:"addFolder",text:UB.i18n("dobavitDirectoriu"),disabled:!r.haveAccessToMethod("insert"),handler:function e(){var i=t.contextMenu.currentRecord,r={cmdType:UB.core.UBCommand.commandType.showForm,entity:n,store:t.storeNavigationShortcut,isFolder:!0};i&&(r.parentID=i.get("isFolder")?i.get("ID"):i.get("parentID"),r.desktopID=i.get("desktopID")),UB.core.UBApp.doCommand(r)},scope:this}),l=new Ext.Action({actionID:"deleteShortcut",text:UB.i18n("Delete"),glyph:UB.core.UBUtil.glyphs.faTrashO,scope:this,disabled:!r.haveAccessToMethod("delete"),handler:function e(){var i=t.contextMenu.currentRecord;if(!t.contextMenu.currentRecord)return void $App.dialogError('Right click on item and when select "Delete" from popup menu');var r=i.get("ID");$App.dialogYesNo("deletionDialogConfirmCaption","vyUvereny").then(function(e){e&&$App.connection.doDelete({entity:n,execParams:{ID:r}}).then(function(){t.storeNavigationShortcut.reload()})})}});t.contextMenu=Ext.create("Ext.menu.Menu",{items:[o,a,s,{xtype:"menuseparator"},l]}),t.addListener("itemcontextmenu",function(e,n,i,r,o){return o.stopEvent(),t.contextMenu.currentRecord=t.storeNavigationShortcut.getById(n.get("id")),t.contextMenu.showAt(o.getXY()),!1},this)},onItemClick:function e(t,n,i,r,o,a){var s=this,l,u,c;if(!s.clickDisabled){if(s.clickDisabled=!0,setTimeout(function(){s.clickDisabled=!1},300),n.childNodes&&n.childNodes.length>0)return o.stopEvent(),void(n.isExpanded()?n.collapse():n.expand());l=parseInt(n.getId(),10),u=UB.core.UBAppConfig.systemEntities.navigationShortcut.fields,c=this.storeNavigationShortcut.getById(l),s.fireEvent("itemclickstart",c),c.get("isFolder")||$App.runShortcutCommand(c.get("ID"),c.get("inWindow"))}},getData:function e(t){var n=[],i=UB.core.UBAppConfig.systemEntities.navigationShortcut.fields,r,o=!0;return r=function e(t){if(!t)return 1;var n=t.match(/(\/)/g);return n?n.length-1:1},this.storeNavigationShortcut.each(function(e){var a;e.get(i.desktopID)===t&&(a=r(e.get(i.ubTreePath)),n.push({id:e.get("ID"),code:e.get(i.code),text:e.get(i.caption),leaf:!e.get(i.isFolder),parentId:e.get(i.folderID),displayOrder:e.get(i.displayOrder),desktopID:e.get(i.desktopID),expanded:(o&&1===a||a>1)&&!e.get(i.isCollapsed),iconCls:e.get("iconCls")||"fa fa-space",cls:"ub_navpnl_item"+(a<4?" ub_navpnl_item_l"+a:"")}),o=!1)}),n},onDesktopChanged:function e(t){this.getStore().setRootNode(UB.core.UBUtilTree.arrayToTreeRootNode(this.getData(t))),this.currentDesktop=t,_.forEach(this.getStore().tree.root.childNodes,function(e,t){t>0&&e.isExpanded()&&e.collapse(!1)})}})},function(e,t){Ext.define("UB.core.UBUtilTree",{singleton:!0,pathSeparator:"/",pathAttribute:"treepath",doSort:!1,arrayToTreeRootNode:function e(t){var n={leaf:!1,id:0,expanded:!0},i={0:n},r,o,a,s;for(a=0,s=t.length;a<s;++a){var l=t[a];r=i[l.id],r?Ext.applyIf(r,l):r=i[l.id]=l,o=i[l.parentId||0],o||(o=i[l.parentId]={id:l.parentId}),o.children||(o.children=[]),o.children.push(r)}return n},addToParent:function e(t,n){_.forEach(n,function(e){var n=t.appendChild(e);e.children&&e.children.length>0&&UB.core.UBUtilTree.addToParent(n,e.children)})}})},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){function i(e,t){this._id=e,this._clearFn=t}var r=Function.prototype.apply;t.setTimeout=function(){return new i(r.call(setTimeout,window,arguments),clearTimeout)},t.setInterval=function(){return new i(r.call(setInterval,window,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(window,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function t(){e._onTimeout&&e._onTimeout()},t))},n(60),t.setImmediate=setImmediate,t.clearImmediate=clearImmediate},function(e,t,n){var i=n(10),r=n(57),o=n(1),a=n(13),s=n(12);window.UB=i,window._=o,window.UB.LocalDataStore=s,window.Q=r,window.UBDomain=a,Promise.prototype.fin||(Promise.prototype.fin=function(e){var t=this,n=function e(){return t},i=function t(){return Promise.resolve(e()).then(n)};return this.then(i,i)}),Promise.prototype.done||(Promise.prototype.done=Promise.prototype.then),window.JSZip=n(88),window.saveAs=n(93).saveAs,Ext.Loader.setConfig({enabled:!0,disableCaching:!1,paths:{"Ext.ux":"@unitybase/adminui-pub/_src/ux",UB:"@unitybase/adminui-pub/_src/app"}}),n(96)(),e.exports={UB:i}},function(e,t,n){function i(e,t){if(t)throw new u.UBError("Access deny");return Promise.resolve({authSchema:B,login:_})}function r(e){return JSON.parse('"'+e.match(/<<<(.*)>>>/)[1]+'"')}function o(e){function t(e,t,n){var i=new f(e,t,n),r=i.userData;return r.lang&&-1!==this.appConfig.supportedLanguages.indexOf(r.lang)||(r.lang=this.appConfig.defaultLang),i}var n=e.host||"http://localhost:888",o=e.appName||"/",a=e.requestAuthParams,d=void 0,h=void 0,p=void 0;l.call(this),s.assign(this,l.prototype),this.ubNotifier=null,this.appConfig={},this.preferredLocale="en",this.domain=null,"/"!==o.charAt(0)&&(o="/"+o),a||(a=i),h=n+o,this.serverUrl=h,d="undefined"!=typeof window&&window.location.origin===n?o:h,"/"!==d.charAt(d.length-1)&&(d+="/"),this.baseURL=d,this.appName=o,this.allowSessionPersistent=e.allowSessionPersistent&&"undefined"!=typeof localStorage,this.allowSessionPersistent&&(this.__sessionPersistKey=this.serverUrl+":storedSession"),this.cache=null,this._pendingCachedEntityRequests={},this.lastLoginName="",this._bufferedRequests=[],this._bufferTimeoutID=0,this.isAuthorized=function(){return void 0!==p},this.userLogin=function(){return this.userData("login")},this.userLang=function(){return this.userData("lang")},this.userData=function(e){var t=this.isAuthorized()?p.userData:{lang:"en",login:_};return e?t[e]:t},this.authorize=function(e){var n=this;if(p)return Promise.resolve(p);if(this.allowSessionPersistent&&!e){var i=localStorage.getItem(this.__sessionPersistKey);if(i)try{var r=JSON.parse(i);return p=t.call(this,r.data,r.secretWord,r.authSchema),n.emit("authorized",n,p),Promise.resolve(p)}catch(e){localStorage.removeItem(this.__sessionPersistKey)}}return this._pendingAuthPromise?this._pendingAuthPromise:(this.exchangeKeysPromise=null,this._pendingAuthPromise=a(this,e).then(function(e){return n.doAuth(e).then(function(t){return n._pendingAuthPromise=null,p=t,n.emit("authorized",n,t,e),t}).catch(function(e){return n._pendingAuthPromise=null,e&&e instanceof u.UBAbortError||n.emit("authorizationFail",e,n),n.authorize(!0)})}),this._pendingAuthPromise)},this.authorizationClear=function(){this.lastLoginName=this.userLogin(),p=void 0},this.authHandshakeUBIP=function(e){return e.login?this.post(C,"",{headers:{Authorization:e.authSchema+" "+e.login}}):Promise.reject({errMsg:"invalid user name"})},this.authHandshakeOpenIDConnect=function(e){return Promise.resolve(e).then(function(e){return e.authSchema="UB",e})},this.authHandshakeUB=function(e){var t=this,n=void 0;return e.login&&e.password?this.post(C,"",{params:{AUTHTYPE:e.authSchema,userName:e.login}}).then(function(i){var r=void 0,a=void 0,s=void 0,l={params:{AUTHTYPE:e.authSchema,userName:e.login,password:""}},u=""+y((new Date).toISOString().substr(0,16));l.params.clientNonce=u,i.data.connectionID&&(l.params.connectionID=i.data.connectionID);var c=i.data.realm;if(c){if(!(r=i.data.nonce))throw Error("invalid LDAP auth response");i.data.useSasl?(a=v(e.login.split("\\")[1].toUpperCase()+":"+c+":"+e.password),a.concat(g.enc.Utf8.parse(":"+r+":"+u)),s=""+v(a),n=s):(s=window.btoa(e.password),n=s)}else{if(!(r=i.data.result))throw Error("invalid auth response");a=""+y("salt"+e.password);var d="/"===o?"/":o.replace(/\//g,"");s=""+y(d.toLowerCase()+r+u+e.login+a),n=a}return l.params.password=s,t.post(C,"",l).then(function(e){return e.secretWord=n,e})}):Promise.reject({errMsg:"invalid user name or password"})},this.authHandshakeCERT=function(){throw Error('authHandshakeCERT should be injected by "nm-dstu" model')},this.doAuth=function(e){var n=this;if(e.authSchema=e.authSchema||"UB",this.isAuthorized())return Promise.reject({errMsg:"invalid auth call",errDetails:"contact developers"});var i=void 0;switch(e.authSchema){case B:i=Promise.resolve({data:{result:"0+0",uData:JSON.stringify({login:_})},secretWord:""});break;case"UB":i=this.authHandshakeUB(e);break;case"CERT":i=this.authHandshakeCERT(e);break;case"UBIP":i=this.authHandshakeUBIP(e);break;case"OpenIDConnect":i=this.authHandshakeOpenIDConnect(e);break;case"Negotiate":i=this.post(C,"",{params:{USERNAME:"",AUTHTYPE:e.authSchema}}).then(function(e){return e.secretWord=e.data.logonname,e});break;default:i=Promise.reject({errMsg:"invalid authentication schema "+e.authSchema})}return i=i.then(function(i){var r=t.call(n,i.data,i.secretWord,e.authSchema);return n.allowSessionPersistent&&localStorage.setItem(n.__sessionPersistKey,JSON.stringify({data:i.data,secretWord:i.secretWord,authSchema:i.authSchema})),r},function(t){if(t instanceof Error)throw t;var i=t.data||t,o={errMsg:i.errMsg,errCode:i.errCode,errDetails:i.errMsg};403===t.status?o.errMsg="UB"===e.authSchema?"msgInvalidUBAuth":"msgInvalidCertAuth":o.errMsg||(o.errMsg="unknownError"),0===t.status&&(o.errDetails="network error"),/<<<.*>>>/.test(o.errMsg)&&(o.errMsg=r(o.errMsg));var a=n.serverErrorByCode(o.errCode);throw a&&(o.errDetails=a+" "+o.errDetails,c(a)!==a&&(o.errMsg=a)),n.allowSessionPersistent&&localStorage.removeItem(n.__sessionPersistKey),new u.UBError(o.errMsg,o.errDetails,o.errCode)})},this.recordedXHRs=[],this.recorderEnabled=!1}function a(e){var t=this.config=s.clone(e),n=new o({host:t.host,appName:t.path||"/",requestAuthParams:t.onCredentialRequired,allowSessionPersistent:e.allowSessionPersistent});return t.onAuthorizationFail&&n.on("authorizationFail",t.onAuthorizationFail),t.onNeedChangePassword&&n.on("passwordExpired",t.onNeedChangePassword),t.onAuthorized&&n.on("authorized",t.onAuthorized),n.getAppInfo().then(function(e){n.appConfig=s.defaults(s.clone(e),{applicationName:"UnityBase",applicationTitle:"UnityBase",loginWindowTopLogoURL:"",loginWindowBottomLogoURL:"",themeName:"UBGrayTheme",userDbVersion:null,defaultLang:"en",supportedLanguages:["en"],uiSettings:{}}),n.ubNotifier=new b(n);var i=null;return I&&(i=I.getItem(n.appName+"preferredLocale")),i||(i=n.appConfig.defaultLang),-1===n.appConfig.supportedLanguages.indexOf(i)&&(i=n.appConfig.defaultLang),n.preferredLocale=i,!t.onGotApplicationConfig||t.onGotApplicationConfig(n)}).then(function(){return n.initCache(n.appConfig.userDbVersion)}).then(function(){return n.authorize()}).then(function(){var e=n.userData("lang");I&&I.setItem(n.appName+"preferredLocale",e),n.preferredLocale=e;var i=n.getDomainInfo();return t.onGotApplicationDomain&&(i=i.then(function(e){return t.onGotApplicationDomain(e)})),i}).then(function(e){return n.domain=e,n})}var s=n(1),l=n(20),u=n(11),c=n(19).i18n,d=n(24),f=n(52),h=n(12),p=n(13),m=n(25),g=n(9),y=n(26),v=n(27),b=n(53),x=n(28),E=/(\/|^)(auth|getAppInfo)(\/|\?|$)/,w=20,C="auth",_="anonymous",B="None";o.prototype.initCache=function(e){return this.cache=new m(this.baseURL,e),this.cachedSessionEntityRequested={},this.cache.clear(m.SESSION)},o.prototype.cacheKeyCalculate=function(e,t){var n=[this.userLogin().toLowerCase(),this.userLang(),e];return Array.isArray(t)&&n.push(""+v(JSON.stringify(t))),n.join("#").replace(/[\\:.]/g,"#")},o.prototype.cacheOccurrenceRefresh=function(e,t){var n=this,i=Promise.resolve(!0);if(t===m.cacheTypes.Session||t===m.cacheTypes.SessionEntity){var r=this.domain.get(e);if(r&&r.hasMixin("unity")){var o=r.mixin("unity"),a=this.domain.get(o.entity);a&&o.entity!==e&&a.cacheType!==m.cacheTypes.None&&(i=i.then(function(){return n.cacheOccurrenceRefresh(o.entity,a.cacheType)}))}var s=n.cacheKeyCalculate(e),l=RegExp("^"+s);Object.keys(n.cachedSessionEntityRequested).filter(function(e){return l.test(e)}).forEach(function(e){delete n.cachedSessionEntityRequested[e]}),t===m.cacheTypes.Session&&(i=i.then(function(){return n.cache.removeIfMach(l,m.SESSION)}))}return i},o.prototype.cacheOccurrenceRemove=function(e,t){var n=this,i=n.cacheKeyCalculate(e),r=RegExp("^"+i);Object.keys(n.cachedSessionEntityRequested).filter(function(e){return r.test(e)}).forEach(function(e){delete n.cachedSessionEntityRequested[e]});var o=t===m.cacheTypes.Session?m.SESSION:m.PERMANENT;return n.cache.removeIfMach(r,o)},o.prototype.cacheClearAll=function(){var e=this;return Object.keys(e.cachedSessionEntityRequested).forEach(function(t){delete e.cachedSessionEntityRequested[t]}),Promise.all([e.cache.clear(m.SESSION),e.cache.clear(m.PERMANENT)])},o.prototype.get=function(e,t){return this.xhr(s.assign({},t,{method:"GET",url:e}))},o.prototype.post=function(e,t,n){return this.xhr(s.assign({},n,{method:"POST",url:e,data:t}))},o.prototype.checkChannelEncryption=function(e,t){return!0},o.prototype.xhr=function(e){var t=this,n=s.assign({headers:{}},e),i=n.url,o=void 0;return t.recorderEnabled&&t.recordedXHRs.push(e),(i.length<t.baseURL.length||i.substring(0,t.baseURL.length)!==t.baseURL)&&(n.url=t.baseURL+n.url),E.test(i)?o=d.xhr(n):(o=t.authorize().then(function(e){return t.checkChannelEncryption(e,n)}),o=o.then(function(){return t.authorize().then(function(e){var t=e.authHeader();return t&&(n.headers.Authorization=t),d.xhr(n)})}).catch(function(n){var i="";if(401===n.status){if(t.allowSessionPersistent&&localStorage.removeItem(t.__sessionPersistKey),u.logDebug("unauth: %o",n),t.isAuthorized()&&t.authorizationClear(),!n.config.url||!/\/logout/.test(n.config.url))return d.xhr.allowRequestReiteration(),t.xhr(e);t.lastLoginName=""}if(n.data&&n.data.hasOwnProperty("errCode")){var o=n.data.errCode,a=i=n.data.errMsg;if(/<<<.*>>>/.test(i)&&(i=c(r(i))),72===o&&t.emit("passwordExpired",t))throw new u.UBAbortError;throw new u.UBError(i,a,o)}throw n})),o},o.prototype.getAppInfo=function(){var e=this;return e.get("getAppInfo").then(function(t){var n=t.data;return Object.defineProperty(e,"trafficEncryption",{enumerable:!0,writable:!1,value:n.trafficEncryption||!1}),Object.defineProperty(e,"serverCertificate",{enumerable:!0,writable:!1,value:n.serverCertificate||""}),Object.defineProperty(e,"encryptionKeyLifetime",{enumerable:!0,writable:!1,value:n.encryptionKeyLifetime||0}),Object.defineProperty(e,"authMethods",{enumerable:!0,writable:!1,value:n.authMethods}),Object.defineProperty(e,"simpleCertAuth",{enumerable:!0,writable:!1,value:n.simpleCertAuth||!1}),Object.defineProperty(e,"supportedWSProtocols",{enumerable:!0,writable:!1,value:n.supportedWSProtocols||[]}),Object.defineProperty(e,"serverVersion",{enumerable:!0,writable:!1,value:n.serverVersion||""}),u.apply(e.appConfig,n.uiSettings.adminUI),n})},o.prototype.getDomainInfo=function(){var e=this;return e.get("getDomainInfo",{params:{v:4,userName:this.userLogin()}}).then(function(t){var n=t.data,i=new p(n);return e.domain=i,i})},o.prototype.processBuffer=function e(){var t=this._bufferedRequests;this._bufferTimeoutID=0,this._bufferedRequests=[],this.post("ubql",s.map(t,"request")).then(function(e){t.forEach(function(t,n){t.deferred.resolve(e.data[n])})},function(e){t.forEach(function(t){t.deferred.reject(e)})})},o.prototype.query=function e(t,n){var i=this;return n?(this._bufferTimeoutID||(this._bufferTimeoutID=setTimeout(i.processBuffer.bind(i),20)),new Promise(function(e,n){i._bufferedRequests.push({request:t,deferred:{resolve:e,reject:n}})})):i.post("ubql",[t]).then(function(e){return e.data[0]})},o.prototype.run=o.prototype.query,o.prototype.convertResponseDataToJsTypes=function(e){if(e.entity&&e.resultData&&!e.resultData.notModified&&e.resultData.fields&&e.resultData.data&&e.resultData.data.length){var t=this.domain.get(e.entity).getConvertRules(e.resultData.fields),n=t.length,i=e.resultData.data;if(n)for(var r=0,o=i.length;r<o;r++)for(var a=0;a<n;a++){var s=t[a].index;i[r][s]=t[a].convertFn(i[r][s])}}return e.resultLock&&e.resultLock.lockTime&&(e.resultLock.lockTime=u.iso8601Parse(e.resultLock.lockTime)),e},o.prototype.doFilterAndSort=function(e,t){return h.doFilterAndSort(e,t)},o.prototype.addNew=function(e){var t=this;return e.method="addnew",t.query(e,!0).then(t.convertResponseDataToJsTypes.bind(t))},o.prototype.invalidateCache=function(e){var t=this,n=t.domain.get(e.entity).cacheType;return n===m.cacheTypes.none?e:t.cacheOccurrenceRefresh(e.entity,n).then(function(){return e})},o.prototype.update=function(e,t){var n=this;return e.method=e.method||"update",n.query(e,t).then(n.convertResponseDataToJsTypes.bind(n)).then(n.invalidateCache.bind(n))},o.prototype.insert=function(e,t){var n=this;return e.method=e.method||"insert",n.query(e,t).then(n.convertResponseDataToJsTypes.bind(n)).then(n.invalidateCache.bind(n))},o.prototype.doDelete=function(e,t){var n=this;return e.method=e.method||"delete",n.query(e,t).then(n.invalidateCache.bind(n))},o.prototype.select=function(e,t){var n=this,i=void 0;t=t||!0===e.__mip_disablecache;var r=t||e.ID||e.bypassCache?m.cacheTypes.None:n.domain.get(e.entity).cacheType;return e.method||(e.method="select"),r!==m.cacheTypes.None?this._doSelectForCacheableEntity(e,r):i=this.query(e,!0).then(this.convertResponseDataToJsTypes.bind(this)).then(function(t){var n={};if(u.apply(n,t),t.__totalRecCount)n.total=t.__totalRecCount;else if(t.resultData&&t.resultData.data){var i=t.resultData.data.length;if(e.options){var r=e.options||{},o=r.start?r.start:0,a=r.limit||0;n.total=i<a?o+i:-1}else n.total=i}return n})},o.prototype._doSelectForCacheableEntity=function(e,t){var n=this,i=this.cacheKeyCalculate(e.entity,e.fieldList),r=t===m.cacheTypes.Session?m.SESSION:m.PERMANENT;return this.cache.get(i+":v",r).then(function(o){var a=void 0;if(!o||o&&t===m.cacheTypes.Entity||o&&t===m.cacheTypes.SessionEntity&&n.cachedSessionEntityRequested[i]!==o){var s={};Object.keys(e).forEach(function(t){-1===["whereList","orderList","options"].indexOf(t)&&(s[t]=e[t])}),s.version=o||"-1";a=(n._pendingCachedEntityRequests[i]?n._pendingCachedEntityRequests[i]:n._pendingCachedEntityRequests[i]=n.query(s,!0)).then(function(e){return delete n._pendingCachedEntityRequests[i],e},function(e){throw delete n._pendingCachedEntityRequests[i],e}).then(n.convertResponseDataToJsTypes.bind(n)).then(function(e){return n._cacheVersionedResponse(e,r,i)})}else a=n.cache.get(i,r);return a}).then(function(t){return n.doFilterAndSort(t,e)})},o.prototype._cacheVersionedResponse=function(e,t,n){var i=this;return e.resultData.notModified?(this.cachedSessionEntityRequested[n]=e.version,this.cache.get(n,t)):this.cache.put([{key:n+":v",value:e.version},{key:n,value:e.resultData}],t).then(function(){return i.cachedSessionEntityRequested[n]=e.version,e.resultData})},o.selectResultToArrayOfObjects=h.selectResultToArrayOfObjects,o.prototype.runTrans=function e(t){return this.post("ubql",t).then(function(e){return e.data})};var U=["entity","attribute","ID","id","isDirty","forceMime","fileName","store","revision"];o.prototype.getDocument=function(e,t){var n=s.defaults({},t),i={url:"getDocument",method:n.bypassCache?"POST":"GET"};return t&&t.resultIsBinary&&(i.responseType="arraybuffer"),n.bypassCache?(i.data=s.clone(e),Object.keys(i.data).forEach(function(e){-1===U.indexOf(e)&&(delete i.data[e],u.logDebug('invalid parameter "'+e+'" passed to getDocument request'))})):i.params=e,this.xhr(i).then(function(e){return e.data})},o.prototype.hexa8=f.prototype.hexa8,o.prototype.crc32=f.prototype.crc32,o.prototype.logout=function(){if(this.allowSessionPersistent&&localStorage.removeItem(this.__sessionPersistKey),!this.isAuthorized())return Promise.resolve(!0);var e=this.post("logout",{});if(this._pki){var t=this;e=e.then(function(){return new Promise(function(e){setTimeout(function(){t._pki.closePK(),e(!0)},20)})})}return e},o.prototype.serverErrorCodes={1:"ubErrNotImplementedErrnum",2:"ubErrRollbackedErrnum",3:"ubErrNotExecutedErrnum",4:"ubErrInvaliddataforrunmethod",5:"ubErrInvaliddataforrunmethodlist",6:"ubErrNoMethodParameter",7:"ubErrMethodNotExist",8:"ubErrElsAccessDeny",9:"ubErrElsInvalidUserOrPwd",10:"ubErrElsNeedAuth",11:"ubErrNoEntityParameter",13:"ubErrNoSuchRecord",14:"ubErrInvalidDocpropFldContent",15:"ubErrEntityNotExist",16:"ubErrAttributeNotExist",17:"ubErrNotexistEntitymethod",18:"ubErrInvalidSetdocData",19:"ubErrSoftlockExist",20:"ubErrNoErrorDescription",21:"ubErrUnknownStore",22:"ubErrObjdatasrcempty",23:"ubErrObjattrexprbodyempty",24:"ubErrNecessaryfieldNotExist",25:"ubErrRecordmodified",26:"ubErrNotexistnecessparam",27:"ubErrNotexistfieldlist",28:"ubErrUpdaterecnotfound",29:"ubErrNecessaryparamnotexist",30:"ubErrInvalidstoredirs",31:"ubErrNofileinstore",32:"ubErrAppnotsupportconnection",33:"ubErrAppnotsupportstore",34:"ubErrDeleterecnotfound",35:"ubErrNotfoundlinkentity",36:"ubErrEntitynotcontainmixinaslink",37:"ubErrEssnotinherfromessaslink",38:"ubErrInstancedatanameisreadonly",39:"ubErrManyrecordsforsoftlock",40:"ubErrNotfoundidentfieldsl",41:"ubErrInvalidlocktypevalue",42:"ubErrLockedbyanotheruser",43:"ubErrInvalidwherelistinparams",44:"ubErrRecnotlocked",45:"ubErrManyrecordsforchecksign",46:"ubErrNotfoundparamnotrootlevel",47:"ubErrCantcreatedirlogmsg",48:"ubErrCantcreatedirclientmsg",49:"ubErrConnectionNotExist",50:"ubErrDirectUnityModification",51:"ubErrCantdelrecthisvalueusedinassocrec",52:"ubErrAssocattrnotfound",53:"ubErrAttrassociationtoentityisempty",54:"ubErrNotfoundconforentityinapp",55:"ubErrNewversionrecnotfound",56:"ubErrElsAccessDenyEntity",57:"ubErrAlsAccessDenyEntityattr",58:"ubErrDatastoreEmptyentity",67:"ubErrTheServerHasExceededMaximumNumberOfConnections",69:"ubErrFtsForAppDisabled",72:"ubErrElsPwdIsExpired",73:"ELS_USER_NOT_FOUND",74:"VALUE_MUST_ME_UNIQUE"},o.prototype.serverErrorByCode=function(e){return this.serverErrorCodes[e]},o.prototype.Repository=function(e){return new x(this,e)},o.prototype.SHA256=y;var I="undefined"!=typeof window&&window.localStorage;e.exports={UBConnection:o,connect:a}},function(e,t){function n(e,t,n){var r=e,a=i(r.result.split("+")[0]),s=r.uData?JSON.parse(r.uData):{lang:"en",login:"anonymous"},l=r.result,u=t||"",c="undefined"!=typeof ncrc32?ncrc32(0,l+u):null;s.login||(s.login=r.logonname),Object.defineProperty(this,"sessionID",{enumerable:!0,writable:!1,value:a}),this.logonname=r.logonname,this.userData=s,this.authSchema=n||"UB",this.signature=function(){switch(this.authSchema){case"None":return"";case"UBIP":return this.logonname;default:var e=Math.floor((new Date).getTime()/1e3),t=i(e);return a+t+i("undefined"!=typeof ncrc32?ncrc32(c,t):o(l+u+t))}},this.isAnonymous=function(){return"None"===this.authSchema},this.authHeader=function(){return this.isAnonymous()?"":("Negotiate"===this.authSchema?"UB":this.authSchema)+" "+this.signature()}}n.prototype.hexa8=function e(t){for(var n=parseInt(t,10),i=isNaN(n)?"00000000":n.toString(16);i.length<8;)i="0"+i;return i};var i=n.prototype.hexa8,r={};n.prototype.crc32=function e(t,n,i,o){t+="",n=n||79764919,i=i||4294967295,o=o||4294967295;var a=i,s=r[n];s||(s=r[n]=function e(){var t=void 0,i=void 0,r=void 0,o=[],a=function e(t,n){for(var i=0;n;)i=2*i+t%2,t/=2,t-=t%1,n--;return i};for(t=255;t>=0;t--){for(r=a(t,32),i=0;i<8;i++)r=(2*r^(r>>>31)%2*n)>>>0;o[t]=a(r,32)}return o}());for(var l=0,u=t.length;l<u;l++){var c=t.charCodeAt(l);if(c>255)throw new RangeError;a=(a/256^s[a%256^c])>>>0}return(a^o)>>>0};var o=n.prototype.crc32;e.exports=n},function(e,t,n){function i(e){function t(e){l&&(f=new WebSocket(d+"?SESSION_SIGNATURE="+e.signature(),"ubNotifier"),f.onopen=function(e){u("connected to",e.target.url,"protocol:",e.target.protocol),i.emit("connected",e.target.url,e.target.protocol)},f.onmessage=function(e){var t;u("Got a raw data",e.data);try{t=JSON.parse(e.data)}catch(t){console.error("ubNotifier: Invalid command from server:",e.data)}var n=t.command,r=t.params,o;switch(u("Got a command",n,"with params",r),n){case"accepted":for(h=!0;(o=p.shift())&&h;)i.sendCommand(o.command,o.params);p=[],i.emit("accepted",r.connectionID);break;case"error":u("Got an error from server",r),i.emit("error",r);break;default:u("Emit event ",n,"with params",r),i.emit(n,r)}},f.onclose=function(e){h=!1,u("Connection closed. Code:",e.code,"Reason:",e.reason),i.emit("disconnected",e.code,e.reason)})}function n(n,i){h=!1,-1!==e.supportedWSProtocols.indexOf(a)?t(i):console.warn("ubNotifier: protocol not supported")}var i=this,l=-1!==e.supportedWSProtocols.indexOf(a)&&"undefined"!=typeof WebSocket;this.supported=l,o.call(this),r.assign(this,o.prototype);var u=function e(){},c=!1;Object.defineProperty(i,"debugMode",{get:function e(){return c},set:function e(t){c!==t&&(c=t,u=c?console.debug.bind(console,"ubNotifier"):function(){})},enumerable:!0,configurable:!0});var d="ws"+e.serverUrl.slice(4)+"ws",f=null,h=!1,p=[];this.sendCommand=function(e,t){l&&(h?f.send(JSON.stringify({command:e,params:t})):(p.push({command:e,params:t}),p.length>s&&p.shift()))},e.on("authorized",n)}var r=n(1),o=n(20),a="ubNotifier",s=100;e.exports=i},function(e,t,n){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}for(var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=(function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}()),a=n(1),s=/\[.*]/,l={equal:"isNull",notEqual:"notIsNull",custom:"custom"},u=[],c=0;c<100;c++)u.push("c"+c);var d=function(){function e(t){i(this,e),this.fieldList=[],this.groupList=[],this.whereList={},this._whereLength=0,this.logicalPredicates=[],this.joinAs=[],this.orderList=[],this.options={},this.method="select",this.__description="",this.__misc={},this.entityName=t}return o(e,[{key:"using",value:function e(t){return this.method=t,this}},{key:"attrs",value:function e(t){for(var n=arguments.length,i=0;i<n;i++){var r=arguments[i];Array.isArray(r)?this.fieldList=this.fieldList.concat(r):this.fieldList.push(r)}return this}},{key:"where",value:function t(n,i,o,c){var d=void 0;if(!c)for(c=u[++this._whereLength];this.whereList[c];)c+="_";var f=i,h=e.prototype.WhereCondition;if(i=h[i],n&&"custom"!==i&&!s.test(n)&&(n="["+n+"]"),!i)throw Error("Unknown conditions");if(("in"===i||"notIn"===i)&&o instanceof e)d=i,i="subquery",o=o.ubql();else if("subquery"===i)d=f,o instanceof e&&(o=o.ubql());else if("in"!==i&&"notIn"!==i||null!==o&&void 0!==o)if("in"!==i||Array.isArray(o))if("in"!==i||o&&o.length)if("notIn"!==i||o&&o.length){if(null===o&&("isNull"!==i||"notIsNull"!==i)){var p=i;if(o=void 0,!(i=l[p]))throw Error("Condition "+p+"is passed to CustomRepository.where but value is null");console.warn("Condition "+p+"is passed to CustomRepository.where but value is null -> condition transformed to "+i+". Check your logic")}}else console.warn('Condition "notIn" is passed to CustomRepository.where but value is empty array -> condition transformed to "1=1". Check your logic'),n="1",i=h.equal,o={a:1};else console.warn('Condition "in" is passed to CustomRepository.where but value is empty array -> condition transformed to "0=1". Check your logic'),n="0",i=h.equal,o={a:1};else console.debug('Condition "in" is passed to CustomRepository.where but values is not an array -> condition transformed to equal. Check your logic'),i=h.equal;else console.warn('Condition "in" is passed to CustomRepository.where but values is null or undefined -> condition transformed to (0=1). Check your logic'),n="0",i=h.equal,o={a:1};if("in"===i&&1===o.length&&(i=h.equal,o=o[0]),void 0!==o&&("object"!==(void 0===o?"undefined":r(o))||Array.isArray(o)||a.isDate(o))){var m={};m[c]=o,o=m}var g={expression:n,condition:i};return"subquery"===i&&(g.subQueryType=d),void 0!==o&&(g.values=o),this.whereList[c]=g,this}},{key:"exists",value:function e(t,n){return this.where("","exists",t,n)}},{key:"notExists",value:function e(t,n){return this.where("","notExists",t,n)}},{key:"correlation",value:function e(t,n,i,r){return s.test(t)||(t="["+t+"]"),i||(i="="),this.where(t+i+"[{master}."+n+"]","custom",void 0,r)}},{key:"logic",value:function e(t){return this.logicalPredicates.push(t),this}},{key:"join",value:function e(t){return this.joinAs.push(t),this}},{key:"joinCondition",value:function e(t,n,i,r){if(!r)for(r=u[++this._whereLength];this.whereList[r];)r+="_";return this.where(t,n,i,r),this.joinAs.push(r),this}},{key:"orderBy",value:function e(t,n){return n=n||"asc",this.orderList.push({expression:t,order:n}),this}},{key:"orderByDesc",value:function e(t){return this.orderList.push({expression:t,order:"desc"}),this}},{key:"groupBy",value:function e(t){return Array.isArray(t)?this.groupList=this.groupList.concat(t):a.isString(t)&&this.groupList.push(t),this}},{key:"start",value:function e(t){return this.options.start=t,this}},{key:"limit",value:function e(t){return this.options.limit=t,this}},{key:"describe",value:function e(t){return this.__description=t,this}},{key:"ubql",value:function e(){var t=this.orderList.length,n={entity:this.entityName,method:this.method,fieldList:this.fieldList};if(this.groupList.length>0&&(n.groupList=this.groupList),Object.keys(this.whereList).length&&(n.whereList=this.whereList),t>0){n.orderList={};for(var i=0;i<t;i++)n.orderList[i]=this.orderList[i]}return Object.keys(this.options).length&&(n.options=this.options),this.logicalPredicates.length&&(n.logicalPredicates=this.logicalPredicates),this.joinAs.length&&(n.joinAs=this.joinAs),a.defaults(n,this.__misc),n}},{key:"selectAsObject",value:function e(){throw Error("abstract")}},{key:"selectAsArray",value:function e(){throw Error("abstract")}},{key:"selectAsStore",value:function e(t){throw Error("abstract")}},{key:"select",value:function e(t){throw Error("abstract")}},{key:"selectSingle",value:function e(){throw Error("abstract")}},{key:"selectScalar",value:function e(){throw Error("abstract")}},{key:"selectById",value:function e(t){throw Error("abstract")}},{key:"misc",value:function e(t){return a.assign(this.__misc,t),this}},{key:"withTotal",value:function e(){return this.options.totalRequired=!0,this}}]),e}();d.prototype.getRunListItem=d.prototype.ubql,d.prototype.ubRequest=d.prototype.ubql,d.prototype.WhereCondition={gt:"more",">":"more",more:"more",lt:"less","<":"less",less:"less",eq:"equal","=":"equal",equal:"equal",ge:"moreEqual",geq:"moreEqual",">=":"moreEqual",moreEqual:"moreEqual",le:"lessEqual",leq:"lessEqual","<=":"lessEqual",lessEqual:"lessEqual",ne:"notEqual",neq:"notEqual","<>":"notEqual","!=":"notEqual","!==":"notEqual",notEqual:"notEqual",contains:"like",like:"like",notContains:"notLike",notLike:"notLike",isNull:"isNull",null:"isNull",notNull:"notIsNull",notIsNull:"notIsNull",isNotNull:"notIsNull",beginWith:"startWith",startWith:"startWith",startsWith:"startWith",startswith:"startWith",notBeginWith:"notStartWith",notStartWith:"notStartWith",notStartsWith:"notStartWith",includes:"in",in:"in",notIncludes:"notIn",notIn:"notIn",match:"match",subquery:"subquery",exists:"subquery",notExists:"subquery",custom:"custom"},e.exports=d},function(e,t){function n(e,t){var n=void 0;return n=o[e]?o[e]:o[e]=new Promise(function(n,i){var s=null,l=/\.css(?:\?|$)/.test(e);l?(s=document.createElement("link"),s.rel="stylesheet",s.async=!0):(s=document.createElement("script"),s.type="text/javascript",t&&(s.charset=t),s.async=!0),s.onerror=function(t){var n="Required "+(t.target.href||t.target.src)+" is not accessible";delete o[e],s.onerror=s.onload=s.onreadystatechange=null,i(Error(n))},s.onload=function(){s.onerror=s.onload=s.onreadystatechange=null,setTimeout(function(){var e=s;n(),e.parentNode&&!e.rel&&(e.parentNode.removeChild(s),s=null)},0)},a.appendChild(s),l?s.href=r(e):s.src=r(e)})}function i(e){var t=l.test(e)?l.exec(e)[1]:"_web";return s&&s[t]?"?ubver="+s[t]:""}function r(e){var t=i(e);return t?e+t:e}var o={},a="undefined"!=typeof document&&document.getElementsByTagName("head")[0],s="undefined"!=typeof window&&window.__ubVersion,l=RegExp("models/(.+?)/");e.exports={inject:n,addResourceVersion:r}},function(e,t,n){function i(e){var t=this,n=0;if(t.getMessageId=function(){return"m"+ ++n},t._cfg=Object.assign({},e),++i.prototype.idCounter,t.id="UBPlugin"+i.prototype.idCounter,t.pendingMessages={},!t._cfg.host)throw Error("Host not defined in UBNativeMessage feature config");if(l.call(t),u.assign(t,l.prototype),t.featureVersion="",t.callTimeOut=3e4,a.isSecureBrowser)t.eventElm={},l.call(t.eventElm),u.assign(t.eventElm,l.prototype),t.eventElm.addEventListener=t.eventElm.addListener;else if(t.eventElm=document.getElementById("ubExtensionPageMessageObj"),!(t.eventElm||window.parent&&window.parent!==window))throw Error('Message exchange element with id="ubExtensionPageMessageObj" not found');t.onContentMessage=function(e){var n=e.detail;if(n&&n.hasOwnProperty("msgType")&&n.hasOwnProperty("messageID")&&n.hasOwnProperty("clientID")||console.error("Empty or invalid content message"),n.clientID===t.id){var i=n.messageID,r=n.msgType,o=n.data,s=t.pendingMessages[i];if(s&&clearTimeout(s.timerID),"disconnected"===r)s&&(delete t.pendingMessages[i],s.deffer.resolve(o)),t.doOnDisconnect(o);else if("notify"===r)!s&&t.onMessage?t.onMessage(o):(s.timerID=setTimeout(function(){t.onMsgTimeOut(i)},s.timeoutValue),t.emit("notify",t,o,i));else if(s)if("resolve"===r)if(n.hasOwnProperty("part")&&n.hasOwnProperty("totalParts")){var l=n.totalParts,c=n.part;if(s.partials){if(l!==s.partials.length||c>=l)throw s.deffer.reject("Invalid part count"),delete t.pendingMessages[i],Error("Invalid part count")}else{if(l>100)throw s.deffer.reject(new a.UBError("unknownError","UBNativeMessage. Result exceed 100Mb limit")),delete t.pendingMessages[i],Error(new a.UBError("unknownError","UBNativeMessage. Result exceed 100Mb limit"));s.partials=Array(l)}s.partials[c]=o,-1===u.indexOf(s.partials,void 0)?(o=s.partials.join(""),delete t.pendingMessages[i],"{"!==o.charAt(0)&&"["!==o.charAt(0)||(o=JSON.parse(o)),s.deffer.resolve(o)):s.timerID=setTimeout(function(){t.onMsgTimeOut(i)},s.timeoutValue)}else delete t.pendingMessages[i],s.deffer.resolve(o);else{if("reject"!==r)throw Error("UBNativeMessage. Invalid msgType type in: "+n);delete t.pendingMessages[i];var d=!1;/<<<.*>>>/.test(o)&&(o=o.match(/<<<(.*)>>>/)[1],d=!0);var f=d?new a.UBError(o):new a.UBError("unknownError",o);s.deffer.reject(f)}else console.error("UBNativeMessage. unknown messageID:"+i)}},t.eventElm.addEventListener("UBExtensionMsg",t.onContentMessage),t.onDisconnected=null,t.onMessage=null}function r(e){var t=e.split(".");if(t.length>4)throw Error("Invalid version number "+e);for(var n=1,i=0,r=t.length,o=r-1;o>=0;o--)i+=parseInt(t[o],10)*n,n*=o===r-1?1e4:1e3;return i}function o(e,t,n){var i=a.format(e.installer,e.minVersion),r="NM"+(n?"Update":"Install")+("none"===e.host?"Extension"+(a.isOpera?"Opera":"Chrome"):"Feature");return a.format(s(r),s(e.UIName),e.minVersion,t,i)}var a=n(11),s=n(19).i18n,l=n(20),u=n(1),c={host:"none",UIName:"NMUBExtension",minVersion:"1.0.0",installer:"pgffhmifenmomiabibdpnceahangimdi"};i.prototype.invoke=function(e,t,n){var i=this;if(!i.connected&&"__"!==e.substr(0,2))return Promise.reject(new a.UBError("unknownError","UBNativeMessage. Not connected. call connect() first"));n=n||i.callTimeOut;var r=i.getMessageId(),o={clientID:i.id,messageID:r,method:e,params:t};return new Promise(function(e,t){i.pendingMessages[r]={request:null,deffer:{resolve:e,reject:t},timerID:setTimeout(function(){i.onMsgTimeOut(r)},n),partials:null,timeoutValue:n||i.callTimeOut,stTime:(new Date).getTime()},i.iFarmeMode?window.parent.postMessage({detail:o,messageType:"UBPageMsg"},"*"):i.eventElm.dispatchEvent(new CustomEvent("UBPageMsg",{detail:o}))})},i.extensionExists=function(){if(a.isSecureBrowser)return!0;var e=document.getElementById("ubExtensionPageMessageObj");return!(!window.parent||window.parent===window)||!!e&&"YES"===e.getAttribute("data-extensionAttached")},i.prototype.doOnDisconnect=function(e){var t=this,n=t.pendingMessages;t.pendingMessages={},t.connected=!1,n&&u.forEach(n,function(t){t&&t.deffer&&t.deffer.reject(e)})},i.prototype.onParentWinMessage=function(e){e.data&&"UBExtensionMsg"===e.data.messageType&&this.onContentMessage(e.data)},i.prototype.connect=function(e){var t=this,n=void 0;return t.connected?Promise.resolve(t):i.extensionExists()?(n=window.parent&&window.parent!==window?new Promise(function(e,n){var i=void 0,r=function r(s){return s.data&&"initUbExtensionParent"===s.data.messageType?(clearTimeout(i),"initUbExtensionReady"!==s.data.detail?(n(new a.UBError(o(c,"-",!1))),s):(t.iFarmeMode=!0,window.removeEventListener("message",r),window.addEventListener("message",t.onParentWinMessage.bind(t),!1),void e(!0))):s};window.addEventListener("message",r,!1),window.parent.postMessage({messageType:"initUbExtension"},"*"),i=setTimeout(function(){n(new a.UBError(o(c,"-",!1)))},1500)}):Promise.resolve(!0),n.then(function(){return t.invoke("__extensionVersion")}).then(function(e){var t=r(e);if(t<r(c.minVersion))throw a.logDebug("browser extension version",e,"is smaller when required",c.minVersion),new a.UBError(o("extension",e,!0));return t!==r(c.minVersion)&&a.logDebug("Current version of extension",e,"is more than required",c.minVersion),!0}).then(function(){return t.invoke("__connect",{hostAppName:t._cfg.host},e).then(function(e){var n=t._cfg.minVersion;if(t.connected=!0,t.featureVersion=e,r(e)<r(n))throw new a.UBError(o(t._cfg,e,!0));return e!==n&&a.logDebug("Current version of feature",t._cfg.host,e,"greater than the required",n),t},function(e){throw a.logError(e),new a.UBError(o(t._cfg,"-",!1))})}).catch(function(e){throw t.disconnect(),e})):Promise.reject(new a.UBError(o(c,"-",!1)))},i.prototype.disconnect=function(){var e=this;return e.connected?e.invoke("__disconnect").then(function(t){return a.logDebug("UBNativeMessage. Disconnected with message",t),e.connected=!1,e.eventElm&&e.eventElm.removeEventListener("UBExtensionMsg",e.onContentMessage),!0}):Promise.resolve(!0)},i.prototype.onMsgTimeOut=function(e){var t=this.pendingMessages[e];t&&(t.timerID=null,delete this.pendingMessages[e],t.deffer.reject(new a.UBError("unknownError","pluginMethodCallTimedOut")))},i.prototype.idCounter=0,e.exports=i},function(e,t,n){"use strict";(function(t){function i(e){return h.resolve(e)}function r(){!S&&"undefined"!=typeof window&&window.console&&(console.warn("[bluebird-Q] Unhandled rejection reasons (should be empty):"),U.forEach(function(e){console.warn(e)}),console.warn("[/bluebird-Q]")),S=!0}function o(){for(var e=0;e<U.length;e++){var t=U[e];console.warn("Unhandled rejection reason:",t)}}function a(){U.length=0,I.length=0,S=!1,k||(k=!0,void 0!==t&&t.on&&t.on("exit",o))}function s(e,t){k&&(I.push(e),t&&void 0!==t.stack?U.push(t.stack):U.push("(no stack) "+t),r())}function l(e){if(k){var t=I.indexOf(e);-1!==t&&(I.splice(t,1),U.splice(t,1))}}function u(){}function c(e,t,n){t=t===m?this:t;var r=i.defer();n.push(r.makeNodeResolver());try{e.apply(t,n)}catch(e){r.reject(e)}return r.promise}function d(e,t){return function(){return e.apply(t,arguments)}}function f(e){return e.isFulfilled()?{state:"fulfilled",value:e.value()}:e.isRejected()?{state:"rejected",reason:e.reason()}:{state:"pending"}}var h=n(58)(),p=n(29),m={},g={},y={thenReturn:"thenResolve",thenThrow:"thenReject",caught:"fail",lastly:"fin",call:"send mcall invoke".split(" ")},v={reject:"reject rejected".split(" "),resolve:"resolve resolved fulfill fulfilled".split(" "),is:"isPromise",race:"race",async:"coroutine",spawn:"spawn",delay:"delay",timeout:g,join:g,spread:g,tap:g,thenReject:g,thenResolve:g,isPending:g,isFulfilled:g,isRejected:g,get:g,set:g,del:g,delete:g,try:g,keys:g,allResolved:g,allSettled:g,fail:g,catch:g,fin:g,finally:g,done:g,nodeify:g,nfapply:g,nfcall:g,nfbind:g,npost:g,nsend:g,ninvoke:g,nbind:g,nmcall:g,fapply:g,fcall:g,fbind:g,denodeify:g,nmapply:g,mapply:g,post:g,send:g,mcall:g,invoke:g};i.all=h.all,i.Promise=function(e){var t=i.defer();try{e(t.resolve,t.reject,t.notify)}catch(e){t.reject(e)}return t.promise},i.promise=i.Promise,i.isPromiseAlike=function(e){return e instanceof h||h.resolve(e).isPending()};var b=h.map,x=h.resolve;i.promised=function(e){return function(){var t=[].slice.call(arguments);return t.unshift(this),b(t,x).then(function(t){return e.apply(t.shift(),t)})}},i.when=function(e,t,n,r){return i(e).then(t,n,r)},i.nearer=function(e){if(e instanceof h){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e},i.passByCopy=function(e){return e},i.defer=function(){var e={},t=new h(function(t,n){e.resolve=e.fulfill=t,e.reject=n});return e.promise=t,e.notify=d(t._progress,t),e.makeNodeResolver=function(){return function(t,n){return t?e.reject(t):arguments.length>2?e.resolve([].slice.call(arguments,1)):e.resolve(n)}},e},i.deferred=i.pending=i.defer,i.getBluebirdPromise=function(){return h},h.prototype.valueOf=h.prototype.value;var E=function(e){if(e instanceof Array)return h.all(e.map(function(e){return(e instanceof h?e:i(e)).reflect()}));if(e instanceof h)return e.then(function(e){return E(e)});throw Error("that must be a promise or an array")};h.prototype.allSettled=function(){return E(this).then(function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];if(i.isFulfilled())t.push({state:"fulfilled",value:i.value()});else{if(!i.isRejected())throw Error("The settled promise has to be fulfilled or rejected");t.push({state:"rejected",reason:i.reason()})}}return t})},h.prototype.allResolved=function(){return E(this).then(function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(r.isFulfilled())t.push(i(r.value()));else{if(!r.isRejected())throw Error("The settled promise has to be fulfilled or rejected");t.push(i.reject(r.reason()))}}return t})},h.prototype.join=function(e){return i([this,e]).spread(function(e,t){if(e===t)return e;throw Error("Can't join: not the same: "+e+" "+t)})},h.prototype.fbind=function(){var e=[].slice.call(arguments),t=this;return function(){var n=e.concat([].slice.call(arguments)),i=this;return t.then(function(e){return e.apply(i,n)})}},h.prototype.fapply=function(e){return this.then(function(t){return t.apply(void 0,e)})},h.prototype.try=h.prototype.fcall=function(){return this.fapply.call(this,[].slice.call(arguments))},h.prototype.nfapply=function(e){return this.then(function(t){return c(t,void 0,e)})},h.prototype.nfcall=function(){return this.nfapply.call(this,[].slice.call(arguments))},h.prototype.nfbind=h.prototype.denodeify=function(){var e=this,t=[].slice.call(arguments);return function(){var n=this,i=t.concat([].slice.call(arguments));return e.then(function(e){return c(e,n,i)})}},h.prototype.nbind=function(e){var t=this,n=[].slice.call(arguments,1);return function(){var i=n.concat([].slice.call(arguments));return t.then(function(t){return c(t,e,i)})}},h.prototype.npost=h.prototype.nmapply=function(e,t){return this.then(function(n){return c(n[e],n,t)})},h.prototype.ninvoke=h.prototype.nsend=h.prototype.nmcall=function(e){var t=[].slice.call(arguments,1);return this.then(function(n){return c(n[e],n,t)})},h.prototype.mapply=h.prototype.post=function(e,t){return e?(t.unshift(e),this.invoke.apply(this,t)):this.fapply(t)};var w=h.prototype.nodeify;h.prototype.nodeify=function(e){return"function"==typeof e?void w.call(this,e):this},h.prototype.inspect=function(){return this.isPending()?{state:"pending"}:this.isFulfilled()?{state:"fulfilled",value:this.value()}:{state:"rejected",reason:this.reason()}},h.prototype.passByCopy=function(){return this},h.prototype.set=function(e,t){return this.then(function(n){n[e]=t})},h.prototype.delete=h.prototype.del=function(e){return this.then(function(t){delete t[e]})},h.prototype.keys=function(){return this.then(function(e){return Object.keys(e)})},h.prototype.race=function(){return this.then(i.race)};var C=h.prototype.caught,_=h.prototype.timeout;h.prototype.timeout=function(e,t){var n=_.apply(this,arguments);return C.call(n,h.TimeoutError,function(e){if(e.code="ETIMEDOUT",t instanceof Error)throw t;throw e})},h.prototype.done=function(e,n,r){var o=function(e){var t=i.onerror,n=p(function(){if(a._attachExtraTrace(e),!t)throw e;t(e)});!0===p.isStatic&&"function"==typeof n&&n()},a=e||n||r?this.then(e,n,r):this;"object"==typeof t&&t&&t.domain&&(o=t.domain.bind(o)),a.then(void 0,o)};var B=p;Object.defineProperty(i,"nextTick",{get:function(){return p},set:function(e){"function"==typeof e?(p=e,h.setScheduler(e)):(p=B,h.setScheduler(B))}}),Object.defineProperty(i,"longStackSupport",{set:function(e){e&&h.longStackTraces()},get:function(){return h.haveLongStackTraces()}});var U=[],I=[],S=!1,k=!0;i.resetUnhandledRejections=a,i.getUnhandledReasons=function(){return U.slice()},i.stopUnhandledRejectionTracking=function(){a(),void 0!==t&&t.on&&t.removeListener("exit",o),k=!1},a(),h.onPossiblyUnhandledRejection(function(e,t){s(t,e)}),h.onUnhandledRejectionHandled(l),Object.keys(y).forEach(function(e){var t=y[e];Array.isArray(t)||(t=[t]),t.forEach(function(t){h.prototype[t]=h.prototype[e]})}),Object.keys(v).forEach(function(e){var t=v[e];if(t===g){if("function"!=typeof h.prototype[e])throw Error("unimplemented Promise.prototype."+e);i[e]=function(t){var n=i(t);return n[e].apply(n,[].slice.call(arguments,1))}}else Array.isArray(t)||(t=[t]),t.forEach(function(t){i[t]=h[e]})}),"object"==typeof t&&t&&t.env&&t.env.Q_DEBUG&&(i.longStackSupport=!0),u.prototype=i,u.prototype=h.prototype,e.exports=i}).call(t,n(5))},function(e,t,n){"use strict";(function(t){e.exports=function(){function i(){}function r(e,t){if(null==e||e.constructor!==o)throw new b("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof t)throw new b("expecting a function but got "+h.classString(t))}function o(e){e!==E&&r(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function a(e){this.promise._resolveCallback(e)}function s(e){this.promise._rejectCallback(e,!1)}function l(e){var t=new o(E);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var u=function(){return new b("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},c=function(){return new o.PromiseInspection(this._target())},d=function(e){return o.reject(new b(e))},f={},h=n(0),p;p=h.isNode?function(){var e=t.domain;return void 0===e&&(e=null),e}:function(){return null},h.notEnumerableProp(o,"_getDomain",p);var m=n(8),g=n(59),y=new g;m.defineProperty(o,"_async",{value:y});var v=n(6),b=o.TypeError=v.TypeError;o.RangeError=v.RangeError;var x=o.CancellationError=v.CancellationError;o.TimeoutError=v.TimeoutError,o.OperationalError=v.OperationalError,o.RejectionError=v.OperationalError,o.AggregateError=v.AggregateError;var E=function(){},w={},C={},_=n(62)(o,E),B=n(63)(o,E,_,d,i),U=n(64)(o),I=U.create,S=n(65)(o,U),k=S.CapturedTrace,D=n(66)(o,_,C),A=n(30)(C),T=n(31),P=h.errorObj,F=h.tryCatch;return o.prototype.toString=function(){return"[object Promise]"},o.prototype.caught=o.prototype.catch=function(e){var t=arguments.length;if(t>1){var n=Array(t-1),i=0,r;for(r=0;r<t-1;++r){var o=arguments[r];if(!h.isObject(o))return d("Catch statement predicate: expecting an object but got "+h.classString(o));n[i++]=o}return n.length=i,e=arguments[r],this.then(void 0,A(n,e,this))}return this.then(void 0,e)},o.prototype.reflect=function(){return this._then(c,c,void 0,this,void 0)},o.prototype.then=function(e,t){if(S.warnings()&&arguments.length>0&&"function"!=typeof e&&"function"!=typeof t){var n=".then() only accepts functions but was passed: "+h.classString(e);arguments.length>1&&(n+=", "+h.classString(t)),this._warn(n)}return this._then(e,t,void 0,void 0,void 0)},o.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},o.prototype.spread=function(e){return"function"!=typeof e?d("expecting a function but got "+h.classString(e)):this.all()._then(e,void 0,void 0,w,void 0)},o.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},o.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new B(this).promise()},o.prototype.error=function(e){return this.caught(h.originatesFromRejection,e)},o.getNewLibraryCopy=e.exports,o.is=function(e){return e instanceof o},o.fromNode=o.fromCallback=function(e){var t=new o(E);t._captureStackTrace();var n=arguments.length>1&&!!Object(arguments[1]).multiArgs,i=F(e)(T(t,n));return i===P&&t._rejectCallback(i.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},o.all=function(e){return new B(e).promise()},o.cast=function(e){var t=_(e);return t instanceof o||(t=new o(E),t._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},o.resolve=o.fulfilled=o.cast,o.reject=o.rejected=function(e){var t=new o(E);return t._captureStackTrace(),t._rejectCallback(e,!0),t},o.setScheduler=function(e){if("function"!=typeof e)throw new b("expecting a function but got "+h.classString(e));return y.setScheduler(e)},o.prototype._then=function(e,t,n,i,r){var a=void 0!==r,s=a?r:new o(E),l=this._target(),u=l._bitField;a||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===i&&0!=(2097152&this._bitField)&&(i=0!=(50397184&u)?this._boundValue():l===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s));var c=p();if(0!=(50397184&u)){var d,f,m=l._settlePromiseCtx;0!=(33554432&u)?(f=l._rejectionHandler0,d=e):0!=(16777216&u)?(f=l._fulfillmentHandler0,d=t,l._unsetRejectionIsUnhandled()):(m=l._settlePromiseLateCancellationObserver,f=new x("late cancellation observer"),l._attachExtraTrace(f),d=t),y.invoke(m,l,{handler:null===c?d:"function"==typeof d&&h.domainBind(c,d),promise:s,receiver:i,value:f})}else l._addCallbacks(e,t,s,i,c);return s},o.prototype._length=function(){return 65535&this._bitField},o.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},o.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},o.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},o.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},o.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},o.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},o.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},o.prototype._isFinal=function(){return(4194304&this._bitField)>0},o.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},o.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},o.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},o.prototype._setAsyncGuaranteed=function(){y.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},o.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==f)return void 0===t&&this._isBound()?this._boundValue():t},o.prototype._promiseAt=function(e){return this[4*e-4+2]},o.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},o.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},o.prototype._boundValue=function(){},o.prototype._migrateCallback0=function(e){var t=e._bitField,n=e._fulfillmentHandler0,i=e._rejectionHandler0,r=e._promise0,o=e._receiverAt(0);void 0===o&&(o=f),this._addCallbacks(n,i,r,o,null)},o.prototype._migrateCallbackAt=function(e,t){var n=e._fulfillmentHandlerAt(t),i=e._rejectionHandlerAt(t),r=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=f),this._addCallbacks(n,i,r,o,null)},o.prototype._addCallbacks=function(e,t,n,i,r){var o=this._length();if(o>=65531&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=i,"function"==typeof e&&(this._fulfillmentHandler0=null===r?e:h.domainBind(r,e)),"function"==typeof t&&(this._rejectionHandler0=null===r?t:h.domainBind(r,t));else{var a=4*o-4;this[a+2]=n,this[a+3]=i,"function"==typeof e&&(this[a+0]=null===r?e:h.domainBind(r,e)),"function"==typeof t&&(this[a+1]=null===r?t:h.domainBind(r,t))}return this._setLength(o+1),o},o.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},o.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(u(),!1);var n=_(e,this);if(!(n instanceof o))return this._fulfill(e);t&&this._propagateFrom(n,2);var i=n._target();if(i===this)return void this._reject(u());var r=i._bitField;if(0==(50397184&r)){var a=this._length();a>0&&i._migrateCallback0(this);for(var s=1;s<a;++s)i._migrateCallbackAt(this,s);this._setFollowing(),this._setLength(0),this._setFollowee(i)}else if(0!=(33554432&r))this._fulfill(i._value());else if(0!=(16777216&r))this._reject(i._reason());else{var l=new x("late cancellation observer");i._attachExtraTrace(l),this._reject(l)}}},o.prototype._rejectCallback=function(e,t,n){var i=h.ensureErrorObject(e),r=i===e;if(!r&&!n&&S.warnings()){var o="a promise was rejected with a non-error: "+h.classString(e);this._warn(o,!0)}this._attachExtraTrace(i,!!t&&r),this._reject(e)},o.prototype._resolveFromExecutor=function(e){if(e!==E){var t=this;this._captureStackTrace(),this._pushContext();var n=!0,i=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,n)});n=!1,this._popContext(),void 0!==i&&t._rejectCallback(i,!0)}},o.prototype._settlePromiseFromHandler=function(e,t,n,i){var r=i._bitField;if(0==(65536&r)){i._pushContext();var o;t===w?n&&"number"==typeof n.length?o=F(e).apply(this._boundValue(),n):(o=P,o.e=new b("cannot .spread() a non-array: "+h.classString(n))):o=F(e).call(t,n);var a=i._popContext();r=i._bitField,0==(65536&r)&&(o===C?i._reject(n):o===P?i._rejectCallback(o.e,!1):(S.checkForgottenReturns(o,a,"",i,this),i._resolveCallback(o)))}},o.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},o.prototype._followee=function(){return this._rejectionHandler0},o.prototype._setFollowee=function(e){this._rejectionHandler0=e},o.prototype._settlePromise=function(e,t,n,r){var a=e instanceof o,s=this._bitField,l=0!=(134217728&s);0!=(65536&s)?(a&&e._invokeInternalOnCancel(),n instanceof D&&n.isFinallyHandler()?(n.cancelPromise=e,F(t).call(n,r)===P&&e._reject(P.e)):t===c?e._fulfill(c.call(n)):n instanceof i?n._promiseCancelled(e):a||e instanceof B?e._cancel():n.cancel()):"function"==typeof t?a?(l&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,n,r,e)):t.call(n,r,e):n instanceof i?n._isResolved()||(0!=(33554432&s)?n._promiseFulfilled(r,e):n._promiseRejected(r,e)):a&&(l&&e._setAsyncGuaranteed(),0!=(33554432&s)?e._fulfill(r):e._reject(r))},o.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,n=e.promise,i=e.receiver,r=e.value;"function"==typeof t?n instanceof o?this._settlePromiseFromHandler(t,i,r,n):t.call(i,r,n):n instanceof o&&n._reject(r)},o.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},o.prototype._settlePromise0=function(e,t,n){var i=this._promise0,r=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(i,e,r,t)},o.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},o.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var n=u();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=e,(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():y.settlePromises(this))}},o.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return y.fatalError(e,h.isNode);(65535&t)>0?y.settlePromises(this):this._ensurePossibleRejectionHandled()}},o.prototype._fulfillPromises=function(e,t){for(var n=1;n<e;n++){var i=this._fulfillmentHandlerAt(n),r=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(r,i,o,t)}},o.prototype._rejectPromises=function(e,t){for(var n=1;n<e;n++){var i=this._rejectionHandlerAt(n),r=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(r,i,o,t)}},o.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(t>0){if(0!=(16842752&e)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,e),this._rejectPromises(t,n)}else{var i=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,i,e),this._fulfillPromises(t,i)}this._setLength(0)}this._clearCancellationData()},o.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},o.defer=o.pending=function(){return S.deprecated("Promise.defer","new Promise"),{promise:new o(E),resolve:a,reject:s}},h.notEnumerableProp(o,"_makeSelfResolutionError",u),n(67)(o,E,_,d,S),n(68)(o,E,_,S),n(69)(o,B,d,S),n(70)(o),n(71)(o),n(72)(o,B,_,E,y,p),o.Promise=o,o.version="3.5.0",n(73)(o,B,d,_,E,S),n(74)(o),n(75)(o,d,_,I,E,S),n(76)(o,E,S),n(77)(o,d,E,_,i,S),n(78)(o),n(79)(o,E),n(80)(o,B,_,d),n(81)(o,E,_,d),n(82)(o,B,d,_,E,S),n(83)(o,B,S),n(84)(o,B,d),n(85)(o,E),n(86)(o,E),n(87)(o),h.toFastProperties(o),h.toFastProperties(o.prototype),l({a:1}),l({b:2}),l({c:3}),l(1),l(function(){}),l(void 0),l(!1),l(new o(E)),S.setBounds(g.firstLineError,h.lastLineError),o}}).call(t,n(5))},function(e,t,n){"use strict";(function(t){function i(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new u(16),this._normalQueue=new u(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=l}function r(e,t,n){this._lateQueue.push(e,t,n),this._queueTick()}function o(e,t,n){this._normalQueue.push(e,t,n),this._queueTick()}function a(e){this._normalQueue._pushOne(e),this._queueTick()}var s;try{throw Error()}catch(e){s=e}var l=n(29),u=n(61),c=n(0);i.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},i.prototype.hasCustomScheduler=function(){return this._customScheduler},i.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},i.prototype.disableTrampolineIfNecessary=function(){c.hasDevTools&&(this._trampolineEnabled=!1)},i.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},i.prototype.fatalError=function(e,n){n?(t.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),t.exit(2)):this.throwLater(e)},i.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},c.hasDevTools?(i.prototype.invokeLater=function(e,t,n){this._trampolineEnabled?r.call(this,e,t,n):this._schedule(function(){setTimeout(function(){e.call(t,n)},100)})},i.prototype.invoke=function(e,t,n){this._trampolineEnabled?o.call(this,e,t,n):this._schedule(function(){e.call(t,n)})},i.prototype.settlePromises=function(e){this._trampolineEnabled?a.call(this,e):this._schedule(function(){e._settlePromises()})}):(i.prototype.invokeLater=r,i.prototype.invoke=o,i.prototype.settlePromises=a),i.prototype._drainQueue=function(e){for(;e.length()>0;){var t=e.shift();if("function"==typeof t){var n=e.shift(),i=e.shift();t.call(n,i)}else t._settlePromises()}},i.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},i.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},i.prototype._reset=function(){this._isTickUsed=!1},e.exports=i,e.exports.firstLineError=s}).call(t,n(5))},function(e,t,n){(function(e,t){!function(e,n){"use strict";function i(e){"function"!=typeof e&&(e=Function(""+e));for(var t=Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var i={callback:e,args:t};return p[h]=i,y(h),h++}function r(e){delete p[e]}function o(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i)}}function a(e){if(m)setTimeout(a,0,e);else{var t=p[e];if(t){m=!0;try{o(t)}finally{r(e),m=!1}}}}function s(){y=function(e){t.nextTick(function(){a(e)})}}function l(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}function u(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&a(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),y=function(n){e.postMessage(t+n,"*")}}function c(){var e=new MessageChannel;e.port1.onmessage=function(e){a(e.data)},y=function(t){e.port2.postMessage(t)}}function d(){var e=g.documentElement;y=function(t){var n=g.createElement("script");n.onreadystatechange=function(){a(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}function f(){y=function(e){setTimeout(a,0,e)}}if(!e.setImmediate){var h=1,p={},m=!1,g=e.document,y,v=Object.getPrototypeOf&&Object.getPrototypeOf(e);v=v&&v.setTimeout?v:e,"[object process]"==={}.toString.call(e.process)?s():l()?u():e.MessageChannel?c():g&&"onreadystatechange"in g.createElement("script")?d():f(),v.setImmediate=i,v.clearImmediate=r}}("undefined"==typeof self?void 0===e?this:e:self)}).call(t,n(7),n(5))},function(e,t,n){"use strict";function i(e,t,n,i,r){for(var o=0;o<r;++o)n[o+i]=e[o+t],e[o+t]=void 0}function r(e){this._capacity=e,this._length=0,this._front=0}r.prototype._willBeOverCapacity=function(e){return this._capacity<e},r.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},r.prototype.push=function(e,t,n){var i=this.length()+3;if(this._willBeOverCapacity(i))return this._pushOne(e),this._pushOne(t),void this._pushOne(n);var r=this._front+i-3;this._checkCapacity(i);var o=this._capacity-1;this[r+0&o]=e,this[r+1&o]=t,this[r+2&o]=n,this._length=i},r.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},r.prototype.length=function(){return this._length},r.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},r.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,i(this,0,this,t,this._front+this._length&t-1)},e.exports=r},function(e,t,n){"use strict";e.exports=function(e,t){function i(n,i){if(c(n)){if(n instanceof e)return n;var r=o(n);if(r===u){i&&i._pushContext();var l=e.reject(r.e);return i&&i._popContext(),l}if("function"==typeof r){if(a(n)){var l=new e(t);return n._then(l._fulfill,l._reject,void 0,l,null),l}return s(n,r,i)}}return n}function r(e){return e.then}function o(e){try{return r(e)}catch(e){return u.e=e,u}}function a(e){try{return d.call(e,"_promise0")}catch(e){return!1}}function s(n,i,r){function o(e){s&&(s._resolveCallback(e),s=null)}function a(e){s&&(s._rejectCallback(e,d,!0),s=null)}var s=new e(t),c=s;r&&r._pushContext(),s._captureStackTrace(),r&&r._popContext();var d=!0,f=l.tryCatch(i).call(n,o,a);return d=!1,s&&f===u&&(s._rejectCallback(f.e,!0,!0),s=null),c}var l=n(0),u=l.errorObj,c=l.isObject,d={}.hasOwnProperty;return i}},function(e,t,n){"use strict";e.exports=function(e,t,i,r,o){function a(e){switch(e){case-2:return[];case-3:return{};case-6:return new Map}}function s(n){var i=this._promise=new e(t);n instanceof e&&i._propagateFrom(n,3),i._setOnCancel(this),this._values=n,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var l=n(0),u=l.isArray;return l.inherits(s,o),s.prototype.length=function(){return this._length},s.prototype.promise=function(){return this._promise},s.prototype._init=function t(n,o){var s=i(this._values,this._promise);if(s instanceof e){s=s._target();var u=s._bitField;if(this._values=s,0==(50397184&u))return this._promise._setAsyncGuaranteed(),s._then(t,this._reject,void 0,this,o);if(0==(33554432&u))return 0!=(16777216&u)?this._reject(s._reason()):this._cancel();s=s._value()}if(null===(s=l.asArray(s))){var c=r("expecting an array or an iterable object but got "+l.classString(s)).reason();return void this._promise._rejectCallback(c,!1)}if(0===s.length)return void(-5===o?this._resolveEmptyArray():this._resolve(a(o)));this._iterate(s)},s.prototype._iterate=function(t){var n=this.getActualLength(t.length);this._length=n,this._values=this.shouldCopyValues()?Array(n):this._values;for(var r=this._promise,o=!1,a=null,s=0;s<n;++s){var l=i(t[s],r);l instanceof e?(l=l._target(),a=l._bitField):a=null,o?null!==a&&l.suppressUnhandledRejections():null!==a?0==(50397184&a)?(l._proxy(this,s),this._values[s]=l):o=0!=(33554432&a)?this._promiseFulfilled(l._value(),s):0!=(16777216&a)?this._promiseRejected(l._reason(),s):this._promiseCancelled(s):o=this._promiseFulfilled(l,s)}o||r._setAsyncGuaranteed()},s.prototype._isResolved=function(){return null===this._values},s.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},s.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},s.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},s.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},s.prototype._promiseCancelled=function(){return this._cancel(),!0},s.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},s.prototype._resultCancelled=function(){if(!this._isResolved()){var t=this._values;if(this._cancel(),t instanceof e)t.cancel();else for(var n=0;n<t.length;++n)t[n]instanceof e&&t[n].cancel()}},s.prototype.shouldCopyValues=function(){return!0},s.prototype.getActualLength=function(e){return e},s}},function(e,t,n){"use strict";e.exports=function(e){function t(){this._trace=new t.CapturedTrace(i())}function n(){if(r)return new t}function i(){var e=o.length-1;if(e>=0)return o[e]}var r=!1,o=[];return e.prototype._promiseCreated=function(){},e.prototype._pushContext=function(){},e.prototype._popContext=function(){return null},e._peekContext=e.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,o.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var e=o.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=n,t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var n=e.prototype._pushContext,o=e.prototype._popContext,a=e._peekContext,s=e.prototype._peekContext,l=e.prototype._promiseCreated;t.deactivateLongStackTraces=function(){e.prototype._pushContext=n,e.prototype._popContext=o,e._peekContext=a,e.prototype._peekContext=s,e.prototype._promiseCreated=l,r=!1},r=!0,e.prototype._pushContext=t.prototype._pushContext,e.prototype._popContext=t.prototype._popContext,e._peekContext=e.prototype._peekContext=i,e.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},t}},function(e,t,n){"use strict";(function(t){e.exports=function(e,i){function r(e,t){return{promise:t}}function o(){return!1}function a(e,t,n){var i=this;try{e(t,n,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+M.toString(e));i._attachCancellationCallback(e)})}catch(e){return e}}function s(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?M.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function l(){return this._onCancelField}function u(e){this._onCancelField=e}function c(){this._cancellationParent=void 0,this._onCancelField=void 0}function d(e,t){if(0!=(1&t)){this._cancellationParent=e;var n=e._branchesRemainingToCancel;void 0===n&&(n=0),e._branchesRemainingToCancel=n+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function f(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function h(){var t=this._boundTo;return void 0!==t&&t instanceof e?t.isFulfilled()?t.value():void 0:t}function p(){this._trace=new T(this._peekContext())}function m(e,t){if(R(e)){var n=this._trace;if(void 0!==n&&t&&(n=n._parent),void 0!==n)n.attachExtraTrace(e);else if(!e.__stackCleaned__){var i=_(e);M.notEnumerableProp(e,"stack",i.message+"\n"+i.stack.join("\n")),M.notEnumerableProp(e,"__stackCleaned__",!0)}}}function g(e,t,n,i,r){if(void 0===e&&null!==t&&X){if(void 0!==r&&r._returnedNonUndefined())return;if(0==(65535&i._bitField))return;n&&(n+=" ");var o="",a="";if(t._trace){for(var s=t._trace.stack.split("\n"),l=w(s),u=l.length-1;u>=0;--u){var c=l[u];if(!V.test(c)){var d=c.match(z);d&&(o="at "+d[1]+":"+d[2]+":"+d[3]+" ");break}}if(l.length>0)for(var f=l[0],u=0;u<s.length;++u)if(s[u]===f){u>0&&(a="\n"+s[u-1]);break}}var h="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+a;i._warn(h,!0,t)}}function y(e,t){var n=e+" is deprecated and will be removed in a future version.";return t&&(n+=" Use "+t+" instead."),v(n)}function v(t,n,i){if(ae.warnings){var r=new L(t),o;if(n)i._attachExtraTrace(r);else if(ae.longStackTraces&&(o=e._peekContext()))o.attachExtraTrace(r);else{var a=_(r);r.stack=a.message+"\n"+a.stack.join("\n")}te("warning",r)||B(r,"",!0)}}function b(e,t){for(var n=0;n<t.length-1;++n)t[n].push("From previous event:"),t[n]=t[n].join("\n");return n<t.length&&(t[n]=t[n].join("\n")),e+"\n"+t.join("\n")}function x(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}function E(e){for(var t=e[0],n=1;n<e.length;++n){for(var i=e[n],r=t.length-1,o=t[r],a=-1,s=i.length-1;s>=0;--s)if(i[s]===o){a=s;break}for(var s=a;s>=0;--s){var l=i[s];if(t[r]!==l)break;t.pop(),r--}t=i}}function w(e){for(var t=[],n=0;n<e.length;++n){var i=e[n],r="    (No stack trace)"===i||W.test(i),o=r&&ie(i);r&&!o&&(H&&" "!==i.charAt(0)&&(i="    "+i),t.push(i))}return t}function C(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),n=0;n<t.length;++n){var i=t[n];if("    (No stack trace)"===i||W.test(i))break}return n>0&&"SyntaxError"!=e.name&&(t=t.slice(n)),t}function _(e){var t=e.stack,n=""+e;return t="string"==typeof t&&t.length>0?C(e):["    (No stack trace)"],{message:n,stack:"SyntaxError"==e.name?t:w(t)}}function B(e,t,n){if("undefined"!=typeof console){var i;if(M.isObject(e)){var r=e.stack;i=t+q(r,e)}else i=t+(e+"");"function"==typeof G?G(i,n):"function"!=typeof console.log&&"object"!=typeof console.log||console.log(i)}}function U(e,t,n,i){var r=!1;try{"function"==typeof t&&(r=!0,"rejectionHandled"===e?t(i):t(n,i))}catch(e){F.throwLater(e)}"unhandledRejection"===e?te(e,n,i)||r||B(n,"Unhandled rejection "):te(e,i)}function I(e){var t;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{t=e&&"function"==typeof e.toString?""+e:M.toString(e);if(/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+S(t)+">, no stack trace)"}function S(e){var t=41;return e.length<41?e:e.substr(0,38)+"..."}function k(){return"function"==typeof oe}function D(e){var t=e.match(re);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function A(e,t){if(k()){for(var n=e.stack.split("\n"),i=t.stack.split("\n"),r=-1,o=-1,a,s,l=0;l<n.length;++l){var u=D(n[l]);if(u){a=u.fileName,r=u.line;break}}for(var l=0;l<i.length;++l){var u=D(i[l]);if(u){s=u.fileName,o=u.line;break}}r<0||o<0||!a||!s||a!==s||r>=o||(ie=function(e){if(j.test(e))return!0;var t=D(e);return!!(t&&t.fileName===a&&r<=t.line&&t.line<=o)})}}function T(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);oe(this,T),t>32&&this.uncycle()}var P=e._getDomain,F=e._async,L=n(6).Warning,M=n(0),R=M.canAttachTrace,O,N,j=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,V=/\((?:timers\.js):\d+:\d+\)/,z=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,W=null,q=null,H=!1,G,$=!(0==M.env("BLUEBIRD_DEBUG")||!M.env("BLUEBIRD_DEBUG")&&"development"!==M.env("NODE_ENV")),K=!(0==M.env("BLUEBIRD_WARNINGS")||!$&&!M.env("BLUEBIRD_WARNINGS")),Y=!(0==M.env("BLUEBIRD_LONG_STACK_TRACES")||!$&&!M.env("BLUEBIRD_LONG_STACK_TRACES")),X=0!=M.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(K||!!M.env("BLUEBIRD_W_FORGOTTEN_RETURN"));e.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},e.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),F.invokeLater(this._notifyUnhandledRejection,this,void 0))},e.prototype._notifyUnhandledRejectionIsHandled=function(){U("rejectionHandled",O,void 0,this)},e.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},e.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},e.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),U("unhandledRejection",N,e,this)}},e.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},e.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},e.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0},e.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},e.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},e.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0},e.prototype._warn=function(e,t,n){return v(e,t,n||this)},e.onPossiblyUnhandledRejection=function(e){var t=P();N="function"==typeof e?null===t?e:M.domainBind(t,e):void 0},e.onUnhandledRejectionHandled=function(e){var t=P();O="function"==typeof e?null===t?e:M.domainBind(t,e):void 0};var Q=function(){};e.longStackTraces=function(){if(F.haveItemsQueued()&&!ae.longStackTraces)throw Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!ae.longStackTraces&&k()){var t=e.prototype._captureStackTrace,n=e.prototype._attachExtraTrace;ae.longStackTraces=!0,Q=function(){if(F.haveItemsQueued()&&!ae.longStackTraces)throw Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");e.prototype._captureStackTrace=t,e.prototype._attachExtraTrace=n,i.deactivateLongStackTraces(),F.enableTrampoline(),ae.longStackTraces=!1},e.prototype._captureStackTrace=p,e.prototype._attachExtraTrace=m,i.activateLongStackTraces(),F.disableTrampolineIfNecessary()}},e.hasLongStackTraces=function(){return ae.longStackTraces&&k()};var Z=function(){try{if("function"==typeof CustomEvent){var e=new CustomEvent("CustomEvent");return M.global.dispatchEvent(e),function(e,t){var n=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!M.global.dispatchEvent(n)}}if("function"==typeof Event){var e=new Event("CustomEvent");return M.global.dispatchEvent(e),function(e,t){var n=new Event(e.toLowerCase(),{cancelable:!0});return n.detail=t,!M.global.dispatchEvent(n)}}var e=document.createEvent("CustomEvent");return e.initCustomEvent("testingtheevent",!1,!0,{}),M.global.dispatchEvent(e),function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e.toLowerCase(),!1,!0,t),!M.global.dispatchEvent(n)}}catch(e){}return function(){return!1}}(),J=function(){return M.isNode?function(){return t.emit.apply(t,arguments)}:M.global?function(e){var t="on"+e.toLowerCase(),n=M.global[t];return!!n&&(n.apply(M.global,[].slice.call(arguments,1)),!0)}:function(){return!1}}(),ee={promiseCreated:r,promiseFulfilled:r,promiseRejected:r,promiseResolved:r,promiseCancelled:r,promiseChained:function(e,t,n){return{promise:t,child:n}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,n){return{reason:t,promise:n}},rejectionHandled:r},te=function(e){var t=!1;try{t=J.apply(null,arguments)}catch(e){F.throwLater(e),t=!0}var n=!1;try{n=Z(e,ee[e].apply(null,arguments))}catch(e){F.throwLater(e),n=!0}return n||t};e.config=function(t){if(t=Object(t),"longStackTraces"in t&&(t.longStackTraces?e.longStackTraces():!t.longStackTraces&&e.hasLongStackTraces()&&Q()),"warnings"in t){var n=t.warnings;ae.warnings=!!n,X=ae.warnings,M.isObject(n)&&"wForgottenReturn"in n&&(X=!!n.wForgottenReturn)}if("cancellation"in t&&t.cancellation&&!ae.cancellation){if(F.haveItemsQueued())throw Error("cannot enable cancellation after promises are in use");e.prototype._clearCancellationData=c,e.prototype._propagateFrom=d,e.prototype._onCancel=l,e.prototype._setOnCancel=u,e.prototype._attachCancellationCallback=s,e.prototype._execute=a,ne=d,ae.cancellation=!0}return"monitoring"in t&&(t.monitoring&&!ae.monitoring?(ae.monitoring=!0,e.prototype._fireEvent=te):!t.monitoring&&ae.monitoring&&(ae.monitoring=!1,e.prototype._fireEvent=o)),e},e.prototype._fireEvent=o,e.prototype._execute=function(e,t,n){try{e(t,n)}catch(e){return e}},e.prototype._onCancel=function(){},e.prototype._setOnCancel=function(e){},e.prototype._attachCancellationCallback=function(e){},e.prototype._captureStackTrace=function(){},e.prototype._attachExtraTrace=function(){},e.prototype._clearCancellationData=function(){},e.prototype._propagateFrom=function(e,t){};var ne=f,ie=function(){return!1},re=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;M.inherits(T,Error),i.CapturedTrace=T,T.prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],n={},i=0,r=this;void 0!==r;++i)t.push(r),r=r._parent;e=this._length=i;for(var i=e-1;i>=0;--i){var o=t[i].stack;void 0===n[o]&&(n[o]=i)}for(var i=0;i<e;++i){var a=t[i].stack,s=n[a];if(void 0!==s&&s!==i){s>0&&(t[s-1]._parent=void 0,t[s-1]._length=1),t[i]._parent=void 0,t[i]._length=1;var l=i>0?t[i-1]:this;s<e-1?(l._parent=t[s+1],l._parent.uncycle(),l._length=l._parent._length+1):(l._parent=void 0,l._length=1);for(var u=l._length+1,c=i-2;c>=0;--c)t[c]._length=u,u++;return}}}},T.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=_(e),n=t.message,i=[t.stack],r=this;void 0!==r;)i.push(w(r.stack.split("\n"))),r=r._parent;E(i),x(i),M.notEnumerableProp(e,"stack",b(n,i)),M.notEnumerableProp(e,"__stackCleaned__",!0)}};var oe=function e(){var t=/^\s*at\s*/,n=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?""+t:I(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,W=t,q=n;var i=Error.captureStackTrace;return ie=function(e){return j.test(e)},function(e,t){Error.stackTraceLimit+=6,i(e,t),Error.stackTraceLimit-=6}}var r=Error();if("string"==typeof r.stack&&r.stack.split("\n")[0].indexOf("stackDetection@")>=0)return W=/@/,q=n,H=!0,function e(t){t.stack=Error().stack};var o;try{throw Error()}catch(e){o="stack"in e}return"stack"in r||!o||"number"!=typeof Error.stackTraceLimit?(q=function(e,t){return"string"==typeof e?e:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?I(t):""+t},null):(W=t,q=n,function e(t){Error.stackTraceLimit+=6;try{throw Error()}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}([]);"undefined"!=typeof console&&void 0!==console.warn&&(G=function(e){console.warn(e)},M.isNode&&t.stderr.isTTY?G=function(e,t){var n=t?"\x1b[33m":"\x1b[31m";console.warn(n+e+"\x1b[0m\n")}:M.isNode||"string"!=typeof Error().stack||(G=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var ae={warnings:K,longStackTraces:!1,cancellation:!1,monitoring:!1};return Y&&e.longStackTraces(),{longStackTraces:function(){return ae.longStackTraces},warnings:function(){return ae.warnings},cancellation:function(){return ae.cancellation},monitoring:function(){return ae.monitoring},propagateFromFunction:function(){return ne},boundValueFunction:function(){return h},checkForgottenReturns:g,setBounds:A,warn:v,deprecated:y,CapturedTrace:T,fireDomEvent:Z,fireGlobalEvent:J}}}).call(t,n(5))},function(e,t,n){"use strict";e.exports=function(e,t,i){function r(e,t,n){this.promise=e,this.type=t,this.handler=n,this.called=!1,this.cancelPromise=null}function o(e){this.finallyHandler=e}function a(e,t){return null!=e.cancelPromise&&(arguments.length>1?e.cancelPromise._reject(t):e.cancelPromise._cancel(),e.cancelPromise=null,!0)}function s(){return u.call(this,this.promise._target()._settledValue())}function l(e){if(!a(this,e))return f.e=e,f}function u(n){var r=this.promise,u=this.handler;if(!this.called){this.called=!0;var c=this.isFinallyHandler()?u.call(r._boundValue()):u.call(r._boundValue(),n);if(c===i)return c;if(void 0!==c){r._setReturnedNonUndefined();var h=t(c,r);if(h instanceof e){if(null!=this.cancelPromise){if(h._isCancelled()){var p=new d("late cancellation observer");return r._attachExtraTrace(p),f.e=p,f}h.isPending()&&h._attachCancellationCallback(new o(this))}return h._then(s,l,void 0,this,void 0)}}}return r.isRejected()?(a(this),f.e=n,f):(a(this),n)}var c=n(0),d=e.CancellationError,f=c.errorObj,h=n(30)(i);return r.prototype.isFinallyHandler=function(){return 0===this.type},o.prototype._resultCancelled=function(){a(this.finallyHandler)},e.prototype._passThrough=function(e,t,n,i){return"function"!=typeof e?this.then():this._then(n,i,void 0,new r(this,t,e),void 0)},e.prototype.lastly=e.prototype.finally=function(e){return this._passThrough(e,0,u,u)},e.prototype.tap=function(e){return this._passThrough(e,1,u)},e.prototype.tapCatch=function(t){var n=arguments.length;if(1===n)return this._passThrough(t,1,void 0,u);var i=Array(n-1),r=0,o;for(o=0;o<n-1;++o){var a=arguments[o];if(!c.isObject(a))return e.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+c.classString(a)));i[r++]=a}i.length=r;var s=arguments[o];return this._passThrough(h(i,s,this),1,void 0,u)},r}},function(e,t,n){"use strict";e.exports=function(e,t,i,r,o){var a=n(0),s=a.tryCatch;e.method=function(n){if("function"!=typeof n)throw new e.TypeError("expecting a function but got "+a.classString(n));return function(){var i=new e(t);i._captureStackTrace(),i._pushContext();var r=s(n).apply(this,arguments),a=i._popContext();return o.checkForgottenReturns(r,a,"Promise.method",i),i._resolveFromSyncValue(r),i}},e.attempt=e.try=function(n){if("function"!=typeof n)return r("expecting a function but got "+a.classString(n));var i=new e(t);i._captureStackTrace(),i._pushContext();var l;if(arguments.length>1){o.deprecated("calling Promise.try with more than 1 argument");var u=arguments[1],c=arguments[2];l=a.isArray(u)?s(n).apply(c,u):s(n).call(c,u)}else l=s(n)();var d=i._popContext();return o.checkForgottenReturns(l,d,"Promise.try",i),i._resolveFromSyncValue(l),i},e.prototype._resolveFromSyncValue=function(e){e===a.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},function(e,t,n){"use strict";e.exports=function(e,t,n,i){var r=!1,o=function(e,t){this._reject(t)},a=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(o,o,null,this,e)},s=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},l=function(e,t){t.promiseRejectionQueued||this._reject(e)};e.prototype.bind=function(o){r||(r=!0,e.prototype._propagateFrom=i.propagateFromFunction(),e.prototype._boundValue=i.boundValueFunction());var u=n(o),c=new e(t);c._propagateFrom(this,1);var d=this._target();if(c._setBoundTo(u),u instanceof e){var f={promiseRejectionQueued:!1,promise:c,target:d,bindingPromise:u};d._then(t,a,void 0,c,f),u._then(s,l,void 0,c,f),c._setOnCancel(u)}else c._resolveCallback(d);return c},e.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},e.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},e.bind=function(t,n){return e.resolve(n).bind(t)}}},function(e,t,n){"use strict";e.exports=function(e,t,i,r){var o=n(0),a=o.tryCatch,s=o.errorObj,l=e._async;e.prototype.break=e.prototype.cancel=function(){if(!r.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var n=e._cancellationParent;if(null==n||!n._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=n}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),l.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._doInvokeOnCancel=function(e,t){if(o.isArray(e))for(var n=0;n<e.length;++n)this._doInvokeOnCancel(e[n],t);else if(void 0!==e)if("function"==typeof e){if(!t){var i=a(e).call(this._boundValue());i===s&&(this._attachExtraTrace(i.e),l.throwLater(i.e))}}else e._resultCancelled(this)},e.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),l.invoke(this._doInvokeOnCancel,this,e)},e.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}}},function(e,t,n){"use strict";e.exports=function(e){function t(){return this.value}function n(){throw this.reason}e.prototype.return=e.prototype.thenReturn=function(n){return n instanceof e&&n.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:n},void 0)},e.prototype.throw=e.prototype.thenThrow=function(e){return this._then(n,void 0,void 0,{reason:e},void 0)},e.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,n,void 0,{reason:e},void 0);var t=arguments[1],i=function(){throw t};return this.caught(e,i)},e.prototype.catchReturn=function(n){if(arguments.length<=1)return n instanceof e&&n.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:n},void 0);var i=arguments[1];i instanceof e&&i.suppressUnhandledRejections();var r=function(){return i};return this.caught(n,r)}}},function(e,t,n){"use strict";e.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var n=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},a=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},s=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return a.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return r.call(this._target())},e.prototype.isResolved=function(){return s.call(this._target())},e.prototype.value=function(){return n.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),i.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},function(e,t,n){"use strict";e.exports=function(e,t,i,r,o,a){var s=n(0),l=s.canEvaluate,u=s.tryCatch,c=s.errorObj,d;if(l){for(var f=function(e){return Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,e))},h=function(e){return Function("promise","holder","                           \n            'use strict';                                                    \n            holder.pIndex = promise;                                         \n            ".replace(/Index/g,e))},p=function(t){for(var n=Array(t),i=0;i<n.length;++i)n[i]="this.p"+(i+1);var r=n.join(" = ")+" = null;",a="var promise;\n"+n.map(function(e){return"                                                         \n                promise = "+e+";                                      \n                if (promise instanceof Promise) {                            \n                    promise.cancel();                                        \n                }                                                            \n            "}).join("\n"),s=n.join(", "),l="Holder$"+t,d="return function(tryCatch, errorObj, Promise, async) {    \n            'use strict';                                                    \n            function [TheName](fn) {                                         \n                [TheProperties]                                              \n                this.fn = fn;                                                \n                this.asyncNeeded = true;                                     \n                this.now = 0;                                                \n            }                                                                \n                                                                             \n            [TheName].prototype._callFunction = function(promise) {          \n                promise._pushContext();                                      \n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \n                promise._popContext();                                       \n                if (ret === errorObj) {                                      \n                    promise._rejectCallback(ret.e, false);                   \n                } else {                                                     \n                    promise._resolveCallback(ret);                           \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype.checkFulfillment = function(promise) {       \n                var now = ++this.now;                                        \n                if (now === [TheTotal]) {                                    \n                    if (this.asyncNeeded) {                                  \n                        async.invoke(this._callFunction, this, promise);     \n                    } else {                                                 \n                        this._callFunction(promise);                         \n                    }                                                        \n                                                                             \n                }                                                            \n            };                                                               \n                                                                             \n            [TheName].prototype._resultCancelled = function() {              \n                [CancellationCode]                                           \n            };                                                               \n                                                                             \n            return [TheName];                                                \n        }(tryCatch, errorObj, Promise, async);                               \n        ";return d=d.replace(/\[TheName\]/g,l).replace(/\[TheTotal\]/g,t).replace(/\[ThePassedArguments\]/g,s).replace(/\[TheProperties\]/g,r).replace(/\[CancellationCode\]/g,a),Function("tryCatch","errorObj","Promise","async",d)(u,c,e,o)},m=[],g=[],y=[],v=0;v<8;++v)m.push(p(v+1)),g.push(f(v+1)),y.push(h(v+1));d=function(e){this._reject(e)}}e.join=function(){var n=arguments.length-1,o;if(n>0&&"function"==typeof arguments[n]&&(o=arguments[n],n<=8&&l)){var u=new e(r);u._captureStackTrace();for(var c=m[n-1],f=new c(o),h=g,p=0;p<n;++p){var v=i(arguments[p],u);if(v instanceof e){v=v._target();var b=v._bitField;0==(50397184&b)?(v._then(h[p],d,void 0,u,f),y[p](v,f),f.asyncNeeded=!1):0!=(33554432&b)?h[p].call(u,v._value(),f):0!=(16777216&b)?u._reject(v._reason()):u._cancel()}else h[p].call(u,v,f)}if(!u._isFateSealed()){if(f.asyncNeeded){var x=a();null!==x&&(f.fn=s.domainBind(x,f.fn))}u._setAsyncGuaranteed(),u._setOnCancel(f)}return u}for(var E=arguments.length,w=Array(E),C=0;C<E;++C)w[C]=arguments[C];o&&w.pop();var u=new t(w).promise();return void 0!==o?u.spread(o):u}}},function(e,t,n){"use strict";e.exports=function(e,t,i,r,o,a){function s(e,t,n,i){this.constructor$(e),this._promise._captureStackTrace();var r=u();this._callback=null===r?t:c.domainBind(r,t),this._preservedValues=i===o?Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],h.invoke(this._asyncInit,this,void 0)}function l(t,n,r,o){if("function"!=typeof n)return i("expecting a function but got "+c.classString(n));var a=0;if(void 0!==r){if("object"!=typeof r||null===r)return e.reject(new TypeError("options argument must be an object but it is "+c.classString(r)));if("number"!=typeof r.concurrency)return e.reject(new TypeError("'concurrency' must be a number but it is "+c.classString(r.concurrency)));a=r.concurrency}return a="number"==typeof a&&isFinite(a)&&a>=1?a:0,new s(t,n,a,o).promise()}var u=e._getDomain,c=n(0),d=c.tryCatch,f=c.errorObj,h=e._async;c.inherits(s,t),s.prototype._asyncInit=function(){this._init$(void 0,-2)},s.prototype._init=function(){},s.prototype._promiseFulfilled=function(t,n){var i=this._values,o=this.length(),s=this._preservedValues,l=this._limit;if(n<0){if(n=-1*n-1,i[n]=t,l>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(l>=1&&this._inFlight>=l)return i[n]=t,this._queue.push(n),!1;null!==s&&(s[n]=t);var u=this._promise,c=this._callback,h=u._boundValue();u._pushContext();var p=d(c).call(h,t,n,o),m=u._popContext();if(a.checkForgottenReturns(p,m,null!==s?"Promise.filter":"Promise.map",u),p===f)return this._reject(p.e),!0;var g=r(p,this._promise);if(g instanceof e){g=g._target();var y=g._bitField;if(0==(50397184&y))return l>=1&&this._inFlight++,i[n]=g,g._proxy(this,-1*(n+1)),!1;if(0==(33554432&y))return 0!=(16777216&y)?(this._reject(g._reason()),!0):(this._cancel(),!0);p=g._value()}i[n]=p}return++this._totalResolved>=o&&(null!==s?this._filter(i,s):this._resolve(i),!0)},s.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,n=this._values;e.length>0&&this._inFlight<t;){if(this._isResolved())return;var i=e.pop();this._promiseFulfilled(n[i],i)}},s.prototype._filter=function(e,t){for(var n=t.length,i=Array(n),r=0,o=0;o<n;++o)e[o]&&(i[r++]=t[o]);i.length=r,this._resolve(i)},s.prototype.preservedValues=function(){return this._preservedValues},e.prototype.map=function(e,t){return l(this,e,t,null)},e.map=function(e,t,n,i){return l(e,t,n,i)}}},function(e,t,n){"use strict";var i=Object.create;if(i){var r=i(null),o=i(null);r[" size"]=o[" size"]=0}e.exports=function(e){function t(t,n){var i;if(null!=t&&(i=t[n]),"function"!=typeof i){var r="Object "+l.classString(t)+" has no method '"+l.toString(n)+"'";throw new e.TypeError(r)}return i}function i(e){return t(e,this.pop()).apply(e,this)}function a(e){return e[this]}function s(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}var l=n(0),u=l.canEvaluate,c=l.isIdentifier,d,f,h=function(e){return Function("ensureMethod","                                    \n        return function(obj) {                                               \n            'use strict'                                                     \n            var len = this.length;                                           \n            ensureMethod(obj, 'methodName');                                 \n            switch(len) {                                                    \n                case 1: return obj.methodName(this[0]);                      \n                case 2: return obj.methodName(this[0], this[1]);             \n                case 3: return obj.methodName(this[0], this[1], this[2]);    \n                case 0: return obj.methodName();                             \n                default:                                                     \n                    return obj.methodName.apply(obj, this);                  \n            }                                                                \n        };                                                                   \n        ".replace(/methodName/g,e))(t)},p=function(e){return Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",e))},m=function(e,t,n){var i=n[e];if("function"!=typeof i){if(!c(e))return null;if(i=t(e),n[e]=i,++n[" size"]>512){for(var r=Object.keys(n),o=0;o<256;++o)delete n[r[o]];n[" size"]=r.length-256}}return i};d=function(e){return m(e,h,r)},f=function(e){return m(e,p,o)},e.prototype.call=function(e){for(var t=arguments.length,n=Array(Math.max(t-1,0)),r=1;r<t;++r)n[r-1]=arguments[r];if(u){var o=d(e);if(null!==o)return this._then(o,void 0,void 0,n,void 0)}return n.push(e),this._then(i,void 0,void 0,n,void 0)},e.prototype.get=function(e){var t="number"==typeof e,n;if(t)n=s;else if(u){var i=f(e);n=null!==i?i:a}else n=a;return this._then(n,void 0,void 0,e,void 0)}}},function(e,t,n){"use strict";e.exports=function(e,t,i,r,o,a){function s(e){setTimeout(function(){throw e},0)}function l(e){var t=i(e);return t!==e&&"function"==typeof e._isDisposable&&"function"==typeof e._getDisposer&&e._isDisposable()&&t._setDisposable(e._getDisposer()),t}function u(t,n){function r(){if(a>=u)return c._fulfill();var o=l(t[a++]);if(o instanceof e&&o._isDisposable()){try{o=i(o._getDisposer().tryDispose(n),t.promise)}catch(e){return s(e)}if(o instanceof e)return o._then(r,s,null,null,null)}r()}var a=0,u=t.length,c=new e(o);return r(),c}function c(e,t,n){this._data=e,this._promise=t,this._context=n}function d(e,t,n){this.constructor$(e,t,n)}function f(e){return c.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function h(e){this.length=e,this.promise=null,this[e-1]=null}var p=n(0),m=n(6).TypeError,g=n(0).inherits,y=p.errorObj,v=p.tryCatch,b={};c.prototype.data=function(){return this._data},c.prototype.promise=function(){return this._promise},c.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():b},c.prototype.tryDispose=function(e){var t=this.resource(),n=this._context;void 0!==n&&n._pushContext();var i=t!==b?this.doDispose(t,e):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,i},c.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},g(d,c),d.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},h.prototype._resultCancelled=function(){for(var t=this.length,n=0;n<t;++n){var i=this[n];i instanceof e&&i.cancel()}},e.using=function(){var n=arguments.length;if(n<2)return t("you must pass at least 2 arguments to Promise.using");var r=arguments[n-1];if("function"!=typeof r)return t("expecting a function but got "+p.classString(r));var o,s=!0;2===n&&Array.isArray(arguments[0])?(o=arguments[0],n=o.length,s=!1):(o=arguments,n--);for(var l=new h(n),d=0;d<n;++d){var m=o[d];if(c.isDisposer(m)){var g=m;m=m.promise(),m._setDisposable(g)}else{var b=i(m);b instanceof e&&(m=b._then(f,null,null,{resources:l,index:d},void 0))}l[d]=m}for(var x=Array(l.length),d=0;d<x.length;++d)x[d]=e.resolve(l[d]).reflect();var E=e.all(x).then(function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.isRejected())return y.e=n.error(),y;if(!n.isFulfilled())return void E.cancel();e[t]=n.value()}w._pushContext(),r=v(r);var i=s?r.apply(void 0,e):r(e),o=w._popContext();return a.checkForgottenReturns(i,o,"Promise.using",w),i}),w=E.lastly(function(){var t=new e.PromiseInspection(E);return u(l,t)});return l.promise=w,w._setOnCancel(l),w},e.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},e.prototype._isDisposable=function(){return(131072&this._bitField)>0},e.prototype._getDisposer=function(){return this._disposer},e.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},e.prototype.disposer=function(e){if("function"==typeof e)return new d(e,this,r());throw new m}}},function(e,t,n){"use strict";e.exports=function(e,t,i){function r(e){this.handle=e}function o(e){return clearTimeout(this.handle),e}function a(e){throw clearTimeout(this.handle),e}var s=n(0),l=e.TimeoutError;r.prototype._resultCancelled=function(){clearTimeout(this.handle)};var u=function(e){return c(+this).thenReturn(e)},c=e.delay=function(n,o){var a,s;return void 0!==o?(a=e.resolve(o)._then(u,null,null,n,void 0),i.cancellation()&&o instanceof e&&a._setOnCancel(o)):(a=new e(t),s=setTimeout(function(){a._fulfill()},+n),i.cancellation()&&a._setOnCancel(new r(s)),a._captureStackTrace()),a._setAsyncGuaranteed(),a};e.prototype.delay=function(e){return c(e,this)};var d=function(e,t,n){var i;i="string"!=typeof t?t instanceof Error?t:new l("operation timed out"):new l(t),s.markAsOriginatingFromRejection(i),e._attachExtraTrace(i),e._reject(i),null!=n&&n.cancel()};e.prototype.timeout=function(e,t){e=+e;var n,s,l=new r(setTimeout(function e(){n.isPending()&&d(n,t,s)},e));return i.cancellation()?(s=this.then(),n=s._then(o,a,void 0,l,void 0),n._setOnCancel(l)):n=this._then(o,a,void 0,l,void 0),n}}},function(e,t,n){"use strict";e.exports=function(e,t,i,r,o,a){function s(t,n,i){for(var o=0;o<n.length;++o){i._pushContext();var a=h(n[o])(t);if(i._popContext(),a===f){i._pushContext();var s=e.reject(f.e);return i._popContext(),s}var l=r(a,i);if(l instanceof e)return l}return null}function l(t,n,r,o){if(a.cancellation()){var s=new e(i),l=this._finallyPromise=new e(i);this._promise=s.lastly(function(){return l}),s._captureStackTrace(),s._setOnCancel(this)}else{(this._promise=new e(i))._captureStackTrace()}this._stack=o,this._generatorFunction=t,this._receiver=n,this._generator=void 0,this._yieldHandlers="function"==typeof r?[r].concat(p):p,this._yieldedPromise=null,this._cancellationPhase=!1}var u=n(6),c=u.TypeError,d=n(0),f=d.errorObj,h=d.tryCatch,p=[];d.inherits(l,o),l.prototype._isResolved=function(){return null===this._promise},l.prototype._cleanup=function(){this._promise=this._generator=null,a.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},l.prototype._promiseCancelled=function(){if(!this._isResolved()){var t=void 0!==this._generator.return,n;if(t)this._promise._pushContext(),n=h(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var i=new e.CancellationError("generator .return() sentinel");e.coroutine.returnSentinel=i,this._promise._attachExtraTrace(i),this._promise._pushContext(),n=h(this._generator.throw).call(this._generator,i),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(n)}},l.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=h(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},l.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=h(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},l.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof e){var t=this._yieldedPromise;this._yieldedPromise=null,t.cancel()}},l.prototype.promise=function(){return this._promise},l.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},l.prototype._continue=function(t){var n=this._promise;if(t===f)return this._cleanup(),this._cancellationPhase?n.cancel():n._rejectCallback(t.e,!1);var i=t.value;if(!0===t.done)return this._cleanup(),this._cancellationPhase?n.cancel():n._resolveCallback(i);var o=r(i,this._promise);if(!(o instanceof e)&&null===(o=s(o,this._yieldHandlers,this._promise)))return void this._promiseRejected(new c("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",i+"")+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));o=o._target();var a=o._bitField;0==(50397184&a)?(this._yieldedPromise=o,o._proxy(this,null)):0!=(33554432&a)?e._async.invoke(this._promiseFulfilled,this,o._value()):0!=(16777216&a)?e._async.invoke(this._promiseRejected,this,o._reason()):this._promiseCancelled()},e.coroutine=function(e,t){if("function"!=typeof e)throw new c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var n=Object(t).yieldHandler,i=l,r=Error().stack;return function(){var t=e.apply(this,arguments),o=new i(void 0,void 0,n,r),a=o.promise();return o._generator=t,o._promiseFulfilled(void 0),a}},e.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new c("expecting a function but got "+d.classString(e));p.push(e)},e.spawn=function(n){if(a.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof n)return t("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var i=new l(n,this),r=i.promise();return i._run(e.spawn),r}}},function(e,t,n){"use strict";e.exports=function(e){function t(e,t){var n=this;if(!o.isArray(e))return i.call(n,e,t);var r=s(t).apply(n._boundValue(),[null].concat(e));r===l&&a.throwLater(r.e)}function i(e,t){var n=this,i=n._boundValue(),r=void 0===e?s(t).call(i,null):s(t).call(i,null,e);r===l&&a.throwLater(r.e)}function r(e,t){var n=this;if(!e){var i=Error(e+"");i.cause=e,e=i}var r=s(t).call(n._boundValue(),e);r===l&&a.throwLater(r.e)}var o=n(0),a=e._async,s=o.tryCatch,l=o.errorObj;e.prototype.asCallback=e.prototype.nodeify=function(e,n){if("function"==typeof e){var o=i;void 0!==n&&Object(n).spread&&(o=t),this._then(o,r,void 0,this,e)}return this}}},function(e,t,n){"use strict";e.exports=function(e,t){function i(e){return!E.test(e)}function r(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function o(e,t,n){var i=f.getDataPropertyOrDefault(e,t+n,b);return!!i&&r(i)}function a(e,t,n){for(var i=0;i<e.length;i+=2){var r=e[i];if(n.test(r))for(var o=r.replace(n,""),a=0;a<e.length;a+=2)if(e[a]===o)throw new y("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}function s(e,t,n,i){for(var s=f.inheritedDataKeys(e),l=[],u=0;u<s.length;++u){var c=s[u],d=e[c],h=i===w||w(c,d,e);"function"!=typeof d||r(d)||o(e,c,t)||!i(c,d,e,h)||l.push(c,d)}return a(l,t,n),l}function l(n,i,r,o,a,s){function l(){var r=i;i===d&&(r=this);var o=new e(t);o._captureStackTrace();var a="string"==typeof c&&this!==u?this[c]:n,l=h(o,s);try{a.apply(r,p(arguments,l))}catch(e){o._rejectCallback(m(e),!0,!0)}return o._isFateSealed()||o._setAsyncGuaranteed(),o}var u=function(){return this}(),c=n;return"string"==typeof c&&(n=o),f.notEnumerableProp(l,"__isPromisified__",!0),l}function u(e,t,n,i,r){for(var o=RegExp(C(t)+"$"),a=s(e,t,o,n),l=0,u=a.length;l<u;l+=2){var c=a[l],h=a[l+1],p=c+t;if(i===k)e[p]=k(c,d,c,h,t,r);else{var m=i(h,function(){return k(c,d,c,h,t,r)});f.notEnumerableProp(m,"__isPromisified__",!0),e[p]=m}}return f.toFastProperties(e),e}function c(e,t,n){return k(e,t,void 0,e,null,n)}var d={},f=n(0),h=n(31),p=f.withAppended,m=f.maybeWrapAsError,g=f.canEvaluate,y=n(6).TypeError,v="Async",b={__isPromisified__:!0},x=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],E=RegExp("^(?:"+x.join("|")+")$"),w=function(e){return f.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},C=function(e){return e.replace(/([$])/,"\\$")},_,B=function(e){for(var t=[e],n=Math.max(0,e-1-3),i=e-1;i>=n;--i)t.push(i);for(var i=e+1;i<=3;++i)t.push(i);return t},U=function(e){return f.filledRange(e,"_arg","")},I=function(e){return f.filledRange(Math.max(e,3),"_arg","")},S=function(e){return"number"==typeof e.length?Math.max(Math.min(e.length,1024),0):0};_=function(n,i,r,o,a,s){function l(e){var t=U(e).join(", "),n=e>0?", ":"",r;return r=y?"ret = callback.call(this, {{args}}, nodeback); break;\n":void 0===i?"ret = callback({{args}}, nodeback); break;\n":"ret = callback.call(receiver, {{args}}, nodeback); break;\n",r.replace("{{args}}",t).replace(", ",n)}function u(){for(var e="",t=0;t<g.length;++t)e+="case "+g[t]+":"+l(g[t]);return e+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = nodeback;                                              \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",y?"ret = callback.apply(this, args);\n":"ret = callback.apply(receiver, args);\n")}var c=Math.max(0,S(o)-1),g=B(c),y="string"==typeof n||i===d,v="string"==typeof n?"this != null ? this['"+n+"'] : fn":"fn",b="'use strict';                                                \n        var ret = function (Parameters) {                                    \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._captureStackTrace();                                    \n            var nodeback = nodebackForPromise(promise, "+s+");   \n            var ret;                                                         \n            var callback = tryCatch([GetFunctionCode]);                      \n            switch(len) {                                                    \n                [CodeForSwitchCase]                                          \n            }                                                                \n            if (ret === errorObj) {                                          \n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\n            }                                                                \n            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \n            return promise;                                                  \n        };                                                                   \n        notEnumerableProp(ret, '__isPromisified__', true);                   \n        return ret;                                                          \n    ".replace("[CodeForSwitchCase]",u()).replace("[GetFunctionCode]",v);return b=b.replace("Parameters",I(c)),Function("Promise","fn","receiver","withAppended","maybeWrapAsError","nodebackForPromise","tryCatch","errorObj","notEnumerableProp","INTERNAL",b)(e,o,i,p,m,h,f.tryCatch,f.errorObj,f.notEnumerableProp,t)};var k=g?_:l;e.promisify=function(e,t){if("function"!=typeof e)throw new y("expecting a function but got "+f.classString(e));if(r(e))return e;t=Object(t);var n=void 0===t.context?d:t.context,o=!!t.multiArgs,a=c(e,n,o);return f.copyDescriptors(e,a,i),a},e.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=typeof e)throw new y("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");t=Object(t);var n=!!t.multiArgs,i=t.suffix;"string"!=typeof i&&(i="Async");var r=t.filter;"function"!=typeof r&&(r=w);var o=t.promisifier;if("function"!=typeof o&&(o=k),!f.isIdentifier(i))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var a=f.inheritedDataKeys(e),s=0;s<a.length;++s){var l=e[a[s]];"constructor"!==a[s]&&f.isClass(l)&&(u(l.prototype,i,r,o,n),u(l,i,r,o,n))}return u(e,i,r,o,n)}}},function(e,t,n){"use strict";e.exports=function(e,t,i,r){function o(e){var t=!1,n;if(void 0!==c&&e instanceof c)n=d(e),t=!0;else{var i=u.keys(e),r=i.length;n=Array(2*r);for(var o=0;o<r;++o){var a=i[o];n[o]=e[a],n[o+r]=a}}this.constructor$(n),this._isMap=t,this._init$(void 0,t?-6:-3)}function a(t){var n,a=i(t);return l(a)?(n=a instanceof e?a._then(e.props,void 0,void 0,void 0,void 0):new o(a).promise(),a instanceof e&&n._propagateFrom(a,2),n):r("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var s=n(0),l=s.isObject,u=n(8),c;"function"==typeof Map&&(c=Map);var d=function(){function e(e,i){this[t]=e,this[t+n]=i,t++}var t=0,n=0;return function i(r){n=r.size,t=0;var o=Array(2*r.size);return r.forEach(e,o),o}}(),f=function(e){for(var t=new c,n=e.length/2|0,i=0;i<n;++i){var r=e[n+i],o=e[i];t.set(r,o)}return t};s.inherits(o,t),o.prototype._init=function(){},o.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var n;if(this._isMap)n=f(this._values);else{n={};for(var i=this.length(),r=0,o=this.length();r<o;++r)n[this._values[r+i]]=this._values[r]}return this._resolve(n),!0}return!1},o.prototype.shouldCopyValues=function(){return!1},o.prototype.getActualLength=function(e){return e>>1},e.prototype.props=function(){return a(this)},e.props=function(e){return a(e)}}},function(e,t,n){"use strict";e.exports=function(e,t,i,r){function o(n,o){var l=i(n);if(l instanceof e)return s(l);if(null===(n=a.asArray(n)))return r("expecting an array or an iterable object but got "+a.classString(n));var u=new e(t);void 0!==o&&u._propagateFrom(o,3);for(var c=u._fulfill,d=u._reject,f=0,h=n.length;f<h;++f){var p=n[f];(void 0!==p||f in n)&&e.cast(p)._then(c,d,void 0,u,null)}return u}var a=n(0),s=function(e){return e.then(function(t){return o(t,e)})};e.race=function(e){return o(e,void 0)},e.prototype.race=function(){return o(this,void 0)}}},function(e,t,n){"use strict";e.exports=function(e,t,i,r,o,a){function s(t,n,i,r){this.constructor$(t);var a=f();this._fn=null===a?n:h.domainBind(a,n),void 0!==i&&(i=e.resolve(i),i._attachCancellationCallback(this)),this._initialValue=i,this._currentCancellable=null,this._eachValues=r===o?Array(this._length):0===r?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function l(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function u(e,t,n,r){return"function"!=typeof t?i("expecting a function but got "+h.classString(t)):new s(e,t,n,r).promise()}function c(t){this.accum=t,this.array._gotAccum(t);var n=r(this.value,this.array._promise);return n instanceof e?(this.array._currentCancellable=n,n._then(d,void 0,void 0,this,void 0)):d.call(this,n)}function d(t){var n=this.array,i=n._promise,r=p(n._fn);i._pushContext();var o;(o=void 0!==n._eachValues?r.call(i._boundValue(),t,this.index,this.length):r.call(i._boundValue(),this.accum,t,this.index,this.length))instanceof e&&(n._currentCancellable=o);var s=i._popContext();return a.checkForgottenReturns(o,s,void 0!==n._eachValues?"Promise.each":"Promise.reduce",i),o}var f=e._getDomain,h=n(0),p=h.tryCatch;h.inherits(s,t),s.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==o&&this._eachValues.push(e)},s.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},s.prototype._init=function(){},s.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},s.prototype.shouldCopyValues=function(){return!1},s.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},s.prototype._resultCancelled=function(t){if(t===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof e&&this._currentCancellable.cancel(),this._initialValue instanceof e&&this._initialValue.cancel())},s.prototype._iterate=function(t){this._values=t;var n,i,r=t.length;if(void 0!==this._initialValue?(n=this._initialValue,i=0):(n=e.resolve(t[0]),i=1),this._currentCancellable=n,!n.isRejected())for(;i<r;++i){var o={accum:null,value:t[i],index:i,length:r,array:this};n=n._then(c,void 0,void 0,o,void 0)}void 0!==this._eachValues&&(n=n._then(this._eachComplete,void 0,void 0,this,void 0)),n._then(l,l,void 0,n,this)},e.prototype.reduce=function(e,t){return u(this,e,t,null)},e.reduce=function(e,t,n,i){return u(e,t,n,i)}}},function(e,t,n){"use strict";e.exports=function(e,t,i){function r(e){this.constructor$(e)}var o=e.PromiseInspection;n(0).inherits(r,t),r.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},r.prototype._promiseFulfilled=function(e,t){var n=new o;return n._bitField=33554432,n._settledValueField=e,this._promiseResolved(t,n)},r.prototype._promiseRejected=function(e,t){var n=new o;return n._bitField=16777216,n._settledValueField=e,this._promiseResolved(t,n)},e.settle=function(e){return i.deprecated(".settle()",".reflect()"),new r(e).promise()},e.prototype.settle=function(){return e.settle(this)}}},function(e,t,n){"use strict";e.exports=function(e,t,i){function r(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function o(e,t){if((0|t)!==t||t<0)return i("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new r(e),o=n.promise();return n.setHowMany(t),n.init(),o}var a=n(0),s=n(6).RangeError,l=n(6).AggregateError,u=a.isArray,c={};a.inherits(r,t),r.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=u(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},r.prototype.init=function(){this._initialized=!0,this._init()},r.prototype.setUnwrap=function(){this._unwrap=!0},r.prototype.howMany=function(){return this._howMany},r.prototype.setHowMany=function(e){this._howMany=e},r.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},r.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},r.prototype._promiseCancelled=function(){return this._values instanceof e||null==this._values?this._cancel():(this._addRejected(c),this._checkOutcome())},r.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new l,t=this.length();t<this._values.length;++t)this._values[t]!==c&&e.push(this._values[t]);return e.length>0?this._reject(e):this._cancel(),!0}return!1},r.prototype._fulfilled=function(){return this._totalResolved},r.prototype._rejected=function(){return this._values.length-this.length()},r.prototype._addRejected=function(e){this._values.push(e)},r.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},r.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},r.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new s(t)},r.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(e,t){return o(e,t)},e.prototype.some=function(e){return o(this,e)},e._SomePromiseArray=r}},function(e,t,n){"use strict";e.exports=function(e,t){var n=e.map;e.prototype.filter=function(e,i){return n(this,e,i,t)},e.filter=function(e,i,r){return n(e,i,r,t)}}},function(e,t,n){"use strict";e.exports=function(e,t){function n(){return o(this)}function i(e,n){return r(e,n,t,t)}var r=e.reduce,o=e.all;e.prototype.each=function(e){return r(this,e,t,0)._then(n,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return r(this,e,t,t)},e.each=function(e,i){return r(e,i,t,0)._then(n,void 0,void 0,e,void 0)},e.mapSeries=i}},function(e,t,n){"use strict";e.exports=function(e){function t(e){var t=new n(e),i=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),i}var n=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},function(e,t,n){(function(t,n){var i,i;!function(t){var n;e.exports=t()}(function(){var e,r,o;return function e(t,n,r){function o(s,l){if(!n[s]){if(!t[s]){var u="function"==typeof i&&i;if(!l&&u)return i(s,!0);if(a)return a(s,!0);var c=Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return o(n||e)},d,d.exports,e,t,n,r)}return n[s].exports}for(var a="function"==typeof i&&i,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){"use strict";var i=e("./utils"),r=e("./support"),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e){for(var t=[],n,r,a,s,l,u,c,d=0,f=e.length,h=f,p="string"!==i.getTypeOf(e);d<e.length;)h=f-d,p?(n=e[d++],r=d<f?e[d++]:0,a=d<f?e[d++]:0):(n=e.charCodeAt(d++),r=d<f?e.charCodeAt(d++):0,a=d<f?e.charCodeAt(d++):0),s=n>>2,l=(3&n)<<4|r>>4,u=h>1?(15&r)<<2|a>>6:64,c=h>2?63&a:64,t.push(o.charAt(s)+o.charAt(l)+o.charAt(u)+o.charAt(c));return t.join("")},n.decode=function(e){var t,n,i,a,s,l,u,c=0,d=0,f="data:";if("data:"===e.substr(0,5))throw Error("Invalid base64 input, it looks like a data url.");e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");var h=3*e.length/4;if(e.charAt(e.length-1)===o.charAt(64)&&h--,e.charAt(e.length-2)===o.charAt(64)&&h--,h%1!=0)throw Error("Invalid base64 input, bad content length.");var p;for(p=r.uint8array?new Uint8Array(0|h):Array(0|h);c<e.length;)a=o.indexOf(e.charAt(c++)),s=o.indexOf(e.charAt(c++)),l=o.indexOf(e.charAt(c++)),u=o.indexOf(e.charAt(c++)),t=a<<2|s>>4,n=(15&s)<<4|l>>2,i=(3&l)<<6|u,p[d++]=t,64!==l&&(p[d++]=n),64!==u&&(p[d++]=i);return p}},{"./support":30,"./utils":32}],2:[function(e,t,n){"use strict";function i(e,t,n,i,r){this.compressedSize=e,this.uncompressedSize=t,this.crc32=n,this.compression=i,this.compressedContent=r}var r=e("./external"),o=e("./stream/DataWorker"),a=e("./stream/DataLengthProbe"),s=e("./stream/Crc32Probe"),a=e("./stream/DataLengthProbe");i.prototype={getContentWorker:function(){var e=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),t=this;return e.on("end",function(){if(this.streamInfo.data_length!==t.uncompressedSize)throw Error("Bug : uncompressed data size mismatch")}),e},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},i.createWorkerFrom=function(e,t,n){return e.pipe(new s).pipe(new a("uncompressedSize")).pipe(t.compressWorker(n)).pipe(new a("compressedSize")).withStreamInfo("compression",t)},t.exports=i},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(e,t,n){"use strict";var i=e("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(e){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},n.DEFLATE=e("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(e,t,n){"use strict";function i(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}function r(e,t,n,i){var r=s,o=i+n;e^=-1;for(var a=i;a<o;a++)e=e>>>8^r[255&(e^t[a])];return-1^e}function o(e,t,n,i){var r=s,o=i+n;e^=-1;for(var a=i;a<o;a++)e=e>>>8^r[255&(e^t.charCodeAt(a))];return-1^e}var a=e("./utils"),s=i();t.exports=function e(t,n){return void 0!==t&&t.length?"string"!==a.getTypeOf(t)?r(0|n,t,t.length,0):o(0|n,t,t.length,0):0}},{"./utils":32}],5:[function(e,t,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(e,t,n){"use strict";var i=null;i="undefined"!=typeof Promise?Promise:e("lie"),t.exports={Promise:i}},{lie:58}],7:[function(e,t,n){"use strict";function i(e,t){s.call(this,"FlateWorker/"+e),this._pako=new o[e]({raw:!0,level:t.level||-1}),this.meta={};var n=this;this._pako.onData=function(e){n.push({data:e,meta:n.meta})}}var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,o=e("pako"),a=e("./utils"),s=e("./stream/GenericWorker"),l=r?"uint8array":"array";n.magic="\b\0",a.inherits(i,s),i.prototype.processChunk=function(e){this.meta=e.meta,this._pako.push(a.transformTo(l,e.data),!1)},i.prototype.flush=function(){s.prototype.flush.call(this),this._pako.push([],!0)},i.prototype.cleanUp=function(){s.prototype.cleanUp.call(this),this._pako=null},n.compressWorker=function(e){return new i("Deflate",e)},n.uncompressWorker=function(){return new i("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:59}],8:[function(e,t,n){"use strict";function i(e,t,n,i){o.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=t,this.zipPlatform=n,this.encodeFileName=i,this.streamFiles=e,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}var r=e("../utils"),o=e("../stream/GenericWorker"),a=e("../utf8"),s=e("../crc32"),l=e("../signature"),u=function(e,t){var n="",i;for(i=0;i<t;i++)n+=String.fromCharCode(255&e),e>>>=8;return n},c=function(e,t){var n=e;return e||(n=t?16893:33204),(65535&n)<<16},d=function(e,t){return 63&(e||0)},f=function(e,t,n,i,o,f){var h=e.file,p=e.compression,m=f!==a.utf8encode,g=r.transformTo("string",f(h.name)),y=r.transformTo("string",a.utf8encode(h.name)),v=h.comment,b=r.transformTo("string",f(v)),x=r.transformTo("string",a.utf8encode(v)),E=y.length!==h.name.length,w=x.length!==v.length,C,_,B="",U="",I="",S=h.dir,k=h.date,D={crc32:0,compressedSize:0,uncompressedSize:0};t&&!n||(D.crc32=e.crc32,D.compressedSize=e.compressedSize,D.uncompressedSize=e.uncompressedSize);var A=0;t&&(A|=8),m||!E&&!w||(A|=2048);var T=0,P=0;S&&(T|=16),"UNIX"===o?(P=798,T|=c(h.unixPermissions,S)):(P=20,T|=d(h.dosPermissions,S)),C=k.getUTCHours(),C<<=6,C|=k.getUTCMinutes(),C<<=5,C|=k.getUTCSeconds()/2,_=k.getUTCFullYear()-1980,_<<=4,_|=k.getUTCMonth()+1,_<<=5,_|=k.getUTCDate(),E&&(U=u(1,1)+u(s(g),4)+y,B+="up"+u(U.length,2)+U),w&&(I=u(1,1)+u(s(b),4)+x,B+="uc"+u(I.length,2)+I);var F="";return F+="\n\0",F+=u(A,2),F+=p.magic,F+=u(C,2),F+=u(_,2),F+=u(D.crc32,4),F+=u(D.compressedSize,4),F+=u(D.uncompressedSize,4),F+=u(g.length,2),F+=u(B.length,2),{fileRecord:l.LOCAL_FILE_HEADER+F+g+B,dirRecord:l.CENTRAL_FILE_HEADER+u(P,2)+F+u(b.length,2)+"\0\0\0\0"+u(T,4)+u(i,4)+g+B+b}},h=function(e,t,n,i,o){var a="",s=r.transformTo("string",o(i));return a=l.CENTRAL_DIRECTORY_END+"\0\0\0\0"+u(e,2)+u(e,2)+u(t,4)+u(n,4)+u(s.length,2)+s},p=function(e){var t="";return t=l.DATA_DESCRIPTOR+u(e.crc32,4)+u(e.compressedSize,4)+u(e.uncompressedSize,4)};r.inherits(i,o),i.prototype.push=function(e){var t=e.meta.percent||0,n=this.entriesCount,i=this._sources.length;this.accumulate?this.contentBuffer.push(e):(this.bytesWritten+=e.data.length,o.prototype.push.call(this,{data:e.data,meta:{currentFile:this.currentFile,percent:n?(t+100*(n-i-1))/n:100}}))},i.prototype.openedSource=function(e){this.currentSourceOffset=this.bytesWritten,this.currentFile=e.file.name;var t=this.streamFiles&&!e.file.dir;if(t){var n=f(e,t,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},i.prototype.closedSource=function(e){this.accumulate=!1;var t=this.streamFiles&&!e.file.dir,n=f(e,t,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),t)this.push({data:p(e),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},i.prototype.flush=function(){for(var e=this.bytesWritten,t=0;t<this.dirRecords.length;t++)this.push({data:this.dirRecords[t],meta:{percent:100}});var n=this.bytesWritten-e,i=h(this.dirRecords.length,n,e,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},i.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},i.prototype.registerPrevious=function(e){this._sources.push(e);var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.closedSource(t.previous.streamInfo),t._sources.length?t.prepareNextSource():t.end()}),e.on("error",function(e){t.error(e)}),this},i.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},i.prototype.error=function(e){var t=this._sources;if(!o.prototype.error.call(this,e))return!1;for(var n=0;n<t.length;n++)try{t[n].error(e)}catch(e){}return!0},i.prototype.lock=function(){o.prototype.lock.call(this);for(var e=this._sources,t=0;t<e.length;t++)e[t].lock()},t.exports=i},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(e,t,n){"use strict";var i=e("../compressions"),r=e("./ZipFileWorker"),o=function(e,t){var n=e||t,r=i[n];if(!r)throw Error(n+" is not a valid compression method !");return r};n.generateWorker=function(e,t,n){var i=new r(t.streamFiles,n,t.platform,t.encodeFileName),a=0;try{e.forEach(function(e,n){a++;var r=o(n.options.compression,t.compression),s=n.options.compressionOptions||t.compressionOptions||{},l=n.dir,u=n.date;n._compressWorker(r,s).withStreamInfo("file",{name:e,dir:l,date:u,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(i)}),i.entriesCount=a}catch(e){i.error(e)}return i}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(e,t,n){"use strict";function i(){if(!(this instanceof i))return new i;if(arguments.length)throw Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var e=new i;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}i.prototype=e("./object"),i.prototype.loadAsync=e("./load"),i.support=e("./support"),i.defaults=e("./defaults"),i.version="3.1.3",i.loadAsync=function(e,t){return(new i).loadAsync(e,t)},i.external=e("./external"),t.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(e,t,n){"use strict";function i(e){return new o.Promise(function(t,n){var i=e.decompressed.getContentWorker().pipe(new l);i.on("error",function(e){n(e)}).on("end",function(){i.streamInfo.crc32!==e.decompressed.crc32?n(Error("Corrupted zip : CRC32 mismatch")):t()}).resume()})}var r=e("./utils"),o=e("./external"),a=e("./utf8"),r=e("./utils"),s=e("./zipEntries"),l=e("./stream/Crc32Probe"),u=e("./nodejsUtils");t.exports=function(e,t){var n=this;return t=r.extend(t||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),u.isNode&&u.isStream(e)?o.Promise.reject(Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",e,!0,t.optimizedBinaryString,t.base64).then(function(e){var n=new s(t);return n.load(e),n}).then(function e(n){var r=[o.Promise.resolve(n)],a=n.files;if(t.checkCRC32)for(var s=0;s<a.length;s++)r.push(i(a[s]));return o.Promise.all(r)}).then(function e(i){for(var r=i.shift(),o=r.files,a=0;a<o.length;a++){var s=o[a];n.file(s.fileNameStr,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileCommentStr.length?s.fileCommentStr:null,unixPermissions:s.unixPermissions,dosPermissions:s.dosPermissions,createFolders:t.createFolders})}return r.zipComment.length&&(n.comment=r.zipComment),n})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(e,t,n){"use strict";function i(e,t){o.call(this,"Nodejs stream input adapter for "+e),this._upstreamEnded=!1,this._bindStream(t)}var r=e("../utils"),o=e("../stream/GenericWorker");r.inherits(i,o),i.prototype._bindStream=function(e){var t=this;this._stream=e,e.pause(),e.on("data",function(e){t.push({data:e,meta:{percent:0}})}).on("error",function(e){t.isPaused?this.generatedError=e:t.error(e)}).on("end",function(){t.isPaused?t._upstreamEnded=!0:t.end()})},i.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},i.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=i},{"../stream/GenericWorker":28,"../utils":32}],13:[function(e,t,n){"use strict";function i(e,t,n){r.call(this,t),this._helper=e;var i=this;e.on("data",function(e,t){i.push(e)||i._helper.pause(),n&&n(t)}).on("error",function(e){i.emit("error",e)}).on("end",function(){i.push(null)})}var r=e("readable-stream").Readable;e("util").inherits(i,r),i.prototype._read=function(){this._helper.resume()},t.exports=i},{"readable-stream":16,util:void 0}],14:[function(e,n,i){"use strict";n.exports={isNode:void 0!==t,newBuffer:function(e,n){return new t(e,n)},isBuffer:function(e){return t.isBuffer(e)},isStream:function(e){return e&&"function"==typeof e.on&&"function"==typeof e.pause&&"function"==typeof e.resume}}},{}],15:[function(e,t,n){"use strict";function i(e){return"[object RegExp]"===Object.prototype.toString.call(e)}var r=e("./utf8"),o=e("./utils"),a=e("./stream/GenericWorker"),s=e("./stream/StreamHelper"),l=e("./defaults"),u=e("./compressedObject"),c=e("./zipObject"),d=e("./generate"),f=e("./nodejsUtils"),h=e("./nodejs/NodejsStreamInputAdapter"),p=function(e,t,n){var i=o.getTypeOf(t),r,s=o.extend(n||{},l);s.date=s.date||new Date,null!==s.compression&&(s.compression=s.compression.toUpperCase()),"string"==typeof s.unixPermissions&&(s.unixPermissions=parseInt(s.unixPermissions,8)),s.unixPermissions&&16384&s.unixPermissions&&(s.dir=!0),s.dosPermissions&&16&s.dosPermissions&&(s.dir=!0),s.dir&&(e=g(e)),s.createFolders&&(r=m(e))&&y.call(this,r,!0);var d="string"===i&&!1===s.binary&&!1===s.base64;n&&void 0!==n.binary||(s.binary=!d),(t instanceof u&&0===t.uncompressedSize||s.dir||!t||0===t.length)&&(s.base64=!1,s.binary=!0,t="",s.compression="STORE",i="string");var p=null;p=t instanceof u||t instanceof a?t:f.isNode&&f.isStream(t)?new h(e,t):o.prepareContent(e,t,s.binary,s.optimizedBinaryString,s.base64);var v=new c(e,p,s);this.files[e]=v},m=function(e){"/"===e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},g=function(e){return"/"!==e.slice(-1)&&(e+="/"),e},y=function(e,t){return t=void 0!==t?t:l.createFolders,e=g(e),this.files[e]||p.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},v={load:function(){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(e){var t,n,i;for(t in this.files)this.files.hasOwnProperty(t)&&(i=this.files[t],(n=t.slice(this.root.length,t.length))&&t.slice(0,this.root.length)===this.root&&e(n,i))},filter:function(e){var t=[];return this.forEach(function(n,i){e(n,i)&&t.push(i)}),t},file:function(e,t,n){if(1===arguments.length){if(i(e)){var r=e;return this.filter(function(e,t){return!t.dir&&r.test(e)})}var o=this.files[this.root+e];return o&&!o.dir?o:null}return e=this.root+e,p.call(this,e,t,n),this},folder:function(e){if(!e)return this;if(i(e))return this.filter(function(t,n){return n.dir&&e.test(t)});var t=this.root+e,n=y.call(this,t),r=this.clone();return r.root=n.name,r},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!==e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter(function(t,n){return n.name.slice(0,e.length)===e}),i=0;i<n.length;i++)delete this.files[n[i].name];return this},generate:function(e){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(e){var t,n={};try{if(n=o.extend(e||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode}),n.type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw Error("No output type specified.");o.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var i=n.comment||this.comment||"";t=d.generateWorker(this,n,i)}catch(e){t=new a("error"),t.error(e)}return new s(t,n.type||"string",n.mimeType)},generateAsync:function(e,t){return this.generateInternalStream(e).accumulate(t)},generateNodeStream:function(e,t){return e=e||{},e.type||(e.type="nodebuffer"),this.generateInternalStream(e).toNodejsStream(t)}};t.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(e,t,n){t.exports=e("stream")},{stream:void 0}],17:[function(e,t,n){"use strict";function i(e){r.call(this,e);for(var t=0;t<this.data.length;t++)e[t]=255&e[t]}var r=e("./DataReader");e("../utils").inherits(i,r),i.prototype.byteAt=function(e){return this.data[this.zero+e]},i.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),r=e.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===t&&this.data[o+1]===n&&this.data[o+2]===i&&this.data[o+3]===r)return o-this.zero;return-1},i.prototype.readAndCheckSignature=function(e){var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),r=e.charCodeAt(3),o=this.readData(4);return t===o[0]&&n===o[1]&&i===o[2]&&r===o[3]},i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return[];var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],18:[function(e,t,n){"use strict";function i(e){this.data=e,this.length=e.length,this.index=0,this.zero=0}var r=e("../utils");i.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<this.zero+e||e<0)throw Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t=0,n;for(this.checkOffset(e),n=this.index+e-1;n>=this.index;n--)t=(t<<8)+this.byteAt(n);return this.index+=e,t},readString:function(e){return r.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readAndCheckSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(Date.UTC(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1))}},t.exports=i},{"../utils":32}],19:[function(e,t,n){"use strict";function i(e){r.call(this,e)}var r=e("./Uint8ArrayReader");e("../utils").inherits(i,r),i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(e,t,n){"use strict";function i(e){r.call(this,e)}var r=e("./DataReader");e("../utils").inherits(i,r),i.prototype.byteAt=function(e){return this.data.charCodeAt(this.zero+e)},i.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)-this.zero},i.prototype.readAndCheckSignature=function(e){return e===this.readData(4)},i.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./DataReader":18}],21:[function(e,t,n){"use strict";function i(e){r.call(this,e)}var r=e("./ArrayReader");e("../utils").inherits(i,r),i.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.zero+this.index,this.zero+this.index+e);return this.index+=e,t},t.exports=i},{"../utils":32,"./ArrayReader":17}],22:[function(e,t,n){"use strict";var i=e("../utils"),r=e("../support"),o=e("./ArrayReader"),a=e("./StringReader"),s=e("./NodeBufferReader"),l=e("./Uint8ArrayReader");t.exports=function(e){var t=i.getTypeOf(e);return i.checkSupport(t),"string"!==t||r.uint8array?"nodebuffer"===t?new s(e):r.uint8array?new l(i.transformTo("uint8array",e)):new o(i.transformTo("array",e)):new a(e)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(e,t,n){"use strict";n.LOCAL_FILE_HEADER="PK\x03\x04",n.CENTRAL_FILE_HEADER="PK\x01\x02",n.CENTRAL_DIRECTORY_END="PK\x05\x06",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(e,t,n){"use strict";function i(e){r.call(this,"ConvertWorker to "+e),this.destType=e}var r=e("./GenericWorker"),o=e("../utils");o.inherits(i,r),i.prototype.processChunk=function(e){this.push({data:o.transformTo(this.destType,e.data),meta:e.meta})},t.exports=i},{"../utils":32,"./GenericWorker":28}],25:[function(e,t,n){"use strict";function i(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}var r=e("./GenericWorker"),o=e("../crc32");e("../utils").inherits(i,r),i.prototype.processChunk=function(e){this.streamInfo.crc32=o(e.data,this.streamInfo.crc32||0),this.push(e)},t.exports=i},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(e,t,n){"use strict";function i(e){o.call(this,"DataLengthProbe for "+e),this.propName=e,this.withStreamInfo(e,0)}var r=e("../utils"),o=e("./GenericWorker");r.inherits(i,o),i.prototype.processChunk=function(e){if(e){var t=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=t+e.data.length}o.prototype.processChunk.call(this,e)},t.exports=i},{"../utils":32,"./GenericWorker":28}],27:[function(e,t,n){"use strict";function i(e){o.call(this,"DataWorker");var t=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,e.then(function(e){t.dataIsReady=!0,t.data=e,t.max=e&&e.length||0,t.type=r.getTypeOf(e),t.isPaused||t._tickAndRepeat()},function(e){t.error(e)})}var r=e("../utils"),o=e("./GenericWorker"),a=16384;r.inherits(i,o),i.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},i.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},i.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},i.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var e=16384,t=null,n=Math.min(this.max,this.index+e);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,n);break;case"uint8array":t=this.data.subarray(this.index,n);break;case"array":case"nodebuffer":t=this.data.slice(this.index,n)}return this.index=n,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=i},{"../utils":32,"./GenericWorker":28}],28:[function(e,t,n){"use strict";function i(e){this.name=e||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(e){this.emit("data",e)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(e){this.emit("error",e)}return!0},error:function(e){return!this.isFinished&&(this.isPaused?this.generatedError=e:(this.isFinished=!0,this.emit("error",e),this.previous&&this.previous.error(e),this.cleanUp()),!0)},on:function(e,t){return this._listeners[e].push(t),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(e,t){if(this._listeners[e])for(var n=0;n<this._listeners[e].length;n++)this._listeners[e][n].call(this,t)},pipe:function(e){return e.registerPrevious(this)},registerPrevious:function(e){if(this.isLocked)throw Error("The stream '"+this+"' has already been used.");this.streamInfo=e.streamInfo,this.mergeStreamInfo(),this.previous=e;var t=this;return e.on("data",function(e){t.processChunk(e)}),e.on("end",function(){t.end()}),e.on("error",function(e){t.error(e)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var e=!1;return this.generatedError&&(this.error(this.generatedError),e=!0),this.previous&&this.previous.resume(),!e},flush:function(){},processChunk:function(e){this.push(e)},withStreamInfo:function(e,t){return this.extraStreamInfo[e]=t,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var e in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(e)&&(this.streamInfo[e]=this.extraStreamInfo[e])},lock:function(){if(this.isLocked)throw Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var e="Worker "+this.name;return this.previous?this.previous+" -> "+e:e}},t.exports=i},{}],29:[function(e,n,i){"use strict";function r(e,t,n,i){var r=null;switch(e){case"blob":return l.newBlob(n,i);case"base64":return r=o(t,n),d.encode(r);default:return r=o(t,n),l.transformTo(e,r)}}function o(e,n){var i,r=0,o=null,a=0;for(i=0;i<n.length;i++)a+=n[i].length;switch(e){case"string":return n.join("");case"array":return Array.prototype.concat.apply([],n);case"uint8array":for(o=new Uint8Array(a),i=0;i<n.length;i++)o.set(n[i],r),r+=n[i].length;return o;case"nodebuffer":return t.concat(n);default:throw Error("concat : unsupported type '"+e+"'")}}function a(e,t){return new h.Promise(function(n,i){var o=[],a=e._internalType,s=e._outputType,l=e._mimeType;e.on("data",function(e,n){o.push(e),t&&t(n)}).on("error",function(e){o=[],i(e)}).on("end",function(){try{var e=r(s,a,o,l);n(e)}catch(e){i(e)}o=[]}).resume()})}function s(e,t,n){var i=t;switch(t){case"blob":i="arraybuffer";break;case"arraybuffer":i="uint8array";break;case"base64":i="string"}try{this._internalType=i,this._outputType=t,this._mimeType=n,l.checkSupport(i),this._worker=e.pipe(new u(i)),e.lock()}catch(e){this._worker=new c("error"),this._worker.error(e)}}var l=e("../utils"),u=e("./ConvertWorker"),c=e("./GenericWorker"),d=e("../base64"),f=e("../support"),h=e("../external"),p=null;if(f.nodestream)try{p=e("../nodejs/NodejsStreamOutputAdapter")}catch(e){}s.prototype={accumulate:function(e){return a(this,e)},on:function(e,t){var n=this;return"data"===e?this._worker.on(e,function(e){t.call(n,e.data,e.meta)}):this._worker.on(e,function(){l.delay(t,arguments,n)}),this},resume:function(){return l.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(e){if(l.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:"nodebuffer"!==this._outputType},e)}},n.exports=s},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(e,n,i){"use strict";if(i.base64=!0,i.array=!0,i.string=!0,i.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,i.nodebuffer=void 0!==t,i.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)i.blob=!1;else{var r=new ArrayBuffer(0);try{i.blob=0===new Blob([r],{type:"application/zip"}).size}catch(e){try{var o=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,a=new o;a.append(r),i.blob=0===a.getBlob("application/zip").size}catch(e){i.blob=!1}}}try{i.nodestream=!!e("readable-stream").Readable}catch(e){i.nodestream=!1}},{"readable-stream":16}],31:[function(e,t,n){"use strict";function i(){l.call(this,"utf-8 decode"),this.leftOver=null}function r(){l.call(this,"utf-8 encode")}for(var o=e("./utils"),a=e("./support"),s=e("./nodejsUtils"),l=e("./stream/GenericWorker"),u=Array(256),c=0;c<256;c++)u[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;u[254]=u[254]=1;var d=function(e){var t,n,i,r,o,s=e.length,l=0;for(r=0;r<s;r++)n=e.charCodeAt(r),55296==(64512&n)&&r+1<s&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=a.uint8array?new Uint8Array(l):Array(l),o=0,r=0;o<l;r++)n=e.charCodeAt(r),55296==(64512&n)&&r+1<s&&56320==(64512&(i=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(i-56320),r++),n<128?t[o++]=n:n<2048?(t[o++]=192|n>>>6,t[o++]=128|63&n):n<65536?(t[o++]=224|n>>>12,t[o++]=128|n>>>6&63,t[o++]=128|63&n):(t[o++]=240|n>>>18,t[o++]=128|n>>>12&63,t[o++]=128|n>>>6&63,t[o++]=128|63&n);return t},f=function(e,t){var n;for(t=t||e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+u[e[n]]>t?n:t},h=function(e){var t,n,i,r,a,s=e.length,l=Array(2*s);for(i=0,n=0;n<s;)if((r=e[n++])<128)l[i++]=r;else if((a=u[r])>4)l[i++]=65533,n+=a-1;else{for(r&=2===a?31:3===a?15:7;a>1&&n<s;)r=r<<6|63&e[n++],a--;a>1?l[i++]=65533:r<65536?l[i++]=r:(r-=65536,l[i++]=55296|r>>10&1023,l[i++]=56320|1023&r)}return l.length!==i&&(l.subarray?l=l.subarray(0,i):l.length=i),o.applyFromCharCode(l)};n.utf8encode=function e(t){return a.nodebuffer?s.newBuffer(t,"utf-8"):d(t)},n.utf8decode=function e(t){return a.nodebuffer?o.transformTo("nodebuffer",t).toString("utf-8"):(t=o.transformTo(a.uint8array?"uint8array":"array",t),h(t))},o.inherits(i,l),i.prototype.processChunk=function(e){var t=o.transformTo(a.uint8array?"uint8array":"array",e.data);if(this.leftOver&&this.leftOver.length){if(a.uint8array){var i=t;t=new Uint8Array(i.length+this.leftOver.length),t.set(this.leftOver,0),t.set(i,this.leftOver.length)}else t=this.leftOver.concat(t);this.leftOver=null}var r=f(t),s=t;r!==t.length&&(a.uint8array?(s=t.subarray(0,r),this.leftOver=t.subarray(r,t.length)):(s=t.slice(0,r),this.leftOver=t.slice(r,t.length))),this.push({data:n.utf8decode(s),meta:e.meta})},i.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=i,o.inherits(r,l),r.prototype.processChunk=function(e){this.push({data:n.utf8encode(e.data),meta:e.meta})},n.Utf8EncodeWorker=r},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(e,t,n){"use strict";function i(e){var t=null;return t=l.uint8array?new Uint8Array(e.length):Array(e.length),o(e,t)}function r(e){return e}function o(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}function a(e){var t=65536,i=n.getTypeOf(e),r=!0;if("uint8array"===i?r=h.applyCanBeUsed.uint8array:"nodebuffer"===i&&(r=h.applyCanBeUsed.nodebuffer),r)for(;t>1;)try{return h.stringifyByChunk(e,i,t)}catch(e){t=Math.floor(t/2)}return h.stringifyByChar(e)}function s(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}var l=e("./support"),u=e("./base64"),c=e("./nodejsUtils"),d=e("core-js/library/fn/set-immediate"),f=e("./external");n.newBlob=function(e,t){n.checkSupport("blob");try{return new Blob(e,{type:t})}catch(n){try{for(var i=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,r=new i,o=0;o<e.length;o++)r.append(e[o]);return r.getBlob(t)}catch(e){throw Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(e,t,n){var i=[],r=0,o=e.length;if(o<=n)return String.fromCharCode.apply(null,e);for(;r<o;)"array"===t||"nodebuffer"===t?i.push(String.fromCharCode.apply(null,e.slice(r,Math.min(r+n,o)))):i.push(String.fromCharCode.apply(null,e.subarray(r,Math.min(r+n,o)))),r+=n;return i.join("")},stringifyByChar:function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t},applyCanBeUsed:{uint8array:function(){try{return l.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(e){return!1}}(),nodebuffer:function(){try{return l.nodebuffer&&1===String.fromCharCode.apply(null,c.newBuffer(1)).length}catch(e){return!1}}()}};n.applyFromCharCode=a;var p={};p.string={string:r,array:function(e){return o(e,Array(e.length))},arraybuffer:function(e){return p.string.uint8array(e).buffer},uint8array:function(e){return o(e,new Uint8Array(e.length))},nodebuffer:function(e){return o(e,c.newBuffer(e.length))}},p.array={string:a,array:r,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return c.newBuffer(e)}},p.arraybuffer={string:function(e){return a(new Uint8Array(e))},array:function(e){return s(new Uint8Array(e),Array(e.byteLength))},arraybuffer:r,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return c.newBuffer(new Uint8Array(e))}},p.uint8array={string:a,array:function(e){return s(e,Array(e.length))},arraybuffer:function(e){var t=new Uint8Array(e.length);return e.length&&t.set(e,0),t.buffer},uint8array:r,nodebuffer:function(e){return c.newBuffer(e)}},p.nodebuffer={string:a,array:function(e){return s(e,Array(e.length))},arraybuffer:function(e){return p.nodebuffer.uint8array(e).buffer},uint8array:function(e){return s(e,new Uint8Array(e.length))},nodebuffer:r},n.transformTo=function(e,t){if(t||(t=""),!e)return t;n.checkSupport(e);var i=n.getTypeOf(t);return p[i][e](t)},n.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":l.nodebuffer&&c.isBuffer(e)?"nodebuffer":l.uint8array&&e instanceof Uint8Array?"uint8array":l.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(e){if(!l[e.toLowerCase()])throw Error(e+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(e){var t="",n,i;for(i=0;i<(e||"").length;i++)n=e.charCodeAt(i),t+="\\x"+(n<16?"0":"")+n.toString(16).toUpperCase();return t},n.delay=function(e,t,n){d(function(){e.apply(n||null,t||[])})},n.inherits=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n},n.extend=function(){var e={},t,n;for(t=0;t<arguments.length;t++)for(n in arguments[t])arguments[t].hasOwnProperty(n)&&void 0===e[n]&&(e[n]=arguments[t][n]);return e},n.prepareContent=function(e,t,r,o,a){return f.Promise.resolve(t).then(function(e){return l.blob&&(e instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(e)))&&"undefined"!=typeof FileReader?new f.Promise(function(t,n){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.onerror=function(e){n(e.target.error)},i.readAsArrayBuffer(e)}):e}).then(function(t){var s=n.getTypeOf(t);return s?("arraybuffer"===s?t=n.transformTo("uint8array",t):"string"===s&&(a?t=u.decode(t):r&&!0!==o&&(t=i(t))),t):f.Promise.reject(Error("The data of '"+e+"' is in an unsupported format !"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"core-js/library/fn/set-immediate":36}],33:[function(e,t,n){"use strict";function i(e){this.files=[],this.loadOptions=e}var r=e("./reader/readerFor"),o=e("./utils"),a=e("./signature"),s=e("./zipEntry"),l=e("./utf8"),u=e("./support");i.prototype={checkSignature:function(e){if(!this.reader.readAndCheckSignature(e)){this.reader.index-=4;var t=this.reader.readString(4);throw Error("Corrupted zip or bug : unexpected signature ("+o.pretty(t)+", expected "+o.pretty(e)+")")}},isSignature:function(e,t){var n=this.reader.index;this.reader.setIndex(e);var i=this.reader.readString(4),r=i===t;return this.reader.setIndex(n),r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var e=this.reader.readData(this.zipCommentLength),t=u.uint8array?"uint8array":"array",n=o.transformTo(t,e);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e=this.zip64EndOfCentralSize-44,t=0,n,i,r;0<e;)n=this.reader.readInt(2),i=this.reader.readInt(4),r=this.reader.readData(i),this.zip64ExtensibleData[n]={id:n,length:i,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8(),t.processAttributes()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)e=new s({zip64:this.zip64},this.loadOptions),e.readCentralPart(this.reader),this.files.push(e);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(e<0){throw!this.isSignature(0,a.LOCAL_FILE_HEADER)?Error("Can't find end of central directory : is this a zip file ? If it is, see http://stuk.github.io/jszip/documentation/howto/read_zip.html"):Error("Corrupted zip : can't find end of central directory")}this.reader.setIndex(e);var t=e;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(e=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw Error("Corrupted zip : can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(e),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw Error("Corrupted zip : can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var i=t-n;if(i>0)this.isSignature(t,a.CENTRAL_FILE_HEADER)||(this.reader.zero=i);else if(i<0)throw Error("Corrupted zip: missing "+Math.abs(i)+" bytes.")},prepareReader:function(e){this.reader=r(e)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=i},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(e,t,n){"use strict";function i(e,t){this.options=e,this.loadOptions=t}var r=e("./reader/readerFor"),o=e("./utils"),a=e("./compressedObject"),s=e("./crc32"),l=e("./utf8"),u=e("./compressions"),c=e("./support"),d=0,f=3,h=function(e){for(var t in u)if(u.hasOwnProperty(t)&&u[t].magic===e)return u[t];return null};i.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readData(this.fileNameLength),e.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(t=h(this.compressionMethod)))throw Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,t,e.readData(this.compressedSize))},readCentralPart:function(e){this.versionMadeBy=e.readInt(2),e.skip(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4);var t=e.readInt(2);if(this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw Error("Encrypted zip are not supported");e.skip(t),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var e=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===e&&(this.dosPermissions=63&this.externalFileAttributes),3===e&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t=e.index+this.extraFieldsLength,n,i,r;for(this.extraFields||(this.extraFields={});e.index<t;)n=e.readInt(2),i=e.readInt(2),r=e.readData(i),this.extraFields[n]={id:n,length:i,value:r}},handleUTF8:function(){var e=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=l.utf8decode(this.fileName),this.fileCommentStr=l.utf8decode(this.fileComment);else{var t=this.findExtraFieldUnicodePath();if(null!==t)this.fileNameStr=t;else{var n=o.transformTo(e,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var i=this.findExtraFieldUnicodeComment();if(null!==i)this.fileCommentStr=i;else{var r=o.transformTo(e,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(r)}}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=r(e.value);return 1!==t.readInt(1)?null:s(this.fileName)!==t.readInt(4)?null:l.utf8decode(t.readData(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=r(e.value);return 1!==t.readInt(1)?null:s(this.fileComment)!==t.readInt(4)?null:l.utf8decode(t.readData(e.length-5))}return null}},t.exports=i},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(e,t,n){"use strict";var i=e("./stream/StreamHelper"),r=e("./stream/DataWorker"),o=e("./utf8"),a=e("./compressedObject"),s=e("./stream/GenericWorker"),l=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=t,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};l.prototype={internalStream:function(e){var t=e.toLowerCase(),n="string"===t||"text"===t;"binarystring"!==t&&"text"!==t||(t="string");var r=this._decompressWorker(),a=!this._dataBinary;return a&&!n&&(r=r.pipe(new o.Utf8EncodeWorker)),!a&&n&&(r=r.pipe(new o.Utf8DecodeWorker)),new i(r,t,"")},async:function(e,t){return this.internalStream(e).accumulate(t)},nodeStream:function(e,t){return this.internalStream(e||"nodebuffer").toNodejsStream(t)},_compressWorker:function(e,t){if(this._data instanceof a&&this._data.compression.magic===e.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new o.Utf8EncodeWorker)),a.createWorkerFrom(n,e,t)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof s?this._data:new r(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],c=function(){throw Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},d=0;d<5;d++)l.prototype[u[d]]=c;t.exports=l},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(e,t,n){e("../modules/web.immediate"),t.exports=e("../modules/_core").setImmediate},{"../modules/_core":40,"../modules/web.immediate":56}],37:[function(e,t,n){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],38:[function(e,t,n){var i=e("./_is-object");t.exports=function(e){if(!i(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":51}],39:[function(e,t,n){var i={}.toString;t.exports=function(e){return i.call(e).slice(8,-1)}},{}],40:[function(e,t,n){var i=t.exports={version:"2.3.0"};"number"==typeof __e&&(__e=i)},{}],41:[function(e,t,n){var i=e("./_a-function");t.exports=function(e,t,n){if(i(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":37}],42:[function(e,t,n){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":45}],43:[function(e,t,n){var i=e("./_is-object"),r=e("./_global").document,o=i(r)&&i(r.createElement);t.exports=function(e){return o?r.createElement(e):{}}},{"./_global":46,"./_is-object":51}],44:[function(e,t,n){var i=e("./_global"),r=e("./_core"),o=e("./_ctx"),a=e("./_hide"),s="prototype",l=function(e,t,n){var u=e&l.F,c=e&l.G,d=e&l.S,f=e&l.P,h=e&l.B,p=e&l.W,m=c?r:r[t]||(r[t]={}),g=m[s],y=c?i:d?i[t]:(i[t]||{})[s],v,b,x;c&&(n=t);for(v in n)(b=!u&&y&&void 0!==y[v])&&v in m||(x=b?y[v]:n[v],m[v]=c&&"function"!=typeof y[v]?n[v]:h&&b?o(x,i):p&&y[v]==x?function(e){var t=function(t,n,i){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,i)}return e.apply(this,arguments)};return t[s]=e[s],t}(x):f&&"function"==typeof x?o(Function.call,x):x,f&&((m.virtual||(m.virtual={}))[v]=x,e&l.R&&g&&!g[v]&&a(g,v,x)))};l.F=1,l.G=2,l.S=4,l.P=8,l.B=16,l.W=32,l.U=64,l.R=128,t.exports=l},{"./_core":40,"./_ctx":41,"./_global":46,"./_hide":47}],45:[function(e,t,n){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],46:[function(e,t,n){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},{}],47:[function(e,t,n){var i=e("./_object-dp"),r=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,n){return i.f(e,t,r(1,n))}:function(e,t,n){return e[t]=n,e}},{"./_descriptors":42,"./_object-dp":52,"./_property-desc":53}],48:[function(e,t,n){t.exports=e("./_global").document&&document.documentElement},{"./_global":46}],49:[function(e,t,n){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":42,"./_dom-create":43,"./_fails":45}],50:[function(e,t,n){t.exports=function(e,t,n){var i=void 0===n;switch(t.length){case 0:return i?e():e.call(n);case 1:return i?e(t[0]):e.call(n,t[0]);case 2:return i?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},{}],51:[function(e,t,n){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],52:[function(e,t,n){var i=e("./_an-object"),r=e("./_ie8-dom-define"),o=e("./_to-primitive"),a=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function e(t,n,s){if(i(t),n=o(n,!0),i(s),r)try{return a(t,n,s)}catch(e){}if("get"in s||"set"in s)throw TypeError("Accessors not supported!");return"value"in s&&(t[n]=s.value),t}},{"./_an-object":38,"./_descriptors":42,"./_ie8-dom-define":49,"./_to-primitive":55}],53:[function(e,t,n){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],54:[function(e,t,n){var i=e("./_ctx"),r=e("./_invoke"),o=e("./_html"),a=e("./_dom-create"),s=e("./_global"),l=s.process,u=s.setImmediate,c=s.clearImmediate,d=s.MessageChannel,f=0,h={},p="onreadystatechange",m,g,y,v=function(){var e=+this;if(h.hasOwnProperty(e)){var t=h[e];delete h[e],t()}},b=function(e){v.call(e.data)};u&&c||(u=function e(t){for(var n=[],i=1;arguments.length>i;)n.push(arguments[i++]);return h[++f]=function(){r("function"==typeof t?t:Function(t),n)},m(f),f},c=function e(t){delete h[t]},"process"==e("./_cof")(l)?m=function(e){l.nextTick(i(v,e,1))}:d?(g=new d,y=g.port2,g.port1.onmessage=b,m=i(y.postMessage,y,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(m=function(e){s.postMessage(e+"","*")},s.addEventListener("message",b,!1)):m=p in a("script")?function(e){o.appendChild(a("script"))[p]=function(){o.removeChild(this),v.call(e)}}:function(e){setTimeout(i(v,e,1),0)}),t.exports={set:u,clear:c}},{"./_cof":39,"./_ctx":41,"./_dom-create":43,"./_global":46,"./_html":48,"./_invoke":50}],55:[function(e,t,n){var i=e("./_is-object");t.exports=function(e,t){if(!i(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!i(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!i(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":51}],56:[function(e,t,n){var i=e("./_export"),r=e("./_task");i(i.G+i.B,{setImmediate:r.set,clearImmediate:r.clear})},{"./_export":44,"./_task":54}],57:[function(e,t,i){(function(e){"use strict";function n(){c=!0;for(var e,t,n=d.length;n;){for(t=d,d=[],e=-1;++e<n;)t[e]();n=d.length}c=!1}function i(e){1!==d.push(e)||c||o()}var r=e.MutationObserver||e.WebKitMutationObserver,o;if(r){var a=0,s=new r(n),l=e.document.createTextNode("");s.observe(l,{characterData:!0}),o=function(){l.data=a=++a%2}}else if(e.setImmediate||void 0===e.MessageChannel)o="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){n(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(n,0)};else{var u=new e.MessageChannel;u.port1.onmessage=n,o=function(){u.port2.postMessage(0)}}var c,d=[];t.exports=i}).call(this,void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],58:[function(e,t,n){"use strict";function i(){}function r(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=v,this.queue=[],this.outcome=void 0,e!==i&&l(this,e)}function o(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function a(e,t,n){p(function(){var i;try{i=t(n)}catch(t){return m.reject(e,t)}i===e?m.reject(e,new TypeError("Cannot resolve promise with itself")):m.resolve(e,i)})}function s(e){var t=e&&e.then;if(e&&"object"==typeof e&&"function"==typeof t)return function n(){t.apply(e,arguments)}}function l(e,t){function n(t){o||(o=!0,m.reject(e,t))}function i(t){o||(o=!0,m.resolve(e,t))}function r(){t(i,n)}var o=!1,a=u(r);"error"===a.status&&n(a.value)}function u(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function c(e){return e instanceof this?e:m.resolve(new this(i),e)}function d(e){var t=new this(i);return m.reject(t,e)}function f(e){function t(e,t){function i(e){a[t]=e,++s!==r||o||(o=!0,m.resolve(u,a))}n.resolve(e).then(i,function(e){o||(o=!0,m.reject(u,e))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,o=!1;if(!r)return this.resolve([]);for(var a=Array(r),s=0,l=-1,u=new this(i);++l<r;)t(e[l],l);return u}function h(e){function t(e){n.resolve(e).then(function(e){o||(o=!0,m.resolve(s,e))},function(e){o||(o=!0,m.reject(s,e))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,o=!1;if(!r)return this.resolve([]);for(var a=-1,s=new this(i);++a<r;)t(e[a]);return s}var p=e("immediate"),m={},g=["REJECTED"],y=["FULFILLED"],v=["PENDING"];t.exports=r,r.prototype.catch=function(e){return this.then(null,e)},r.prototype.then=function(e,t){if("function"!=typeof e&&this.state===y||"function"!=typeof t&&this.state===g)return this;var n=new this.constructor(i);if(this.state!==v){a(n,this.state===y?e:t,this.outcome)}else this.queue.push(new o(n,e,t));return n},o.prototype.callFulfilled=function(e){m.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){a(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){m.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){a(this.promise,this.onRejected,e)},m.resolve=function(e,t){var n=u(s,t);if("error"===n.status)return m.reject(e,n.value);var i=n.value;if(i)l(e,i);else{e.state=y,e.outcome=t;for(var r=-1,o=e.queue.length;++r<o;)e.queue[r].callFulfilled(t)}return e},m.reject=function(e,t){e.state=g,e.outcome=t;for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callRejected(t);return e},r.resolve=c,r.reject=d,r.all=f,r.race=h},{immediate:57}],59:[function(e,t,n){"use strict";var i=e("./lib/utils/common").assign,r=e("./lib/deflate"),o=e("./lib/inflate"),a=e("./lib/zlib/constants"),s={};i(s,r,o,a),t.exports=s},{"./lib/deflate":60,"./lib/inflate":61,"./lib/utils/common":62,"./lib/zlib/constants":65}],60:[function(e,t,n){"use strict";function i(e){if(!(this instanceof i))return new i(e);this.options=l.assign({level:v,method:x,chunkSize:16384,windowBits:15,memLevel:8,strategy:b,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var n=s.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==m)throw Error(c[n]);if(t.header&&s.deflateSetHeader(this.strm,t.header),t.dictionary){var r;if(r="string"==typeof t.dictionary?u.string2buf(t.dictionary):"[object ArrayBuffer]"===f.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=s.deflateSetDictionary(this.strm,r))!==m)throw Error(c[n]);this._dict_set=!0}}function r(e,t){var n=new i(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function o(e,t){return t=t||{},t.raw=!0,r(e,t)}function a(e,t){return t=t||{},t.gzip=!0,r(e,t)}var s=e("./zlib/deflate"),l=e("./utils/common"),u=e("./utils/strings"),c=e("./zlib/messages"),d=e("./zlib/zstream"),f=Object.prototype.toString,h=0,p=4,m=0,g=1,y=2,v=-1,b=0,x=8;i.prototype.push=function(e,t){var n=this.strm,i=this.options.chunkSize,r,o;if(this.ended)return!1;o=t===~~t?t:!0===t?4:0,"string"==typeof e?n.input=u.string2buf(e):"[object ArrayBuffer]"===f.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new l.Buf8(i),n.next_out=0,n.avail_out=i),1!==(r=s.deflate(n,o))&&r!==m)return this.onEnd(r),this.ended=!0,!1;0!==n.avail_out&&(0!==n.avail_in||4!==o&&2!==o)||("string"===this.options.to?this.onData(u.buf2binstring(l.shrinkBuf(n.output,n.next_out))):this.onData(l.shrinkBuf(n.output,n.next_out)))}while((n.avail_in>0||0===n.avail_out)&&1!==r);return 4===o?(r=s.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===m):2!==o||(this.onEnd(m),n.avail_out=0,!0)},i.prototype.onData=function(e){this.chunks.push(e)},i.prototype.onEnd=function(e){e===m&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=l.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=i,n.deflate=r,n.deflateRaw=o,n.gzip=a},{"./utils/common":62,"./utils/strings":63,"./zlib/deflate":67,"./zlib/messages":72,"./zlib/zstream":74}],61:[function(e,t,n){"use strict";function i(e){if(!(this instanceof i))return new i(e);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var n=a.inflateInit2(this.strm,t.windowBits);if(n!==u.Z_OK)throw Error(c[n]);this.header=new f,a.inflateGetHeader(this.strm,this.header)}function r(e,t){var n=new i(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function o(e,t){return t=t||{},t.raw=!0,r(e,t)}var a=e("./zlib/inflate"),s=e("./utils/common"),l=e("./utils/strings"),u=e("./zlib/constants"),c=e("./zlib/messages"),d=e("./zlib/zstream"),f=e("./zlib/gzheader"),h=Object.prototype.toString;i.prototype.push=function(e,t){var n=this.strm,i=this.options.chunkSize,r=this.options.dictionary,o,c,d,f,p,m,g=!1;if(this.ended)return!1;c=t===~~t?t:!0===t?u.Z_FINISH:u.Z_NO_FLUSH,"string"==typeof e?n.input=l.binstring2buf(e):"[object ArrayBuffer]"===h.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;do{if(0===n.avail_out&&(n.output=new s.Buf8(i),n.next_out=0,n.avail_out=i),o=a.inflate(n,u.Z_NO_FLUSH),o===u.Z_NEED_DICT&&r&&(m="string"==typeof r?l.string2buf(r):"[object ArrayBuffer]"===h.call(r)?new Uint8Array(r):r,o=a.inflateSetDictionary(this.strm,m)),o===u.Z_BUF_ERROR&&!0===g&&(o=u.Z_OK,g=!1),o!==u.Z_STREAM_END&&o!==u.Z_OK)return this.onEnd(o),this.ended=!0,!1;n.next_out&&(0!==n.avail_out&&o!==u.Z_STREAM_END&&(0!==n.avail_in||c!==u.Z_FINISH&&c!==u.Z_SYNC_FLUSH)||("string"===this.options.to?(d=l.utf8border(n.output,n.next_out),f=n.next_out-d,p=l.buf2string(n.output,d),n.next_out=f,n.avail_out=i-f,f&&s.arraySet(n.output,n.output,d,f,0),this.onData(p)):this.onData(s.shrinkBuf(n.output,n.next_out)))),0===n.avail_in&&0===n.avail_out&&(g=!0)}while((n.avail_in>0||0===n.avail_out)&&o!==u.Z_STREAM_END);return o===u.Z_STREAM_END&&(c=u.Z_FINISH),c===u.Z_FINISH?(o=a.inflateEnd(this.strm),this.onEnd(o),this.ended=!0,o===u.Z_OK):c!==u.Z_SYNC_FLUSH||(this.onEnd(u.Z_OK),n.avail_out=0,!0)},i.prototype.onData=function(e){this.chunks.push(e)},i.prototype.onEnd=function(e){e===u.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=i,n.inflate=r,n.inflateRaw=o,n.ungzip=r},{"./utils/common":62,"./utils/strings":63,"./zlib/constants":65,"./zlib/gzheader":68,"./zlib/inflate":70,"./zlib/messages":72,"./zlib/zstream":74}],62:[function(e,t,n){"use strict";var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,n,i,r){if(t.subarray&&e.subarray)return void e.set(t.subarray(n,n+i),r);for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){var t,n,i,r,o,a;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),r=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,r),r+=o.length;return a}},o={arraySet:function(e,t,n,i,r){for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(i)},{}],63:[function(e,t,n){"use strict";function i(e,t){if(t<65537&&(e.subarray&&a||!e.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(e,t));for(var n="",i=0;i<t;i++)n+=String.fromCharCode(e[i]);return n}var r=e("./common"),o=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(e){o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){a=!1}for(var s=new r.Buf8(256),l=0;l<256;l++)s[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s[254]=s[254]=1,n.string2buf=function(e){var t,n,i,o,a,s=e.length,l=0;for(o=0;o<s;o++)n=e.charCodeAt(o),55296==(64512&n)&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new r.Buf8(l),a=0,o=0;a<l;o++)n=e.charCodeAt(o),55296==(64512&n)&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},n.buf2binstring=function(e){return i(e,e.length)},n.binstring2buf=function(e){for(var t=new r.Buf8(e.length),n=0,i=t.length;n<i;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,r,o,a,l=t||e.length,u=Array(2*l);for(r=0,n=0;n<l;)if((o=e[n++])<128)u[r++]=o;else if((a=s[o])>4)u[r++]=65533,n+=a-1;else{for(o&=2===a?31:3===a?15:7;a>1&&n<l;)o=o<<6|63&e[n++],a--;a>1?u[r++]=65533:o<65536?u[r++]=o:(o-=65536,u[r++]=55296|o>>10&1023,u[r++]=56320|1023&o)}return i(u,r)},n.utf8border=function(e,t){var n;for(t=t||e.length,t>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0?t:0===n?t:n+s[e[n]]>t?n:t}},{"./common":62}],64:[function(e,t,n){"use strict";function i(e,t,n,i){for(var r=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){a=n>2e3?2e3:n,n-=a;do{r=r+t[i++]|0,o=o+r|0}while(--a);r%=65521,o%=65521}return r|o<<16|0}t.exports=i},{}],65:[function(e,t,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],66:[function(e,t,n){"use strict";function i(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}function r(e,t,n,i){var r=o,a=i+n;e^=-1;for(var s=i;s<a;s++)e=e>>>8^r[255&(e^t[s])];return-1^e}var o=i();t.exports=r},{}],67:[function(e,t,n){"use strict";function i(e,t){return e.msg=P[t],t}function r(e){return(e<<1)-(e>4?9:0)}function o(e){for(var t=e.length;--t>=0;)e[t]=0}function a(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(k.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function s(e,t){D._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,a(e.strm)}function l(e,t){e.pending_buf[e.pending++]=t}function u(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function c(e,t,n,i){var r=e.avail_in;return r>i&&(r=i),0===r?0:(e.avail_in-=r,k.arraySet(t,e.input,e.next_in,r,n),1===e.state.wrap?e.adler=A(e.adler,t,r,n):2===e.state.wrap&&(e.adler=T(e.adler,t,r,n)),e.next_in+=r,e.total_in+=r,r)}function d(e,t){var n=e.max_chain_length,i=e.strstart,r,o,a=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-ce?e.strstart-(e.w_size-ce):0,u=e.window,c=e.w_mask,d=e.prev,f=e.strstart+ue,h=u[i+a-1],p=u[i+a];e.prev_length>=e.good_match&&(n>>=2),s>e.lookahead&&(s=e.lookahead);do{if(r=t,u[r+a]===p&&u[r+a-1]===h&&u[r]===u[i]&&u[++r]===u[i+1]){i+=2,r++;do{}while(u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&u[++i]===u[++r]&&i<f);if(o=ue-(f-i),i=f-ue,o>a){if(e.match_start=t,a=o,o>=s)break;h=u[i+a-1],p=u[i+a]}}}while((t=d[t&c])>l&&0!=--n);return a<=e.lookahead?a:e.lookahead}function f(e){var t=e.w_size,n,i,r,o,a;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-ce)){k.arraySet(e.window,e.window,t,t,0),e.match_start-=t,e.strstart-=t,e.block_start-=t,i=e.hash_size,n=i;do{r=e.head[--n],e.head[n]=r>=t?r-t:0}while(--i);i=t,n=i;do{r=e.prev[--n],e.prev[n]=r>=t?r-t:0}while(--i);o+=t}if(0===e.strm.avail_in)break;if(i=c(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=le)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+le-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<le)););}while(e.lookahead<ce&&0!==e.strm.avail_in)}function h(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(f(e),0===e.lookahead&&t===F)return be;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,s(e,!1),0===e.strm.avail_out))return be;if(e.strstart-e.block_start>=e.w_size-ce&&(s(e,!1),0===e.strm.avail_out))return be}return e.insert=0,t===R?(s(e,!0),0===e.strm.avail_out?Ee:we):(e.strstart>e.block_start&&(s(e,!1),e.strm.avail_out),be)}function p(e,t){for(var n,i;;){if(e.lookahead<ce){if(f(e),e.lookahead<ce&&t===F)return be;if(0===e.lookahead)break}if(n=0,e.lookahead>=le&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+le-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-ce&&(e.match_length=d(e,n)),e.match_length>=le)if(i=D._tr_tally(e,e.strstart-e.match_start,e.match_length-le),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=le){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+le-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=D._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(s(e,!1),0===e.strm.avail_out))return be}return e.insert=e.strstart<le-1?e.strstart:le-1,t===R?(s(e,!0),0===e.strm.avail_out?Ee:we):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?be:xe}function m(e,t){for(var n,i,r;;){if(e.lookahead<ce){if(f(e),e.lookahead<ce&&t===F)return be;if(0===e.lookahead)break}if(n=0,e.lookahead>=le&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+le-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=le-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-ce&&(e.match_length=d(e,n),e.match_length<=5&&(e.strategy===H||e.match_length===le&&e.strstart-e.match_start>4096)&&(e.match_length=le-1)),e.prev_length>=le&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-le,i=D._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-le),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+le-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=le-1,e.strstart++,i&&(s(e,!1),0===e.strm.avail_out))return be}else if(e.match_available){if(i=D._tr_tally(e,0,e.window[e.strstart-1]),i&&s(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return be}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=D._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<le-1?e.strstart:le-1,t===R?(s(e,!0),0===e.strm.avail_out?Ee:we):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?be:xe}function g(e,t){for(var n,i,r,o,a=e.window;;){if(e.lookahead<=ue){if(f(e),e.lookahead<=ue&&t===F)return be;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=le&&e.strstart>0&&(r=e.strstart-1,(i=a[r])===a[++r]&&i===a[++r]&&i===a[++r])){o=e.strstart+ue;do{}while(i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&r<o);e.match_length=ue-(o-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=le?(n=D._tr_tally(e,1,e.match_length-le),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=D._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(s(e,!1),0===e.strm.avail_out))return be}return e.insert=0,t===R?(s(e,!0),0===e.strm.avail_out?Ee:we):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?be:xe}function y(e,t){for(var n;;){if(0===e.lookahead&&(f(e),0===e.lookahead)){if(t===F)return be;break}if(e.match_length=0,n=D._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(s(e,!1),0===e.strm.avail_out))return be}return e.insert=0,t===R?(s(e,!0),0===e.strm.avail_out?Ee:we):e.last_lit&&(s(e,!1),0===e.strm.avail_out)?be:xe}function v(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r}function b(e){e.window_size=2*e.w_size,o(e.head),e.max_lazy_match=_e[e.level].max_lazy,e.good_match=_e[e.level].good_length,e.nice_match=_e[e.level].nice_length,e.max_chain_length=_e[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=le-1,e.match_available=0,e.ins_h=0}function x(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Q,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new k.Buf16(2*ae),this.dyn_dtree=new k.Buf16(2*(2*re+1)),this.bl_tree=new k.Buf16(2*(2*oe+1)),o(this.dyn_ltree),o(this.dyn_dtree),o(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new k.Buf16(se+1),this.heap=new k.Buf16(2*ie+1),o(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new k.Buf16(2*ie+1),o(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function E(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=X,t=e.state,t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?fe:ye,e.adler=2===t.wrap?0:1,t.last_flush=F,D._tr_init(t),N):i(e,V)}function w(e){var t=E(e);return t===N&&b(e.state),t}function C(e,t){return e&&e.state?2!==e.state.wrap?V:(e.state.gzhead=t,N):V}function _(e,t,n,r,o,a){if(!e)return V;var s=1;if(t===q&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),o<1||o>Z||n!==Q||r<8||r>15||t<0||t>9||a<0||a>K)return i(e,V);8===r&&(r=9);var l=new x;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+le-1)/le),l.window=new k.Buf8(2*l.w_size),l.head=new k.Buf16(l.hash_size),l.prev=new k.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new k.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=a,l.method=n,w(e)}function B(e,t){return _(e,t,Q,J,ee,Y)}function U(e,t){var n,s,c,d;if(!e||!e.state||t>O||t<0)return e?i(e,V):V;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===ve&&t!==R)return i(e,0===e.avail_out?W:V);if(s.strm=e,n=s.last_flush,s.last_flush=t,s.status===fe)if(2===s.wrap)e.adler=0,l(s,31),l(s,139),l(s,8),s.gzhead?(l(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),l(s,255&s.gzhead.time),l(s,s.gzhead.time>>8&255),l(s,s.gzhead.time>>16&255),l(s,s.gzhead.time>>24&255),l(s,9===s.level?2:s.strategy>=G||s.level<2?4:0),l(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(l(s,255&s.gzhead.extra.length),l(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=T(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=he):(l(s,0),l(s,0),l(s,0),l(s,0),l(s,0),l(s,9===s.level?2:s.strategy>=G||s.level<2?4:0),l(s,Ce),s.status=ye);else{var f=Q+(s.w_bits-8<<4)<<8,h=-1;h=s.strategy>=G||s.level<2?0:s.level<6?1:6===s.level?2:3,f|=h<<6,0!==s.strstart&&(f|=de),f+=31-f%31,s.status=ye,u(s,f),0!==s.strstart&&(u(s,e.adler>>>16),u(s,65535&e.adler)),e.adler=1}if(s.status===he)if(s.gzhead.extra){for(c=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>c&&(e.adler=T(e.adler,s.pending_buf,s.pending-c,c)),a(e),c=s.pending,s.pending!==s.pending_buf_size));)l(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>c&&(e.adler=T(e.adler,s.pending_buf,s.pending-c,c)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=pe)}else s.status=pe;if(s.status===pe)if(s.gzhead.name){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=T(e.adler,s.pending_buf,s.pending-c,c)),a(e),c=s.pending,s.pending===s.pending_buf_size)){d=1;break}d=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,l(s,d)}while(0!==d);s.gzhead.hcrc&&s.pending>c&&(e.adler=T(e.adler,s.pending_buf,s.pending-c,c)),0===d&&(s.gzindex=0,s.status=me)}else s.status=me;if(s.status===me)if(s.gzhead.comment){c=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>c&&(e.adler=T(e.adler,s.pending_buf,s.pending-c,c)),a(e),c=s.pending,s.pending===s.pending_buf_size)){d=1;break}d=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,l(s,d)}while(0!==d);s.gzhead.hcrc&&s.pending>c&&(e.adler=T(e.adler,s.pending_buf,s.pending-c,c)),0===d&&(s.status=ge)}else s.status=ge;if(s.status===ge&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&a(e),s.pending+2<=s.pending_buf_size&&(l(s,255&e.adler),l(s,e.adler>>8&255),e.adler=0,s.status=ye)):s.status=ye),0!==s.pending){if(a(e),0===e.avail_out)return s.last_flush=-1,N}else if(0===e.avail_in&&r(t)<=r(n)&&t!==R)return i(e,W);if(s.status===ve&&0!==e.avail_in)return i(e,W);if(0!==e.avail_in||0!==s.lookahead||t!==F&&s.status!==ve){var p=s.strategy===G?y(s,t):s.strategy===$?g(s,t):_e[s.level].func(s,t);if(p!==Ee&&p!==we||(s.status=ve),p===be||p===Ee)return 0===e.avail_out&&(s.last_flush=-1),N;if(p===xe&&(t===L?D._tr_align(s):t!==O&&(D._tr_stored_block(s,0,0,!1),t===M&&(o(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),a(e),0===e.avail_out))return s.last_flush=-1,N}return t!==R?N:s.wrap<=0?j:(2===s.wrap?(l(s,255&e.adler),l(s,e.adler>>8&255),l(s,e.adler>>16&255),l(s,e.adler>>24&255),l(s,255&e.total_in),l(s,e.total_in>>8&255),l(s,e.total_in>>16&255),l(s,e.total_in>>24&255)):(u(s,e.adler>>>16),u(s,65535&e.adler)),a(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?N:j)}function I(e){var t;return e&&e.state?(t=e.state.status)!==fe&&t!==he&&t!==pe&&t!==me&&t!==ge&&t!==ye&&t!==ve?i(e,V):(e.state=null,t===ye?i(e,z):N):V}function S(e,t){var n=t.length,i,r,a,s,l,u,c,d;if(!e||!e.state)return V;if(i=e.state,2===(s=i.wrap)||1===s&&i.status!==fe||i.lookahead)return V;for(1===s&&(e.adler=A(e.adler,t,n,0)),i.wrap=0,n>=i.w_size&&(0===s&&(o(i.head),i.strstart=0,i.block_start=0,i.insert=0),d=new k.Buf8(i.w_size),k.arraySet(d,t,n-i.w_size,i.w_size,0),t=d,n=i.w_size),l=e.avail_in,u=e.next_in,c=e.input,e.avail_in=n,e.next_in=0,e.input=t,f(i);i.lookahead>=le;){r=i.strstart,a=i.lookahead-(le-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[r+le-1])&i.hash_mask,i.prev[r&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=r,r++}while(--a);i.strstart=r,i.lookahead=le-1,f(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=le-1,i.match_available=0,e.next_in=u,e.input=c,e.avail_in=l,i.wrap=s,N}var k=e("../utils/common"),D=e("./trees"),A=e("./adler32"),T=e("./crc32"),P=e("./messages"),F=0,L=1,M=3,R=4,O=5,N=0,j=1,V=-2,z=-3,W=-5,q=-1,H=1,G=2,$=3,K=4,Y=0,X=2,Q=8,Z=9,J=15,ee=8,te=29,ne=256,ie=286,re=30,oe=19,ae=2*ie+1,se=15,le=3,ue=258,ce=ue+le+1,de=32,fe=42,he=69,pe=73,me=91,ge=103,ye=113,ve=666,be=1,xe=2,Ee=3,we=4,Ce=3,_e;_e=[new v(0,0,0,0,h),new v(4,4,8,4,p),new v(4,5,16,8,p),new v(4,6,32,32,p),new v(4,4,16,16,m),new v(8,16,32,32,m),new v(8,16,128,128,m),new v(8,32,128,256,m),new v(32,128,258,1024,m),new v(32,258,258,4096,m)],n.deflateInit=B,n.deflateInit2=_,n.deflateReset=w,n.deflateResetKeep=E,n.deflateSetHeader=C,n.deflate=U,n.deflateEnd=I,n.deflateSetDictionary=S,n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./messages":72,"./trees":73}],68:[function(e,t,n){"use strict";function i(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=i},{}],69:[function(e,t,n){"use strict";var i=30,r=12;t.exports=function e(t,n){var i,r,o,a,s,l,u,c,d,f,h,p,m,g,y,v,b,x,E,w,C,_,B,U,I;i=t.state,r=t.next_in,U=t.input,o=r+(t.avail_in-5),a=t.next_out,I=t.output,s=a-(n-t.avail_out),l=a+(t.avail_out-257),u=i.dmax,c=i.wsize,d=i.whave,f=i.wnext,h=i.window,p=i.hold,m=i.bits,g=i.lencode,y=i.distcode,v=(1<<i.lenbits)-1,b=(1<<i.distbits)-1;e:do{m<15&&(p+=U[r++]<<m,m+=8,p+=U[r++]<<m,m+=8),x=g[p&v];t:for(;;){if(E=x>>>24,p>>>=E,m-=E,0===(E=x>>>16&255))I[a++]=65535&x;else{if(!(16&E)){if(0==(64&E)){x=g[(65535&x)+(p&(1<<E)-1)];continue t}if(32&E){i.mode=12;break e}t.msg="invalid literal/length code",i.mode=30;break e}w=65535&x,E&=15,E&&(m<E&&(p+=U[r++]<<m,m+=8),w+=p&(1<<E)-1,p>>>=E,m-=E),m<15&&(p+=U[r++]<<m,m+=8,p+=U[r++]<<m,m+=8),x=y[p&b];n:for(;;){if(E=x>>>24,p>>>=E,m-=E,!(16&(E=x>>>16&255))){if(0==(64&E)){x=y[(65535&x)+(p&(1<<E)-1)];continue n}t.msg="invalid distance code",i.mode=30;break e}if(C=65535&x,E&=15,m<E&&(p+=U[r++]<<m,(m+=8)<E&&(p+=U[r++]<<m,m+=8)),(C+=p&(1<<E)-1)>u){t.msg="invalid distance too far back",i.mode=30;break e}if(p>>>=E,m-=E,E=a-s,C>E){if((E=C-E)>d&&i.sane){t.msg="invalid distance too far back",i.mode=30;break e}if(_=0,B=h,0===f){if(_+=c-E,E<w){w-=E;do{I[a++]=h[_++]}while(--E);_=a-C,B=I}}else if(f<E){if(_+=c+f-E,(E-=f)<w){w-=E;do{I[a++]=h[_++]}while(--E);if(_=0,f<w){E=f,w-=E;do{I[a++]=h[_++]}while(--E);_=a-C,B=I}}}else if(_+=f-E,E<w){w-=E;do{I[a++]=h[_++]}while(--E);_=a-C,B=I}for(;w>2;)I[a++]=B[_++],I[a++]=B[_++],I[a++]=B[_++],w-=3;w&&(I[a++]=B[_++],w>1&&(I[a++]=B[_++]))}else{_=a-C;do{I[a++]=I[_++],I[a++]=I[_++],I[a++]=I[_++],w-=3}while(w>2);w&&(I[a++]=I[_++],w>1&&(I[a++]=I[_++]))}break}}break}}while(r<o&&a<l);w=m>>3,r-=w,m-=w<<3,p&=(1<<m)-1,t.next_in=r,t.next_out=a,t.avail_in=r<o?o-r+5:5-(r-o),t.avail_out=a<l?l-a+257:257-(a-l),i.hold=p,i.bits=m}},{}],70:[function(e,t,n){"use strict";function i(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function r(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new g.Buf16(320),this.work=new g.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function o(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=L,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new g.Buf32(he),t.distcode=t.distdyn=new g.Buf32(pe),t.sane=1,t.back=-1,I):D}function a(e){var t;return e&&e.state?(t=e.state,t.wsize=0,t.whave=0,t.wnext=0,o(e)):D}function s(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?D:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,a(e))):D}function l(e,t){var n,i;return e?(i=new r,e.state=i,i.window=null,n=s(e,t),n!==I&&(e.state=null),n):D}function u(e){return l(e,ge)}function c(e){if(ye){var t;for(ve=new g.Buf32(512),be=new g.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(x(w,e.lens,0,288,ve,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;x(C,e.lens,0,32,be,0,e.work,{bits:5}),ye=!1}e.lencode=ve,e.lenbits=9,e.distcode=be,e.distbits=5}function d(e,t,n,i){var r,o=e.state;return null===o.window&&(o.wsize=1<<o.wbits,o.wnext=0,o.whave=0,o.window=new g.Buf8(o.wsize)),i>=o.wsize?(g.arraySet(o.window,t,n-o.wsize,o.wsize,0),o.wnext=0,o.whave=o.wsize):(r=o.wsize-o.wnext,r>i&&(r=i),g.arraySet(o.window,t,n-i,r,o.wnext),i-=r,i?(g.arraySet(o.window,t,n-i,i,0),o.wnext=i,o.whave=o.wsize):(o.wnext+=r,o.wnext===o.wsize&&(o.wnext=0),o.whave<o.wsize&&(o.whave+=r))),0}function f(e,t){var n,r,o,a,s,l,u,f,h,p,m,he,pe,me,ge=0,ye,ve,be,xe,Ee,we,Ce,_e,Be=new g.Buf8(4),Ue,Ie,Se=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return D;n=e.state,n.mode===G&&(n.mode=$),s=e.next_out,o=e.output,u=e.avail_out,a=e.next_in,r=e.input,l=e.avail_in,f=n.hold,h=n.bits,p=l,m=u,_e=I;e:for(;;)switch(n.mode){case L:if(0===n.wrap){n.mode=$;break}for(;h<16;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}if(2&n.wrap&&35615===f){n.check=0,Be[0]=255&f,Be[1]=f>>>8&255,n.check=v(n.check,Be,2,0),f=0,h=0,n.mode=M;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&f)<<8)+(f>>8))%31){e.msg="incorrect header check",n.mode=ce;break}if((15&f)!==F){e.msg="unknown compression method",n.mode=ce;break}if(f>>>=4,h-=4,Ce=8+(15&f),0===n.wbits)n.wbits=Ce;else if(Ce>n.wbits){e.msg="invalid window size",n.mode=ce;break}n.dmax=1<<Ce,e.adler=n.check=1,n.mode=512&f?q:G,f=0,h=0;break;case M:for(;h<16;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}if(n.flags=f,(255&n.flags)!==F){e.msg="unknown compression method",n.mode=ce;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=ce;break}n.head&&(n.head.text=f>>8&1),512&n.flags&&(Be[0]=255&f,Be[1]=f>>>8&255,n.check=v(n.check,Be,2,0)),f=0,h=0,n.mode=R;case R:for(;h<32;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}n.head&&(n.head.time=f),512&n.flags&&(Be[0]=255&f,Be[1]=f>>>8&255,Be[2]=f>>>16&255,Be[3]=f>>>24&255,n.check=v(n.check,Be,4,0)),f=0,h=0,n.mode=O;case O:for(;h<16;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}n.head&&(n.head.xflags=255&f,n.head.os=f>>8),512&n.flags&&(Be[0]=255&f,Be[1]=f>>>8&255,n.check=v(n.check,Be,2,0)),f=0,h=0,n.mode=N;case N:if(1024&n.flags){for(;h<16;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}n.length=f,n.head&&(n.head.extra_len=f),512&n.flags&&(Be[0]=255&f,Be[1]=f>>>8&255,n.check=v(n.check,Be,2,0)),f=0,h=0}else n.head&&(n.head.extra=null);n.mode=j;case j:if(1024&n.flags&&(he=n.length,he>l&&(he=l),he&&(n.head&&(Ce=n.head.extra_len-n.length,n.head.extra||(n.head.extra=Array(n.head.extra_len)),g.arraySet(n.head.extra,r,a,he,Ce)),512&n.flags&&(n.check=v(n.check,r,he,a)),l-=he,a+=he,n.length-=he),n.length))break e;n.length=0,n.mode=V;case V:if(2048&n.flags){if(0===l)break e;he=0;do{Ce=r[a+he++],n.head&&Ce&&n.length<65536&&(n.head.name+=String.fromCharCode(Ce))}while(Ce&&he<l);if(512&n.flags&&(n.check=v(n.check,r,he,a)),l-=he,a+=he,Ce)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=z;case z:if(4096&n.flags){if(0===l)break e;he=0;do{Ce=r[a+he++],n.head&&Ce&&n.length<65536&&(n.head.comment+=String.fromCharCode(Ce))}while(Ce&&he<l);if(512&n.flags&&(n.check=v(n.check,r,he,a)),l-=he,a+=he,Ce)break e}else n.head&&(n.head.comment=null);n.mode=W;case W:if(512&n.flags){for(;h<16;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}if(f!==(65535&n.check)){e.msg="header crc mismatch",n.mode=ce;break}f=0,h=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=G;break;case q:for(;h<32;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}e.adler=n.check=i(f),f=0,h=0,n.mode=H;case H:if(0===n.havedict)return e.next_out=s,e.avail_out=u,e.next_in=a,e.avail_in=l,n.hold=f,n.bits=h,k;e.adler=n.check=1,n.mode=G;case G:if(t===B||t===U)break e;case $:if(n.last){f>>>=7&h,h-=7&h,n.mode=se;break}for(;h<3;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}switch(n.last=1&f,f>>>=1,h-=1,3&f){case 0:n.mode=K;break;case 1:if(c(n),n.mode=ee,t===U){f>>>=2,h-=2;break e}break;case 2:n.mode=Q;break;case 3:e.msg="invalid block type",n.mode=ce}f>>>=2,h-=2;break;case K:for(f>>>=7&h,h-=7&h;h<32;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}if((65535&f)!=(f>>>16^65535)){e.msg="invalid stored block lengths",n.mode=ce;break}if(n.length=65535&f,f=0,h=0,n.mode=Y,t===U)break e;case Y:n.mode=X;case X:if(he=n.length){if(he>l&&(he=l),he>u&&(he=u),0===he)break e;g.arraySet(o,r,a,he,s),l-=he,a+=he,u-=he,s+=he,n.length-=he;break}n.mode=G;break;case Q:for(;h<14;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}if(n.nlen=257+(31&f),f>>>=5,h-=5,n.ndist=1+(31&f),f>>>=5,h-=5,n.ncode=4+(15&f),f>>>=4,h-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=ce;break}n.have=0,n.mode=Z;case Z:for(;n.have<n.ncode;){for(;h<3;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}n.lens[Se[n.have++]]=7&f,f>>>=3,h-=3}for(;n.have<19;)n.lens[Se[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Ue={bits:n.lenbits},_e=x(E,n.lens,0,19,n.lencode,0,n.work,Ue),n.lenbits=Ue.bits,_e){e.msg="invalid code lengths set",n.mode=ce;break}n.have=0,n.mode=J;case J:for(;n.have<n.nlen+n.ndist;){for(;ge=n.lencode[f&(1<<n.lenbits)-1],ye=ge>>>24,ve=ge>>>16&255,be=65535&ge,!(ye<=h);){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}if(be<16)f>>>=ye,h-=ye,n.lens[n.have++]=be;else{if(16===be){for(Ie=ye+2;h<Ie;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}if(f>>>=ye,h-=ye,0===n.have){e.msg="invalid bit length repeat",n.mode=ce;break}Ce=n.lens[n.have-1],he=3+(3&f),f>>>=2,h-=2}else if(17===be){for(Ie=ye+3;h<Ie;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}f>>>=ye,h-=ye,Ce=0,he=3+(7&f),f>>>=3,h-=3}else{for(Ie=ye+7;h<Ie;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}f>>>=ye,h-=ye,Ce=0,he=11+(127&f),f>>>=7,h-=7}if(n.have+he>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=ce;break}for(;he--;)n.lens[n.have++]=Ce}}if(n.mode===ce)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=ce;break}if(n.lenbits=9,Ue={bits:n.lenbits},_e=x(w,n.lens,0,n.nlen,n.lencode,0,n.work,Ue),n.lenbits=Ue.bits,_e){e.msg="invalid literal/lengths set",n.mode=ce;break}if(n.distbits=6,n.distcode=n.distdyn,Ue={bits:n.distbits},_e=x(C,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Ue),n.distbits=Ue.bits,_e){e.msg="invalid distances set",n.mode=ce;break}if(n.mode=ee,t===U)break e;case ee:n.mode=te;case te:if(l>=6&&u>=258){e.next_out=s,e.avail_out=u,e.next_in=a,e.avail_in=l,n.hold=f,n.bits=h,b(e,m),s=e.next_out,o=e.output,u=e.avail_out,a=e.next_in,r=e.input,l=e.avail_in,f=n.hold,h=n.bits,n.mode===G&&(n.back=-1);break}for(n.back=0;ge=n.lencode[f&(1<<n.lenbits)-1],ye=ge>>>24,ve=ge>>>16&255,be=65535&ge,!(ye<=h);){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}if(ve&&0==(240&ve)){for(xe=ye,Ee=ve,we=be;ge=n.lencode[we+((f&(1<<xe+Ee)-1)>>xe)],ye=ge>>>24,ve=ge>>>16&255,be=65535&ge,!(xe+ye<=h);){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}f>>>=xe,h-=xe,n.back+=xe}if(f>>>=ye,h-=ye,n.back+=ye,n.length=be,0===ve){n.mode=ae;break}if(32&ve){n.back=-1,n.mode=G;break}if(64&ve){e.msg="invalid literal/length code",n.mode=ce;break}n.extra=15&ve,n.mode=ne;case ne:if(n.extra){for(Ie=n.extra;h<Ie;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}n.length+=f&(1<<n.extra)-1,f>>>=n.extra,h-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=ie;case ie:for(;ge=n.distcode[f&(1<<n.distbits)-1],ye=ge>>>24,ve=ge>>>16&255,be=65535&ge,!(ye<=h);){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}if(0==(240&ve)){for(xe=ye,Ee=ve,we=be;ge=n.distcode[we+((f&(1<<xe+Ee)-1)>>xe)],ye=ge>>>24,ve=ge>>>16&255,be=65535&ge,!(xe+ye<=h);){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}f>>>=xe,h-=xe,n.back+=xe}if(f>>>=ye,h-=ye,n.back+=ye,64&ve){e.msg="invalid distance code",n.mode=ce;break}n.offset=be,n.extra=15&ve,n.mode=re;case re:if(n.extra){for(Ie=n.extra;h<Ie;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}n.offset+=f&(1<<n.extra)-1,f>>>=n.extra,h-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=ce;break}n.mode=oe;case oe:if(0===u)break e;if(he=m-u,n.offset>he){if((he=n.offset-he)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=ce;break}he>n.wnext?(he-=n.wnext,pe=n.wsize-he):pe=n.wnext-he,he>n.length&&(he=n.length),me=n.window}else me=o,pe=s-n.offset,he=n.length;he>u&&(he=u),u-=he,n.length-=he;do{o[s++]=me[pe++]}while(--he);0===n.length&&(n.mode=te);break;case ae:if(0===u)break e;o[s++]=n.length,u--,n.mode=te;break;case se:if(n.wrap){for(;h<32;){if(0===l)break e;l--,f|=r[a++]<<h,h+=8}if(m-=u,e.total_out+=m,n.total+=m,m&&(e.adler=n.check=n.flags?v(n.check,o,m,s-m):y(n.check,o,m,s-m)),m=u,(n.flags?f:i(f))!==n.check){e.msg="incorrect data check",n.mode=ce;break}f=0,h=0}n.mode=le;case le:if(n.wrap&&n.flags){for(;h<32;){if(0===l)break e;l--,f+=r[a++]<<h,h+=8}if(f!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=ce;break}f=0,h=0}n.mode=ue;case ue:_e=S;break e;case ce:_e=A;break e;case de:return T;case fe:default:return D}return e.next_out=s,e.avail_out=u,e.next_in=a,e.avail_in=l,n.hold=f,n.bits=h,(n.wsize||m!==e.avail_out&&n.mode<ce&&(n.mode<se||t!==_))&&d(e,e.output,e.next_out,m-e.avail_out)?(n.mode=de,T):(p-=e.avail_in,m-=e.avail_out,e.total_in+=p,e.total_out+=m,n.total+=m,n.wrap&&m&&(e.adler=n.check=n.flags?v(n.check,o,m,e.next_out-m):y(n.check,o,m,e.next_out-m)),e.data_type=n.bits+(n.last?64:0)+(n.mode===G?128:0)+(n.mode===ee||n.mode===Y?256:0),(0===p&&0===m||t===_)&&_e===I&&(_e=P),_e)}function h(e){if(!e||!e.state)return D;var t=e.state;return t.window&&(t.window=null),e.state=null,I}function p(e,t){var n;return e&&e.state?(n=e.state,0==(2&n.wrap)?D:(n.head=t,t.done=!1,I)):D}function m(e,t){var n=t.length,i,r,o;return e&&e.state?(i=e.state,0!==i.wrap&&i.mode!==H?D:i.mode===H&&(r=1,(r=y(r,t,n,0))!==i.check)?A:(o=d(e,t,n,n))?(i.mode=de,T):(i.havedict=1,I)):D}var g=e("../utils/common"),y=e("./adler32"),v=e("./crc32"),b=e("./inffast"),x=e("./inftrees"),E=0,w=1,C=2,_=4,B=5,U=6,I=0,S=1,k=2,D=-2,A=-3,T=-4,P=-5,F=8,L=1,M=2,R=3,O=4,N=5,j=6,V=7,z=8,W=9,q=10,H=11,G=12,$=13,K=14,Y=15,X=16,Q=17,Z=18,J=19,ee=20,te=21,ne=22,ie=23,re=24,oe=25,ae=26,se=27,le=28,ue=29,ce=30,de=31,fe=32,he=852,pe=592,me=15,ge=15,ye=!0,ve,be;n.inflateReset=a,n.inflateReset2=s,n.inflateResetKeep=o,n.inflateInit=u,n.inflateInit2=l,n.inflate=f,n.inflateEnd=h,n.inflateGetHeader=p,n.inflateSetDictionary=m,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":62,"./adler32":64,"./crc32":66,"./inffast":69,"./inftrees":71}],71:[function(e,t,n){"use strict";var i=e("../utils/common"),r=15,o=852,a=592,s=0,l=1,u=2,c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],f=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function e(t,n,r,o,a,s,l,u){var p=u.bits,m=0,g=0,y=0,v=0,b=0,x=0,E=0,w=0,C=0,_=0,B,U,I,S,k,D=null,A=0,T,P=new i.Buf16(16),F=new i.Buf16(16),L=null,M=0,R,O,N;for(m=0;m<=15;m++)P[m]=0;for(g=0;g<o;g++)P[n[r+g]]++;for(b=p,v=15;v>=1&&0===P[v];v--);if(b>v&&(b=v),0===v)return a[s++]=20971520,a[s++]=20971520,u.bits=1,0;for(y=1;y<v&&0===P[y];y++);for(b<y&&(b=y),w=1,m=1;m<=15;m++)if(w<<=1,(w-=P[m])<0)return-1;if(w>0&&(0===t||1!==v))return-1;for(F[1]=0,m=1;m<15;m++)F[m+1]=F[m]+P[m];for(g=0;g<o;g++)0!==n[r+g]&&(l[F[n[r+g]]++]=g);if(0===t?(D=L=l,T=19):1===t?(D=c,A-=257,L=d,M-=257,T=256):(D=f,L=h,T=-1),_=0,g=0,m=y,k=s,x=b,E=0,I=-1,C=1<<b,S=C-1,1===t&&C>852||2===t&&C>592)return 1;for(var j=0;;){j++,R=m-E,l[g]<T?(O=0,N=l[g]):l[g]>T?(O=L[M+l[g]],N=D[A+l[g]]):(O=96,N=0),B=1<<m-E,U=1<<x,y=U;do{U-=B,a[k+(_>>E)+U]=R<<24|O<<16|N|0}while(0!==U);for(B=1<<m-1;_&B;)B>>=1;if(0!==B?(_&=B-1,_+=B):_=0,g++,0==--P[m]){if(m===v)break;m=n[r+l[g]]}if(m>b&&(_&S)!==I){for(0===E&&(E=b),k+=y,x=m-E,w=1<<x;x+E<v&&!((w-=P[x+E])<=0);)x++,w<<=1;if(C+=1<<x,1===t&&C>852||2===t&&C>592)return 1;I=_&S,a[I]=b<<24|x<<16|k-s|0}}return 0!==_&&(a[k+_]=m-E<<24|64<<16|0),u.bits=b,0}},{"../utils/common":62}],72:[function(e,t,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],73:[function(e,t,n){"use strict";function i(e){for(var t=e.length;--t>=0;)e[t]=0}function r(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}function o(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function a(e){return e<256?le[e]:le[256+(e>>>7)]}function s(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function l(e,t,n){e.bi_valid>Y-n?(e.bi_buf|=t<<e.bi_valid&65535,s(e,e.bi_buf),e.bi_buf=t>>Y-e.bi_valid,e.bi_valid+=n-Y):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function u(e,t,n){l(e,n[2*t],n[2*t+1])}function c(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function d(e){16===e.bi_valid?(s(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function f(e,t){var n=t.dyn_tree,i=t.max_code,r=t.stat_desc.static_tree,o=t.stat_desc.has_stree,a=t.stat_desc.extra_bits,s=t.stat_desc.extra_base,l=t.stat_desc.max_length,u,c,d,f,h,p,m=0;for(f=0;f<=K;f++)e.bl_count[f]=0;for(n[2*e.heap[e.heap_max]+1]=0,u=e.heap_max+1;u<$;u++)c=e.heap[u],f=n[2*n[2*c+1]+1]+1,f>l&&(f=l,m++),n[2*c+1]=f,c>i||(e.bl_count[f]++,h=0,c>=s&&(h=a[c-s]),p=n[2*c],e.opt_len+=p*(f+h),o&&(e.static_len+=p*(r[2*c+1]+h)));if(0!==m){do{for(f=l-1;0===e.bl_count[f];)f--;e.bl_count[f]--,e.bl_count[f+1]+=2,e.bl_count[l]--,m-=2}while(m>0);for(f=l;0!==f;f--)for(c=e.bl_count[f];0!==c;)(d=e.heap[--u])>i||(n[2*d+1]!==f&&(e.opt_len+=(f-n[2*d+1])*n[2*d],n[2*d+1]=f),c--)}}function h(e,t,n){var i=Array(K+1),r=0,o,a;for(o=1;o<=K;o++)i[o]=r=r+n[o-1]<<1;for(a=0;a<=t;a++){var s=e[2*a+1];0!==s&&(e[2*a]=c(i[s]++,s))}}function p(){var e,t,n,i,o,a=Array(K+1);for(n=0,i=0;i<z-1;i++)for(ce[i]=n,e=0;e<1<<te[i];e++)ue[n++]=i;for(ue[n-1]=i,o=0,i=0;i<16;i++)for(de[i]=o,e=0;e<1<<ne[i];e++)le[o++]=i;for(o>>=7;i<H;i++)for(de[i]=o<<7,e=0;e<1<<ne[i]-7;e++)le[256+o++]=i;for(t=0;t<=K;t++)a[t]=0;for(e=0;e<=143;)ae[2*e+1]=8,e++,a[8]++;for(;e<=255;)ae[2*e+1]=9,e++,a[9]++;for(;e<=279;)ae[2*e+1]=7,e++,a[7]++;for(;e<=287;)ae[2*e+1]=8,e++,a[8]++;for(h(ae,q+1,a),e=0;e<H;e++)se[2*e+1]=5,se[2*e]=c(e,5);fe=new r(ae,te,W+1,q,K),he=new r(se,ne,0,H,K),pe=new r(Array(0),ie,0,G,X)}function m(e){var t;for(t=0;t<q;t++)e.dyn_ltree[2*t]=0;for(t=0;t<H;t++)e.dyn_dtree[2*t]=0;for(t=0;t<G;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*Q]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function g(e){e.bi_valid>8?s(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function y(e,t,n,i){g(e),i&&(s(e,n),s(e,~n)),T.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}function v(e,t,n,i){var r=2*t,o=2*n;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[n]}function b(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&v(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!v(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function x(e,t,n){var i,r,o=0,s,c;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],r=e.pending_buf[e.l_buf+o],o++,0===i?u(e,r,t):(s=ue[r],u(e,s+W+1,t),c=te[s],0!==c&&(r-=ce[s],l(e,r,c)),i--,s=a(i),u(e,s,n),0!==(c=ne[s])&&(i-=de[s],l(e,i,c)))}while(o<e.last_lit);u(e,Q,t)}function E(e,t){var n=t.dyn_tree,i=t.stat_desc.static_tree,r=t.stat_desc.has_stree,o=t.stat_desc.elems,a,s,l=-1,u;for(e.heap_len=0,e.heap_max=$,a=0;a<o;a++)0!==n[2*a]?(e.heap[++e.heap_len]=l=a,e.depth[a]=0):n[2*a+1]=0;for(;e.heap_len<2;)u=e.heap[++e.heap_len]=l<2?++l:0,n[2*u]=1,e.depth[u]=0,e.opt_len--,r&&(e.static_len-=i[2*u+1]);for(t.max_code=l,a=e.heap_len>>1;a>=1;a--)b(e,n,a);u=o;do{a=e.heap[1],e.heap[1]=e.heap[e.heap_len--],b(e,n,1),s=e.heap[1],e.heap[--e.heap_max]=a,e.heap[--e.heap_max]=s,n[2*u]=n[2*a]+n[2*s],e.depth[u]=(e.depth[a]>=e.depth[s]?e.depth[a]:e.depth[s])+1,n[2*a+1]=n[2*s+1]=u,e.heap[1]=u++,b(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],f(e,t),h(n,l,e.bl_count)}function w(e,t,n){var i,r=-1,o,a=t[1],s=0,l=7,u=4;for(0===a&&(l=138,u=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)o=a,a=t[2*(i+1)+1],++s<l&&o===a||(s<u?e.bl_tree[2*o]+=s:0!==o?(o!==r&&e.bl_tree[2*o]++,e.bl_tree[2*Z]++):s<=10?e.bl_tree[2*J]++:e.bl_tree[2*ee]++,s=0,r=o,0===a?(l=138,u=3):o===a?(l=6,u=3):(l=7,u=4))}function C(e,t,n){var i,r=-1,o,a=t[1],s=0,c=7,d=4;for(0===a&&(c=138,d=3),i=0;i<=n;i++)if(o=a,a=t[2*(i+1)+1],!(++s<c&&o===a)){if(s<d)do{u(e,o,e.bl_tree)}while(0!=--s);else 0!==o?(o!==r&&(u(e,o,e.bl_tree),s--),u(e,Z,e.bl_tree),l(e,s-3,2)):s<=10?(u(e,J,e.bl_tree),l(e,s-3,3)):(u(e,ee,e.bl_tree),l(e,s-11,7));s=0,r=o,0===a?(c=138,d=3):o===a?(c=6,d=3):(c=7,d=4)}}function _(e){var t;for(w(e,e.dyn_ltree,e.l_desc.max_code),w(e,e.dyn_dtree,e.d_desc.max_code),E(e,e.bl_desc),t=G-1;t>=3&&0===e.bl_tree[2*re[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function B(e,t,n,i){var r;for(l(e,t-257,5),l(e,n-1,5),l(e,i-4,4),r=0;r<i;r++)l(e,e.bl_tree[2*re[r]+1],3);C(e,e.dyn_ltree,t-1),C(e,e.dyn_dtree,n-1)}function U(e){var t=4093624447,n;for(n=0;n<=31;n++,t>>>=1)if(1&t&&0!==e.dyn_ltree[2*n])return F;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return L;for(n=32;n<W;n++)if(0!==e.dyn_ltree[2*n])return L;return F}function I(e){me||(p(),me=!0),e.l_desc=new o(e.dyn_ltree,fe),e.d_desc=new o(e.dyn_dtree,he),e.bl_desc=new o(e.bl_tree,pe),e.bi_buf=0,e.bi_valid=0,m(e)}function S(e,t,n,i){l(e,(R<<1)+(i?1:0),3),y(e,t,n,!0)}function k(e){l(e,O<<1,3),u(e,Q,ae),d(e)}function D(e,t,n,i){var r,o,a=0;e.level>0?(e.strm.data_type===M&&(e.strm.data_type=U(e)),E(e,e.l_desc),E(e,e.d_desc),a=_(e),r=e.opt_len+3+7>>>3,(o=e.static_len+3+7>>>3)<=r&&(r=o)):r=o=n+5,n+4<=r&&-1!==t?S(e,t,n,i):e.strategy===P||o===r?(l(e,(O<<1)+(i?1:0),3),x(e,ae,se)):(l(e,(N<<1)+(i?1:0),3),B(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),x(e,e.dyn_ltree,e.dyn_dtree)),m(e),i&&g(e)}function A(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(ue[n]+W+1)]++,e.dyn_dtree[2*a(t)]++),e.last_lit===e.lit_bufsize-1}var T=e("../utils/common"),P=4,F=0,L=1,M=2,R=0,O=1,N=2,j=3,V=258,z=29,W=256,q=W+1+z,H=30,G=19,$=2*q+1,K=15,Y=16,X=7,Q=256,Z=16,J=17,ee=18,te=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],ne=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ie=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],re=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],oe=512,ae=Array(2*(q+2));i(ae);var se=Array(2*H);i(se);var le=Array(512);i(le);var ue=Array(256);i(ue);var ce=Array(z);i(ce);var de=Array(H);i(de);var fe,he,pe,me=!1;n._tr_init=I,n._tr_stored_block=S,n._tr_flush_block=D,n._tr_tally=A,n._tr_align=k},{"../utils/common":62}],74:[function(e,t,n){"use strict";function i(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=i},{}]},{},[10])(10)})}).call(t,n(89).Buffer,n(7))},function(e,t,n){"use strict";(function(e){function i(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}function r(){return a.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return a.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=a.prototype):(null===e&&(e=new a(t)),e.length=t),e}function a(e,t,n){if(!(a.TYPED_ARRAY_SUPPORT||this instanceof a))return new a(e,t,n);if("number"==typeof e){if("string"==typeof t)throw Error("If encoding is specified then the first argument must be a string");return c(this,e)}return s(this,e,t,n)}function s(e,t,n,i){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?h(e,t,n,i):"string"==typeof t?d(e,t,n):p(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function u(e,t,n,i){return l(t),t<=0?o(e,t):void 0!==n?"string"==typeof i?o(e,t).fill(n,i):o(e,t).fill(n):o(e,t)}function c(e,t){if(l(t),e=o(e,t<0?0:0|m(t)),!a.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function d(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!a.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var i=0|y(t,n);e=o(e,i);var r=e.write(t,n);return r!==i&&(e=e.slice(0,r)),e}function f(e,t){var n=t.length<0?0:0|m(t.length);e=o(e,n);for(var i=0;i<n;i+=1)e[i]=255&t[i];return e}function h(e,t,n,i){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(i||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===i?new Uint8Array(t):void 0===i?new Uint8Array(t,n):new Uint8Array(t,n,i),a.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=a.prototype):e=f(e,t),e}function p(e,t){if(a.isBuffer(t)){var n=0|m(t.length);return e=o(e,n),0===e.length?e:(t.copy(e,0,0,n),e)}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||X(t.length)?o(e,0):f(e,t);if("Buffer"===t.type&&J(t.data))return f(e,t.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function m(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function g(e){return+e!=e&&(e=0),a.alloc(+e)}function y(e,t){if(a.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var i=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return H(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return K(e).length;default:if(i)return H(e).length;t=(""+t).toLowerCase(),i=!0}}function v(e,t,n){var i=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";for(e||(e="utf8");;)switch(e){case"hex":return P(this,t,n);case"utf8":case"utf-8":return k(this,t,n);case"ascii":return A(this,t,n);case"latin1":case"binary":return T(this,t,n);case"base64":return S(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,t,n);default:if(i)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),i=!0}}function b(e,t,n){var i=e[t];e[t]=e[n],e[n]=i}function x(e,t,n,i,r){if(0===e.length)return-1;if("string"==typeof n?(i=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(n<0){if(!r)return-1;n=0}if("string"==typeof t&&(t=a.from(t,i)),a.isBuffer(t))return 0===t.length?-1:E(e,t,n,i,r);if("number"==typeof t)return t&=255,a.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):E(e,[t],n,i,r);throw new TypeError("val must be string, number or Buffer")}function E(e,t,n,i,r){function o(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}var a=1,s=e.length,l=t.length;if(void 0!==i&&("ucs2"===(i=(i+"").toLowerCase())||"ucs-2"===i||"utf16le"===i||"utf-16le"===i)){if(e.length<2||t.length<2)return-1;a=2,s/=2,l/=2,n/=2}var u;if(r){var c=-1;for(u=n;u<s;u++)if(o(e,u)===o(t,-1===c?0:u-c)){if(-1===c&&(c=u),u-c+1===l)return c*a}else-1!==c&&(u-=u-c),c=-1}else for(n+l>s&&(n=s-l),u=n;u>=0;u--){for(var d=!0,f=0;f<l;f++)if(o(e,u+f)!==o(t,f)){d=!1;break}if(d)return u}return-1}function w(e,t,n,i){n=+n||0;var r=e.length-n;i?(i=+i)>r&&(i=r):i=r;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");i>o/2&&(i=o/2);for(var a=0;a<i;++a){var s=parseInt(t.substr(2*a,2),16);if(isNaN(s))return a;e[n+a]=s}return a}function C(e,t,n,i){return Y(H(t,e.length-n),e,n,i)}function _(e,t,n,i){return Y(G(t),e,n,i)}function B(e,t,n,i){return _(e,t,n,i)}function U(e,t,n,i){return Y(K(t),e,n,i)}function I(e,t,n,i){return Y($(t,e.length-n),e,n,i)}function S(e,t,n){return 0===t&&n===e.length?Q.fromByteArray(e):Q.fromByteArray(e.slice(t,n))}function k(e,t,n){n=Math.min(e.length,n);for(var i=[],r=t;r<n;){var o=e[r],a=null,s=o>239?4:o>223?3:o>191?2:1;if(r+s<=n){var l,u,c,d;switch(s){case 1:o<128&&(a=o);break;case 2:l=e[r+1],128==(192&l)&&(d=(31&o)<<6|63&l)>127&&(a=d);break;case 3:l=e[r+1],u=e[r+2],128==(192&l)&&128==(192&u)&&(d=(15&o)<<12|(63&l)<<6|63&u)>2047&&(d<55296||d>57343)&&(a=d);break;case 4:l=e[r+1],u=e[r+2],c=e[r+3],128==(192&l)&&128==(192&u)&&128==(192&c)&&(d=(15&o)<<18|(63&l)<<12|(63&u)<<6|63&c)>65535&&d<1114112&&(a=d)}}null===a?(a=65533,s=1):a>65535&&(a-=65536,i.push(a>>>10&1023|55296),a=56320|1023&a),i.push(a),r+=s}return D(i)}function D(e){var t=e.length;if(t<=ee)return String.fromCharCode.apply(String,e);for(var n="",i=0;i<t;)n+=String.fromCharCode.apply(String,e.slice(i,i+=ee));return n}function A(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(127&e[r]);return i}function T(e,t,n){var i="";n=Math.min(e.length,n);for(var r=t;r<n;++r)i+=String.fromCharCode(e[r]);return i}function P(e,t,n){var i=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>i)&&(n=i);for(var r="",o=t;o<n;++o)r+=q(e[o]);return r}function F(e,t,n){for(var i=e.slice(t,n),r="",o=0;o<i.length;o+=2)r+=String.fromCharCode(i[o]+256*i[o+1]);return r}function L(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function M(e,t,n,i,r,o){if(!a.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(n+i>e.length)throw new RangeError("Index out of range")}function R(e,t,n,i){t<0&&(t=65535+t+1);for(var r=0,o=Math.min(e.length-n,2);r<o;++r)e[n+r]=(t&255<<8*(i?r:1-r))>>>8*(i?r:1-r)}function O(e,t,n,i){t<0&&(t=4294967295+t+1);for(var r=0,o=Math.min(e.length-n,4);r<o;++r)e[n+r]=t>>>8*(i?r:3-r)&255}function N(e,t,n,i,r,o){if(n+i>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function j(e,t,n,i,r){return r||N(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),Z.write(e,t,n,i,23,4),n+4}function V(e,t,n,i,r){return r||N(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),Z.write(e,t,n,i,52,8),n+8}function z(e){if(e=W(e).replace(te,""),e.length<2)return"";for(;e.length%4!=0;)e+="=";return e}function W(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function q(e){return e<16?"0"+e.toString(16):e.toString(16)}function H(e,t){t=t||1/0;for(var n,i=e.length,r=null,o=[],a=0;a<i;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!r){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(a+1===i){(t-=3)>-1&&o.push(239,191,189);continue}r=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),r=n;continue}n=65536+(r-55296<<10|n-56320)}else r&&(t-=3)>-1&&o.push(239,191,189);if(r=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function G(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function $(e,t){for(var n,i,r,o=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),i=n>>8,r=n%256,o.push(r),o.push(i);return o}function K(e){return Q.toByteArray(z(e))}function Y(e,t,n,i){for(var r=0;r<i&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function X(e){return e!==e}var Q=n(90),Z=n(91),J=n(92);t.Buffer=a,t.SlowBuffer=g,t.INSPECT_MAX_BYTES=50,a.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:i(),t.kMaxLength=r(),a.poolSize=8192,a._augment=function(e){return e.__proto__=a.prototype,e},a.from=function(e,t,n){return s(null,e,t,n)},a.TYPED_ARRAY_SUPPORT&&(a.prototype.__proto__=Uint8Array.prototype,a.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&a[Symbol.species]===a&&Object.defineProperty(a,Symbol.species,{value:null,configurable:!0})),a.alloc=function(e,t,n){return u(null,e,t,n)},a.allocUnsafe=function(e){return c(null,e)},a.allocUnsafeSlow=function(e){return c(null,e)},a.isBuffer=function e(t){return!(null==t||!t._isBuffer)},a.compare=function e(t,n){if(!a.isBuffer(t)||!a.isBuffer(n))throw new TypeError("Arguments must be Buffers");if(t===n)return 0;for(var i=t.length,r=n.length,o=0,s=Math.min(i,r);o<s;++o)if(t[o]!==n[o]){i=t[o],r=n[o];break}return i<r?-1:r<i?1:0},a.isEncoding=function e(t){switch((t+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function e(t,n){if(!J(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return a.alloc(0);var i;if(void 0===n)for(n=0,i=0;i<t.length;++i)n+=t[i].length;var r=a.allocUnsafe(n),o=0;for(i=0;i<t.length;++i){var s=t[i];if(!a.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,o),o+=s.length}return r},a.byteLength=y,a.prototype._isBuffer=!0,a.prototype.swap16=function e(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var n=0;n<t;n+=2)b(this,n,n+1);return this},a.prototype.swap32=function e(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var n=0;n<t;n+=4)b(this,n,n+3),b(this,n+1,n+2);return this},a.prototype.swap64=function e(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var n=0;n<t;n+=8)b(this,n,n+7),b(this,n+1,n+6),b(this,n+2,n+5),b(this,n+3,n+4);return this},a.prototype.toString=function e(){var t=0|this.length;return 0===t?"":0===arguments.length?k(this,0,t):v.apply(this,arguments)},a.prototype.equals=function e(t){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===a.compare(this,t)},a.prototype.inspect=function e(){var n="",i=t.INSPECT_MAX_BYTES;return this.length>0&&(n=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(n+=" ... ")),"<Buffer "+n+">"},a.prototype.compare=function e(t,n,i,r,o){if(!a.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===n&&(n=0),void 0===i&&(i=t?t.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),n<0||i>t.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&n>=i)return 0;if(r>=o)return-1;if(n>=i)return 1;if(n>>>=0,i>>>=0,r>>>=0,o>>>=0,this===t)return 0;for(var s=o-r,l=i-n,u=Math.min(s,l),c=this.slice(r,o),d=t.slice(n,i),f=0;f<u;++f)if(c[f]!==d[f]){s=c[f],l=d[f];break}return s<l?-1:l<s?1:0},a.prototype.includes=function e(t,n,i){return-1!==this.indexOf(t,n,i)},a.prototype.indexOf=function e(t,n,i){return x(this,t,n,i,!0)},a.prototype.lastIndexOf=function e(t,n,i){return x(this,t,n,i,!1)},a.prototype.write=function e(t,n,i,r){if(void 0===n)r="utf8",i=this.length,n=0;else if(void 0===i&&"string"==typeof n)r=n,i=this.length,n=0;else{if(!isFinite(n))throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");n|=0,isFinite(i)?(i|=0,void 0===r&&(r="utf8")):(r=i,i=void 0)}var o=this.length-n;if((void 0===i||i>o)&&(i=o),t.length>0&&(i<0||n<0)||n>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return w(this,t,n,i);case"utf8":case"utf-8":return C(this,t,n,i);case"ascii":return _(this,t,n,i);case"latin1":case"binary":return B(this,t,n,i);case"base64":return U(this,t,n,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,t,n,i);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},a.prototype.toJSON=function e(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var ee=4096;a.prototype.slice=function e(t,n){var i=this.length;t=~~t,n=void 0===n?i:~~n,t<0?(t+=i)<0&&(t=0):t>i&&(t=i),n<0?(n+=i)<0&&(n=0):n>i&&(n=i),n<t&&(n=t);var r;if(a.TYPED_ARRAY_SUPPORT)r=this.subarray(t,n),r.__proto__=a.prototype;else{var o=n-t;r=new a(o,void 0);for(var s=0;s<o;++s)r[s]=this[s+t]}return r},a.prototype.readUIntLE=function e(t,n,i){t|=0,n|=0,i||L(t,n,this.length);for(var r=this[t],o=1,a=0;++a<n&&(o*=256);)r+=this[t+a]*o;return r},a.prototype.readUIntBE=function e(t,n,i){t|=0,n|=0,i||L(t,n,this.length);for(var r=this[t+--n],o=1;n>0&&(o*=256);)r+=this[t+--n]*o;return r},a.prototype.readUInt8=function e(t,n){return n||L(t,1,this.length),this[t]},a.prototype.readUInt16LE=function e(t,n){return n||L(t,2,this.length),this[t]|this[t+1]<<8},a.prototype.readUInt16BE=function e(t,n){return n||L(t,2,this.length),this[t]<<8|this[t+1]},a.prototype.readUInt32LE=function e(t,n){return n||L(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},a.prototype.readUInt32BE=function e(t,n){return n||L(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},a.prototype.readIntLE=function e(t,n,i){t|=0,n|=0,i||L(t,n,this.length);for(var r=this[t],o=1,a=0;++a<n&&(o*=256);)r+=this[t+a]*o;return o*=128,r>=o&&(r-=Math.pow(2,8*n)),r},a.prototype.readIntBE=function e(t,n,i){t|=0,n|=0,i||L(t,n,this.length);for(var r=n,o=1,a=this[t+--r];r>0&&(o*=256);)a+=this[t+--r]*o;return o*=128,a>=o&&(a-=Math.pow(2,8*n)),a},a.prototype.readInt8=function e(t,n){return n||L(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},a.prototype.readInt16LE=function e(t,n){n||L(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},a.prototype.readInt16BE=function e(t,n){n||L(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},a.prototype.readInt32LE=function e(t,n){return n||L(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},a.prototype.readInt32BE=function e(t,n){return n||L(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},a.prototype.readFloatLE=function e(t,n){return n||L(t,4,this.length),Z.read(this,t,!0,23,4)},a.prototype.readFloatBE=function e(t,n){return n||L(t,4,this.length),Z.read(this,t,!1,23,4)},a.prototype.readDoubleLE=function e(t,n){return n||L(t,8,this.length),Z.read(this,t,!0,52,8)},a.prototype.readDoubleBE=function e(t,n){return n||L(t,8,this.length),Z.read(this,t,!1,52,8)},a.prototype.writeUIntLE=function e(t,n,i,r){if(t=+t,n|=0,i|=0,!r){M(this,t,n,i,Math.pow(2,8*i)-1,0)}var o=1,a=0;for(this[n]=255&t;++a<i&&(o*=256);)this[n+a]=t/o&255;return n+i},a.prototype.writeUIntBE=function e(t,n,i,r){if(t=+t,n|=0,i|=0,!r){M(this,t,n,i,Math.pow(2,8*i)-1,0)}var o=i-1,a=1;for(this[n+o]=255&t;--o>=0&&(a*=256);)this[n+o]=t/a&255;return n+i},a.prototype.writeUInt8=function e(t,n,i){return t=+t,n|=0,i||M(this,t,n,1,255,0),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[n]=255&t,n+1},a.prototype.writeUInt16LE=function e(t,n,i){return t=+t,n|=0,i||M(this,t,n,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[n]=255&t,this[n+1]=t>>>8):R(this,t,n,!0),n+2},a.prototype.writeUInt16BE=function e(t,n,i){return t=+t,n|=0,i||M(this,t,n,2,65535,0),a.TYPED_ARRAY_SUPPORT?(this[n]=t>>>8,this[n+1]=255&t):R(this,t,n,!1),n+2},a.prototype.writeUInt32LE=function e(t,n,i){return t=+t,n|=0,i||M(this,t,n,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[n+3]=t>>>24,this[n+2]=t>>>16,this[n+1]=t>>>8,this[n]=255&t):O(this,t,n,!0),n+4},a.prototype.writeUInt32BE=function e(t,n,i){return t=+t,n|=0,i||M(this,t,n,4,4294967295,0),a.TYPED_ARRAY_SUPPORT?(this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=255&t):O(this,t,n,!1),n+4},a.prototype.writeIntLE=function e(t,n,i,r){if(t=+t,n|=0,!r){var o=Math.pow(2,8*i-1);M(this,t,n,i,o-1,-o)}var a=0,s=1,l=0;for(this[n]=255&t;++a<i&&(s*=256);)t<0&&0===l&&0!==this[n+a-1]&&(l=1),this[n+a]=(t/s>>0)-l&255;return n+i},a.prototype.writeIntBE=function e(t,n,i,r){if(t=+t,n|=0,!r){var o=Math.pow(2,8*i-1);M(this,t,n,i,o-1,-o)}var a=i-1,s=1,l=0;for(this[n+a]=255&t;--a>=0&&(s*=256);)t<0&&0===l&&0!==this[n+a+1]&&(l=1),this[n+a]=(t/s>>0)-l&255;return n+i},a.prototype.writeInt8=function e(t,n,i){return t=+t,n|=0,i||M(this,t,n,1,127,-128),a.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[n]=255&t,n+1},a.prototype.writeInt16LE=function e(t,n,i){return t=+t,n|=0,i||M(this,t,n,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[n]=255&t,this[n+1]=t>>>8):R(this,t,n,!0),n+2},a.prototype.writeInt16BE=function e(t,n,i){return t=+t,n|=0,i||M(this,t,n,2,32767,-32768),a.TYPED_ARRAY_SUPPORT?(this[n]=t>>>8,this[n+1]=255&t):R(this,t,n,!1),n+2},a.prototype.writeInt32LE=function e(t,n,i){return t=+t,n|=0,i||M(this,t,n,4,2147483647,-2147483648),a.TYPED_ARRAY_SUPPORT?(this[n]=255&t,this[n+1]=t>>>8,this[n+2]=t>>>16,this[n+3]=t>>>24):O(this,t,n,!0),n+4},a.prototype.writeInt32BE=function e(t,n,i){return t=+t,n|=0,i||M(this,t,n,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),a.TYPED_ARRAY_SUPPORT?(this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=255&t):O(this,t,n,!1),n+4},a.prototype.writeFloatLE=function e(t,n,i){return j(this,t,n,!0,i)},a.prototype.writeFloatBE=function e(t,n,i){return j(this,t,n,!1,i)},a.prototype.writeDoubleLE=function e(t,n,i){return V(this,t,n,!0,i)},a.prototype.writeDoubleBE=function e(t,n,i){return V(this,t,n,!1,i)},a.prototype.copy=function e(t,n,i,r){if(i||(i=0),r||0===r||(r=this.length),n>=t.length&&(n=t.length),n||(n=0),r>0&&r<i&&(r=i),r===i)return 0;if(0===t.length||0===this.length)return 0;if(n<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-n<r-i&&(r=t.length-n+i);var o=r-i,s;if(this===t&&i<n&&n<r)for(s=o-1;s>=0;--s)t[s+n]=this[s+i];else if(o<1e3||!a.TYPED_ARRAY_SUPPORT)for(s=0;s<o;++s)t[s+n]=this[s+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+o),n);return o},a.prototype.fill=function e(t,n,i,r){if("string"==typeof t){if("string"==typeof n?(r=n,n=0,i=this.length):"string"==typeof i&&(r=i,i=this.length),1===t.length){var o=t.charCodeAt(0);o<256&&(t=o)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!a.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(n<0||this.length<n||this.length<i)throw new RangeError("Out of range index");if(i<=n)return this;n>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0);var s;if("number"==typeof t)for(s=n;s<i;++s)this[s]=t;else{var l=a.isBuffer(t)?t:H(""+new a(t,r)),u=l.length;for(s=0;s<i-n;++s)this[s+n]=l[s%u]}return this};var te=/[^+\/0-9A-Za-z-_]/g}).call(t,n(7))},function(e,t,n){"use strict";function i(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");return"="===e[t-2]?2:"="===e[t-1]?1:0}function r(e){return 3*e.length/4-i(e)}function o(e){var t,n,r,o,a,s=e.length;o=i(e),a=new d(3*s/4-o),n=o>0?s-4:s;var l=0;for(t=0;t<n;t+=4)r=c[e.charCodeAt(t)]<<18|c[e.charCodeAt(t+1)]<<12|c[e.charCodeAt(t+2)]<<6|c[e.charCodeAt(t+3)],a[l++]=r>>16&255,a[l++]=r>>8&255,a[l++]=255&r;return 2===o?(r=c[e.charCodeAt(t)]<<2|c[e.charCodeAt(t+1)]>>4,a[l++]=255&r):1===o&&(r=c[e.charCodeAt(t)]<<10|c[e.charCodeAt(t+1)]<<4|c[e.charCodeAt(t+2)]>>2,a[l++]=r>>8&255,a[l++]=255&r),a}function a(e){return u[e>>18&63]+u[e>>12&63]+u[e>>6&63]+u[63&e]}function s(e,t,n){for(var i,r=[],o=t;o<n;o+=3)i=(e[o]<<16)+(e[o+1]<<8)+e[o+2],r.push(a(i));return r.join("")}function l(e){for(var t,n=e.length,i=n%3,r="",o=[],a=16383,l=0,c=n-i;l<c;l+=16383)o.push(s(e,l,l+16383>c?c:l+16383));return 1===i?(t=e[n-1],r+=u[t>>2],r+=u[t<<4&63],r+="=="):2===i&&(t=(e[n-2]<<8)+e[n-1],r+=u[t>>10],r+=u[t>>4&63],r+=u[t<<2&63],r+="="),o.push(r),o.join("")}t.byteLength=r,t.toByteArray=o,t.fromByteArray=l;for(var u=[],c=[],d="undefined"!=typeof Uint8Array?Uint8Array:Array,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=0,p=f.length;h<p;++h)u[h]=f[h],c[f.charCodeAt(h)]=h;c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,i,r){var o,a,s=8*r-i-1,l=(1<<s)-1,u=l>>1,c=-7,d=n?r-1:0,f=n?-1:1,h=e[t+d];for(d+=f,o=h&(1<<-c)-1,h>>=-c,c+=s;c>0;o=256*o+e[t+d],d+=f,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=i;c>0;a=256*a+e[t+d],d+=f,c-=8);if(0===o)o=1-u;else{if(o===l)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,i),o-=u}return(h?-1:1)*a*Math.pow(2,o-i)},t.write=function(e,t,n,i,r,o){var a,s,l,u=8*o-r-1,c=(1<<u)-1,d=c>>1,f=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,h=i?0:o-1,p=i?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),t+=a+d>=1?f/l:f*Math.pow(2,1-d),t*l>=2&&(a++,l/=2),a+d>=c?(s=0,a=c):a+d>=1?(s=(t*l-1)*Math.pow(2,r),a+=d):(s=t*Math.pow(2,d-1)*Math.pow(2,r),a=0));r>=8;e[n+h]=255&s,h+=p,s/=256,r-=8);for(a=a<<r|s,u+=r;u>0;e[n+h]=255&a,h+=p,a/=256,u-=8);e[n+h-p]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){var i,r=r||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=e.document,n=function(){return e.URL||e.webkitURL||e},i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in i,o=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},a=/constructor/i.test(e.HTMLElement)||e.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent),l=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},u="application/octet-stream",c=4e4,d=function(e){var t=function(){"string"==typeof e?n().revokeObjectURL(e):e.remove()};setTimeout(t,4e4)},f=function(e,t,n){t=[].concat(t);for(var i=t.length;i--;){var r=e["on"+t[i]];if("function"==typeof r)try{r.call(e,n||e)}catch(e){l(e)}}},h=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},p=function(t,l,c){c||(t=h(t));var p=this,m=t.type,g=m===u,y,v=function(){f(p,"writestart progress write writeend".split(" "))},b=function(){if((s||g&&a)&&e.FileReader){var i=new FileReader;return i.onloadend=function(){var t=s?i.result:i.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,p.readyState=p.DONE,v()},i.readAsDataURL(t),void(p.readyState=p.INIT)}if(y||(y=n().createObjectURL(t)),g)e.location.href=y;else{e.open(y,"_blank")||(e.location.href=y)}p.readyState=p.DONE,v(),d(y)};if(p.readyState=p.INIT,r)return y=n().createObjectURL(t),void setTimeout(function(){i.href=y,i.download=l,o(i),v(),d(y),p.readyState=p.DONE});b()},m=p.prototype,g=function(e,t,n){return new p(e,t||e.name||"download",n)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=h(e)),navigator.msSaveOrOpenBlob(e,t)}:(m.abort=function(){},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,g)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);void 0!==e&&e.exports?e.exports.saveAs=r:null!==n(94)&&null!==n(95)&&void 0!==(i=function(){return r}.call(t,n,t,e))&&(e.exports=i)},function(e,t){e.exports=function(){throw Error("define cannot be used indirect")}},function(e,t){(function(t){e.exports=t}).call(t,{})},function(e,t,n){function i(){function e(){Ext.tip.QuickTipManager.init(),Ext.override(Ext.ZIndexManager,{_showModalMask:function e(t){var n=this,i=t.el.getStyle("zIndex")-4,r=t.floatParent?t.floatParent.getTargetEl():t.container,o=n.mask;o||(o=n.mask=Ext.getBody().createChild({role:"presentation",cls:"ub-mask"}),o.setVisibilityMode(Ext.Element.DISPLAY),o.on("click",n._onMaskClick,n)),o.maskTarget=r,o.setStyle("zIndex",i),o.show()}}),Ext.override(Ext.AbstractManager,{unregister:function e(t){t.id?this.all.removeAtKey(t.id):this.all.remove(t)}}),Ext.override(Ext.LoadMask,{getMaskEl:function e(){return(this.maskEl||this.el)&&(this.maskEl||this.el).setVisibilityMode(Ext.Element.DISPLAY),this.callParent(arguments)}}),Ext.override(Ext.menu.Menu,{onMouseLeave:function e(t){var n=!1;this.items.each(function(e){e.menu&&e.menu.isVisible()&&(n=!0)}),n||(this.deactivateActiveItem(),this.disabled||this.fireEvent("mouseleave",this,t))}}),Ext.override(Ext.layout.component.field.Field,{beginLayoutFixed:function e(t,n,i){var r=t.target,o=r.inputEl,a=r.inputWidth;r.el.setStyle("table-layout","fixed"),100!==n&&"%"!==i&&r.bodyEl.setStyle("width",n+i),o&&a&&o.setStyle("width",a+"px"),t.isFixed=!0}}),Ext.override(Ext.form.field.Text,{initComponent:function e(){this.requiredCls="ub-require-control-u",this.callParent(arguments)},afterRender:function e(){this.callParent(arguments),this.allowBlank||this.setAllowBlank(this.allowBlank)},fieldSubTpl:['<input id="{id}" type="{type}" role="{role}" {inputAttrTpl}','<tpl if="name"> name="{name}"</tpl>','<tpl if="value"> value="{[Ext.util.Format.htmlEncode(values.value)]}"</tpl>','<tpl if="placeholder"> placeholder="{placeholder}"</tpl>','{%if (values.maxLength !== undefined){%} maxlength="{maxLength}"{%}%}','<tpl if="readOnly"> readonly="readonly"</tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','<tpl if="tabIdx"> tabIndex="{tabIdx}"</tpl>','<tpl if="fieldStyle"> style="{fieldStyle}"</tpl>',' class="{fieldCls} {typeCls} {editableCls} {inputCls} x-form-field-text" />',{disableFormats:!0}],requireText:"pleaseInputValueToThisField",setAllowBlank:function e(t){this.allowBlank=t,this.inputEl&&(t?(this.inputEl.removeCls(this.requiredCls),this.inputEl.dom.removeAttribute("placeholder")):(this.inputEl.addCls(this.requiredCls),this.requireText&&this.inputEl.dom.setAttribute("placeholder",r.i18n(this.requireText))))}}),Ext.override(Ext.grid.plugin.RowEditing,{validateEdit:function e(){var t=this,n=t.context;return!1!==t.fireEvent("validateedit",t,n)&&!n.cancel&&this.getEditor().completeEdit()}}),Ext.override(Ext.form.field.Base,{leftIndent:15,rightIndent:15,margin:"3 15 2 15",withoutIndent:!0,getLabelableRenderData:function e(){var t=this.callParent(arguments);return this.withoutIndent||(t.leftIndent=this.leftIndent,t.rightIndent=this.rightIndent),t},labelableRenderTpl:['<tr role="presentation" id="{id}-inputRow" <tpl if="inFormLayout">id="{id}"</tpl> class="{inputRowCls}">','<tpl if="leftIndent">','<td class="labelable-left-indent" style="width: {leftIndent}px;" ></td>',"</tpl>",'<tpl if="labelOnLeft">','<td role="presentation" id="{id}-labelCell" style="{labelCellStyle}" {labelCellAttrs}>',"{beforeLabelTpl}",'<label id="{id}-labelEl" {labelAttrTpl}','<tpl if="inputId && !(boxLabel && !fieldLabel)"> for="{inputId}"</tpl>',' class="{labelCls}"','<tpl if="labelStyle"> style="{labelStyle}"</tpl>',' unselectable="on"',">","{beforeLabelTextTpl}",'<tpl if="fieldLabel">{fieldLabel}','<tpl if="labelSeparator">','<span role="separator">{labelSeparator}</span>',"</tpl>","</tpl>","{afterLabelTextTpl}","</label>","{afterLabelTpl}","</td>","</tpl>",'<td role="presentation" class="{baseBodyCls} {fieldBodyCls} {extraFieldBodyCls}" id="{id}-bodyEl" colspan="{bodyColspan}" role="presentation">',"{beforeBodyEl}","<tpl if=\"labelAlign=='top'\">","{beforeLabelTpl}",'<div role="presentation" id="{id}-labelCell" style="{labelCellStyle}">','<label id="{id}-labelEl" {labelAttrTpl}<tpl if="inputId"> for="{inputId}"</tpl> class="{labelCls}"','<tpl if="labelStyle"> style="{labelStyle}"</tpl>',' unselectable="on"',">","{beforeLabelTextTpl}",'<tpl if="fieldLabel">{fieldLabel}','<tpl if="labelSeparator">','<span role="separator">{labelSeparator}</span>',"</tpl>","</tpl>","{afterLabelTextTpl}","</label>","</div>","{afterLabelTpl}","</tpl>","{beforeSubTpl}","{[values.$comp.getSubTplMarkup(values)]}","{afterSubTpl}","<tpl if=\"msgTarget==='side'\">","{afterBodyEl}","</td>","<td role=\"presentation\" id=\"{id}-sideErrorCell\" vAlign=\"{[values.labelAlign==='top' && !values.hideLabel ? 'bottom' : 'middle']}\" style=\"{[values.autoFitErrors ? 'display:none' : '']}\" width=\"{errorIconWidth}\">",'<div role="alert" aria-live="polite" id="{id}-errorEl" class="{errorMsgCls}" style="display:none"></div>',"</td>","<tpl elseif=\"msgTarget=='under'\">",'<div role="alert" aria-live="polite" id="{id}-errorEl" class="{errorMsgClass}" colspan="2" style="display:none"></div>',"{afterBodyEl}","</td>","</tpl>",'<tpl if="rightIndent">','<td class="labelable-right-indent" style="width: {rightIndent}px;" ></td>',"</tpl>","</tr>",{disableFormats:!0}]}),Ext.override(Ext.form.FieldContainer,{margin:"0 15 0 15"}),Ext.override(Ext.layout.container.Accordion,{beforeRenderItems:function e(t){for(var n=0,i=t.length;n<i;n++)t[n].simpleCollapse=!0;this.callParent([t])}}),Ext.override(Ext.panel.Panel,{initTools:function e(){var t=this;if(t.simpleCollapse){t.tools=[],t.toggleCmp=Ext.widget({xtype:"component",autoEl:{tag:"div"},height:15,width:35,isHeader:!0,id:t.id+"-legendToggle",style:"float: left; font-size: 1.4em; padding-left: 12px; cursor: pointer;",scope:t}),t.toggleCmp.on("boxready",function(){}),t.collapsed?t.toggleCmp.addCls(["fa","fa-angle-right"]):t.toggleCmp.addCls(["fa","fa-angle-down"]);var n="left"===t.headerPosition||"right"===t.headerPosition;t.header=Ext.widget(Ext.apply({xtype:"header",title:t.title,titleAlign:t.titleAlign,orientation:n?"vertical":"horizontal",dock:t.headerPosition||"top",textCls:t.headerTextCls,iconCls:t.iconCls,icon:t.icon,glyph:t.glyph,baseCls:t.baseCls+"-header",tools:[t.toggleCmp],ui:t.ui,id:t.id+"_header",overCls:t.headerOverCls,indicateDrag:t.draggable,frame:(t.frame||t.alwaysFramed)&&t.frameHeader,ignoreParentFrame:t.frame||t.overlapHeader,ignoreBorderManagement:t.frame||t.ignoreHeaderBorderManagement,headerRole:t.headerRole,ownerCt:t,listeners:t.collapsible&&t.titleCollapse?{click:t.toggleCollapse,scope:t}:null},t.header)),t.header.titleCmp.flex=void 0,t.header.addCls(["accordion-header"]),t.addDocked(t.header,0)}else t.callParent(arguments)},toggleC:function e(){this.toggleCmp&&(this.collapsed?(this.toggleCmp.removeCls("fa-angle-down"),this.toggleCmp.addCls("fa-angle-right")):(this.toggleCmp.removeCls("fa-angle-right"),this.toggleCmp.addCls("fa-angle-down")))},expand:function e(t){this.callParent(arguments),this.toggleC()},collapse:function e(t,n){this.callParent(arguments),this.toggleC()},updateCollapseTool:function e(){this.simpleCollapse||this.callParent(arguments)}}),Ext.util.CSS.refreshCache(),delete Ext.tip.Tip.prototype.minWidth,Ext.Ajax.timeout=12e4,"onHashChange"in window?window.addEventListener("hashchange",r.core.UBApp.locationHashChanged,!1):window.onhashchange=r.core.UBApp.locationHashChanged,Ext.setGlyphFontFamily("FontAwesome"),Ext.state.Manager.setProvider(Ext.create("Ext.state.LocalStorageProvider")),$App.launch().fin(function(){Ext.get(Ext.query("html.loading")).removeCls("loading")}),new Ext.util.KeyMap({target:window.document.body,binding:[{ctrl:!0,shift:!1,key:Ext.EventObject.R,fn:function e(t,n){return n.stopEvent(),!1}}]}),Ext.EventManager.addListener(Ext.getBody(),"keydown",function(e){var t=(e.getTarget().tagName||"").toLocaleLowerCase();e.getKey()===Ext.EventObject.BACKSPACE&&"textarea|input".indexOf(t)<0&&e.preventDefault(),e.getKey()===Ext.EventObject.C&&e.ctrlKey&&e.altKey&&r.core.UBFormLoader.clearFormCache()}),r.view.UBDropZone.init(),window.onbeforeunload=function(){window.onbeforeunload=null,window.toLog=null,window.onerror=null,$App.connection&&$App.connection.logout()},document.addEventListener("contextmenu",function(e){e.preventDefault()},!1)}window.Q&&window.Q.getBluebirdPromise&&(window.Q.onerror=function(e){window.onerror.apply(this,["","","","",e])}),window.addEventListener("unhandledrejection",function(e){e.preventDefault();var t=e.detail?e.detail.reason:e.reason,n=e.detail?e.detail.promise:e.promise;window.onerror&&window.onerror.apply(this,["","","","",t]),console.error("UNHANDLED",t,n)}),window.onerror=function(e,t,n,i,o){var a=void 0,s="";if(o&&r.UBAbortError&&o instanceof r.UBAbortError)return void console.log(o);var l=o&&r.UBError&&o instanceof r.UBError;if(o&&Error&&o instanceof Error){a=o.message,s="",!1===/q\.js/.test(t)&&(s+='file: "'+t+'" line: '+n);s+=(o.stack||"").replace(/\?ubver=\w*/g,"").replace(/\?ver=\w*/g,""),s=s.replace(RegExp(window.location.origin.replace(/:/g,"\\$&"),"g"),""),s=s.replace(/\/[\w-]+\.js:/g,"<b>$&</b>&nbsp;line "),s=s.replace(/\n/g,"<br>&nbsp;&nbsp;")}else o&&o.data&&o.data.errMsg?a=o.data.errMsg:o&&0===o.status?(a="serverIsBusy",l=!0):o&&o.errMsg?(a=o.errMsg,s=o.detail?o.detail:a):a=o&&"string"==typeof o?o:e;o&&o.detail&&(s=o.detail+(s?"<BR/>"+s:""),"Method Not Allowed"===o.detail&&(a="recordNotExistsOrDontHaveRights")),a||(a="internalServerError"),l||(a="unknownError");try{r.showErrorWindow?r.showErrorWindow(a,"","",s):window.alert(a)}catch(e){window.alert(a)}},Ext.Window.prototype.floating={shadow:!1};var t=r.addResourceVersion;Ext.Loader.loadScriptBase=Ext.Loader.loadScript,Ext.Loader.loadScript=function(e){var n=this.getConfig(),i=e;if(!n.disableCaching){"string"==typeof e?i=t(i):(i=Ext.clone(e),i.url=t(i.url))}this.loadScriptBase(i)},Ext.Loader.loadScriptFileBase=Ext.Loader.loadScriptFile,Ext.Loader.loadScriptFile=function(e,t,n,i,r){try{throw Error('Component "'+e+'" is loaded directly using Ext.require or inderectly by one of Ext.create({"requires":.., "extend": ..., "mixins": ...}) directive) - in UB4 use require() instead')}catch(e){console.warn(e)}Ext.Loader.isLoading=!0,SystemJS.import(e).then(function(){return t.call(i)},function(){return n.call(i)})},Ext.onReady(e),Ext.JSON.encodeDate=JSON.stringify,window.toLog=function(e,t){console&&console.debug&&(t?console.debug(e.replace("%","%s"),t):console.debug(e))}}n(14),n(170),n(45);var r=n(10);e.exports=i},function(e,t){e.exports={import:function(){throw Error("System.import cannot be used indirectly")}}},function(e,t){Ext.define("UB.view.LoginWindow",{extend:"Ext.window.Window",alias:"widget.loginwindow",uses:["UB.core.UBApp","UB.core.UBAppConfig"],statics:{DoLogon:function e(t,n){var i,r=JSON.parse(window.localStorage.getItem("silenceKerberosLogin")||"false"),o=JSON.parse(window.localStorage.getItem("userDidLogout")||"false"),a;return o&&window.localStorage.setItem("userDidLogout","false"),t.authMethods.length?r&&!n&&!o&&t.authMethods.indexOf("Negotiate")>=0?Promise.resolve({authSchema:"Negotiate",login:"",password:"",registration:0}):(i=Ext.create("UB.view.LoginWindow",{connection:t}),a=new Promise(function(e,t){i.deferred={resolve:e,reject:t}}),t.lastLoginName&&(i.textFieldLoginCert&&i.textFieldLoginCert.setDisabled(!0),i.textFieldLogin&&i.textFieldLogin.setDisabled(!0),i.authTabs&&i.authTabs.getTabBar().setDisabled(!0)),i.show(),Ext.WindowManager.bringToFront(i),a):Promise.resolve({authSchema:"None",login:"anonymous"})}},cls:"ub-login-window",layout:"anchor",buttonAlign:"center",width:500,plain:!0,modal:!0,closable:!1,header:!1,resizable:!1,id:"extClientLoginForm",connection:null,constructor:function e(t){this.callParent(arguments)},destroy:function e(){this.connection=null,this.poweredBy&&this.poweredBy.destroy(),this.keyNav&&this.keyNav.destroy(!1),this.callParent(arguments)},listeners:{afterRender:function e(t,n){this.keyNav=Ext.create("Ext.util.KeyNav",this.el,{enter:this.submitLogin,scope:this})}},initComponent:function e(){var t=this,n=t.connection.authMethods,i=[],r,o,a=265,s=window.localStorage.getItem("lastLogin"),l=this.connection.preferredLocale,u,c=UB.appConfig.uiSettings.adminUI;if(r=JSON.parse(window.localStorage.getItem("firstLogin")||"false"),o=JSON.parse(window.localStorage.getItem("silenceKerberosLogin")||"false"),t.items=[],t.buttons=[{text:UB.i18n("enter"),cls:"ub-login-btn",scope:this,minWidth:150,margins:"0 0 10 0",handler:function e(){this.submitLogin()}}],c&&c.loginWindowTopLogoURL&&t.items.push(Ext.create("Ext.Img",{src:c.loginWindowTopLogoURL,autoEl:"div",cls:"logo-top"})),c&&c.applicationName&&("string"==typeof c.applicationName?u=c.applicationName:_.isObject(c.applicationName)&&(u=c.applicationName[l])),u&&t.items.push({xtype:"component",autoEl:{tag:"h2",html:u}}),n.indexOf("CERT")>=0){var d=c.authenticationCert||{};a=345,t.textFieldLoginCert=Ext.create("Ext.form.field.Text",{margin:"0 80 0 80",allowBlank:!1,cls:"ub-login-input",labelClsExtra:"fa fa-user fa-2x",requireText:UB.i18n("login"),fieldLabel:" ",labelSeparator:"",regex:d.userNameRE?RegExp(d.userNameRE):null,regexText:d.userNameREMessage?UB.i18n(d.userNameREMessage):null,labelWidth:40,value:t.connection.lastLoginName||s}),t.textFieldPasswordCert=Ext.create("Ext.form.field.Text",{margin:"10 80 10 80",allowBlank:!1,cls:"ub-login-input",labelClsExtra:"fa fa-key fa-2x",requireText:UB.i18n("parol"),fieldLabel:" ",labelSeparator:"",labelWidth:40,inputType:"password",name:"password",anchor:"100%",value:c.defaultPasswordForDebugOnly}),t.chkFirstLogin=Ext.create("Ext.form.field.Checkbox",{margin:"10 80 10 125",xtype:"checkbox",labelAlign:"left",labelCls:"ub-login-label",labelWidth:80,checked:!!r,boxLabel:UB.i18n("isFirstLogin")});var f=[],h="useCertificateInfoSimple";t.connection.simpleCertAuth?d.requireUserName&&(h="useCertificateInfoSimpleUserName",f.push(t.textFieldLoginCert)):(h="useCertificateInfo",f.push(t.textFieldLoginCert,t.textFieldPasswordCert)),d.description&&(h=d.description),f.push(t.chkFirstLogin,{xtype:"component",padding:"20 0 0 0",autoEl:{tag:"div",html:UB.i18n(h)}}),t.pnlCert=Ext.create("Ext.panel.Panel",{title:UB.i18n("useCertificateTitle"),header:!1,authType:"CERT",padding:"20 50 0 50",layout:{type:"vbox",align:"stretch"},items:f}),i.push(t.pnlCert)}n.indexOf("UB")>=0&&(t.textFieldLogin=Ext.create("Ext.form.field.Text",{margin:"0 80 0 80",allowBlank:!1,cls:"ub-login-input",labelClsExtra:"fa fa-user fa-2x",requireText:UB.i18n("login"),fieldLabel:" ",labelSeparator:"",labelWidth:40,anchor:"100%",value:t.connection.lastLoginName||s}),t.textFieldPassword=Ext.create("Ext.form.field.Text",{margin:"10 80 10 80",allowBlank:!1,cls:"ub-login-input",labelClsExtra:"fa fa-key fa-2x",requireText:UB.i18n("parol"),fieldLabel:" ",labelSeparator:"",labelWidth:40,inputType:"password",anchor:"100%",value:UB.appConfig.uiSettings.adminUI.defaultPasswordForDebugOnly,listeners:{keyup:{fn:$App.passwordKeyUpHandler}},enableKeyEvents:!0}),t.pnlUB=Ext.create("Ext.panel.Panel",{title:UB.i18n("useUBAuthenticationTitle"),header:!1,authType:"UB",padding:"20 50 30 50",layout:{type:"vbox",align:"stretch"},items:[t.textFieldLogin,t.textFieldPassword,{xtype:"component",padding:"50 0 0 0",autoEl:{tag:"div",html:UB.i18n("useUBAuthenticatinInfo")}}]}),i.push(t.pnlUB)),n.indexOf("Negotiate")>=0&&(t.chkSilenceLogint=Ext.create("Ext.form.field.Checkbox",{margin:"10 80 10 125",xtype:"checkbox",labelAlign:"left",labelCls:"ub-login-label",labelWidth:80,checked:!!o,boxLabel:UB.i18n("chkSilenceLogin")}),t.pnlOs=Ext.create("Ext.panel.Panel",{title:UB.i18n("useOSCredentialTitle"),header:!1,authType:"Negotiate",padding:"20 50 50 50",items:[t.chkSilenceLogint,{xtype:"component",autoEl:{tag:"div",html:UB.i18n("useOSCredentialInfo")}}]}),i.push(t.pnlOs)),n.indexOf("OpenIDConnect")>=0&&(UB.get("openIDConnect",{responceType:"json"}).done(function(e){var n=e.data,i={xtype:"radiogroup",columns:1,id:"extLoginOpenIDType",vertical:!0,items:[]};n.forEach(function(e){i.items.push({boxLabel:UB.i18n(e),name:"providerName",inputValue:e})}),i.items.length&&(i.items[0].checked=!0),t.pnlOID.add(i)}),t.pnlOID=Ext.create("Ext.panel.Panel",{title:UB.i18n("OpenIDConnect"),header:!1,authType:"OpenIDConnect",padding:"20 150 50 50"}),i.push(t.pnlOID)),i.length>1?(t.authTabs=Ext.create("Ext.tab.Panel",{height:a,maxTabWidth:140,tabBar:{layout:{pack:"center",align:"middle"},titleAlign:"center",buttonAlign:"center"},items:i}),t.items.push(t.authTabs)):t.items.push(i[0]),UB.appConfig.uiSettings.adminUI&&UB.appConfig.uiSettings.adminUI.loginWindowBottomLogoURL&&t.items.push(Ext.create("Ext.Img",{src:UB.appConfig.uiSettings.adminUI.loginWindowBottomLogoURL,cls:"logo-bottom"})),t.poweredByText="Powered by UnityBase "+(t.connection.serverVersion?t.connection.serverVersion:""),t.on("boxready",function(){this.poweredBy=Ext.create("Ext.Component",{html:this.poweredByText,top:"95%",style:{opacity:.5,fontSize:"0.9em"},shadow:!1,floating:!0}),this.poweredBy.showBy(this,"bl",[15,4])}),t.callParent(arguments);var p=void 0;if(t.authTabs){var m=window.localStorage.getItem("lastAuthType")||n[0];p=t.query('panel[authType="'+m+'"]')[0]||i[0],t.authTabs.setActiveTab(p)}else p=i[0];var g=p.query("textfield");g[0]&&g[0].getValue()?t.defaultFocus=g[1]:t.defaultFocus=g[0]},submitLogin:function e(){var t=this,n="",i="",r;if("UB"!==(r=t.authTabs?t.authTabs.getActiveTab().authType:t.down("panel").authType)||(t.textFieldLogin.validate(),t.textFieldPassword.validate(),n=Ext.String.trim(t.textFieldLogin.getValue()),(i=Ext.String.trim(t.textFieldPassword.getValue()))&&""!==i&&n&&""!==n)){if("CERT"===r){t.textFieldLoginCert.validate(),t.textFieldPasswordCert.validate();var o=UB.appConfig.uiSettings.adminUI.authenticationCert||{};if((!t.connection.simpleCertAuth||o.requireUserName)&&!t.textFieldLoginCert.validate())return;if(!t.connection.simpleCertAuth&&!t.textFieldPasswordCert.validate())return;n=Ext.String.trim(t.textFieldLoginCert.getValue()||""),i=Ext.String.trim(t.textFieldPasswordCert.getValue()||""),window.localStorage.setItem("firstLogin",t.chkFirstLogin.checked),UB.inject("models/UBA/BigInteger.js").done(function(){function e(e){var t=30,n,i,r,o=bigInt.one;for(n=e;n.length<30;)n=n+e.length+e;for(n=n.substr(0,30),i=1;i<=30;i++)r=n.charCodeAt(i-1)-15,o=o.multiply(Math.ceil(r/3)).add(r*i+i);return(""+o).substr(0,30)}t.deferred.resolve({authSchema:r,login:n.toLowerCase(),password:""+UB.MD5(n.toLowerCase()+":"+e(i)),registration:t.chkFirstLogin.checked?1:0})})}else{if("OpenIDConnect"===r){var a=function e(){var t=600,n=525;return"width=600,height=525,left="+Math.floor(window.screenX+(window.outerWidth-600)/2)+",top="+Math.floor(window.screenY+(window.outerHeight-525)/2)+",toolbar=0,scrollbars=1,status=1,resizable=1,location=1,menuBar=0"},s=function e(n){if(n.source===c)if(window.removeEventListener("message",e),0===n.origin.indexOf(window.location.origin)){var i=n.data;i.success?(i.authSchema="OpenIDConnect",t.deferred.resolve(i),t.close()):$App.dialogError("authOpenIDConnectFail")}else $App.dialogError("authOpenIDConnectFail")},l=Ext.getCmp("extLoginOpenIDType").getValue(),u=window.location.href;u=u.substr(0,u.lastIndexOf("/"))+"/openIDConnect/"+l.providerName;var c=window.open(u,"login",a());return window.addEventListener("message",s),void window.localStorage.setItem("lastAuthType",r)}t.deferred.resolve({authSchema:r,login:n.toLowerCase(),password:i,registration:0})}window.localStorage.setItem("lastAuthType",r),window.localStorage.setItem("lastLogin",n),"Negotiate"===r&&window.localStorage.setItem("silenceKerberosLogin",t.chkSilenceLogint.getValue()),t.close()}}})},function(e,t,n){n(33),n(100),n(4),n(101),n(46),n(165),n(32),n(166),n(167),Ext.define("UB.view.Viewport",{extend:"Ext.container.Viewport",uses:["UB.core.UBApp"],initComponent:function e(){var t=this;$App.on({updateCenterPanel:t.onUpdateCenterPanel,desktopChanged:t.onDesktopChanged,scope:t}),t.topPanel=Ext.create("UB.view.MainToolbar",{region:"north",collapsible:!1,border:!1,margin:"0, 0, 0, 0"}),t.leftPanel=Ext.create("UB.view.LeftPanel",{header:!1,region:"west",width:225,margin:"3, 5, 0, 0",border:!1}),t.contextMenu=Ext.create("Ext.menu.Menu",{items:[{text:UB.i18n("close"),scope:t,handler:function e(){t.centralPanel.remove(t.centralPanel.items.getAt(t.contextMenu.itemPos))}},{text:UB.i18n("closeOther"),scope:t,handler:function e(){t.centralPanel.items.each(function(e,n){n!==t.contextMenu.itemPos&&t.centralPanel.remove(e)})}},{text:UB.i18n("closeAll"),scope:t,handler:function e(){t.centralPanel.removeAll()}}]}),t.centralPanel=Ext.create("Ext.tab.Panel",{region:"center",id:"ubCenterViewport",isMainTabPanel:!0,deferredRender:!1,layout:"fit",maxTabWidth:200,border:!1,margin:"3, 0, 0, 0",loader:{autoLoad:!1},listeners:{boxready:function e(){if(window.location.href&&window.location.href.indexOf("#")>0){var n=UB.core.UBCommand.getCommandByUrl(window.location.href,t.getCenterPanel());n&&$App.doCommand(n)}},add:function e(n,i,r){t.centralPanel.tabBar.items.getAt(r).on("boxready",function(e){e.getEl().on("contextmenu",function(e){t.contextMenu.itemPos=r,t.contextMenu.showAt(e.getXY())},t)},t)},scope:t}}),Ext.apply(t,{layout:"border",items:[t.topPanel,t.leftPanel,t.centralPanel]}),this.callParent(arguments),UB.view.Viewport.main=this,this.on("destroy",function(){this.topPanel=null,this.leftPanel=null,UB.view.Viewport.main=null,UB.view.Viewport.centerPanel=null},this)},getCenterPanel:function e(){return this.getLayout().centerRegion},getLeftPanel:function e(){return this.leftPanel},onUpdateCenterPanel:function e(t){var n=this.getCenterPanel();"string"==typeof t?n.getLoader().load({url:t}):n.add(t)},onDesktopChanged:function e(t){var n=parseInt(t,10),i=UB.core.UBStoreManager.getDesktopStore().getById(n),r;i&&(r=i.get("Url"))&&this.onUpdateCenterPanel(r)}})},function(e,t,n){n(33),Ext.define("UB.view.UBBar",{override:"Ext.tab.Bar",initComponent:function e(){this.callParent(arguments);var t=UB.view.OverflowSelect||this.classOverflowSelect;this.layout.overflowHandler=new t(this.layout)},afterComponentLayout:function e(t){this.needsScroll=!1,this.callParent(arguments)}})},function(e,t,n){n(2),n(3),n(15),n(21),n(102),n(103),n(161),n(162),Ext.define("UB.view.MainToolbar",{extend:"Ext.toolbar.Toolbar",alias:"widget.maintoolbar",cls:"ub-header-menu-container",initComponent:function e(){this.buildToolbar(),this.callParent(arguments),UB.view.MainToolbar.toolbar=this},buildToolbar:function e(){var t=[];$App.fireEvent("buildMainMenu",t),Ext.apply(this,{items:t})}})},function(e,t,n){n(21),n(4),n(3),Ext.define("UB.view.ToolbarMenu",{extend:"UB.view.ToolbarWidget",alias:"widget.ubtoolbarmenu",requires:["Ext.menu.Menu"],border:0,margin:0,padding:0,flex:30,enableOverflow:!0,cls:"ub-header-menu-item",initComponent:function e(){this.items=this.buildMenu(),this.callParent(arguments)},buildMenu:function e(){var t=this,n=[],i,r,o,a;for(i=UB.core.UBStoreManager.getDesktopStore(),r=UB.core.UBStoreManager.getNavigationShortcutStore(),o=0;o<i.getCount();o++)a=i.getAt(o),n.push(t.buildMenuItem(a,r));return n},dsMenuToTree:function e(t,n){var i=this,r={},o=t.get("ID");return n.each(function(e){if(e.get("desktopID")===o){var t=e.get("ID"),n=e.get("parentID"),i,a;i=r[t],i?i.row=e:r[t]=i={id:t,items:[],row:e},a=r[n||"master"],a||(r[n||"master"]=a={id:t,items:[]}),a.items.push(i)}},i),r.master},buildMenuItem:function e(t,n){var i=this,r,o;return o=i.dsMenuToTree(t,n),r=function e(t){var n,o,a=[];if(t)for(n=0;n<t.items.length;n++)o=t.items[n],o.items.length>0?a.push({text:o.row.get("caption"),shortcutCode:o.row.get("code"),menu:{items:r(o)}}):a.push({text:o.row.get("caption"),record:o.row,shortcutCode:o.row.get("code"),handler:i.onItemClick});return a},{text:t.get("caption"),desktopCode:t.get("code"),menu:Ext.create("Ext.menu.Menu",{style:{overflow:"visible"},items:r(o)})}},onItemClick:function e(t){var n=t.record;$App.runShortcutCommand(n.get("ID"),n.get("inWindow"))}})},function(e,t,n){n(2),n(3),n(15),n(104),Ext.define("UB.view.ToolbarUser",{extend:"UB.view.ToolbarWidget",alias:"widget.ubtoolbaruser",initComponent:function e(){this.items=[{xtype:"button",id:"UB-view-ToolbarUser-button",iconCls:"fa fa-2x fa-user",text:$App.connection.userData("employeeShortFIO")||$App.connection.userLogin(),menu:{items:[{glyph:UB.core.UBUtil.glyphs.faCog,text:UB.i18n("userSettings"),handler:function e(){$App.doCommand({cmdType:UB.core.UBCommand.commandType.showForm,formCode:"ubm_desktop-userSettings"})}},{xtype:"checkbox",checked:JSON.parse(window.localStorage.getItem("silenceKerberosLogin")||"false"),boxLabel:UB.i18n("chkSilenceLogin"),hidden:$App.connection.authMethods.indexOf("Negotiate")<0,handler:function e(){window.localStorage.setItem("silenceKerberosLogin",this.getValue())}},{glyph:UB.core.UBUtil.glyphs.faKey,text:UB.i18n("changePassword"),handler:function e(){$App.showModal({formCode:"uba_user-changeUserPassword",description:UB.i18n("changePassword"),customParams:"self"}).then(function(e){"ok"===e.action&&$App.connection.xhr({method:"POST",url:"changePassword",data:{newPwd:e.newPwd,pwd:e.pwd,needChangePassword:e.needChangePassword}}).done(function(){$App.dialogInfo("passwordChangedSuccessfully")})})}},{glyph:UB.core.UBUtil.glyphs.faDatabase,text:UB.i18n("storedData"),menu:{items:[{text:UB.i18n("clearLocalStore"),iconCls:"iconData",handler:function e(){$App.connection.cacheClearAll().done(function(){Ext.create("widget.uxNotification",{title:UB.i18n("executed"),position:"t",slideInDuration:800,useXAxis:!0,autoShow:!0,cls:"ux-notification-light",bodyPadding:5,items:[{xtype:"component",autoEl:{tag:"div",html:UB.i18n("clearLocalStore")}}]})})}},{text:UB.i18n("resetGUIToDefault"),iconCls:"iconUI",handler:function e(){UB.core.UBLocalStorageManager.removeUserDataUI()}},{text:UB.i18n("clearFormsCache"),iconCls:"iconForm",tooltip:"Ctrl+Alt+C",handler:function e(){UB.core.UBFormLoader.clearFormCache(),Ext.create("widget.uxNotification",{title:UB.i18n("executed"),position:"t",slideInDuration:800,useXAxis:!0,autoShow:!0,cls:"ux-notification-light",bodyPadding:5,items:[{xtype:"component",autoEl:{tag:"div",html:UB.i18n("clearFormsCache")}}]})}}]}}]}}],UB.appConfig.supportedLanguages.length>1&&this.items[0].menu.items.push({glyph:UB.core.UBUtil.glyphs.faLanguage,text:UB.i18n("changeLanguage"),menu:{items:function(){var e=[];return _.forEach(UB.appConfig.supportedLanguages,function(t){t!==$App.connection.userLang()&&e.push({text:UB.i18n(t),handler:function e(){$App.dialogYesNo("?","changeLanguageRequireRestart").then(function(e){e&&$App.connection.query({entity:"uba_user",method:"changeLanguage",newLang:t}).then(function(){window.localStorage.setItem($App.connection.appName+"preferredLocale",t),$App.logout()})})}})}),e.length?e:{text:UB.i18n("noMoreLanguages")}}()},handler:function e(){}}),this.items[0].menu.items.push("-"),this.items[0].menu.items.push({glyph:UB.core.UBUtil.glyphs.faSignOut,text:UB.i18n("logout"),handler:function e(){window.localStorage.setItem("userDidLogout","true"),$App.logout()}}),this.callParent(arguments)}})},function(module,exports,__webpack_require__){__webpack_require__(2),__webpack_require__(22),__webpack_require__(3),__webpack_require__(16);var _=__webpack_require__(1),UB=__webpack_require__(10);Ext.define("UB.core.UBFormLoader",{uses:["UB.core.UBApp"],singleton:!0,formType:{auto:"auto",custom:"custom"},CACHE_PREFIX:"ubm_form_formdata_",definedClasses:[],evaluatedNames:{},getComponentClassName:function e(t){return this.getComponentPart(t,/(?:Ext.define\s*?\(\s*?["'])([\w.]+?)(?=["'])/,1)},getComponentRequires:function e(t){return this.getComponentPartAsArray(t,/(?:requires\s*?:\s*?\[)((\s*?.*?\s*?)*?)(?=])/m,1)},getComponentUses:function e(t){return this.getComponentPartAsArray(t,/(?:uses\s*?:\s*?\[)((\s*?.*?\s*?)*?)(?=])/m,1)},getComponentPartAsArray:function e(t,n,i){var r=UB.core.UBFormLoader.getComponentPart(t,n,i);return r&&r.length?Ext.JSON.decode("["+r+"]"):[]},getComponentPart:function e(t,n,i){var r=n.exec(t);return r&&r.length>i?UB.core.UBUtil.removeWhitespaces(r[i]):void 0},getFormCacheKey:function e(t,n){return UB.core.UBFormLoader.CACHE_PREFIX+t+"_"+(n||"formDef")},getFormByEntity:function e(t,n){var i=UB.core.UBStoreManager.getFormStore(),r=[],o=null;return i.each(function(e){if(e.get("entity")===t&&(r.push(e),!0===e.get("isDefault")&&!o&&(o=e,!n)))return!1}),o=o||r[0],n?r:o},undefineExtClass:function e(t){var n=t.split("."),i=window,r=Ext.ClassManager.get(t),o=void 0;if(r&&(delete Ext.ClassManager.classes[t],delete Ext.ClassManager.existCache[t],n.length)){o=n.pop();for(var a=0,s=n.length;a<s&&(i=i[n[a]]);a++);i&&delete i[o]}},clearFormCache:function e(t){var n=[],i=UB.core.UBFormLoader.CACHE_PREFIX,r=RegExp(i);t&&(n.push(i+t+"_formDef"),n.push(i+t+"_formCode"));for(var o=0,a=window.localStorage.length;o<a;o++){var s=window.localStorage.key(o);r.test(s)&&n.push(s)}_.forEach(n,function(e){window.localStorage.removeItem(e)}),t||(this.definedClasses.forEach(function(e){UB.core.UBFormLoader.undefineExtClass(e)}),this.definedClasses=[]),this.unloadModule(t),UB.logDebug("Forms data was cleared "+(t?"for form "+t:"for all forms"))},unloadModule:function e(t){t?delete this.evaluatedNames[t]:this.evaluatedNames={}},reloadModule:function e(t,n,i){this.unloadModule(i),this.evaluateModule(t,n,i)},evaluateModule:function evaluateModule(source,sourceTail,fileName){var exports=void 0,fullSrc=source;if(sourceTail&&(fullSrc+="\n/**** UBFormLoader splitting point ****/\n"+sourceTail),this.evaluatedNames[fileName])exports=this.evaluatedNames[fileName];else{exports={},fullSrc="(function (exports) { "+fullSrc+"\n});\n//# sourceURL=forms/"+fileName+".js";var fn=eval(fullSrc);fn(exports),this.evaluatedNames[fileName]=exports}return exports},getFormViewAndController:function e(t){function n(e,n,i,r){if(!r||!r.length)return Promise.resolve("");var o=window.localStorage.getItem(UB.core.UBFormLoader.getFormCacheKey(n,i));return o?Promise.resolve(o):UB.core.UBService.getDocument({id:e,entity:"ubm_form",attribute:i},null,null,{usePostMethod:!0}).then(function(e){if(!e)throw Error('Error loading form "'+t.formCode+'"');return window.localStorage.setItem(UB.core.UBFormLoader.getFormCacheKey(n,i),e),e})}var i=this,r=UB.core.UBStoreManager.getFormStore(),o=r.findRecord("code",t.formCode,0,!1,!0,!0);if(!o)throw Error('Unknown form code "'+t.formCode+'"');var a=""+o.get("formType"),s=""+o.get("formDef"),l=o.get("formCode");if(l=null===l?"":""+l,!s)throw Error("Form definition is empty for form with code "+t.formCode);var u=o.get("ID");return Promise.all([n(u,t.formCode,"formDef",s),n(u,t.formCode,"formCode",l)]).then(function(e){var n=e[0],r=e[1],o={formType:a};switch(a){case"auto":var s=i.evaluateModule(r,n,t.formCode);return o.formView=s.formDef,o.formController=s.formCode,o.formView&&o.formView.requires&&o.formView.requires.length?new Promise(function(e){Ext.Loader.require(o.formView.requires,function(){e(o)})}):o;case"custom":return UB.core.UBFormLoader.createExtClass(n,t.formCode);case"vue":return o.formView=n,o.formController=i.evaluateModule(r,null,t.formCode).formCode,o;default:throw Error("Unknown form type "+a+" for form "+t.formCode)}})},createExtClass:function createExtClass(classScript,fileName){return new Promise(function(resolve,reject){function doOnRequiredLoaded(){try{var extClass=eval(classScript+"\n//# sourceURL="+fileName+".js");resolve({formView:extClass})}catch(e){reject(Error("Errors in file "+fileName+".def\n"+e.message))}}var className=UB.core.UBFormLoader.getComponentClassName(classScript),definedClass=Ext.ClassManager.get(className);if(definedClass)resolve({formView:definedClass});else{UB.core.UBFormLoader.definedClasses.push(className);var requires=Ext.Array.merge(UB.core.UBFormLoader.getComponentRequires(classScript),UB.core.UBFormLoader.getComponentUses(classScript)),undefinedClasses=_.filter(requires,function(e){return!Ext.ClassManager.get(e)});undefinedClasses.length?Ext.Loader.require(undefinedClasses,doOnRequiredLoaded):doOnRequiredLoaded()}})}})},function(e,t,n){n(34),n(106),n(35),n(108),n(109),n(110),n(121),n(136),n(138),n(139),n(41),n(42),n(140),n(39),n(145),n(43),n(45),n(148),n(149),n(150),n(151),n(152),n(18),n(40),n(153),n(154),n(155),n(156),n(157),n(158),n(159);var i=n(1);Ext.define("UB.view.BasePanel",{extend:"Ext.form.Panel",alias:"widget.basepanel",border:!1,uses:["UB.core.UBAppConfig","UB.core.UBStoreManager","UB.core.UBUtil","UB.core.UBService","UB.core.UBCommand","UB.core.UBApp","UB.view.StatusWindow"],bodyPadding:0,isBasePanel:!0,statics:{defaultUBName:"ubName",actionId:{save:"save",saveAndClose:"saveAndClose",fDelete:"fDelete",refresh:"refresh",scan:"scan",attach:"attach",showOriginal:"showOriginal",deleteAttachment:"deleteAttachment",showVersions:"showVersions",accessRight:"accessRight",audit:"audit",history:"history",formConstructor:"formConstructor",downloadAttach:"downloadAttach",lock:"lock",unLock:"unLock"},eventId:{save:"save",fDelete:"fDelete",refresh:"refresh",scan:"scan",attach:"attach",showOriginal:"showOriginal",deleteattachment:"deleteattachment",showVersions:"showVersions",accessRight:"accessRight",audit:"audit",history:"history",formConstructor:"formConstructor",downloadAttach:"downloadAttach",lock:"lock",unLock:"unLock"},hotKeys:{saveAndClose:{key:Ext.EventObject.ENTER,shift:!1,ctrl:!0,text:" (Ctrl+Enter)"},save:{key:Ext.EventObject.S,ctrl:!0,shift:!1,text:" (Ctrl+S)"},fDelete:{key:Ext.EventObject.DELETE,ctrl:!0,shift:!1,text:" (Ctrl+DELETE)"},refresh:{ctrl:!0,shift:!1,key:Ext.EventObject.R,text:" (Ctrl+R)"}},markFieldLabelAsMandatory:function e(t){return t+'<span class="ub-view-marked-field-label">*</span>'}},mixins:{ubPanelMixin:"UB.core.UBPanelMixin"},overflowX:!0,overflowY:!0,bodyStyle:"padding: 5px 0 0 0",cls:"ub-basepanel",switchSaveButtonsAction:!1,isNewInstance:!0,record:null,postOnlySimpleAttributes:!1,formWasSaved:!1,initComponent:function e(){function t(){Ext.suspendLayouts();try{r.enableBinder(),r.initUBComponentFired||Ext.callback(r.initUBComponent,r),r.initUBComponentFired=!0,r.isDestroyed||r.fireEvent("formDataReady")}finally{Ext.resumeLayouts(!0)}r.unmaskForm()}function n(){r.startHideDone||(r.items.each(function(e){e.oldHidden||e.setVisible(!0),e.hideMode=e.oldHideMode,delete e.oldHidden,delete e.oldHideMode}),r.startHideDone=!0)}var r=this;r.dfm&&r.dfm.parentConfig&&Ext.apply(r,r.dfm.parentConfig),r.formDataReady=!1,r.domainEntity=$App.domainInfo.get(r.entityName),r.entityMethods=r.domainEntity.entityMethods,r.isNewInstance=!(r.instanceID&&!r.addByCurrent),r.isEditMode=!r.isNewInstance,r.addByCurrent&&(r.addByCurrentInstanceID=r.instanceID),r.documents={},i.forEach(r.domainEntity.filterAttribute({dataType:"Document"}),function(e){r.documents[e.code]=e}),r.documentsCount=Ext.Object.getSize(r.documents),r.hasDataHistoryMixin=r.domainEntity.hasMixin("dataHistory"),r.hasAuditMixin=r.domainEntity.hasMixin("audit"),r.hasHardSecurityMixin=r.domainEntity.hasMixin("aclRls"),r.isEntityLockable=r.domainEntity.hasMixin("softLock"),r.hasEntityALS=r.domainEntity.hasMixin("als"),r.addItems(),r.fieldList=r.getFieldList(),r.startLoadFormData(),r.preprocessPanel(),r.tabID&&(r.dockedItems||(r.dockedItems=[]),r.headerPanel=Ext.create("Ext.panel.Header",{border:0,padding:"3 3 3 8",isHeader:!0,layout:"hbox",height:25,dock:"top",cls:"ub-toolbar-header",bodyCls:"ub-toolbar-header",title:r.title||""}),r.dockedItems.splice(0,0,r.headerPanel)),r.initComponentStart&&i.isFunction(r.initComponentStart)&&Ext.callback(r.initComponentStart,r),r.callParent(arguments),r.initUBControlMap(),r.fields.forEach(function(e){e.getFieldLabel&&(e.originalFieldLabel=e.getFieldLabel())}),r.details=r.getDetails(),r.addEvents("recordloaded","beforesave","manualsaving","aftersave","afterdelete","formDataReady","beforeSaveForm","beforeDelete","beforeClose","updateFields","controlChanged","initComponentDone","dataBind","beforeRefresh"),r.on("destroy",r.onFormDestroy,r),r.on("close",r.onPanelClose,r),r.on("boxready",function(){var e=r.getFormWin();e&&r.mon(e,"close",r.onPanelClose,r),r.formDataReady||r.getEl().mask(UB.i18n("loadingData"))}),r.record=UB.ux.data.UBStore.createRecord(r.entityName,r.fieldList),r.record.store.on("update",r.onRecordUpdate,r),r.binder=Ext.create("UB.view.FormDataBinder",{panel:r}),r.binder.on("controlChanged",r.controlChanged,r),r.binder.on("formDataReady",function(){r.formDataReady=!0,Ext.suspendLayouts();try{r.rendered?t():r.on("afterrender",t,r,{single:!0}),n()}finally{Ext.resumeLayouts(!0)}if(!r.isDestroyed){var e=r.getEl();e&&e.unmask()}}),r.binder.on("dataBind",function(){r.fireEvent("dataBind",r.record)},r),this.updateActions("init"),r.initComponentDone&&i.isFunction(r.initComponentDone)&&Ext.callback(r.initComponentDone,r),r.fireEvent("initComponentDone",r)},createForm:function e(){for(var t={},n=this.basicFormConfigs,i=n.length,r=0,o;r<i;++r)o=n[r],t[o]=this[o];return new UB.view.UBForm(this,t)},setInstanceID:function e(t){var n=this;n.instanceID=t,n.isEditMode=!!n.instanceID,n.addByCurrent=!1},getInstanceID:function e(){var t=this;return t.instanceID||t.record.get("ID")},isFormDirty:function e(t){return this.record.dirty||this.extendedDataForSave&&Object.keys(this.extendedDataForSave).length>0},onRecordUpdate:function e(t,n){var i=this,r;i.record===n&&(i.isInnerChangingRecord||(r=i.isFormDirty(),(!i.fireDirty&&r||i.fireDirty&&!r)&&(i.fireDirty=!i.fireDirty,this.updateActions())))},disableBinder:function e(){this.isInnerChangingRecord=!0,this.binder.isInnerChangingRecord=!0},enableBinder:function e(){this.isInnerChangingRecord=!1,this.binder.isInnerChangingRecord=!1},onPanelClose:function e(){var t=this;t.onClose&&"function"==typeof t.onClose&&(t.isDeleted?t.onClose(null,t.store,t.formWasSaved):t.onClose(t.isNewInstance?null:t.instanceID,t.store,t.formWasSaved)),t.fireEvent("beforeClose",t)},getFormWin:function e(){return this.formWin||(this.formWin=this.up("window")),this.formWin},onFormDestroy:function e(){this.entityLocked&&this.deleteLock(),this.deleteInstanceID(),UB.view.UBDropZone&&UB.view.UBDropZone.un("configureDropZone",this.onFileDragDropConfigure,this),this.binder&&this.binder.destroy()},controlChanged:function e(t,n,i){var r=this;r.entityLocked||r.isNewInstance||!r.formDataReady||r.isSaveProcess||r.hasPersistLock||r.setEntityLocked(),r.fireEvent("controlChanged",t,n,i)},addPersistLock:function e(){var t=this,n,i=t.getInstanceID(),r=t.entityName;return t.isEntityLockable?("ID"!==t.domainEntity.mixins.softLock.lockIdentifier&&(n=t.domainEntity.mixins.softLock.lockIdentifier.split("."),n.length>0&&(n=n[0]),r=t.domainEntity.attr(n).associatedEntity,i=t.record.get(n)),$App.connection.run({method:"isLocked",entity:r,ID:i}).then(function(e){if(t.onGetLockInfo(e),e.lockInfo.isLocked&&"Temp"===e.lockInfo.lockType&&(!t.lockCtx||!t.entityLocked))throw new UB.UBError(UB.i18n("tempLockExistForThisUser"));return $App.connection.run({method:"lock",lockType:"ltPersist",entity:r,ID:i})}).then(function(e){e.resultLock&&e.resultLock.success&&(t.clearLockCtx(),t.onGetLockInfo({lockInfo:e.resultLock.lockInfo}))})):Promise.resolve(!1)},removePersistLock:function e(){var t=this,n,i=t.getInstanceID(),r=t.entityName;return t.isEntityLockable?("ID"!==t.domainEntity.mixins.softLock.lockIdentifier&&(n=t.domainEntity.mixins.softLock.lockIdentifier.split("."),n.length>0&&(n=n[0]),r=t.domainEntity.attr(n).associatedEntity,i=t.record.get(n)),$App.connection.run({method:"isLocked",entity:r,ID:i}).then(function(e){if(e.lockInfo.isLocked&&"Temp"===e.lockInfo.lockType&&(!t.lockCtx||!t.entityLocked))throw new UB.UBError(UB.i18n("tempLockExistForThisUser"));if(e.lockInfo.isLocked&&"Temp"===e.lockInfo.lockType)throw Error("Can not delete temporary lock");return $App.connection.run({method:"unlock",lockType:"ltPersist",entity:r,ID:i})}).then(function(e){e.resultLock&&e.resultLock.success&&t.onGetLockInfo()})):Q.resolve(!1)},onGetLockInfo:function e(t){var n=this;n.record.lockInfo=t?t.lockInfo||{}:{},n.hasPersistLock=(n.record.lockInfo.isLocked||n.record.lockInfo.lockExists)&&"Persist"===n.record.lockInfo.lockType&&n.record.lockInfo.lockUser===$App.connection.userLogin(),n.updateLockButton()},setEntityLocked:function e(){var t=this,n,i,r,o,a=t.getInstanceID(),s=t.entityName;return!t.isEntityLockable||t.lockingProcessStarted?Promise.resolve(!0):(t.lockingProcessStarted=!0,t.hasPersistLock?Promise.resolve(!1):("ID"!==t.domainEntity.mixins.softLock.lockIdentifier&&(o=t.domainEntity.mixins.softLock.lockIdentifier.split("."),o.length>0&&(o=o[0]),s=t.domainEntity.attr(o).associatedEntity,a=t.record.get(o)),$App.connection.run({method:"isLocked",entity:s,ID:a}).then(function(e){return t.onGetLockInfo(e),!t.hasPersistLock&&(t.isNewInstance?(i={},t.initValue&&Ext.applyIf(i,t.initValue),t.parentContext&&Ext.applyIf(i,t.parentContext),n={method:"addnew",entity:t.entityName,execParams:i,fieldList:t.fieldList,lockType:"ltTemp"},r=$App.connection.addNew(n)):(n={entity:t.entityName,fieldList:["ID","mi_modifyDate"],lockType:"ltTemp",ID:t.instanceID},t.formRequestConfig("select",n),r=$App.connection.select(n)),r.catch(function(e){throw t.entityLocked=!1,e}).then(function(e){if(!e.resultLock.success)throw t.entityLocked=!1,new UB.UBError(UB.format(UB.i18n("doNotGetLock"),e.resultLock.lockUser,Math.floor((new Date-e.resultLock.lockTime)/1e3)));return t.isNewInstance||t.record.get("mi_modifyDate").getTime()===e.resultData.data[0][e.resultData.fields.indexOf("mi_modifyDate")].getTime()?(t.lockCtx=UB.ux.LockManager.addLock({lockIdentifier:e.resultLock.lockID,entity:t.entityName,instance:e.resultLock.lockValue?e.resultLock.lockValue:t.record,onLockLoss:function e(){t.lockCtx&&UB.ux.LockManager.deleteLock(t.lockCtx),t.removeEntityLock(),t.lockCtx=null,t.updateLockButton()},scope:t}),t.entityLocked||(t.record.resultLock=e.resultLock,t.entityLocked=!0),t.updateLockButton(),t.updateActions("entityRequiredLock",!1),!0):(t.entityLocked=!0,t.deleteLock(!0).then(function(e){throw new UB.UBError("changedByAnotherUserForLock")}))}).fin(function(){t.lockingProcessStarted=!1}))})))},updateLockButton:function e(){var t=this,n,i;if(!t.isDestroyed){if(!t.entityLocked&&!t.hasPersistLock&&!t.record.lockInfo)return void(t.lockButton&&t.lockButton.isVisible()&&t.lockButton.setVisible(!1));t.lockButton||(i=t.getHeader(),i||(n=t.getFormWin())&&(i=n.getHeader()),t.headerPanel&&(i=t.headerPanel),i&&(t.lockButton=i.insert(1,{xtype:"label",style:{fontWeight:"bold"},text:UB.i18n("entityLockedOwn")}))),t.lockButton.removeCls("ub-persistlockinfo"),t.hasPersistLock?(t.lockButton.addCls("ub-persistlockinfo"),t.lockButton.setText(UB.format(UB.i18n("persistLockInfo"),t.record.lockInfo.lockUser,Ext.Date.format(new Date(t.record.lockInfo.lockTime),"d.m.Y H:i:s"))),t.lockButton.show()):t.entityLocked?(t.lockButton.setText(UB.i18n("entityLockedOwn")),t.lockButton.show()):t.record.lockInfo&&t.record.lockInfo.lockExists&&"Temp"===t.record.lockInfo.lockType?UB.ux.LockManager.existLock(t.entityName,t.record.lockInfo.lockValue)||(t.lockButton.setText(UB.format(UB.i18n("tempSoftLockInfo"),t.record.lockInfo.lockUser,Ext.Date.format(new Date(t.record.lockInfo.lockTime),"d.m.Y H:i:s"))),t.lockButton.show()):t.record.lockInfo&&t.record.lockInfo.lockExists&&"Persist"===t.record.lockInfo.lockType?(t.lockButton.setText(UB.format(UB.i18n("softLockInfo"),t.record.lockInfo.lockUser,Ext.Date.format(new Date(t.record.lockInfo.lockTime),"d.m.Y H:i:s"))),t.lockButton.show()):t.lockButton.isVisible()&&t.lockButton.hide(),t.hasPersistLock?(t.actions.unLock.show(),t.actions.lock.hide()):(t.actions.unLock.hide(),t.entityLocked||t.actions.lock.show())}},removeEntityLock:function e(){var t=this;t.isEntityLockable&&(t.entityLocked=!1,t.updateLockButton(),t.updateActions("entityRequiredLock",!0))},clearLockCtx:function e(){var t=this;t.isEntityLockable&&t.entityLocked&&t.lockCtx&&(t.entityLocked=!1,UB.ux.LockManager.deleteLock(t.lockCtx),t.lockCtx=null)},deleteLock:function e(t){var n=!1,i=this,r=Promise.resolve(i.isEntityLockable&&i.entityLocked),o,a=i.getInstanceID(),s=i.entityName;return i.hasPersistLock||i.startDeleteLock||!i.isEntityLockable||!i.entityLocked?Promise.resolve(!1):("ID"!==i.domainEntity.mixins.softLock.lockIdentifier&&(o=i.domainEntity.mixins.softLock.lockIdentifier.split("."),o.length>0&&(o=o[0]),s=i.domainEntity.attr(o).associatedEntity,a=i.record.get(o)),i.startDeleteLock=!0,$App.connection.run({method:"isLocked",entity:s,ID:a}).then(function(e){return i.onGetLockInfo(e),!i.hasPersistLock&&(i.isEntityLockable&&i.entityLocked&&(i.lockCtx&&(i.entityLocked=!0,n=UB.ux.LockManager.deleteLock(i.lockCtx),i.lockCtx=null),i.entityLocked&&(n||t)&&(r=r.then(function(){return $App.connection.run({entity:s,method:"unlock",ID:a}).then(function(e){return i.record.lockInfo=e&&e.resultLock&&e.resultLock.lockInfo?e.resultLock.lockInfo:{},!(!e||!e.resultLock)&&e.resultLock.success})}))),delete i.startDeleteLock,r.then(function(e){return i.removeEntityLock(),e}))}))},setTitle:function e(t,n){var i=this,r=i.getFormWin(),o=i.placeholder;i._formFullTitle=n,i._formTitle=t,r?r.setTitle(n||t):(i.headerPanel&&(i.headerPanel.setTitle(n||t),o&&o.setTooltip&&o.setTooltip(t)),i.callParent(arguments))},getFormTitle:function e(){var t=this,n=t.getFormWin(),i=t.placeholder;return t._formFullTitle||t._formTitle||t.title||(n?n.title:null)||(i?i.title:null)},addNewVersionToTitle:function e(){var t=this;t.on("afterrender",function(){t.setTitle(t._formTitle,UB.format("{0} ({1} {2})",t._formFullTitle||t._formTitle,UB.i18n("novajaVersija"),Ext.Date.format(t.__mip_ondate,"d.m.Y")))},t,{single:!0})},enableEdit:function e(){for(var t=this,n=t.fields,i=n.length,r=0;r<i;++r)n[r].setReadOnly&&Ext.isDefined(n[r].initialReadOnly)&&!n[r].initialReadOnly&&n[r].setReadOnly(!1)},disableEdit:function e(){for(var t=this,n=t.fields,i=n.length,r=0;r<i;++r)n[r].setReadOnly&&n[r].setReadOnly(!0)},getCanEdit:function e(){var t=this;return Ext.isDefined(t.isEditable)?t.isEditable():!Ext.isDefined(t.canEdit)||t.canEdit},setupParentContainer:function e(){var t=this;t.isDetail&&(t.target.ownerCt.mainEntityGridPanel.on("parentchange",t.onParentChange,t),t.mainEntityGridPanel=t.target.ownerCt.mainEntityGridPanel,t.on("close",function(){var e=t.up("tabpanel");e&&e.isMainTabPanel||(e&&1===e.items.getCount()&&(e.relatedSplitter.hide(),e.hide(),e.ownerCt.doLayout()),e.mainPanel.mainEntityGridPanel.onDetailClose(t.entityName))},t))},onParentChange:function e(t){var n=this,i;i=function e(){n.oldParentID!==n.newParentID&&(n.refreshInProgress=!0,n.setInstanceID(n.newParentID),n.loadInstance())},n.reloadTimeoutID&&(clearTimeout(n.reloadTimeoutID),n.reloadTimeoutID=null),n.newParentID=t,n.oldParentID=n.instanceID,n.isNewInstance=!1,n.reloadTimeoutID=setTimeout(i,700)},initFields:function e(){var t=this,n=Ext.ComponentQuery.query(":focusable",t),r=t.fields,o=r.length,a=t.getCanEdit(),s=null,l,u,c;for(u=r[0],u&&u.isMasterLink&&(t.masterForm=t.getMasterForm(u),t.masterForm&&(a=Ext.isDefined(t.isEditable)?t.isEditable():t.masterForm.getCanEdit())),t.canEdit=a,l=0;l<o;++l)u=r[l],u.initialReadOnly=u.readOnly,a||u.setReadOnly&&u.setReadOnly(!0),t.canFocus(u=r[l])&&-1!==n.indexOf(u)&&!Ext.isDefined(u.checked)&&(u.addListener("keydown",t.preventDefaultKeys,t),u.enableKeyEvents=!0),s||(s=u),u.minVal&&(u.minValue=i.isFunction(u.minVal)?u.minVal(t,u):u.minVal),u.maxVal&&(u.maxValue=i.isFunction(u.maxVal)?u.maxVal(t,u):u.maxVal),!t.isEditMode&&a&&Ext.isDefined(u.defaultValue)&&(c=u.defaultValue,t.setFieldValue(u,i.isFunction(c)?c(t,u):c));t.firstControl=s,u=t.down("tabpanel"),u&&u.addListener("tabchange",t.onTabChange,t),s&&document.activeElement!==s.getEl()&&t.focusControl(s),t.instanceID&&(UB.view.activeForm||(UB.view.activeForm=[]),UB.view.activeForm[t.instanceID]=t),t.setupParentContainer()},getMasterForm:function e(t){return UB.view.activeForm?UB.view.activeForm[this.record.get(t.attributeName)]:null},getEntityGridPanel:function e(t){return t instanceof UB.view.EntityGridPanel?t:t.down("entitygridpanel")},setFieldValue:function e(t,n){Ext.isArray(t.fieldList)?t.setValueById(n):(t.setValue(n),this.isEditMode&&t.resetOriginalValue())},makeGridReadonly:function e(t,n){var i,r;return!!(i=this.getEntityGridPanel(t))&&(r=i.actions[UB.view.EntityGridPanel.actionId.addNew],r.setDisabled(n),r=i.actions[UB.view.EntityGridPanel.actionId.addNewByCurrent],r.setDisabled(n),r=i.actions[UB.view.EntityGridPanel.actionId.del],r.setDisabled(n),!0)},makeGridEditable:function e(t,n){var i,r;return!!(i=this.getEntityGridPanel(t))&&(r=i.actions[UB.view.EntityGridPanel.actionId.edit],r.setDisabled(!n),n||i.suspendEvent("itemdblclick"),!0)},getGrids:function e(){var t=this,n,i,r,o;if(r=t.query("ubdetailgrid")||[],i=t.query("tabpanel"))for(o=0,n=i.length;o<n;++o)r.concat(i[o].query("ubdetailgrid"));return r},onControlFocused:function e(t){var n=this;t.enableKeyEvents||(t.addListener("keydown",n.preventDefaultKeys,n),t.enableKeyEvents=!0)},canFocus:function e(t){var n="gridview"===t.xtype;return n=n||t&&(!t.readOnly||!this.canEdit)&&("x-field"===t.componentCls||t.isFocusableField)&&t.container&&!t.ownerCt.gridOwner,!n||t.myFocusHandlerActive||Ext.isDefined(t.checked)||t.ownerCt.gridOwner||(t.addListener("focus",this.onControlFocused,this),t.myFocusHandlerActive=!0),n},focusFirst:function e(t){var n=this,i,r,o,a,s=-1;if(!t)return!1;for(i=Ext.isArray(t)?t:Ext.ComponentQuery.query(":focusable",t),r=i.length;++s<r;)if(n.canFocus(i[s]))return n.focusControl(i[s]),i[s];return r>0&&(o=i[0].up("tabpanel"))&&(a=o.getActiveTab().down("gridview"))?(n.focusControl(a,500),a):null},activateNextTab:function e(t,n){var i=t.getActiveTab(),r=t.items.items,o=r.indexOf(i)+(n?-1:1);return o===r.length?o=0:-1===o&&(o=r.length-1),t.setActiveTab(o),r[o]},onTabChange:function e(t,n){this.focusFirst(n)},collapseControl:function e(t){t&&i.isFunction(t.collapse)&&t.collapse()},frameControl:function e(t){t&&t.el&&t.el.frame("#668AB8",1,{duration:500})},preventDefaultKeys:function e(t,n){var r=this,o=n.shiftKey,a=null,s=null,l,u,c=n.getKey(),d=0,f,h;switch(c){case Ext.EventObject.TAB:n.stopEvent(),u=Ext.ComponentQuery.query(":focusable",this),f=u.length;do{this.canFocus(l=u[d])&&(a||(a=l),s=l)}while(++d<f);if(t===(o?a:s)){if(t.ownerCt.gridOwner&&(l=t.ownerCt.gridOwner.down("gridview"))){r.focusControl(l,500);break}r.focusControl(o?s:a)}else for(d=u.indexOf(t)+(h=o?-1:1);d>=0&&d<f;){if(this.canFocus(l=u[d])){this.focusControl(l);break}d+=h}break;case Ext.EventObject.DELETE:t.readOnly&&n.stopEvent();break;case Ext.EventObject.BACKSPACE:if(t.readOnly){n.stopEvent();break}n.ctrlKey&&(n.stopEvent(),i.isFunction(t.clearValue)?t.clearValue():t.setValue(""));break;case Ext.EventObject.F5:n.stopEvent();break;case Ext.EventObject.X:n.altKey&&(n.stopEvent(),r.closeWindow(!0));break;case Ext.EventObject.Q:n.ctrlKey&&(n.stopEvent(),r.switchTabs(t,n.shiftKey))}},switchTabs:function e(t,n){var i,r=this;if(i=t.up("tabpanel"),!n||!i)if(i)r.activateNextTab(i,!1);else{if(!(i=r.down("tabpanel")))return;i.getActiveTab()}},focusControl:function e(t,n){var r,o=!1,a;if(t&&this.canFocus(t)&&i.isFunction(t.focus)&&(r=t.getFocusEl(),o=r&&r.dom&&r.dom.select,n?setTimeout(function(){t.focus(o,!1)},n):t.focus(!0,!0),"gridview"===t.xtype)){t.focus(o,!1);var s=t.up("entitygridpanel");if(s){var l=s.getSelectionModel();a=s.getStore(),l&&l.getSelection().length<1&&a&&a.getCount()&&!a.isDestroyed&&l.select(0,!0)}}},setActionDisabled:function e(t,n){var i=this,r=this.actions[t],o;i.actionsKeyMap&&(o=i.actionsKeyMap[t]),r&&r.setDisabled(n),o&&o.setDisabled(n)},updateActions:function e(t,n){function i(e,t){switch(e){case"aSave":u&&u.setDisabled(t);break;case"aSaveAndClose":c&&c.setDisabled(t);break;case"aDelete":d&&d.setDisabled(t);break;case"aRefresh":f&&f.setDisabled(t)}}var r=this,o=this.actions[UB.view.BasePanel.actionId.save],a=this.actions[UB.view.BasePanel.actionId.saveAndClose],s=this.actions[UB.view.BasePanel.actionId.fDelete],l=this.actions[UB.view.BasePanel.actionId.refresh],u,c,d,f;switch(r.actionsKeyMap&&(u=r.actionsKeyMap[UB.view.BasePanel.actionId.save],c=r.actionsKeyMap[UB.view.BasePanel.actionId.saveAndClose],d=r.actionsKeyMap[UB.view.BasePanel.actionId.fDelete],f=r.actionsKeyMap[UB.view.BasePanel.actionId.refresh]),t||(t="onDirtychange",n=!r.isFormDirty()),t){case"onDirtychange":o&&!o.initialConfig.blocked&&(o.setDisabled(n),i("aSave",n)),a&&!a.initialConfig.blocked&&(a.setDisabled(n),i("aSaveAndClose",n));break;case"init":r.isEditMode?(l.initialConfig.blocked||(l.setDisabled(!1),i("aRefresh",!1)),s.initialConfig.blocked||(s.setDisabled(!1),i("aDelete",!1))):(l.setDisabled(!0),s.setDisabled(!0),o.setDisabled(!0),a.setDisabled(!0),i("aRefresh",!0),i("aDelete",!0),i("aSave",!0),i("aSaveAndClose",!0));break;case"entityRequiredLock":o.setDisabled(n),a.setDisabled(n),i("aSave",n),i("aSaveAndClose",n);break;case"onSave":l.show(),l.setDisabled(!1),i("aRefresh",!1),s.initialConfig.blocked||(s.setDisabled(!1),i("aDelete",!1)),o.initialConfig.blocked||(o.setDisabled(!1),i("aSave",!1)),a.initialConfig.blocked||(a.setDisabled(!1),i("aSaveAndClose",!1))}},getDetails:function e(t){var n=[],i;t=t||this.items;for(var r=0,o=t.length;r<o;++r)i=t.items[r],i instanceof UB.ux.UBDetailGrid||i.isDetail?n.push(i):(i.isContainer||i.isPanel)&&(n=n.concat(this.getDetails(i.items)));return n},setDetails:function e(t,n){var i=this.details,r,o;if(t)for(r=0,o=i.length;r<o;++r)n?i[r].onRefreshDetail(t,this.entityName):i[r].setValue(t,this.entityName)},getLoadMask:function e(){return this.lm=this.lm||new Ext.LoadMask(this.getEl()),this.lm},onAfterRender:function e(t,n){var i,r=this;r.formDataReady||r.maskForm(),i=r.getFormWin(),i&&r.mon(i,"beforeclose",r.beforeClose,r),r.on({beforeclose:r.beforeClose,scope:r})},startLoadFormData:function e(){var t=this;if(t.entityName)t.__mip_ondate&&t.addNewVersionToTitle(),t.isEditMode||t.addByCurrent?t.initEditOrByCurrentFormData():t.initEmptyFormData();else{Ext.suspendLayouts();try{Ext.callback(t.initUBComponent,t)}finally{Ext.resumeLayouts(!0)}}},initEmptyFormData:function e(){var t=this,n,i;t.addCreatingToTitle(),n={entity:t.entityName,alsNeed:t.hasEntityALS,fieldList:t.fieldList},t.parentContext&&(i=t.parentContext),t.initValue&&(i=i||{},Ext.applyIf(i,t.initValue)),Ext.Object.getSize(i)&&(n.execParams=i),$App.connection.addNew(n).then(function(e){t.initFormData(e)}).catch(function(e){t.unmaskForm(),UB.showErrorWindow(e),t.closeWindow(!0)})},formRequestConfig:function e(t,n){var i=this;return i.selectMethod&&"select"===t&&(n.method=i.selectMethod),i.insertMethod&&"insert"===n.method&&"save"===t&&(n.method=i.insertMethod),i.updateMethod&&"update"===n.method&&"save"===t&&(n.method=i.updateMethod),i.deleteMethod&&"delete"===t&&(n.method=i.deleteMethod),n},initEditOrByCurrentFormData:function e(){var t=this,n=[];n.push($App.connection.select(t.formRequestConfig("select",{entity:t.entityName,fieldList:t.fieldList,ID:t.instanceID,alsNeed:t.hasEntityALS}))),t.isEntityLockable&&n.push($App.connection.query({method:"isLocked",entity:t.entityName,ID:t.getInstanceID()})),Promise.all(n).done(function(e){var n=e[0],i=e[1];t.isDestroyed||(n&&n.resultData.data.length?(t.addByCurrent?(t.addCreatingToTitle(),$App.connection.addNew({entity:t.entityName,fieldList:t.fieldList,alsNeed:t.hasEntityALS,execParams:UB.core.UBCommand.resultDataRow2Object(n,0,t.getFieldListWithoutAdtDocument(t.fieldList))}).done(t.initFormData.bind(t))):(t.disableBinder(),UB.ux.data.UBStore.resultDataRow2Record(n,t.record),t.record.resultData=n.resultData,t.record.resultAls=n.resultAls,UB.ux.data.UBStore.resetRecord(t.record),t.isEntityLockable&&i&&i.lockInfo&&t.onGetLockInfo(i),t.enableBinder(),t.isNewInstance=!1,t.initFormData()),t.fireEvent("recordloaded",t.record,n)):(t.closeWindow(!0),$App.dialogError("recordNotExistsOrDontHaveRights")))})},initFormData:function e(t){function n(){o&&r.record&&(r.record.resultAls=o),Ext.suspendLayouts();try{r.addInitialFieldValues(),r.setFields(r.record),r.setDetails(r.record),r.initFields(),r.updateActions()}finally{Ext.resumeLayouts(!0)}}var r=this,o=void 0;if(!r.isDestroyed){if(t){if(o=t.resultAls,r.isNewInstance=t.method===UB.core.UBCommand.methodName.ADDNEW,r.disableBinder(),UB.ux.data.UBStore.resultDataRow2Record(t,r.record),r.instanceID=r.record.get("ID")||r.instanceID,t.method===UB.core.UBCommand.methodName.ADDNEW){i.filter($App.domainInfo.entities[t.entity].attributes,{dataType:"Date"}).forEach(function(e){if(r.record.get(e.name)&&i.isDate(r.record.get(e.name))){var t=r.record.get(e.name);t.setMinutes(t.getMinutes()-t.getTimezoneOffset()),r.record.set(e.name,t)}})}r.isNewInstance||UB.ux.data.UBStore.resetRecord(r.record),r.enableBinder(),r.fireEvent("recordloaded",r.record,t)}r.record&&r.isEntityLockable&&r.isNewInstance&&"ID"!==r.domainEntity.mixins.softLock.lockIdentifier?r.setEntityLocked().done(function e(){n()},function e(t){throw r.closeForce=!0,r.closeWindow(!0),t}):n()}},bindHotKeys:function e(){var t=this,n=t.getFormWin(),r=UB.view.BasePanel.actionId,o=UB.view.BasePanel.hotKeys,a=n?n.getEl():t.getEl();t.actionsKeyMap={},a&&(t.actionsKeyMap[r.saveAndClose]=new Ext.util.KeyMap({target:a,binding:[{key:o[r.saveAndClose].key,ctrl:o[r.saveAndClose].ctrl,shift:o[r.saveAndClose].shift,fn:function e(){t.onAction(t.actions[UB.view.BasePanel.actionId.saveAndClose].initialConfig)}}]}),t.actionsKeyMap[r.save]=new Ext.util.KeyMap({target:t.getEl(),binding:[{key:o[r.save].key,ctrl:o[r.save].ctrl,shift:o[r.save].shift,fn:function e(n,i){i.stopEvent(),t.onAction(t.actions[UB.view.BasePanel.actionId.save].initialConfig)}}]}),t.actionsKeyMap[r.refresh]=new Ext.util.KeyMap({target:t.getEl(),binding:[{key:o[r.refresh].key,ctrl:o[r.refresh].ctrl,shift:o[r.refresh].shift,fn:function e(n,i){i.stopEvent(),t.onRefresh()}}]}),t.actionsKeyMap[r.fDelete]=new Ext.util.KeyMap({target:t.getEl(),binding:[{key:o[r.fDelete].key,ctrl:o[r.fDelete].ctrl,shift:o[r.fDelete].shift,fn:function e(n,i){i.stopEvent(),t.onAction(t.actions[UB.view.BasePanel.actionId.fDelete].initialConfig)}}]}),t.hideActions&&t.hideActions.length&&i.forEach(t.hideActions,function(e){var n=t.actionsKeyMap[e];n&&n.disable()}),t.updateActions("init"))},addCreatingToTitle:function e(){var t=this;t.on("afterrender",function(){t.setTitle(t.getFormTitle()+UB.format(" ({0})",UB.i18n("dobavlenie")))},t,{single:!0})},addInitialFieldValues:function e(){var t=this;t.initialFieldValues&&t.isNewInstance&&Ext.Object.each(t.initialFieldValues,function(e,n){t.record.fields.containsKey(e)&&t.record.set(e,n)},t)},getUBCmp:function e(t){return this.ubNameMap[t]},getField:function e(t){return this.ubAttributeMap[t]||this.binder.getFields()[t]},initUBControlMap:function e(){var t=this,n=UB.view.BasePanel.defaultUBName,r;r=t.getForm().getFields().items,t.ubNameMap={},t.ubAttributeMap={},t.fields=[],i.forEach(r,function(e){var i=e[n];e.attributeName&&(t.ubAttributeMap[e.attributeName]=e),i&&!e.oneWayBinding&&(t.ubNameMap[i]=e,t.fields.push(e))}),i.each(t.documents,function(e,n){var i=t.ubNameMap[t.attrName(n)];i&&(i.isUBDocumentCtrl=!0)})},getUBCmps:function e(){return this.fields},addDocumentAttrForComplexUBDocumentAttr:function e(t,n,i,r){if(t[r].attributeName.split(".").length>1){for(var o=t[r].attributeName.substring(0,t[r].attributeName.lastIndexOf(".")),a=!1,s=0;s<i;++s)if(t[s].attributeName===o){a=!0;break}a||n.push(o)}},setFields:function e(t){var n=this,i,r=n.fields;if(t){n.binder.record&&n.binder.record===t||n.binder.setRecord(t),n.isEntityLockable&&n.updateActions("entityRequiredLock",!0),n.formDataReady=!1,Ext.suspendLayouts();try{n.disableBinder(),n.binder.bind(!0),n.enableBinder();for(var o=0,a=r.length;o<a;++o){if(i=r[o],"ubdocument"===i.xtype)for(var s=0;s<this.docActions.length;s++)if(this.docActions[s].initialConfig.key===i.attributeName){i.action=this.docActions[s];break}n.updateAls(i,i.attributeName)}n.fireEvent("updateFields",t)}finally{Ext.resumeLayouts(!0)}}},updateAls:function e(t,n){var i=this,r,o,a,s;o=i.record.resultAls?i.record.resultAls[n]||"":"SUM",a=-1===o.indexOf("U"),s=i.domainEntity.attr(n),a&&!t.readOnly&&t.setReadOnly?(t.setReadOnly(!0),t.wasLockedByMixin=!0):!a&&t.readOnly&&t.setReadOnly&&t.wasLockedByMixin&&(t.setReadOnly(!1),t.wasLockedByMixin=!1),(i.isNewInstance&&!i.entityMethods.insert||!i.isNewInstance&&!i.entityMethods.update)&&t.setReadOnly(!0),r=t.allowBlank,i.record.resultAls&&o&&(r=-1===o.indexOf("M")),(r=r&&s.allowNull&&!t.isRequired)!==t.allowBlank&&t.setAllowBlank(r)},getFieldValues:function e(t,n,i){for(var r={},o=UBDomain.ubDataTypes.Document,a=0,s=n.length;a<s;++a)i&&this.domainEntity.attr(n[a]).dataType===o||(r[n[a]]=t.get(n[a]));return r},getFieldListWithoutAdtDocument:function e(t){for(var n=[],i=UBDomain.ubDataTypes.Document,r=0,o=t.length;r<o;++r)this.domainEntity.attr(t[r]).dataType!==i&&n.push(t[r]);return n},addBaseActions:function e(){var t=this,n=UB.view.BasePanel.actionId,i=UB.view.BasePanel.hotKeys,r=UB.view.BasePanel.eventId,o=UB.core.UBCommand.methodName,a,s=new Ext.Action({actionId:n.saveAndClose,scale:"medium",glyph:UB.core.UBUtil.glyphs.faShareSquare,text:UB.i18n("saveAndClose")+i[n.saveAndClose].text,eventId:r.save,cls:"save-and-close-action",handler:t.onAction,blocked:!t.domainEntity.haveAccessToAnyMethods([o.INSERT,o.UPDATE]),disabled:!0,scope:t}),l=new Ext.Action({actionId:n.save,scale:"medium",glyph:UB.core.UBUtil.glyphs.faFloppy,text:UB.i18n("sohranit")+i[n.save].text,cls:"save-action",eventId:r.save,handler:t.onAction,blocked:!t.domainEntity.haveAccessToAnyMethods([o.INSERT,o.UPDATE]),disabled:!0,scope:t});if(t.switchSaveButtonsAction?(t.actions[n.save]=s,t.actions[n.saveAndClose]=l):(t.actions[n.save]=l,t.actions[n.saveAndClose]=s),t.hasDataHistoryMixin&&(t.actions[n.history]=new Ext.Action({actionId:n.history,iconCls:"iconHistory",text:UB.i18n("istorijaIzmenenij"),eventId:r.history,handler:t.onAction,scope:t})),t.hasAuditMixin&&(t.actions[n.audit]=new Ext.Action({actionId:n.audit,iconCls:"iconAudit",text:UB.i18n("showAudit"),eventId:r.audit,handler:t.onAction,disabled:!$App.domainInfo.isEntityMethodsAccessible("uba_auditTrail","select"),scope:t})),t.hasHardSecurityMixin){var u=t.entityName+"_acl",c=t.domainEntity;c.mixins&&c.mixins.aclRls&&c.mixins.aclRls.useUnityName&&(u=c.mixins.unity.entity+"_acl"),t.actions[n.accessRight]=new Ext.Action({actionId:n.accessRight,text:UB.i18n("accessRight"),eventId:r.accessRight,handler:t.onAction,disabled:!$App.domainInfo.isEntityMethodsAccessible(u,"select"),scope:t})}t.actions[n.refresh]=new Ext.Action({actionId:n.refresh,scale:"medium",glyph:UB.core.UBUtil.glyphs.faRefresh,text:UB.i18n("obnovit")+i[n.refresh].text,cls:"refresh-action",eventId:r.refresh,handler:t.onAction,scope:t}),t.actions[n.lock]=new Ext.Action({actionId:n.lock,scale:"medium",glyph:UB.core.UBUtil.glyphs.faLock,text:UB.i18n("lockBtn"),hidden:!t.isEntityLockable||t.isNewInstance,eventId:r.lock,handler:t.onAction,scope:t}),t.actions[n.unLock]=new Ext.Action({actionId:n.unLock,scale:"medium",glyph:UB.core.UBUtil.glyphs.faUnLock,hidden:!t.isEntityLockable||t.isNewInstance,text:UB.i18n("unLockBtn"),eventId:r.unLock,handler:t.onAction,scope:t}),t.actions[n.fDelete]=new Ext.Action({actionId:n.fDelete,scale:"medium",glyph:UB.core.UBUtil.glyphs.faTrashO,text:UB.i18n("Delete")+i[n.fDelete].text,cls:"delete-action",eventId:r.fDelete,handler:t.onAction,blocked:a=!t.domainEntity.haveAccessToMethod(o.DELETE),disabled:a||t.isNewInstance,scope:t}),$App.domainInfo.isEntityMethodsAccessible("ubm_form",o.UPDATE)&&(t.actions[n.formConstructor]=new Ext.Action({actionId:n.formConstructor,scale:"medium",glyph:UB.core.UBUtil.glyphs.faWrench,text:UB.i18n("formConstructor"),eventId:r.formConstructor,handler:t.onAction,scope:t})),t.createDocActions()},onFileDragDrop:function e(t,n){var i=this,r=i.getField(t),o,a=i.getInstanceID(),s,l=!1,u=!1,c=0,d;if(n.preventDefault(),1!==n.dataTransfer.files.length)return void $App.dialogError("dropZoneOneFileRequired");o=n.dataTransfer.files[0],r.fireEvent("change"),s=Ext.MessageBox.progress(UB.i18n("loadingData"),"");var f=function e(t){t.loaded<t.total?l?s.updateProgress(t.loaded/t.total,UB.i18n("loadingData")):l=t.loaded/t.total<.3:u||(u=!0,s.updateProgress(0,UB.i18n("Transformation")),d=setInterval(function(){c=c>=1?0:c+.1,s.updateProgress(c,UB.i18n("Transformation"))},1e3))};$App.connection.post("setDocument",o,{params:{entity:i.entityName,attribute:t,id:a,origName:o.name,filename:o.name},headers:{"Content-Type":"application/octet-stream"},onProgress:f}).fin(function(){clearInterval(d),s.close()}).done(function(e){r.setValue(e.data.result,a),$App.dialogInfo("dropZoneOperationComplete")})},onFileDragDropConfigure:function e(t){var n=this;n.isVisible()&&i.forEach(n.documents,function(e,i){var r=n.getField(i),o;!r||r.isDisabled()||r.readOnly||(o=r.getValue(),t.push({message:UB.i18n(o?"dropZoneReplace":"dropZoneAdd")+" "+e.caption,dropHandler:n.onFileDragDrop.bind(n,i)}))})},createDocActions:function e(){var t=this,n=UB.view.BasePanel.actionId,i=UB.view.BasePanel.eventId,r=[];t.docActions=r,0!==t.documentsCount&&(UB.view.UBDropZone&&UB.view.UBDropZone.on("configureDropZone",t.onFileDragDropConfigure,t),Ext.Object.each(t.documents,function(e,o){r.push(new Ext.Action({text:o.caption,iconCls:"iconDocument",key:e,menu:[{actionId:n.scan+"_"+e,iconCls:"iconScanner",text:UB.i18n("skanirovat"),eventId:i.scan,handler:t.onAction,attribute:e,scope:t},{actionId:n.attach+"_"+e,iconCls:"iconAttach",text:UB.i18n("izFayla"),eventId:i.attach,handler:t.onAction,attribute:e,scope:t},{actionId:n.deleteAttachment+"_"+e,iconCls:"iconClear",text:UB.i18n("ochistit"),eventId:i.deleteattachment,handler:t.onAction,attribute:e,scope:t},{xtype:"menucheckitem",actionId:n.showOriginal+"_"+e,eventId:i.showOriginal,iconCls:"icon-list",text:UB.i18n("original"),handler:t.onAction,attribute:e,scope:t},{actionId:n.showVersions+"_"+e,iconCls:"iconVersions",text:UB.i18n("showDocVersions"),eventId:i.showVersions,handler:t.onAction,attribute:e,scope:t},{actionId:n.downloadAttach+"_"+e,scale:"medium",glyph:UB.core.UBUtil.glyphs.faDownload,text:UB.i18n("downloadAttach"),eventId:i.downloadAttach,handler:t.onAction,attribute:e,scope:t}]}))}))},addBaseDockedItems:function e(){var t=this,n=UB.view.BasePanel.actionId,i=[t.actions[n.refresh],t.actions[n.save],t.actions[n.saveAndClose],t.actions[n.fDelete],"-",t.createMenuItemLink()],r=[t.createButtonWOText(t.actions[n.refresh]),t.createButtonWOText(t.actions[n.saveAndClose]),t.createButtonWOText(t.actions[n.save]),t.createButtonWOText(t.actions[n.fDelete]),"->",{menuId:"AllActions",scale:"medium",glyph:UB.core.UBUtil.glyphs.faCog,arrowCls:"",tooltip:UB.i18n("vseDeystviya"),menu:i}];t.actions[n.formConstructor]&&i.splice(3,0,t.actions[n.formConstructor]),t.hasDataHistoryMixin&&(i.push("-"),i.push(t.actions[n.history])),t.hasAuditMixin&&(i.push("-"),i.push(t.actions[n.audit])),t.hasHardSecurityMixin&&(i.push("-"),i.push(t.actions[n.accessRight])),t.isEntityLockable&&(i.push("-"),i.push(t.actions[n.lock]),i.push(t.actions[n.unLock])),t.documentsCount>0&&(i.push("-"),Ext.Array.insert(i,i.length,t.docActions),Ext.Array.insert(r,2,["-"].concat(t.docActions))),t.dockedItems=[{xtype:"toolbar",dock:"top",items:r,ubID:"mainToolbar",enableOverflow:!0}]},getFieldList:function e(){var t=this,n=[],r,o;if(o=t.baseFieldList.map(function(e){return"string"==typeof e?e:e.attributeName}),o=i.uniq(o),n=UB.ux.data.UBStore.normalizeFieldList(this.entityName,o||[]),t.parentContext&&i.forEach(t.parentContext,function(e,t){n.indexOf(t)<0&&n.push(t)}),r=t.dfm&&t.dfm.requiredFields?t.dfm.requiredFields:t.requiredFields,r&&i.forEach(r,function(e){n.indexOf(e)<0&&n.push(e)}),t.isEntityLockable&&"ID"!==t.domainEntity.mixins.softLock.lockIdentifier){var a=t.domainEntity.mixins.softLock.lockIdentifier.split(".");a=a.length>0?a[0]:null,a&&n.indexOf(a)<0&&(n.push(a),UB.logError("Attribute",a,"implicitly added to form fieldlist (it present in softLock.lockIdentifier)"))}return n},prepareDfmItems:function e(t,n){function r(e){var t,n=!1,r=Ext.ClassManager.getNameByAlias("widget."+e);return r&&(t=Ext.ClassManager.get(r)),t&&t.prototype&&(t=t.prototype,i.forEachRight(t.xtypesChain,function(e){if("form"===e)return n=!0,!1})),n}var o=this,a=o.domainEntity,s=UB.core.UBCommand,l,u=!1;if(Ext.isArray(t))for(var c=0,d=t.length;c<d;++c){if(l=t[c],n&&(u=!r(l.xtype)),Ext.isString(l.attributeName))if(a.attr(l.attributeName))o.baseFieldList.push(l.isMultilang?{isMultilang:!0,attributeName:l.attributeName}:l.attributeName),Ext.applyIf(l,Ext.applyIf(UB.core.UBUtil.attribute2cmpConfig(a,l),{ubName:s.getUBCmpUBName(l.attributeName)}));else if(a.attr(l.attributeName)){o.baseFieldList.push(l.isMultilang?{isMultilang:!0,attributeName:l.attributeName}:l.attributeName);var f=UB.core.UBUtil.attribute2cmpConfig(a,l);Ext.applyIf(l,Ext.applyIf(f,{ubName:s.getUBCmpUBName(l.attributeName)}))}else Ext.apply(l,{xtype:"label",text:"!"+l.attributeName,style:{color:"white",backgroundColor:"red"}});Ext.isArray(l.items)?this.prepareDfmItems(l.items,u):Ext.isObject(l.items)&&this.prepareDfmItems([l.items],u)}},addItems:function e(){var t=this;t.items=t.items||[],t.dfm&&(Ext.isString(t.dfm)?t.dfm=Ext.decode(t.dfm):t.dfm=i.cloneDeep(t.dfm),t.baseFieldList=[],t.prepareDfmItems(t.dfm.items,!0),t.dfm&&t.dfm.items&&(t.items=t.items.concat(t.dfm.items)),i.forEach(t.items,function(e){e.oldHideMode=e.hideMode,e.oldHidden=e.hidden,e.hideMode="visibility",e.hidden=!0}))},callBase:function e(t){return this.callBase.caller.$previous.apply(this,arguments)},addBaseListeners:function e(){var t=this,n=UB.view.BasePanel.eventId;t.on("afterrender",t.onAfterRender,t),t.on("boxready",function(){this.bindHotKeys()},t),t.on(n.save,function(){t.fireEvent("manualsaving",t,arguments),t.onSave.apply(t,arguments)},t),t.on(n.refresh,t.onRefresh,t),t.on(n.fDelete,t.onDelete,t),t.on(n.history,t.onHistory,t),t.on(n.lock,t.onLock,t),t.on(n.unLock,t.onUnLock,t),t.actions.formConstructor&&t.on(n.formConstructor,t.onConstructor,t),t.instanceID&&t.entityDetails.length&&t.on(n.showdetail,t.onShowDetail,t),t.documentsCount>0&&(t.on(n.scan,t.onScan,t),t.on(n.attach,t.onAttach,t),t.on(n.deleteattachment,t.onDeleteAttachment,t),t.on(n.showOriginal,t.onShowOriginal,t),t.on(n.showVersions,t.onshowVersions,t),t.on(n.downloadAttach,t.ondownloadAttach,t)),t.hideActions&&t.hideActions.length&&i.forEach(t.hideActions,function(e){var n=t.actions[e];n||"docAction"!==e.substr(0,9)||i.forEach(t.docActions,function(t){if(t.initialConfig&&t.initialConfig.key&&e==="docAction"+t.initialConfig.key)return n=t,!1}),n&&(n.initialConfig.blocked=!0,n.disable(),n.hide())}),t.hasAuditMixin&&t.on(n.audit,t.onAudit,t),t.hasHardSecurityMixin&&t.on(n.accessRight,t.onAccessRight,t)},onConstructor:function e(){var t=this;if($App.domainInfo.get("ubm_form").haveAccessToMethod("update")){if(!t.formCode)throw new UB.UBError("isAutoGeneratedForm");UB.Repository("ubm_form").attrs(["ID","code"]).where("code","=",t.formCode).select().done(function(e){var n=t.up("window"),i=!!n&&n.modal;if(!e||e.length<1)throw new UB.UBError("formNotFound");var r={cmdType:"showForm",description:"",entity:"ubm_form",instanceID:e[0].ID,isModal:i,isModalDialog:i,sender:t};r.isModal||(r.target=UB.core.UBApp.getViewport().getCenterPanel(),r.tabId="ubm_form"+e[0].ID),$App.doCommand(r)})}},onShowOriginal:function e(t){var n=this.getField(t.attribute);t&&t.checked?(n._forceMIME=n.forceMIME,n.setMIME(n.originalMIME)):n.setMIME(n._forceMIME||n.originalMIME)},onshowVersions:function e(t){if(!this.record.get(t.attribute))throw new UB.UBError("emptyContent");Ext.create("UB.view.DocumentVersions",{docRecord:this.record,docAttribute:t.attribute,instanceID:this.getInstanceID(),docContainerBase:this.getField(t.attribute)}).show()},ondownloadAttach:function e(t){var n=this,i,r,o;if(!(i=n.record.get(t.attribute)))throw new UB.UBError("emptyContent");i=JSON.parse(i),r={entity:n.entityName,attribute:t.attribute,ID:n.getInstanceID()},i.store&&(r.store=i.store),i.filename&&(r.filename=i.filename),i.origName&&(r.origName=i.origName),!0!==i.isDirty&&!1!==i.isDirty||(r.isDirty=i.isDirty),o=Ext.String.urlAppend($App.connection.baseURL+"getDocument",Ext.Object.toQueryString(r)),$App.connection.get(o,{responseType:"arraybuffer"}).then(function(e){var t,r=e.data;t=new Blob([r],{type:i.ct}),saveAs(t,i.origName||i.filename||n.getInstanceID()+"_"+i.ct)}).catch(function(e){if(404===e.status)throw new UB.UBError(UB.i18n("documentNotFound"))})},onDelete:function e(){var t=this,n=[],i;t.lockInterface();try{t.fireEvent("beforeDelete",n)}catch(e){throw t.unmaskForm(),e}Promise.all(n).then(function(){return $App.dialogYesNo("deletionDialogConfirmCaption",UB.format(UB.i18n("deleteFormConfirmCaption"),t.getFormTitle()))}).then(function(e){if(e)return t.maskForm(2e3),i=t.formRequestConfig("delete",{entity:t.entityName,method:"delete",execParams:{ID:t.instanceID}}),$App.connection.doDelete(i).then(function(e){if(t.store&&!t.store.isDestroyed){var n=t.store.findRecord("ID",t.instanceID);n&&t.store.remove(n)}t.store&&t.store.fireModifyEvent&&t.store.fireModifyEvent(i,e),t.isDeleted=!0,t.fireEvent("afterdelete"),Ext.callback(t.eventHandler,t,[t,"afterdelete"])}).fin(function(){t.unmaskForm()}).then(function(){t.closeWindow(!0)})}).fin(function(){t.unmaskForm()})},onRefresh:function e(){var t=this,n;n=t.isFormDirty()?$App.dialogYesNo("areYouSure","formWasChanged"):Q.resolve(!0),n.done(function(e){if(e){t.fireEvent("beforeRefresh",t);var n=t.details;n&&n.length&&n.forEach(function(e){e.rowEditing&&e.editingPlugin.editing&&e.editingPlugin.cancelEdit()}),t.deleteLock().then(function(){t.loadInstance()})}})},onLock:function e(){this.hasPersistLock||this.addPersistLock()},onUnLock:function e(){this.hasPersistLock&&this.removePersistLock()},onShowDetail:function e(t){$App.runLink({cmdData:UB.core.UBCommand.getCommandByEntityAndType(t.entityName,UB.core.UBCommand.commandType.showList),parent:t.attribute,parentid:this.getInstanceID()})},loadInstance:function e(){var t=this,n;n=[$App.connection.select(t.formRequestConfig("select",{entity:t.entityName,fieldList:t.fieldList,ID:t.instanceID,alsNeed:t.hasEntityALS}))],t.isEntityLockable&&n.push($App.connection.query({method:"isLocked",entity:t.entityName,ID:t.getInstanceID()})),t.formDataReady=!1,Promise.all(n).done(function(e){var n=e[0],i=e[1];t.disableBinder(),UB.ux.data.UBStore.resultDataRow2Record(n,t.record),t.record.resultData=n.resultData,t.record.resultAls=n.resultAls,UB.ux.data.UBStore.resetRecord(t.record),t.isEntityLockable&&i&&i.lockInfo&&t.onGetLockInfo(i),t.enableBinder(),t.setFields(t.record),t.setDetails(t.record,!0),t.fireDirty=!1,t.updateActions(),t.fireEvent("recordloaded",t.record,n)})},onSave:function e(t){var n=this;t&&t.length&&(t=t[0]);var i=t&&t.actionId===UB.view.BasePanel.actionId.saveAndClose||!1;n.lockInterface(),n.saveForm().fin(function(){n.unmaskForm()}).then(function(e){i&&e>=0&&n.closeWindow(!0)})},saveForm:function e(){var t=this,n=t.getForm(),r,o=[];return t.fireEvent("beforeSaveForm",o),o.sort(function(e,t){return e[0]-t[0]}),r=Q.resolve(!0),i.forEach(o,function(e){r=r.then(function(){return e[1]()})}),r.then(function(e){return-1===e||0===e?e:n.isValid()?n.isValid()?i.isFunction(t.onBeforeSave)?Q.resolve(t.onBeforeSave()).then(function(e){return!1!==e?t.saveInstance():Q.resolve(-1)}):t.saveInstance():Q.resolve(-1):(n.getFields().each(function(e){e.isValid()||(UB.toast({entityTitle:t.domainEntity.caption,fieldLabel:e.fieldLabel,callback:function n(){if(t){var i=t.getFormWin();i&&i.toFront(),Ext.callback(e.focus,e,[],100)}}}),e.focus())},t),Q.resolve(-1))})},attrName:function e(t){return"attr"+Ext.String.capitalize(t)},saveInstance:function e(t){var n=this,r=[],o=[],a,s;return i.forEach(n.documents,function(e,t){var i=n.getField(t);i&&i.isEditor()&&i.isContentDirty()&&!n.__mip_ondate&&r.push(i),n.__mip_ondate&&(n.record.get(t)&&o.push(t),n.record.set(t,null))}),0!==r.length||n.isFormDirty()||n.__mip_ondate||t?(n.maskForm(UB.appConfig.formSaveMaskDelay),Q.all(r.map(function(e){return e.save(!!n.__mip_ondate)})).then(function(){if(n.binder.suspendAutoBind(),n.disableBinder(),i.forEach(n.documents,function(e,t){var i=n.getField(t);if(i&&i.isDirty()){var r=i.getValue();n.record.set(t,r)}}),n.enableBinder(),n.binder.releaseAutoBind(),a=n.record.getChanges(),n.postOnlySimpleAttributes){Object.keys(a).forEach(function(e){-1!==e.indexOf(".")&&delete a[e]})}void 0===a.ID&&(a.ID=n.instanceID?n.instanceID:n.record.get("ID")),n.record.get("mi_modifyDate")&&(a.mi_modifyDate=n.record.get("mi_modifyDate"));var e=[];return n.extendedDataForSave&&(i.forEach(n.extendedDataForSave,function(t,n){var i=n.match(/(\w+)_\w\w\^/);i&&i.length>1&&e.indexOf(i[1])<0&&e.push(i[1])}),i.forEach(e,function(e){a&&a.hasOwnProperty(e)&&(a[e+"_"+$App.connection.userLang()+"^"]=a[e],delete a[e])}),i.defaults(a,n.extendedDataForSave)),s={fieldList:n.fieldList,entity:n.entityName,method:n.__mip_ondate&&!n.addByCurrent?"newversion":n.isEditMode?"update":"insert",alsNeed:n.hasEntityALS,execParams:a},s.__mip_ondate=n.__mip_ondate,s=n.formRequestConfig("save",s),n.fireEvent("beforesave",n,s),$App.connection.update(s).then(function(e){return n.deleteLock().then(function(){return n.isEntityLockable?$App.connection.query({method:"isLocked",entity:n.entityName,ID:n.getInstanceID()}).then(function(t){return[e,t]}):[e]})}).then(function(e){var t=e[0],a=e[1],l=!!n.__mip_ondate;n.store&&n.store.fireModifyEvent&&n.store.fireModifyEvent(s,e),delete n.extendedDataForSave,n.isNewInstance="addnew"===t.method,n.isEditMode=!0,delete n.__mip_ondate,n.updateActions("onSave"),n.disableBinder(),UB.ux.data.UBStore.resultDataRow2Record(t,n.record),UB.ux.data.UBStore.resetRecord(n.record),n.setInstanceID(n.record.get("ID")),n.enableBinder(),n.record.resultLock=t.resultLock,n.record.resultAls=t.resultAls,n.setFields(n.record),n.store&&!n.store.isDestroyed&&n.store.clearCache(),n.updateStoreRecord(t),n.isEntityLockable&&a&&a.lockInfo&&n.onGetLockInfo(a);var u=n.getFormWin();return u&&delete u.newInstance,n.formWasSaved=!0,n.fireEvent("aftersave",n,t),Ext.callback(n.eventHandler,n,[n,"aftersave"]),Ext.callback(n.onAfterSave,n),n.fireDirty=!1,n.updateActions(),l&&o.length>0?(r=[],i.forEach(n.documents,function(e,t){n.getField(t).instanceID=n.record.get("ID")}),i.forEach(o,function(e){var t=n.getField(e);r.push(t)}),Q.all(r.map(function(e){return e.existData()?e.save(!0):Q.resolve(null)})).then(function(){return i.forEach(n.documents,function(e,t){var i=n.getField(t);n.record.set(t,i.getValue())}),n.saveInstance()})):1}).catch(function(e){throw n.unmaskForm(),e}).fin(function(){n.isSaveProcess=!1})})):Q.resolve(0)},addExtendedDataForSave:function e(t){var n=this;t&&(n.extendedDataForSave?i.forEach(t,function(e,t){""!==e&&null!==e&&void 0!==e||""===n.extendedDataForSave[t]&&null===n.extendedDataForSave[t]&&void 0===n.extendedDataForSave[t]?n.extendedDataForSave[t]=e:delete n.extendedDataForSave[t]}):n.extendedDataForSave=t,this.updateActions("onDirtychange",0===Object.keys(n.extendedDataForSave).length))},getExtendedDataForSave:function e(){return this.extendedDataForSave||{}},updateStoreRecord:function e(){var t=this,n;this.store&&!this.store.isDestroyed&&(t.updateOrInsertStoreRecord(t.store,t.record),UB.core.UBAppConfig.systemEntities.hasOwnProperty(t.entityName)&&(n=UB.core.UBStoreManager.getSystemEntityStore(UB.core.UBAppConfig.systemEntities[t.entityName].name),t.store!==n&&t.updateOrInsertStoreRecord(n,t.record)))},updateOrInsertStoreRecord:function e(t,n){if(t&&!t.isDestroyed){var i=t.getById(n.get("ID")),r=n.fields.items,o=null===i||void 0===i,a,s,l,u,c,d;if(o)return void t.reload();for(a=i.fields,u=0,c=r.length;u<c;++u)s=r[u].name||r[u],a.get(s)&&!i.isEqual(i.get(s),l=n.get(s))&&(d=!0,i.set(s,l));t.clearCache(),d&&(i.commit(),t.fireEvent("childwasmodified"))}},onScan:function e(t){function n(){return"Scaned at "+(new Date).toLocaleString().replace(/[\/\:.]/g,"-")+"."+$App.__scanService.lastScanedFormat}var i=this,r=i.entityName,o=i.getInstanceID(),a=t.attribute,s=UB.format('{0}: "{1}"',UB.i18n("skanirovanieAtributa"),this.documents[t.attribute].caption),l=i.getField(a),u=o;l.fireEvent("change"),$App.scan(s,{},this.documents[t.attribute].documentMIME).then(function(e){var t=n();return $App.connection.post("setDocument",UB.base64toArrayBuffer(e),{params:{entity:r,attribute:a,id:u,origName:t,filename:t},headers:{"Content-Type":"application/octet-stream"}})}).then(function(e){l.setValue(e.data.result,u)})},onAttach:function e(t){var n=this,i=n.getField(t.attribute),r=!(i.isEditor&&i.isEditor()&&i.documentMIME),o=this.getInstanceID();i.fireEvent("change"),Ext.create("UB.view.UploadFileAjax",{entityName:this.entityName,instanceID:o,attribute:t.attribute,scope:this,uploadData:r,callback:function e(t){var n;r?t.success?(n=t.result,i.setValue(n,o).done(function(){n=null})):UB.showResponseError(t):i.setContent(t,!1).done(function(){n=null})}})},onDeleteAttachment:function e(t){var n=this,i=n.getField(t.attribute);i.fireEvent("change"),$App.dialogYesNo("ochistit","vyHotiteUdalitSoderzhimoeDocumenta").done(function(e){var t,r;e&&(t=i.getValue(),Ext.isString(t)&&t.length&&(t=Ext.JSON.decode(t,!0)),Ext.Object.getSize(t)&&(r=Ext.apply(t,{deleting:!0,size:0}),i.setValue(r,n.getInstanceID())))})},lockInterface:function e(){var t,n=this.getEl();n&&(t=n.mask(),t.addCls("ub-invisible-mask"))},maskForm:function e(t){var n=this,i;clearTimeout(n.maskTimeout||0),t=t||1,n.maskTimeout=setTimeout(function(){(i=n.getEl())&&i.mask(UB.i18n("loadingData"))},t)},unmaskForm:function e(){var t=this,n;clearTimeout(t.maskTimeout||0),(n=t.getEl())&&n.unmask()},beforeDestroy:function e(){var t=this;if(this.mainEntityGridPanel&&(this.mainEntityGridPanel.un("parentchange",this.onParentChange,this),this.mainEntityGridPanel.actions[UB.view.EntityGridPanel.actionId.showPreview].setDisabled(!1)),clearTimeout(this.maskTimeout||0),t.callParent(),t.sender&&t.sender.up){var n=t.sender.up("form");n&&(n.focusControl?n.focusControl(t.sender,300):t.sender.focus())}},deleteInstanceID:function e(){return this.instanceID&&UB.view.activeForm&&delete UB.view.activeForm[this.instanceID],!0},beforeClose:function e(){var t=this,n=t.getFormWin()||{};return!(!n.closeForce&&!t.closeForce&&t.isFormDirty(!0)&&t.getCanEdit())||(Ext.Msg.confirm({buttons:Ext.MessageBox.YESNOCANCEL,icon:Ext.MessageBox.WARNING,buttonText:{yes:UB.i18n("save"),no:UB.i18n("doNotSave"),cancel:UB.i18n("cancel")},minWidth:320,title:UB.i18n("unsavedData"),msg:UB.i18n("confirmSave"),fn:function e(i){"yes"===i&&t.saveForm().done(function(e){e>=0&&t.closeWindow(!0)}),"no"===i&&(t.closeForce=!0,n.closeForce=!0,t.closeWindow(!0)),t.deleteInstanceID()}}),!1)},closeWindow:function e(t){var n=this,i=this.getFormWin();if(n.deleteLock(),n.closeForce=t,i&&!n.target)return i.closeForce=t,void i.close();n&&n.close()},onHistory:function e(){function t(e){i.findIndex(o,{name:e})<0&&(r=[e].concat(r),o=[{name:e,visibility:!0,description:UB.i18n(e)}].concat(o))}var n=this,r=n.fieldList.concat(),o=UB.core.UBUtil.convertFieldListToExtended(n.fieldList);n.instanceID&&(t("mi_dateTo"),t("mi_dateFrom"),$App.doCommand({cmdType:"showList",isModal:!0,cmdData:{params:[{entity:n.entityName,method:UB.core.UBCommand.methodName.SELECT,fieldList:r}]},cmpInitConfig:{extendedFieldList:o},instanceID:n.instanceID,__mip_recordhistory:!0}))},onAccessRight:function e(){var t=this,n,r,o=[],a,s=!1;t.instanceID&&(t.isEntityLockable&&!t.entityLocked?(a=t.setEntityLocked(),s=!0):a=Q.resolve(!0),r=t.entityName+"_acl",(n=t.domainEntity)&&n.mixins&&n.mixins.aclRls&&(n.mixins.aclRls.useUnityName&&(r=n.mixins.unity.entity+"_acl"),i.forEach(n.mixins.aclRls.onEntities,function(e){var t=$App.domainInfo.get(e);t.descriptionAttribute?o.push(t.sqlAlias+"ID."+t.descriptionAttribute):o.push(t.sqlAlias+"ID")}),a.done(function(){$App.doCommand({cmdType:"showList",cmdData:{params:[{entity:r,method:"select",fieldList:o,whereList:{parentExpr:{expression:"[instanceID]",condition:"equal",values:{instanceID:t.instanceID}}}}]},isModalDialog:!0,parentContext:{instanceID:t.instanceID},hideActions:["addNewByCurrent"],onClose:function e(){s&&t.deleteLock()}})})))},onAudit:function e(){var t=this;t.instanceID&&$App.doCommand({cmdType:"showList",isModalDialog:!0,hideActions:["addNew","addNewByCurrent","edit","del","newVersion"],cmdData:{params:[UB.Repository("uba_auditTrail").attrs(["actionTime","actionType","actionUser","remoteIP"]).where("[entity]","=",t.entityName).where("[entityinfo_id]","=",t.instanceID).orderByDesc("actionTime").ubRequest()]},cmpInitConfig:{onItemDblClick:function e(t,n,i,r,o,a){this.doOnEdit(a)}}})}}),Ext.onReady(function(){Ext.define("Ext.layout.container.AutoUB",{override:"Ext.layout.container.Auto",chromeCellMeasureBug:!1})})},function(e,t,n){n(34),Ext.define("UB.ux.form.field.UBTextArea",{extend:"UB.ux.form.field.UBText",alias:["widget.ubtextareafield","widget.ubtextarea"],requires:["Ext.XTemplate","Ext.layout.component.field.TextArea","Ext.util.DelayedTask"],fieldSubTpl:['<textarea id="{id}" role="{role}" {inputAttrTpl}','<tpl if="name"> name="{name}"</tpl>','<tpl if="rows"> rows="{rows}" </tpl>','<tpl if="cols"> cols="{cols}" </tpl>','<tpl if="placeholder"> placeholder="{placeholder}"</tpl>','<tpl if="size"> size="{size}"</tpl>','<tpl if="maxLength !== undefined"> maxlength="{maxLength}"</tpl>','<tpl if="readOnly"> readonly="readonly"</tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','<tpl if="tabIdx"> tabIndex="{tabIdx}"</tpl>',' class="{fieldCls} {typeCls} {inputCls}" ','<tpl if="fieldStyle"> style="{fieldStyle}"</tpl>',' autocomplete="off">\n','<tpl if="value">{[Ext.util.Format.htmlEncode(values.value)]}</tpl>',"</textarea>",{disableFormats:!0}],getSubTplMarkup:function e(t){var n=this,i=t.childElCls,r=n.getTpl("fieldSubTpl").apply(this.getSubTplData());return n.hideTrigger?this.getTpl("fieldSubTpl").apply(this.getSubTplData()):'<table id="'+n.id+'-triggerWrap" class="'+Ext.baseCSSPrefix+"form-trigger-wrap ub-textarea-wrap"+i+'" cellpadding="0" cellspacing="0" role="presentation"><tbody role="presentation"><tr role="presentation"><td id="'+n.id+'-inputCell" class="'+Ext.baseCSSPrefix+"form-trigger-input-cell"+i+'" role="presentation">'+r+"</td>"+n.getTriggerMarkup()+"</tr></tbody></table>"},getTriggerMarkup:function e(){var t=this;return t.hideTrigger?"":t.callParent(arguments)},initTrigger:function e(){var t=this;t.hideTrigger||t.callParent(arguments)},growMin:60,growMax:1e3,growAppend:"\n-",cols:20,rows:4,enterIsSpecial:!1,preventScrollbars:!1,componentLayout:"textareafield",setGrowSizePolicy:Ext.emptyFn,returnRe:/\r/g,inputCls:Ext.baseCSSPrefix+"form-textarea",getSubTplData:function e(){var t=this,n=t.getFieldStyle(),i=t.callParent();return t.grow&&t.preventScrollbars&&(i.fieldStyle=(n||"")+";overflow:hidden;height:"+t.growMin+"px"),Ext.applyIf(i,{cols:t.cols,rows:t.rows}),i},afterRender:function e(){var t=this;t.callParent(arguments),t.needsMaxCheck=t.enforceMaxLength&&t.maxLength!==Number.MAX_VALUE&&!Ext.supports.TextAreaMaxLength,t.needsMaxCheck&&t.inputEl.on("paste",t.onPaste,t)},transformRawValue:function e(t){return this.stripReturns(t)},transformOriginalValue:function e(t){return this.stripReturns(t)},getValue:function e(){return this.stripReturns(this.callParent())},valueToRaw:function e(t){return t=this.stripReturns(t),this.callParent([t])},stripReturns:function e(t){return t&&"string"==typeof t&&(t=t.replace(this.returnRe,"")),t},onPaste:function e(t){var n=this;n.pasteTask||(n.pasteTask=new Ext.util.DelayedTask(n.pasteCheck,n)),n.pasteTask.delay(1)},pasteCheck:function e(){var t=this,n=t.getValue(),i=t.maxLength;n.length>i&&(n=n.substr(0,i),t.setValue(n))},fireKey:function e(t){var n=this,i=t.getKey(),r;t.isSpecialKey()&&(n.enterIsSpecial||i!==t.ENTER||t.hasModifier())&&n.fireEvent("specialkey",n,t),!n.needsMaxCheck||i===t.BACKSPACE||i===t.DELETE||t.isNavKeyPress()||n.isCutCopyPasteSelectAll(t,i)||(r=n.getValue(),r.length>=n.maxLength&&t.stopEvent())},isCutCopyPasteSelectAll:function e(t,n){return!!t.ctrlKey&&(n===t.A||n===t.C||n===t.V||n===t.X)},autoSize:function e(){var t=this,n;t.grow&&t.rendered&&(t.updateLayout(),(n=t.inputEl.getHeight())!==t.lastInputHeight&&(t.fireEvent("autosize",t,n),t.lastInputHeight=n))},beforeDestroy:function e(){var t=this.pasteTask;t&&(t.cancel(),this.pasteTask=null),this.callParent()}})},function(e,t){Ext.define("Ext.ux.form.field.BoxSelect",{extend:"Ext.form.field.ComboBox",alias:["widget.comboboxselect","widget.boxselect"],requires:["Ext.selection.Model","Ext.data.Store"],delimiter:",",multiSelect:!0,forceSelection:!0,createNewOnEnter:!1,createNewOnBlur:!1,encodeSubmitValue:!1,triggerOnClick:!0,stacked:!1,pinList:!0,filterPickList:!1,selectOnFocus:!0,grow:!0,growMin:!1,growMax:!1,fieldSubTpl:['<div id="{cmpId}-listWrapper" class="x-boxselect {fieldCls} {typeCls}">','<ul id="{cmpId}-itemList" class="x-boxselect-list">','<li id="{cmpId}-inputElCt" class="x-boxselect-input">','<div id="{cmpId}-emptyEl" class="{emptyCls}">{emptyText}</div>','<input id="{cmpId}-inputEl" type="{type}" ','<tpl if="name">name="{name}" </tpl>','<tpl if="value"> value="{[Ext.util.Format.htmlEncode(values.value)]}"</tpl>','<tpl if="size">size="{size}" </tpl>','<tpl if="tabIdx">tabIndex="{tabIdx}" </tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','class="x-boxselect-input-field {inputElCls}" autocomplete="off">',"</li>","</ul>","</div>",{compiled:!0,disableFormats:!0}],childEls:["listWrapper","itemList","inputEl","inputElCt","emptyEl"],componentLayout:"boxselectfield",emptyInputCls:"x-boxselect-emptyinput",initComponent:function e(){var t=this,n=t.typeAhead;n&&!t.editable&&Ext.Error.raise("If typeAhead is enabled the combo must be editable: true -- please change one of those settings."),Ext.apply(t,{typeAhead:!1}),t.callParent(),t.typeAhead=n,t.selectionModel=new Ext.selection.Model({store:t.valueStore,mode:"MULTI",lastFocused:null,onSelectChange:function e(t,n,i,r){r()}}),!Ext.isEmpty(t.delimiter)&&t.multiSelect&&(t.delimiterRegexp=RegExp((t.delimiter+"").replace(/[$%()*+.?\[\\\]{|}]/g,"\\$&")))},initEvents:function e(){var t=this;t.callParent(arguments),t.enableKeyEvents||t.mon(t.inputEl,"keydown",t.onKeyDown,t),t.mon(t.inputEl,"paste",t.onPaste,t),t.mon(t.listWrapper,"click",t.onItemListClick,t),t.mon(t.selectionModel,{selectionchange:function e(n,i){t.applyMultiselectItemMarkup(),t.fireEvent("valueselectionchange",t,i)},focuschange:function e(n,i,r){t.fireEvent("valuefocuschange",t,i,r)},scope:t})},onBindStore:function e(t,n){var i=this;t&&(i.valueStore=new Ext.data.Store({model:t.model,proxy:{type:"memory"}}),i.mon(i.valueStore,"datachanged",i.applyMultiselectItemMarkup,i),i.selectionModel&&i.selectionModel.bindStore(i.valueStore))},onUnbindStore:function e(t){var n=this,i=n.valueStore;i&&(n.selectionModel&&(n.selectionModel.setLastFocused(null),n.selectionModel.deselectAll(),n.selectionModel.bindStore(null)),n.mun(i,"datachanged",n.applyMultiselectItemMarkup,n),i.destroy(),n.valueStore=null),n.callParent(arguments)},createPicker:function e(){var t=this,n=t.callParent(arguments);return t.mon(n,{beforerefresh:t.onBeforeListRefresh,scope:t}),t.filterPickList&&n.addCls("x-boxselect-hideselections"),n},onDestroy:function e(){var t=this;Ext.destroyMembers(t,"valueStore","selectionModel"),t.callParent(arguments)},getSubTplData:function e(){var t=this,n=t.callParent(),i=t.emptyText&&n.value.length<1;return n.value="",i?(n.emptyText=t.emptyText,n.emptyCls=t.emptyCls,n.inputElCls=t.emptyInputCls):(n.emptyText="",n.emptyCls=t.emptyInputCls,n.inputElCls=""),n},afterRender:function e(){var t=this;Ext.supports.Placeholder&&t.inputEl&&t.emptyText&&delete t.inputEl.dom.placeholder,t.bodyEl.applyStyles("vertical-align:top"),t.grow&&(Ext.isNumber(t.growMin)&&t.growMin>0&&t.listWrapper.applyStyles("min-height:"+t.growMin+"px"),Ext.isNumber(t.growMax)&&t.growMax>0&&t.listWrapper.applyStyles("max-height:"+t.growMax+"px")),!0===t.stacked&&t.itemList.addCls("x-boxselect-stacked"),t.multiSelect||t.itemList.addCls("x-boxselect-singleselect"),t.applyMultiselectItemMarkup(),t.callParent(arguments)},findRecord:function e(t,n){var i=this.store,r;return!!i&&(r=i.queryBy(function(e,i){return e.isEqual(e.get(t),n)}),r.getCount()>0&&r.first())},onLoad:function e(){var t=this,n=t.valueField,i=t.valueStore,r=!1;i&&(Ext.isEmpty(t.value)||0!=i.getCount()||t.setValue(t.value,!1,!0),i.suspendEvents(),i.each(function(e){var o=t.findRecord(n,e.get(n)),a=o?i.indexOf(e):-1;a>=0&&(i.removeAt(a),i.insert(a,o),r=!0)}),i.resumeEvents(),r&&i.fireEvent("datachanged",i)),t.callParent(arguments)},isFilteredRecord:function e(t){var n=this,i=n.valueField,r=t.get(i);return-1===n.store.findExact(i,r)&&-1!==n.valueStore.findExact(i,r)},doRawQuery:function e(){var t=this,n=t.inputEl.dom.value;t.multiSelect&&(n=n.split(t.delimiter).pop()),this.doQuery(n,!1,!0)},onBeforeListRefresh:function e(){this.ignoreSelection++},onListRefresh:function e(){this.callParent(arguments),this.ignoreSelection>0&&--this.ignoreSelection},onListSelectionChange:function e(t,n){var i=this,r=i.valueStore,o=[],a;if(i.ignoreSelection<=0&&i.isExpanded){if(!n.length)return!1;r.each(function(e){(Ext.Array.contains(n,e)||i.isFilteredRecord(e))&&o.push(e)}),o=Ext.Array.merge(o,n),a=Ext.Array.intersect(o,r.getRange()).length,a===o.length&&a===i.valueStore.getCount()||(i.setValue(o,!1),i.multiSelect&&i.pinList||Ext.defer(i.collapse,1,i),r.getCount()>0&&i.fireEvent("select",i,r.getRange())),i.inputEl.focus(),i.pinList||(i.inputEl.dom.value=""),i.selectOnFocus&&i.inputEl.dom.select()}},syncSelection:function e(){var t=this,n=t.picker,i=t.valueField,r,o,a;n&&(r=n.store,o=[],t.valueStore&&t.valueStore.each(function(e){var t=r.findExact(i,e.get(i));t>=0&&o.push(r.getAt(t))}),t.ignoreSelection++,a=n.getSelectionModel(),a.deselectAll(),o.length>0&&a.select(o),t.ignoreSelection>0&&--t.ignoreSelection)},doAlign:function e(){var t=this,n=t.picker,i="-above",r;t.picker.alignTo(t.listWrapper,t.pickerAlign,t.pickerOffset),r=n.el.getY()<t.inputEl.getY(),t.bodyEl[r?"addCls":"removeCls"](t.openCls+"-above"),n[r?"addCls":"removeCls"](n.baseCls+"-above")},alignPicker:function e(){var t=this,n=t.picker,i=n.getTargetEl().dom.scrollTop;t.callParent(arguments),t.isExpanded&&(t.matchFieldWidth&&n.setWidth(t.listWrapper.getWidth()),n.getTargetEl().dom.scrollTop=i)},getCursorPosition:function e(){var t;return Ext.isIE?(t=document.selection.createRange(),t.collapse(!0),t.moveStart("character",-this.inputEl.dom.value.length),t=t.text.length):t=this.inputEl.dom.selectionStart,t},hasSelectedText:function e(){var t,n;return Ext.isIE?(t=document.selection,n=t.createRange(),n.parentElement()==this.inputEl.dom):this.inputEl.dom.selectionStart!=this.inputEl.dom.selectionEnd},onKeyDown:function e(t,n){var i=this,r=t.getKey(),o=i.inputEl.dom.value,a=i.valueStore,s=i.selectionModel,l=!1;if(!i.readOnly&&!i.disabled&&i.editable){if(i.isExpanded&&r==t.A&&t.ctrlKey)i.select(i.getStore().getRange()),s.setLastFocused(null),s.deselectAll(),i.collapse(),i.inputEl.focus(),l=!0;else if(a.getCount()>0&&(""==o||0===i.getCursorPosition()&&!i.hasSelectedText())){var u=s.getCount()>0?a.indexOf(s.getLastSelected()||s.getLastFocused()):-1;r==t.BACKSPACE||r==t.DELETE?(u>-1?(s.getCount()>1&&(u=-1),i.valueStore.remove(s.getSelection())):i.valueStore.remove(i.valueStore.last()),s.clearSelections(),i.setValue(i.valueStore.getRange()),u>0&&s.select(u-1),l=!0):r==t.RIGHT||r==t.LEFT?-1==u&&r==t.LEFT?(s.select(a.last()),l=!0):u>-1&&(r==t.RIGHT?u<a.getCount()-1?(s.select(u+1,t.shiftKey),l=!0):t.shiftKey||(s.setLastFocused(null),s.deselectAll(),l=!0):r==t.LEFT&&u>0&&(s.select(u-1,t.shiftKey),l=!0)):r==t.A&&t.ctrlKey&&(s.selectAll(),l=t.A),i.inputEl.focus()}if(l)return i.preventKeyUpEvent=l,void t.stopEvent();i.isExpanded&&r==t.ENTER&&i.picker.highlightedItem&&(i.preventKeyUpEvent=!0),i.enableKeyEvents&&i.callParent(arguments),t.isSpecialKey()||t.hasModifier()||(i.selectionModel.setLastFocused(null),i.selectionModel.deselectAll(),i.inputEl.focus())}},onKeyUp:function e(t,n){var i=this,r=i.inputEl.dom.value;if(i.preventKeyUpEvent)return t.stopEvent(),void(!0!==i.preventKeyUpEvent&&t.getKey()!==i.preventKeyUpEvent||delete i.preventKeyUpEvent);(i.multiSelect&&i.delimiterRegexp&&i.delimiterRegexp.test(r)||!0===i.createNewOnEnter&&t.getKey()==t.ENTER)&&(r=Ext.Array.clean(r.split(i.delimiterRegexp)),i.inputEl.dom.value="",i.setValue(i.valueStore.getRange().concat(r)),i.inputEl.focus()),i.callParent([t,n])},onPaste:function e(t,n){var i=this,r=i.inputEl.dom.value,o=!!(t&&t.browserEvent&&t.browserEvent.clipboardData)&&t.browserEvent.clipboardData;i.multiSelect&&i.delimiterRegexp&&i.delimiterRegexp.test(r)&&(o&&o.getData&&(/text\/plain/.test(o.types)?r=o.getData("text/plain"):/text\/html/.test(o.types)&&(r=o.getData("text/html"))),r=Ext.Array.clean(r.split(i.delimiterRegexp)),i.inputEl.dom.value="",i.setValue(i.valueStore.getRange().concat(r)),i.inputEl.focus())},onExpand:function e(){var t=this,n=t.listKeyNav;t.callParent(arguments),!n&&t.filterPickList&&(n=t.listKeyNav,n.highlightAt=function(e){var t=this.boundList,n=t.all.item(e),i=t.all.getCount(),r;if(n&&n.hasCls("x-boundlist-selected")){r=0==e||!t.highlightedItem||t.indexOf(t.highlightedItem)<e?1:-1;do{e+=r,n=t.all.item(e)}while(e>0&&e<i&&n.hasCls("x-boundlist-selected"));if(n.hasCls("x-boundlist-selected"))return}n&&(n=n.dom,t.highlightItem(n),t.getTargetEl().scrollChildIntoView(n,!1))})},onTypeAhead:function e(){var t=this,n=t.displayField,i=t.inputEl.dom,r=t.valueStore,o=t.getPicker(),a,s,l,u;if(t.filterPickList){var c=this.createFilterFn(n,i.value);a=t.store.findBy(function(e){return-1===r.indexOfId(e.getId())&&c(e)}),a=-1!==a&&t.store.getAt(a)}else a=t.store.findRecord(n,i.value);a&&(s=a.get(n),l=s.length,u=i.value.length,o.highlightItem(o.getNode(a)),0!==u&&u!==l&&(i.value=s,t.selectText(u,s.length)))},onItemListClick:function e(t,n,i){var r=this,o=t.getTarget(".x-boxselect-item"),a=!!o&&t.getTarget(".x-boxselect-item-close");r.readOnly||r.disabled||(t.stopPropagation(),o?(a?(r.removeByListItemNode(o),r.valueStore.getCount()>0&&r.fireEvent("select",r,r.valueStore.getRange())):r.toggleSelectionByListItemNode(o,t.shiftKey),r.inputEl.focus()):(r.selectionModel.getCount()>0&&(r.selectionModel.setLastFocused(null),r.selectionModel.deselectAll()),r.triggerOnClick&&r.onTriggerClick()))},getMultiSelectItemMarkup:function e(){var t=this;return t.multiSelectItemTpl||(t.labelTpl?(Ext.isString(t.labelTpl)||Ext.isArray(t.labelTpl))&&(t.labelTpl=Ext.create("Ext.XTemplate",t.labelTpl)):t.labelTpl=Ext.create("Ext.XTemplate",'{[values["'+t.displayField+'"]]}'),t.multiSelectItemTpl=['<tpl for=".">','<li class="x-tab-default x-boxselect-item ','<tpl if="this.isSelected(values.'+t.valueField+')">'," selected","</tpl>",'" qtip="{[typeof values === "string" ? values : ["'+t.displayField+'"]]}">','<div class="x-boxselect-item-text">{[typeof values === "string" ? values : this.getItemLabel(values)]}</div>','<div class="x-tab-close-btn x-boxselect-item-close"></div>',"</li>","</tpl>",{compile:!0,disableFormats:!0,isSelected:function e(n){var i=t.valueStore.findExact(t.valueField,n);return i>=0&&t.selectionModel.isSelected(t.valueStore.getAt(i))},getItemLabel:function e(n){return t.getTpl("labelTpl").apply(n)}}]),this.getTpl("multiSelectItemTpl").apply(Ext.Array.pluck(this.valueStore.getRange(),"data"))},applyMultiselectItemMarkup:function e(){var t=this,n=t.itemList,i;if(n){for(;null!=(i=t.inputElCt.prev());)i.remove();t.inputElCt.insertHtml("beforeBegin",t.getMultiSelectItemMarkup())}Ext.Function.defer(function(){t.picker&&t.isExpanded&&t.alignPicker(),t.hasFocus&&t.inputElCt&&t.listWrapper&&t.inputElCt.scrollIntoView(t.listWrapper)},15)},getRecordByListItemNode:function e(t){for(var n=this,i=0,r=n.itemList.dom.firstChild;r&&r.nextSibling&&r!=t;)i++,r=r.nextSibling;return!1!==(i=r==t&&i)&&n.valueStore.getAt(i)},toggleSelectionByListItemNode:function e(t,n){var i=this,r=i.getRecordByListItemNode(t),o=i.selectionModel;r&&(o.isSelected(r)?(o.isFocused(r)&&o.setLastFocused(null),o.deselect(r)):o.select(r,n))},removeByListItemNode:function e(t){var n=this,i=n.getRecordByListItemNode(t);i&&(n.valueStore.remove(i),n.setValue(n.valueStore.getRange()))},getRawValue:function e(){var t=this,n=t.inputEl,i;return t.inputEl=!1,i=t.callParent(arguments),t.inputEl=n,i},setRawValue:function e(t){var n=this,i=n.inputEl,r;return n.inputEl=!1,r=n.callParent([t]),n.inputEl=i,r},addValue:function e(t){var n=this;t&&n.setValue(Ext.Array.merge(n.value,Ext.Array.from(t)))},removeValue:function e(t){var n=this;t&&n.setValue(Ext.Array.difference(n.value,Ext.Array.from(t)))},setValue:function e(t,n,i){var r=this,o=r.valueStore,a=r.valueField,s,l,u,c,d=[];for(Ext.isEmpty(t)&&(t=null),Ext.isString(t)&&r.multiSelect&&(t=t.split(r.delimiter)),t=Ext.Array.from(t,!0),u=0,l=t.length;u<l;u++)(s=t[u])&&s.isModel||(c=o.findExact(a,s),c>=0?t[u]=o.getAt(c):(c=r.findRecord(a,s),c||(r.forceSelection?d.push(s):(c={},c[r.valueField]=s,c[r.displayField]=s,c=new r.valueStore.model(c))),c&&(t[u]=c)));if(!0!==i&&d.length>0&&"remote"===r.queryMode){var f={};return f[r.valueParam||r.valueField]=d.join(r.delimiter),r.store.load({params:f,callback:function e(){r.itemList&&r.itemList.unmask(),r.setValue(t,n,!0),r.autoSize(),r.lastQuery=!1}}),!1}if(!r.multiSelect&&t.length>0){for(u=t.length-1;u>=0;u--)if(t[u].isModel){t=t[u];break}Ext.isArray(t)&&(t=t[t.length-1])}return r.callParent([t,n])},getValueRecords:function e(){return this.valueStore.getRange()},getSubmitData:function e(){var t=this,n=t.callParent(arguments);return t.multiSelect&&t.encodeSubmitValue&&n&&n[t.name]&&(n[t.name]=Ext.encode(n[t.name])),n},mimicBlur:function e(){var t=this;t.selectOnTab&&t.picker&&t.picker.highlightedItem&&(t.inputEl.dom.value=""),t.callParent(arguments)},assertValue:function e(){var t=this,n=t.inputEl.dom.value,i=!Ext.isEmpty(n)&&t.findRecordByDisplay(n),r=!1;i||t.forceSelection||!t.createNewOnBlur||Ext.isEmpty(n)?i&&(r=i):r=n,r&&t.addValue(r),t.inputEl.dom.value="",t.collapse()},checkChange:function e(){if(!this.suspendCheckChange&&!this.isDestroyed){var t=this,n=t.valueStore,i=t.lastValue||"",r=t.valueField,o=Ext.Array.map(Ext.Array.from(t.value),function(e){return e.isModel?e.get(r):e},this).join(this.delimiter),a=t.isEqual(o,i);(!a||o.length>0&&n.getCount()<o.length)&&(n.suspendEvents(),n.removeAll(),Ext.isArray(t.valueModels)&&n.add(t.valueModels),n.resumeEvents(),n.fireEvent("datachanged",n),a||(t.lastValue=o,t.fireEvent("change",t,o,i),t.onChange(o,i)))}},isEqual:function e(t,n){var i=Ext.Array.from,r=this.valueField,o,a,s,l;if(t=i(t),n=i(n),(a=t.length)!==n.length)return!1;for(o=0;o<a;o++)if(s=t[o].isModel?t[o].get(r):t[o],l=n[o].isModel?n[o].get(r):n[o],s!==l)return!1;return!0},applyEmptyText:function e(){var t=this,n=t.emptyText,i,r;t.rendered&&n&&(r=Ext.isEmpty(t.value)&&!t.hasFocus,i=t.inputEl,r?(i.dom.value="",t.emptyEl.update(n),t.emptyEl.addCls(t.emptyCls),t.emptyEl.removeCls(t.emptyInputCls),t.listWrapper.addCls(t.emptyCls),t.inputEl.addCls(t.emptyInputCls)):(t.emptyEl.addCls(t.emptyInputCls),t.emptyEl.removeCls(t.emptyCls),t.listWrapper.removeCls(t.emptyCls),t.inputEl.removeCls(t.emptyInputCls)),t.autoSize())},preFocus:function e(){var t=this,n=t.inputEl,i=""==n.dom.value;t.emptyEl.addCls(t.emptyInputCls),t.emptyEl.removeCls(t.emptyCls),t.listWrapper.removeCls(t.emptyCls),t.inputEl.removeCls(t.emptyInputCls),(t.selectOnFocus||i)&&n.dom.select()},onFocus:function e(){var t=this,n=t.focusCls,i=t.itemList;n&&i&&i.addCls(n),t.callParent(arguments)},onBlur:function e(){var t=this,n=t.focusCls,i=t.itemList;n&&i&&i.removeCls(n),t.callParent(arguments)},renderActiveError:function e(){var t=this,n=t.invalidCls,i=t.itemList,r=t.hasActiveError();n&&i&&i[r?"addCls":"removeCls"](t.invalidCls+"-field"),t.callParent(arguments)},autoSize:function e(){var t=this;return t.grow&&t.rendered&&(t.autoSizing=!0,t.updateLayout()),t},afterComponentLayout:function e(){var t=this;t.autoSizing&&(height=t.getHeight(),height!==t.lastInputHeight&&(t.isExpanded&&t.alignPicker(),t.fireEvent("autosize",t,height),t.lastInputHeight=height,delete t.autoSizing))}}),Ext.define("Ext.ux.layout.component.field.BoxSelectField",{alias:["layout.boxselectfield"],extend:"Ext.layout.component.field.Trigger",type:"boxselectfield",waitForOuterWidthInDom:!0,beginLayout:function e(t){var n=this,i=n.owner;n.callParent(arguments),t.inputElCtContext=t.getEl("inputElCt"),i.inputElCt.setStyle("width",""),n.skipInputGrowth=!i.grow||!i.multiSelect},beginLayoutFixed:function e(t,n,i){var r=this,o=t.target;o.triggerEl.setStyle("height","24px"),r.callParent(arguments),t.heightModel.fixed&&t.lastBox&&(o.listWrapper.setStyle("height",t.lastBox.height+"px"),o.itemList.setStyle("height","100%"))},publishInnerWidth:function e(t){var n=this,i=n.owner,r=i.itemList.getWidth(!0)-10,o=i.inputElCt.prev(null,!0);o&&!i.stacked&&(o=Ext.fly(o),r=r-o.getOffsetsTo(o.up(""))[0]-o.getWidth()),!n.skipInputGrowth&&r<35?r-=10:r<1&&(r=1),t.inputElCtContext.setWidth(r)}})},function(e,t){Ext.define("UB.ux.form.field.ComboExtraButtons",{extend:"Ext.panel.Panel",hidden:!0,width:"100px",shadow:!1,autoRender:!0,autoHide:!1,alwaysFramed:!1,frameHeader:!1,frame:!1,baseCls:Ext.baseCSSPrefix+"ubcombo",floating:!0,constrain:!1,focusOnToFront:!1,init:function e(t){var n=this;n.parentCombo=t,n.ownerCt=t,t.on({afterrender:n.onParentAfterRenderer,added:function e(t,i,r,o){n.ownerCt=t.up("[floating]"),n.registerWithOwnerCt()},refresh:function e(){var i=t.bodyEl.getXY();i[1]-=20,n.showAt(i)},scope:this})},clearSelection:function e(){var t=this,n=t.parentCombo;t.items.first().disable(),n.clearValue()},addItem:function e(){var t=this,n=t.parentCombo,i=n.getStore(),r=i.entityName,o=n.displayField,a=n.getValue(),s=i.getById(a),l={cmdType:UB.core.UBCommand.commandType.showForm,entity:r,store:i,isModal:!0,sender:n,onItemAdded:function e(t){n.setValueById(t)}};l.initValue={},l.initValue[o]=s?s.get(o):a,UB.core.UBApp.doCommand(l)},editItem:function e(){var t=this,n=t.parentCombo,i=n.getStore(),r=i.entityName,o=n.getValue(),a={cmdType:UB.core.UBCommand.commandType.showForm,entity:r,instanceID:o,store:i,isModal:!0,sender:n,onClose:function e(){n.setValue(i.getById(n.getValue())),t.enable()}};o&&UB.core.UBApp.doCommand(a)},showLookup:function e(){var t=this,n=t.parentCombo,i=n.getStore(),r=i.entityName,o=n.getValue(),a={entity:r,cmdType:UB.core.UBCommand.commandType.showList,description:$App.domainInfo.get(r,!0).getEntityDescription(),isModal:!0,sender:n,selectedInstanceID:o,onItemSelected:function e(t){n.setValueById(t.get("ID"))},cmdData:{params:[{entity:r,method:"select",fieldList:"*",whereList:i.ubRequest.whereList}]}},s=i.filters.clone();s.removeAtKey(n.userFilterId),a.filters=s,UB.core.UBApp.doCommand(a)},onParentAfterRenderer:function e(){this.initEventHandlers(),this.bindHotKeys()},initEventHandlers:function e(){var t=this;t.parentCombo.on({expand:t.onParentFocus,change:t.onParentValueChange,focus:t.onParentFocus,blur:t.onParentBlur,scope:t}),t.parentCombo.on({expand:t.onParentExpand,scope:t}),setTimeout(function(){t.ownerCt=t.parentCombo.up("[floating]"),t.registerWithOwnerCt()},100)},bindHotKeys:function e(){var t=this;new Ext.util.KeyMap({target:t.parentCombo.getEl(),binding:[{ctrl:!0,key:Ext.EventObject.E,fn:function e(n,i){if(!t.parentCombo.disabled&&!t.parentCombo.readOnly)return i.stopEvent(),t.editItem(),!1}},{key:120,fn:function e(n,i){if(!t.parentCombo.disabled&&!t.parentCombo.readOnly)return t.showLookup(),!1}}]})},onParentExpand:function e(){this.parentCombo.un({expand:this.onParentExpand,scope:this})},initComponent:function e(){var t=this;t.floating=Ext.apply({},{shadow:t.shadow},t.self.prototype.floating),t.items=[{xtype:"button",width:"25px",flex:1,glyph:UB.core.UBUtil.glyphs.faEdit,handler:{fn:t.editItem,scope:t}},{xtype:"button",width:"25px",flex:1,glyph:UB.core.UBUtil.glyphs.faTable,handler:{fn:t.showLookup,scope:t}},{xtype:"button",width:"25px",flex:1,glyph:UB.core.UBUtil.glyphs.faPlusCircle,handler:{fn:t.addItem,scope:t}},{xtype:"button",width:"25px",glyph:UB.core.UBUtil.glyphs.faEraser,handler:{fn:t.clearSelection,scope:t}}],t.callParent(arguments),t.on({element:"el",mousedown:t.onClick,scope:t})},showAt:function e(t){var n=this;n.parentCombo.disabled||n.parentCombo.readOnly||(n.callParent(arguments),n.isVisible()&&(n.setPagePosition(t[0],t[1]),(n.constrainPosition||n.constrain)&&n.doConstrain(),n.toFront()))},onParentFocus:function e(t){var n=this,i=n.parentCombo,r=i.getStore(),o=i.getValue(),a=!(r.getById(o)||0===r.getCount()&&Ext.isNumber(o));n.items.first().setDisabled(a);var s=i.bodyEl.getXY();s[1]-=20,n.showAt(s)},onParentBlur:function e(){this.hide()},onParentValueChange:function e(){var t=this,n=t.parentCombo,i=!n.getStore().getById(n.getValue());t.items.first().setDisabled(i)},onClick:function e(t){var n=this,i;if(n.disabled)return void t.stopEvent();(i=n.getItemFromEvent(t))&&!i.isDisabled()&&(_.isFunction(i.handler)?i.handler(t):i.handler&&_.isFunction(i.handler.fn)&&Ext.callback(i.handler.fn,i.handler.scope,[t]))},getItemFromEvent:function e(t){return this.getChildByElement(t.getTarget())}})},function(e,t){Ext.define("UB.view.FormDataBinder",{mixins:{observable:"Ext.util.Observable"},constructor:function e(t){var n=this;if(!t||!Ext.isObject(t))throw Error("Config object is required.");if(!t.panel)throw Error("Properties panel is required.");if(Ext.apply(n,t),!(n.form||n.controls&&Ext.isArray(n.controls))){if(!n.panel.getForm)throw Error("Property form or controls in config object is required.");n.form=n.panel.getForm()}n.mixins.observable.constructor.call(this,t),n.addEvents("formDataReady","controlDataReady","controlChanged","dataBind"),n.connectFieldsEvents()},updateFormFields:function e(){var t=this;t.disconnectFieldsEvents(),t.connectFieldsEvents()},getFields:function e(t){var n=this,i,r={};return i=n.controls?n.controls:n.form.getFields().items,_.forEach(i,function(e){e.attributeName&&(t||!0!==e.oneWayBinding)&&(r[e.attributeName]=e)}),r},getFieldsByName:function e(t,n){var i=this,r=[],o;return o=function e(n){return n.attributeName===t&&r.push(n),!0},n||_.forEach(i.getFields(),o),_.forEach(i.getOneWayBindCtrl(),o),r},suspendAutoBind:function e(){this.isSuspendAutoBind=!0},releaseAutoBind:function e(){this.isSuspendAutoBind=!1},setRecord:function e(t){var n=this;n.record&&n.record.store.un("update",n.onRecordUpdate,n),n.record=t,n.record.store.on("update",n.onRecordUpdate,n)},getOneWayBindCtrl:function e(){var t=this,n,i=[],r,o;return t.oneWayBindCtrl||(o=t.panel.getForm(),n=t.panel.query("form"),Ext.each(n,function(e){e!==o&&Ext.each(e.query("[attributeName][oneWayBinding=true]"),function(e){i.push(e)},t)},t),r=t.panel.query("[attributeName][oneWayBinding=true]"),Ext.each(i,function(e){var t=r.indexOf(e);t>=0&&r.splice(t,1)},t),t.oneWayBindCtrl=r),t.oneWayBindCtrl},bind:function e(t){var n=this,i=n.getFields(!0),r;r=n.getOneWayBindCtrl(),n.calcReady=!0,n.notReadyControls=1,n.notReadyControlList=[];try{_.forEach(i,function(e){n.bindField(e,t)}),_.forEach(r,function(e){n.bindField(e,t)}),n.controlDataReady(),n.fireEvent("dataBind",n.record)}finally{n.calcReady=!1}},controlDataReady:function e(t){var n=this,i;n.notReadyControls--,t&&(i=n.notReadyControlList.indexOf(t))>=0&&n.notReadyControlList.splice(i,1),n.fireEvent("controlDataReady",t),0===n.notReadyControls&&n.fireEvent("formDataReady")},bindField:function e(t,n){var i=this,r,o,a;i.isInnerChangingControl=!0;try{r=i.record.get(t.attributeName),a=i.panel.getInstanceID(),t.setValueById?t.dataLoadDelay&&i.calcReady?(i.notReadyControls+=1,i.notReadyControlList.push(t),o=t.setValueById(r,n,i.controlDataReady,i)):o=t.setValueById(r,n,i.controlDataReady,i):(o="ubdocument"===t.xtype&&-1!==t.attributeName.indexOf(".")?t.setComplexValue(i.record):t.setValue?t.setValue(r,a,!0):t.setText(r,a,!0),t.resetOriginalValue&&t.resetOriginalValue(),o&&Q.isPromise(o)&&(i.notReadyControls+=1,i.notReadyControlList.push(t),o.done(function(){i.controlDataReady(t)}))),t.onBeforeSaveForm&&i.panel&&i.panel.on("beforeSaveForm",t.onBeforeSaveForm,t)}finally{i.isInnerChangingControl=!1}},onRecordUpdate:function e(t,n,i,r){var o=this;o.record===n&&(o.isInnerChangingRecord||o.isSuspendAutoBind||_.forEach(r,function(e){_.forEach(o.getFieldsByName(e),function(e){o.bindField(e)})}))},onControlChanged:function e(t,n,i){var r=this;if(t&&t.attributeName&&!r.isInnerChangingControl&&!r.isSuspendAutoBind&&(!r.panel||r.panel.formDataReady)&&!1!==r.fireEvent("controlChanged",t,n,i)){r.isInnerChangingRecord=!0;try{void 0===n&&(n=null),null!==n&&"string"==typeof n&&""===n&&(n=null),r.record.set(t.attributeName,n)}finally{r.isInnerChangingRecord=!1}}},connectFieldsEvents:function e(){var t=this,n=t.getFields();t.connectedFields={},_.forEach(n,function(e){t.connectedFields[e.attributeName]=e,e.on("change",t.onControlChanged,t)})},getBindedFields:function e(){return this.connectedFields},disconnectFieldsEvents:function e(){var t=this,n=t.connectedFields;n&&(_.forEach(n,function(e){e.un("change",t.onControlChanged,t)}),t.connectedFields=null)},destroy:function e(){var t=this;t.isDestroyed||(t.record&&t.record.store.un("update",t.onRecordUpdate,t),t.disconnectFieldsEvents(),t.record=null,t.parent=null,t.form=null,t.isDestroyed=!0)}})},function(e,t,n){var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};n(22),n(36),n(111),n(112),n(113),n(114),n(18),n(116),n(117),n(118),n(119),n(120),Ext.define("UB.ux.UBDocument",{extend:"Ext.container.Container",mixins:{labelable:"Ext.form.Labelable",field:"Ext.form.field.Field"},alias:"widget.ubdocument",uses:["UB.core.UBApp"],autoEl:"div",statics:{editors:{tinyMCE:"UB.ux.UBTinyMCETextArea",codeMirror:"UB.ux.UBCodeMirror",ubDiagram:"UB.ux.UBMetaDiagram",ubOrgChart:"UB.ux.UBOrgChart",ubReport:"UB.ux.UBReportEditor",onlyOffice:"UB.ux.UBOnlyOffice"},valueProperties:{fName:"fName",origName:"origName"},contentTypeMapping:{"application/pdf":"UB.ux.PDFComponent","application/edi":"UB.ux.PDFComponent","image/png":"UB.ux.UBImg","image/gif":"UB.ux.UBImg","image/jpeg":"UB.ux.UBImg","image/jpg":"UB.ux.UBImg","image/bmp":"UB.ux.UBImg","image/x-icon":"UB.ux.UBImg","text/html":"UB.ux.UBTinyMCETextArea","application/txt":"UB.ux.UBTinyMCETextArea","application/ubreport":"UB.ux.UBReportEditor","text/plain":"UB.ux.UBCodeMirror","application/json":"UB.ux.UBCodeMirror","application/def":"UB.ux.UBCodeMirror","application/javascript":"UB.ux.UBCodeMirror","text/x-yaml":"UB.ux.UBCodeMirror","application/yaml":"UB.ux.UBCodeMirror","text/xml":"UB.ux.UBCodeMirror","application/xml":"UB.ux.UBCodeMirror","application/ubWorkFlow":"UB.ux.GraphViewer","application/ubworkflow":"UB.ux.GraphViewer","application/ubMetaDiagram":"UB.ux.UBMetaDiagram","application/ubmetadiagram":"UB.ux.UBMetaDiagram","application/uborgchart":"UB.ux.UBOrgChart","application/UBOrgChart":"UB.ux.UBOrgChart","application/word":"UB.ux.UBOnlyOffice","application/excel":"UB.ux.UBOnlyOffice"}},layout:"fit",cls:"ub-document-container",forceMIME:"",bypassCache:!1,originalMIME:null,lastOriginalValue:null,expanded:!1,documentMIME:null,initComponent:function e(){this.originalValue=void 0,this.forceMIME=this.forceMIME||"",this.callParent(arguments),this.addEvents("change","dirtychange","initialize"),this.initEmptyDocumentMIME&&this.setValue("")},createComponent:function e(t){var n=this;n.ubCmp&&!1!==n.keepCmpOnRefresh&&t===n.cmpContentType||(n.cmpContentType=t,n.items&&n.items.length>0&&n.removeAll(),n.contentXType=n.getExtXType(t),n.ubCmp=Ext.create(n.contentXType,Ext.apply({name:n.name,useBlobForData:!0,mode:n.getNormalizeContentType(t),readOnly:n.readOnly},n.cmpConfig||{})),n.add(n.ubCmp),n.ubCmp.on("change",n.checkContentChange,n),n.ubCmp.on("setOriginalValue",function(e){n.lastCmpValue=e},n)),n.fireEvent("initialize",n)},onContentNotFound:function e(){this.errorLabel?this.errorLabel.show():(this.errorLabel=Ext.create("UB.ux.UBLabel",{html:'<span style="color: red">'+UB.i18n("documentNotFound")+"<span/>"}),this.add(this.errorLabel)),this.ubCmp&&this.ubCmp.hide()},checkContentChange:function e(){var t=this;if(!t.suspendCheckChange&&!t.readOnly)switch(t.ubCmp.xtype){case"UBOnlyOffice":t.ubCmp.checkDirty()&&(t.fireEvent("change",t,"",""),t.onChange("",""));break;default:var n=t.ubCmp.getValue(),i=t.lastCmpValue,r=t.getValue();if(!t.isDestroyed&&(t.ubCmp.isDirty?t.ubCmp.isDirty():!t.isEqual(n,i))){t.lastCmpValue=n;var o=r?JSON.parse(r):{};o.md5="changedAt"+(new Date).getTime(),t.value=o=JSON.stringify(o),t.fireEvent("change",t,o,r),t.onChange(n,i)}else{var a=void 0;t.lastCmpValue=n,t.value=a=t.originalValue,t.fireEvent("change",t,a,r),t.onChange(n,i)}}},checkDirty:function e(){if(this.readOnly)return!1;var t=this.isDirty();t!==this.wasDirty&&(this.fireEvent("dirtychange",this,t),this.onDirtyChange(t),this.wasDirty=t)},getNormalizeContentType:function e(t){var n=t.indexOf(";");return-1!==n?t.substring(0,n):t},getExtXType:function e(t){var n=void 0;if("UB.ux.UBLink"===t||"UB.ux.UBLabel"===t)return t;if(this.expanded){var i=this.getNormalizeContentType(t);n=UB.ux.UBDocument.contentTypeMapping[i]}return n||"UB.ux.UBLink"},getValueProperty:function e(t){return JSON.parse(this.value)[t]},setValueProperty:function e(t,n){var i=Ext.JSON.decode(this.value,!0);i&&(UB.core.UBUtil.isEqual(i[t],n)||(i[t]=n,this.value=Ext.JSON.encode(i)))},getFName:function e(){return this.getValueProperty(UB.ux.UBDocument.valueProperties.fName)},setFName:function e(t){this.setValueProperty(UB.ux.UBDocument.valueProperties.fName,t)},getOrigName:function e(){return this.getValueProperty(UB.ux.UBDocument.valueProperties.origName)},setOrigName:function e(t){this.setValueProperty(UB.ux.UBDocument.valueProperties.origName,t)},getValue:function e(){return this.value},loadContent:function e(t,n,i){var r=this;return r.bypassCache&&(t+="&_dc="+(new Date).getTime()),$App.connection.get(t,{responseType:"arraybuffer"}).then(function(e){return i?{data:e.data,type:r.documentMIME||e.headers("content-type")||n}:new Blob([e.data],{type:r.documentMIME||e.headers("content-type")||n})},function(e){throw 401!==e.status?(r.onContentNotFound(),new UB.UBAbortError):e})},setContent:function e(t,n){var r=this;if(!r.documentMIME)throw Error('This method support only  if "documentMIME" property has value true.');return!1!==n&&(n=!0),r.ubCmp||(r.createComponent(r.documentMIME),n=!0),t&&"object"===(void 0===t?"undefined":i(t))&&(t instanceof Blob||t instanceof File)?r.ubCmp.setSrc({blobData:t,resetOriginalValue:n}).then(function(e){return t instanceof File&&r.setOrigName(t.name),e}):r.ubCmp.setSrc({rawValue:t,resetOriginalValue:n})||Promise.resolve(!0)},setValue:function e(t,n,r,o){function a(e,t,n){s.sourceBlob=e,s.loadUrl=t,s.ubCmp.isHidden()&&s.ubCmp.show(),s.errorLabel&&s.errorLabel.hide();var i={url:t,contentType:n,html:!h||h.deleting?d:h.origName||d,blobData:e};!s.forceReload&&s.editorInited&&s.isEditor()?l.resolve(null):(s.ubCmp.setSrc(i).then(function(e){l.resolve(e)},function(e){l.reject(e)}),s.editorInited=s.isEditor())}var s=this,l=Q.defer(),u=void 0,c=void 0,d=void 0,f=void 0,h={},p=!1,m="string"==typeof t,g=t&&"object"===(void 0===t?"undefined":i(t));return s.lastNotEmptyValue=t||s.lastNotEmptyValue,s.lastOriginalValue=t,s.instanceID=n,h=m?JSON.parse(t):t,!m&&!g||m&&0===t.length||g&&(!t.ct||!t.origName||t.deleting)?(p=!0,s.documentMIME?u=s.documentMIME:(u="UB.ux.UBLabel",d=UB.i18n("emptyContent"))):(u=s.expanded?h.ct:"UB.ux.UBLink",f={entity:s.entityName,attribute:s.attributeName,ID:s.instanceID},h.store&&(f.store=h.store),h.filename&&(f.filename=h.filename),h.origName&&(f.origName=h.origName),h.isDirty&&(f.isDirty=h.isDirty),s.useRevision&&!Ext.isEmpty(h.revision)&&(f.revision=h.revision),f.filename||(f.filename=s.entityName+s.instanceID+s.attributeName),d=Ext.String.urlAppend($App.connection.baseURL+"getDocument",Ext.Object.toQueryString(f))),s.originalMIME=s.originalMIME||u,u=s.documentMIME||u,s.value=Ext.Object.getSize(h)>0?JSON.stringify(h):void 0,s.checkChange(),"application/word"===u||"application/excel"===u?(s.createComponent(u),void s.ubCmp.setSrc({url:d,contentType:u,html:!h||h.deleting?d:h.origName||d,blobData:null}).then(function(){l.resolve(null)},function(e){!e||e instanceof UB.UBAbortError?l.resolve(null):l.reject(e)}).finally(function(){s.getEl()&&s.getEl().unmask()})):("UB.ux.UBLink"===u||p&&0!==Ext.Object.getSize(h)?(s.createComponent(u),a(null,d,u)):0===Ext.Object.getSize(h)?(s.createComponent(u),s.ubCmp.initNewSrc&&(s.value=s.ubCmp.initNewSrc()),l.resolve(null)):o&&!h.deleting?(s.createComponent(o.type),a(o,d,u)):(s.getEl()&&s.getEl().mask(UB.i18n("loadingData")),s.loadContent(d,u).then(function(e){c=e.type,s.createComponent(c),a(e,d,c),s.getEl()&&s.getEl().unmask()},function(e){s.getEl()&&s.getEl().unmask(),!e||e instanceof UB.UBAbortError?l.resolve(null):l.reject(e)})),l.promise)},setComplexValue:function e(t){var n=this.attributeName,i=n.lastIndexOf("."),r=n.substring(0,i),o=n.substring(i+1,n.length),a=t.get(r),s=this.entityName;this.entityName=$App.domainInfo.get(s).attr(r).associatedEntity,this.attributeName=o;var l=this.setValue(t.get(n),a,!0);return this.attributeName=n,this.entityName=s,l},resetOriginalValue:function e(){this.originalValue=this.getValue(),this.ubCmp&&"function"==typeof this.ubCmp.resetOriginalValue&&this.ubCmp.resetOriginalValue(),this.checkDirty()},isDirty:function e(){return!this.readOnly&&(this.isContentDirty()||!this.isEqual(this.getValue(),this.originalValue))},isContentDirty:function e(){return!(!this.ubCmp||"function"!=typeof this.ubCmp.isDirty)&&this.ubCmp.isDirty()},isEditor:function e(){var t=this.contentXType,n=UB.ux.UBDocument.editors,i=!1;return Ext.Object.each(n,function(e,n){return t!==n||(i=!0,!1)},this),i},existData:function e(){var t=void 0;return this.ubCmp&&this.ubCmp.getValue?t=this.ubCmp.getValue("UBDocument"):this.sourceBlob&&(t=this.sourceBlob.data),!!t},save:function e(t){var n=this;if(!(t||n.isEditor()&&n.isDirty()))return Promise.resolve(!0);var i=n.getValue()||n.lastNotEmptyValue;i&&(i=JSON.parse(i));var r=void 0;n.ubCmp.getValue?r=n.ubCmp.getValue("UBDocument"):n.sourceBlob&&(r=n.sourceBlob.data);var o=void 0;return o=!r&&n.loadUrl?n.loadContent(n.loadUrl,null,!0):Promise.resolve(r),o.then(function(e){var t="UBOnlyOffice"===n.ubCmp.xtype?"setOnlyOfficeDocumentToTempStore":"setDocument";return $App.connection.post(t,e,{params:{entity:n.entityName,attribute:n.attributeName,ID:n.instanceID,filename:n.documentFileName||(i&&i.origName?i.origName:n.documentMIME&&n.documentMIME.indexOf("/")<n.documentMIME.length-1?"newfile."+n.documentMIME.substr(n.documentMIME.indexOf("/")+1):"")},headers:{"Content-Type":"application/octet-stream"}})}).then(function(e){var t=e.data;return n.ubCmp.resetOriginalValue&&n.ubCmp.resetOriginalValue(),n.value=Ext.isObject(t.result)?JSON.stringify(t.result):t.result,!0})},onSave:function e(t,n,i){var r=JSON.parse(t);r.success?(this.ubCmp.resetOriginalValue(),this.value=Ext.JSON.encode(r.result)):UB.showErrorWindow(r.errMsg,r.errCode,this.entityName),Ext.callback(n,i,[r.success])},setMIME:function e(t){this.forceMIME=t||"",this.setValue(this.lastOriginalValue,this.instanceID,!0)},disableActions:function e(t){this.action&&this.action.each(function(e){e.menu.items.each(function(e){var n=UB.view.BasePanel.eventId,i=e.eventId;i!==n.scan&&i!==n.attach&&i!==n.deleteattachment||e[t?"disable":"enable"](t)})})},setReadOnly:function e(t){this.readOnly=t,this.ubCmp&&this.ubCmp.setReadOnly&&this.ubCmp.setReadOnly(t),this.disableActions(t)},disable:function e(){this.setDisable(!0)},enable:function e(){this.setDisable(!1)},setDisable:function e(t){this.disabled=!!t,this.disableActions(t)}})},function(e,t,n){n(36),Ext.define("UB.ux.PDFComponent",{extend:"UB.ux.UBObject",alias:"widget.ubpdf",type:"application/pdf",constructor:function e(){this.useBlobForData=!0,this.dataBlob=null,this.dataUrl=null,this.objUrl=null,this.data=null,this.callParent(arguments)},getElConfig:function e(){var t=this.callParent(),n;return t.cn=[n={tag:"div"}],n.width=this.width,n.height=this.height,t},afterRender:function e(){var t=this;t.callParent(arguments),t.data&&t.afterSetUrl()},useBlobForData:!0,getDataBlob:function e(){var t=this;return t.useBlobForData||Ext.Error.raise("object does not use Blob"),t.dataBlob},updateDataBlob:function e(t){var n=this;n.useBlobForData||Ext.Error.raise("object does not use Blob"),n.dataBlob&&!Ext.isEmpty(this.objUrl)&&window.URL.revokeObjectURL(this.objUrl),n.data=null,n.dataBlob=t,n.objUrl=window.URL.createObjectURL(t),n.data=n.objUrl+"#view=Fit"},onDestroy:function e(){var t=this;t.dataBlob=null,t.data=null,t.useBlobForData&&!Ext.isEmpty(t.objUrl)&&window.URL.revokeObjectURL(t.objUrl),t.objUrl=null,this.callParent()},updateDataUrl:function e(){var t=this.data;this.data="",this.data=t},afterSetUrl:function e(){var t,n=this,i={tag:"iframe",type:n.type,src:n.data,width:n.width,height:n.height};(t=n.getEl())&&t.setHTML("").appendChild(i)},setSrc:function e(t){var n=this,i=t.url,r=t.blobData;if(n.dataUrl=i,n.useBlobForData){if(!r)return $App.connection.get(n.dataUrl,{responseType:"arraybuffer"}).then(function(e){var t=e.data;n.updateDataBlob(new Blob([t],{type:"application/pdf"})),n.afterSetUrl()}).catch(function(e){401!==e.status&&(t.onContentNotFound?t.onContentNotFound():UB.showErrorWindow('<span style="color: red">'+UB.i18n("documentNotFound")+"<span/>"))}).then();n.updateDataBlob(r),n.afterSetUrl()}else n.data=n.dataUrl,n.afterSetUrl();return Q.resolve(!0)}})},function(e,t){Ext.define("UB.ux.UBImg",{extend:"Ext.Img",alias:"widget.ubimg",constructor:function e(){this.useBlobForData=!0,this.dataBlob=null,this.dataUrl=null,this.objUrl=null,this.callParent(arguments)},useBlobForData:!0,updateDataBlob:function e(t){var n=this;n.useBlobForData||Ext.Error.raise("object does not use Blob"),n.dataBlob&&!Ext.isEmpty(this.objUrl)&&window.URL.revokeObjectURL(this.objUrl),n.data=null,n.dataBlob=t,n.objUrl=window.URL.createObjectURL(t),n.data=n.objUrl},onDestroy:function e(){var t=this;t.dataBlob=null,t.data=null,t.useBlobForData&&!Ext.isEmpty(t.objUrl)&&window.URL.revokeObjectURL(t.objUrl),t.objUrl=null,this.callParent()},setSrc:function e(t){var n=this,i=t.url,r=t.blobData;if(n.dataUrl=i,n.useBlobForData){if(!r)return $App.connection.get(n.dataUrl,{responseType:"arraybuffer"}).then(function(e){var i=e.data;return t.blobData=new Blob([i],{type:t.contentType}),n.setSrc(t)}).catch(function(e){return 404===e.status&&(t.onContentNotFound?t.onContentNotFound():UB.showErrorWindow('<span style="color: red">'+UB.i18n("documentNotFound")+"<span/>")),e});n.updateDataBlob(r),n.callParent([n.data])}else n.data=n.dataUrl,n.callParent([n.data]);return Q.resolve(!0)}})},function(e,t){Ext.define("UB.ux.UBLink",{extend:"Ext.Component",alias:"widget.ublink",autoEl:"a",href:"javascript:;",html:"",target:"_blank",getElConfig:function e(){var t=this.callParent(),n,i=this;return"a"===this.autoEl?n=t:t.cn=[n={tag:"a",target:"_blank",id:this.id+"-a"}],n.href="javascript:;",n.target=n.target||this.target,n.style=n.style||{},n.style.wordBreak="break-all",t},onRender:function e(){var t,n=this;this.callParent(arguments),t=this.el,t.on("click",function(){n.useBlobForData?$App.connection.get(n.dataUrl,{responseType:"arraybuffer"}).then(function(e){var t,i=e.data;t=new Blob([i],{type:n.srcConfig.contentType}),saveAs(t,n.srcConfig.html||(n.srcConfig.params?n.srcConfig.params.origName:""))}).catch(function(e){404===e.status&&(n.html='<span style="color: red">'+UB.i18n("documentNotFound")+"<span/>",n.aEl&&(n.aEl.dom.innerHTML=n.html,n.aEl.dom.href="_blank"))}):$App.connection.authorize().then(function(e){n.dom.href=Ext.String.urlAppend(n.href,"session_signature="+e.signature())})}),this.aEl="a"===this.autoEl?t:t.getById(this.id+"-a")},setSrc:function e(t){var n=this.aEl,i=this;return i.dataUrl=t.url,i.srcConfig=t,i.html=t.html,i.aEl&&t&&(i.aEl.dom.download=t.html||(t.params?t.params.origName:"")),n&&(n.dom.innerHTML=t.html),Q.resolve(!0)},onDestroy:function e(){var t=this;Ext.destroy(t.aEl),t.aEl=null,this.callParent()}})},function(e,t){Ext.define("UB.ux.UBLabel",{extend:"Ext.form.Label",alias:"widget.ublabel",cls:"emptyDocument",setSrc:function e(t){return this.setText(t.html),Q.resolve(!0)}})},function(e,t,n){Ext.define("Ext.ux.form.TinyMCETextArea",{extend:"Ext.form.field.TextArea",alias:["widget.tinymce_textarea","widget.tinymce_field"],wysiwygIntialized:!1,intializationInProgress:!1,lastHeight:null,lastFrameHeight:null,noWysiwyg:!1,tinyMCEConfig:{},ensureTinyMCELoaded:function e(){return window.BOUNDLED_BY_WEBPACK=!1,n.e(0).then(n.bind(null,171))},afterRender:function e(){var t=this;t.callParent(arguments),t.on("blur",function(e,n,i){var r=document.getElementById(t.getInputId());if(t.wysiwygIntialized){var o=tinymce.get(t.getInputId());o&&o.isHidden()&&(r&&(t.positionBeforeBlur={start:r.selectionStart,end:r.selectionEnd}),o.load())}else r&&(t.positionBeforeBlur={start:r.selectionStart,end:r.selectionEnd})},t),t.on("resize",function(e,n,i){t.noWysiwyg||t.wysiwygIntialized?t.syncEditorHeight(i):t.initEditor(i)},t)},syncEditorHeight:function e(t){var n=this;if(n.lastHeight=t,n.wysiwygIntialized&&n.rendered){var i=tinymce.get(n.getInputId());if(i&&!i.isHidden()){var r=Ext.get(n.getInputId()+"_ifr");if(r){var o=r.up(".mce-edit-area");o=o.up(".mce-container-body");var a=t,s=o.down(".mce-toolbar-grp");s&&(a-=s.getHeight());var l=o.down(".mce-menubar");l&&(a-=l.getHeight());var u=o.down(".mce-statusbar");return u&&(a-=u.getHeight()),n.lastFrameHeight=a-3,r.setHeight(a-3),a-3}}}},initEditor:function e(t){var n=this;if(!(n.noWysiwyg||n.intializationInProgress||n.wysiwygIntialized)){if(n.intializationInProgress=!0,n.tinyMCEConfig){var i=n.tinyMCEConfig;n.tinyMCEConfig={},Ext.Object.merge(n.tinyMCEConfig,i)}else n.tinyMCEConfig={};n.tinyMCEConfig.mode="exact",n.tinyMCEConfig.resize=!1,n.tinyMCEConfig.elements=n.getInputId(),n.lastFrameHeight?n.tinyMCEConfig.height=n.lastFrameHeight:n.tinyMCEConfig.height=30,n.readOnly&&(n.tinyMCEConfig.readonly=!0),n.isDisabled()&&(n.tinyMCEConfig.readonly=!0),n.labelEl&&n.labelEl.on("click",function(e,t,i){n.focus(!1)},n.labelEl);var r=null;n.tinyMCEConfig.setup&&(r=n.tinyMCEConfig.setup),n.tinyMCEConfig.setup=function(e){e.on("init",function(i){n.wysiwygIntialized=!0,n.intializationInProgress=!1;var r=e.setContent;e.setContent=function(){r.apply(e,arguments),e.fire("change",{})},t&&setTimeout(function(){n.syncEditorHeight(t)},200)}),e.on("change",function(t){var i=n.getValue(),r=e.getContent();e.save(),n.fireEvent("change",n,r,i,{}),n.validateOnChange&&n.validate()}),e.on("focus",function(e){var t=n.findParentByType("window");t&&t.toFront(!0)}),r&&r(e)},this.ensureTinyMCELoaded().then(function(){window.tinymce.init(n.tinyMCEConfig),n.intializationInProgress=!1})}},getEditor:function e(){var t=this;if(t.wysiwygIntialized)return tinymce.get(t.getInputId())},isEditorHidden:function e(){var t=this;if(!t.wysiwygIntialized)return!0;var n=tinymce.get(t.getInputId());return!n||n.isHidden()},showEditor:function e(){var t=this;if(t.storedCursorPosition=null,!t.wysiwygIntialized)return t.noWysiwyg=!1,void t.initEditor(t.getHeight());var n=tinymce.get(t.getInputId());n&&(n.show(),n.nodeChanged(),t.lastHeight&&t.syncEditorHeight(t.lastHeight),t.focus())},hideEditor:function e(){var t=this;if(t.wysiwygIntialized){var n=tinymce.get(t.getInputId());if(n){var i=n.selection.getNode();if(!i||"#document"===i.nodeName||"BODY"===i.nodeName||"body"===i.nodeName)return void n.hide();var r='<a id="_____sys__11223___"></a>';n.selection.collapse(!0),n.execCommand("mceInsertContent",0,r),n.hide();var o=document.getElementById(t.getInputId()),a=-1,s="";if(o&&(s=o.value,a=s.indexOf(r)),-1!==a){var l=RegExp(r,"g");s=s.replace(l,""),o.value=s,o.setSelectionRange&&(o.focus(),o.setSelectionRange(a,a))}}}},toggleEditor:function e(){var t=this;if(!t.wysiwygIntialized)return void t.showEditor();tinymce.get(t.getInputId()).isHidden()?t.showEditor():t.hideEditor()},removeEditor:function e(){var t=this;if(t.intializationInProgress)return t;if(!t.wysiwygIntialized)return t;var n=tinymce.get(t.getInputId());return n&&(n.save(),n.destroy(!1)),t.wysiwygIntialized=!1,t},reinitEditor:function e(t){var n=this;if(n.noWysiwyg||n.intializationInProgress)return n;if(n.tinyMCEConfig||(n.tinyMCEConfig={}),t||(t={}),Ext.apply(n.tinyMCEConfig,t),!n.wysiwygIntialized)return n;var i=!0,r=tinymce.get(n.getInputId());return r&&(i=r.isHidden(),r.save(),r.destroy(!1)),n.wysiwygIntialized=!1,i||n.initEditor(n.getHeight()),n},setValue:function e(t){var n=this,i=n.callParent(arguments);if(n.wysiwygIntialized){var r=tinymce.get(n.getInputId());r&&(r.load(),r.save())}return i},focus:function e(t,n){var i=this;if(i.isDisabled())return i;if(n)return isNaN(n)&&(n=10),setTimeout(function(){i.focus(t,!1)},n),i;if(!i.wysiwygIntialized)return i.callParent(arguments);var r=tinymce.get(i.getInputId());return!r||r.isHidden()?i.callParent(arguments):(i.callParent(arguments),r.focus(!0),i)},enable:function e(t){var n=this,i=n.callParent(arguments);return i?(n.tinyMCEConfig.readonly&&n.reinitEditor({readonly:!1}),i):i},disable:function e(t){var n=this,i=n.callParent(arguments);return i?(n.tinyMCEConfig.readonly||n.reinitEditor({readonly:!0}),i):i},setReadOnly:function e(t){var n=this,i=n.callParent(arguments);return t!==n.tinyMCEConfig.readonly&&n.reinitEditor({readonly:t}),i},storeCurrentSelection:function e(){var t=this,n=!1,i=tinymce.get(t.getInputId());t.wysiwygIntialized&&i&&!i.isHidden()&&(n=!0);var r=document.getElementById(t.getInputId());n?t.storedCursorPosition=i.selection.getBookmark("simple"):r&&(t.storedCursorPosition=t.positionBeforeBlur)},restoreCurrentSelection:function e(){var t=this;if(t.storedCursorPosition){var n=!1,i=tinymce.get(t.getInputId());t.wysiwygIntialized&&i&&!i.isHidden()&&(n=!0);var r=document.getElementById(t.getInputId());n?i.selection.moveToBookmark(t.storedCursorPosition):r&&r.setSelectionRange(t.storedCursorPosition.start,t.storedCursorPosition.end)}},insertText:function e(t){var n=this,i=!1,r=tinymce.get(n.getInputId());n.wysiwygIntialized&&r&&!r.isHidden()&&(i=!0);var o=document.getElementById(n.getInputId());if(i)r.focus(),r.execCommand("mceInsertContent",0,t);else if(o){o.focus();var a=o.selectionStart+t.length;o.value=o.value.slice(0,o.selectionStart)+t+o.value.slice(o.selectionEnd),o.setSelectionRange(a,a)}},beforeDestroy:function e(){var t=this,n=tinymce.get(t.getInputId());n&&n.destroy(!1)},renderActiveError:function e(){var t=this,n=t.getActiveError(),i=!!n,r=Ext.get(t.getInputId()+"_ifr");if(!r)return t.callParent(arguments);var o=tinymce.get(t.getInputId());if(!o)return t.callParent(arguments);var a=r.up(".mce-edit-area");if(!(a=a.up(".mce-container-body")))return t.callParent(arguments);if(!(a=a.up(".mce-tinymce")))return t.callParent(arguments);if(t.rendered&&!t.isDestroyed&&!t.preventMark){var s=function e(n){t.clearInvalid()};i?(a.addCls("tinymce-error-field"),o.on("keydown",s),o.on("change",s)):(a.removeCls("tinymce-error-field"),o.off("keydown",s),o.off("change",s))}return t.callParent(arguments)}})},function(e,t,n){Ext.define("UB.ux.UBCodeMirror",{extend:"Ext.Component",mixins:{field:"Ext.form.field.Field"},statics:{editorQTip:"<h5>Helpers</h5><ul><li>Ctrl+Q - code templates</li><li>Ctrl+Space - code competition</li><li>Ctrl+B - Beautify content</li></ul><h5>Search</h5><ul><li>Ctrl-F  - Start searching</li><li>Ctrl-G  - Find next</li><li>Shift-Ctrl-G - Find previous</li><li>Shift-Ctrl-F - Replace</li><li>Shift-Ctrl-R - Replace all</li><li>Alt-F - Persistent search (dialog does not autoclose, enter to find next, Shift-Enter to find previous)</li><li>Alt-G - Jump to line</li></ul><h5>Edit</h5><ul><li>Ctrl-A - Select the whole content of the editor</li><li>Ctrl-D - Deletes the whole line under the cursor</li><li>Ctrl-Z - Undo the last change</li><li>Ctrl-Y - Redo the last undone change</li><li>Ctrl-U - Undo the last change to the selection</li><li>Alt-Left / Alt-Right - Move the cursor to the start/end  of the line</li><li>Tab / Shift + Tab - If something is selected, indent/dedent it</li></ul>"},alias:"widget.ubcodemirror",border:1,codeMirrorInstance:void 0,codeSnippetsGetter:null,editorMode:"javascript",getValue:function e(){return this.codeMirrorInstance?this.codeMirrorInstance.getValue():this.rawValue},setValue:function e(t){this.rawValue=t,this.codeMirrorInstance&&(this.codeMirrorInstance.setValue(""+t),this.editorMode!==this.codeMirrorInstance.getOption("mode")&&this.codeMirrorInstance.setOption("mode",this.editorMode))},setSrc:function e(t){function n(e){return i.setValue(e),o&&(i.resetOriginalValue(),i.fireEvent("setOriginalValue",e,i)),e}var i=this,r=t.blobData,o=t.resetOriginalValue;return t.contentType&&t.contentType.endsWith("yaml")?this.editorMode="yaml":this.editorMode="javascript",r?new Promise(function(e,t){var i=new window.FileReader;i.addEventListener("loadend",function(){e(n(i.result))}),i.addEventListener("error",function(){t(n(i.error))}),i.readAsText(r)}):t.params?UB.core.UBService.getDocument(t.params).then(function(e){return n(e)}):Promise.resolve(n(t.rawValue))},initComponent:function e(){this.callParent(arguments)},onShowSnippets:function e(t){var n=this;n.codeSnippetsGetter&&t.showHint({hint:function e(){var i=t.getCursor(),r=t.options.tabSize||2,o=i.ch/r>1?"\t".repeat(i.ch/2):"";return{list:n.codeSnippetsGetter(o),from:CodeMirror.Pos(i.line,i.ch),to:CodeMirror.Pos(i.line,i.ch)}}})},doBeautify:function e(){var t=this;this.codeMirrorInstance&&n.e(2).then(n.bind(null,172)).then(function(e){var n=t.codeMirrorInstance.getValue();n=e.js_beautify(n,{indent_size:2,indent_char:" "}),t.codeMirrorInstance.setValue(n)})},listeners:{render:function e(){var t=this,i=this.getEl().dom,r=this;n.e(4).then(n.bind(null,173)).then(function(e){window.CodeMirror=e,e.commands.codeSnippets=e.showHint,t.codeMirrorInstance=t.editor=e(i,{mode:t.editorMode,value:t.rawValue||"",lineNumbers:!0,lint:_.assign({asi:!0},$App.connection.appConfig.uiSettings.adminUI.linter),readOnly:!1,tabSize:2,highlightSelectionMatches:{annotateScrollbar:!0},matchBrackets:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter","CodeMirror-lint-markers"],extraKeys:{"Ctrl-Space":"autocomplete","Ctrl-Q":t.onShowSnippets.bind(t),"Ctrl-B":t.doBeautify.bind(t)}});var n=document.createElement("i");n.style="position: absolute;right: 15px; z-index: 10000",n.className="fa fa-question fa-border fa-2x",i.firstChild.insertBefore(n,i.firstChild.firstChild),r.editorTip=Ext.create("Ext.tip.ToolTip",{target:n,html:UB.ux.UBCodeMirror.editorQTip}),r.on("destroy",function(){this.editorTip&&this.editorTip.destroy()},r),t.codeMirrorInstance.on("change",function(){r.checkChange()})})}}})},function(e,t,n){n(18);var i=n(1);Ext.define("UB.ux.UBReportEditor",{extend:"UB.ux.UBTinyMCETextArea",alias:"widget.ubreporteditor",statics:{portrait:{width:793},landscape:{width:1121},paste_postprocess:function e(t,n){UB.ux.UBReportEditor.filter_node(n.node)},possibleElement:{node:["table","thead","tbody","tr","td","img","div","p","hr","strong","em","big","span","font","li","ul","ol","blockquote","h1","h2","h3","h4","h5","h6","#comment","#text"],inlineInnerNode:["#comment","#text"],attributes:["style","data-mce-style","src","rowspan","colspan"],style:["font-family","font-weight","font-style","font-size","text-align","vertical-align","text-indent","list-style-type","list-style-position","background-color","width","height","border-style","border-top-style","border-bottom-style","border-right-style","border-left-style","border","border-width","border-top-width","border-bottom-width","border-right-width","border-left-width","padding","padding-top","padding-bottom","padding-right","padding-left","margin","margin-top","margin-bottom","margin-right","margin-left","disable-split","disableSplit","disablesplit","indissoluble-first-rows","indissoluble-end-rows","draw-border-onsplit","top-through-line"]},filter_node:function e(t){var n=[],i=void 0,r=void 0,o=void 0,a=void 0,s=void 0,l=void 0,u=void 0,c=void 0,d=void 0,f=void 0;if("table"===t.nodeName.toLowerCase()&&this.filter_table(t),t.attributes){for(i=t.attributes.length-1;i>=0;i--)o=t.attributes[i],this.possibleElement.attributes.indexOf(o.name.toLowerCase())<0&&t.removeAttribute(o.name);if((a=t.attributes.getNamedItem("style"))&&a.value){for(a=a.value.split(";"),i=0;i<a.length;i++)s=a[i],s&&(l=s.split(":")),2===l.length&&"string"==typeof l[0]&&this.possibleElement.style.indexOf(l[0].toLowerCase())>=0&&n.push(s);a.value=n.join(";")}}if(t.childNodes)for(i=0;i<t.childNodes.length;i++){if(u=t.childNodes[i],this.possibleElement.node.indexOf(u.nodeName.toLowerCase())<0){if(d=!0,u.childNodes)for(r=0;r<u.childNodes.length;r++)if(c=u.childNodes[r].nodeName.toLowerCase(),this.possibleElement.inlineInnerNode.indexOf(c)<0){d=!1;break}f=document.createElement(d?"SPAN":"DIV"),this.copyNodeParams(u,f),t.replaceChild(f,u),u=f}this.filter_node(u)}},copyNodeParams:function e(t,n){var i=void 0,r=void 0;t.attributes&&(r=t.attributes.getNamedItem("style"),i=r?r.value:null),i&&n.setAttribute("style",i),n.innerHTML=t.innerHTML},filter_table:function e(t){var n=[],r=void 0,o=void 0,a=t.attributes.getNamedItem("width");a&&(r=a.value),a=t.attributes.getNamedItem("style"),a?(n=a.value?a.value.split(";"):[],i.forEach(n,function(e){if(e){var t=e.split(":");if(2===t.length&&"width"===t[0].toLowerCase())return o=t[1],!1}})):(a=document.createAttribute("style"),t.attributes.setNamedItem(a)),o||(n.push("width:"+(r||"100%")),a.value=n.join(";"));var s=void 0;i.forEach(t.childNodes,function(e){if("tbody"===e.nodeName.toLowerCase())return s=e,!1}),s||(s=document.createElement("TBODY"),t.appendChild(s)),this.createSpanTableMap(s,[],[])},createSpanTableMap:function e(t,n,i){function r(e,t,n){if(!e.attributes)return n;var i=e.attributes.getNamedItem(t);return i?i.value||n:n}function o(e,t){return parseInt(r(e,t,0),10)}function a(e,t,n){if(e.attributes){var i=e.attributes.getNamedItem(t);i?i.value=n:(i=document.createAttribute(t),i.value=n,e.attributes.setNamedItem(i))}}for(var s=0,l=void 0,u=void 0,c=void 0,d=void 0,f=void 0,h=void 0,p=void 0,m=void 0,g=void 0,y=void 0,v=void 0,b=void 0,x=void 0,E=void 0,w=void 0,C=void 0,_=void 0,B=!1,U=0;U<t.childNodes.length;U++)n[U]=[],i[U]=[];x=0,b=t.childNodes.length;for(var I=0;I<b;I++)if(l=t.childNodes[I],"tr"===l.nodeName.toLowerCase()){if(x++,!B){for(u=0;u<l.childNodes.length;u++)y=l.childNodes[u],"td"===y.nodeName.toLowerCase()&&(w=o(y,"colspan"),w>1&&(s+=w-1),s++);B=!0}for(E=0,u=0,c=0;u<s;u++)if(i[I][u]||n[I][u])E++;else if(!(c>=l.childNodes.length)){for(y=l.childNodes[c];"td"!==y.nodeName.toLowerCase();)c++,y=l.childNodes[c];if(v=y,E++,w=o(y,"colspan",0),(C=o(y,"rowspan",0))>1)for(C-1+I>=b&&(C=b-I||1,a(y,"rowspan",C)),h=I+1,f=I+1;f<I+C&&h<t.childNodes.length;h++)if(_=t.childNodes[h],"tr"===_.nodeName.toLowerCase()){for(g=_.childNodes.length,m=0,p=0;p<g;p++)"td"===_.childNodes[p].nodeName.toLowerCase()&&(m++,m+=(o(_.childNodes[p],"colspan")||1)-1);for(g=n[f].length,p=0;p<g;p++)n[f][p]&&m++;if(m+((w||1)-1)>=s){C=f-I,a(y,"rowspan",C);break}f++}if(w>1){for(m=0,f=u;f<s;f++)n[I][f]||m++;w>m&&(w=m||1,a(y,"colspan",w))}if(C>1)for(var S=I+1;S<I+C;S++)if(n[S][u]=1,w>1)for(d=u+1;d<u+w;d++)i[S]||(i[S]=[]),i[S][d]=1;if(w>1)for(d=u+1;d<u+w;d++)i[I][d]=1;c++}E<s&&a(v,"colspan",s-E+1)}return{colCount:s,rowCount:x}}},pageWidth:793,setOrientation:function e(t){return("landscape"===t||"portrait"===t)&&(this.setWidth("landscape"===t?UB.ux.UBReportEditor.landscape.width:UB.ux.UBReportEditor.portrait.width),this.orientation=t,!0)},initComponent:function e(){Ext.getBody().getSize(),this.width=UB.ux.UBReportEditor.portrait.width,this.orientation="portrait",this.tinyMCEConfig=Ext.apply({convert_urls:!1,object_resizing:"img,table,p[class=isTopColontitle],p[class=isBottomColontitle]",toolbar1:"undo redo | bold italic underline | alignleft aligncenter alignright alignjustify | formatselect fontsizeselect | pageOrientation | Colontitle | borderL borderR borderT borderB borderE borderA | forecolor | bullist numlist outdent indent |",paste_postprocess:UB.ux.UBReportEditor.paste_postprocess},this.tinyMCEConfig||{}),this.tinyMCEConfig.reportEditor=this,this.lastFrameHeight="100%",this.callParent(arguments),this.tinyMCEConfig.plugins.push("paste"),this.tinyMCEConfig.plugins.push("templateEditor")},onStartSetup:function e(t){var n=this;t.on("change",function(e){n.updateSize()},n),this.callParent(arguments)},syncEditorHeight:function e(){this.callParent(arguments),this.updateSize()},updateSize:function e(){var t=50,n=Ext.get(this.getInputId()+"_ifr");if(!this.inResizing&&n&&n.dom&&n.dom.contentDocument){var i=this.getEditor();i.editorContainer&&i.contentAreaContainer&&(t=i.editorContainer.offsetHeight-i.contentAreaContainer.offsetHeight+50),this.inResizing=!0,this.setHeight(n.dom.contentDocument.body.offsetHeight+t),this.inResizing=!1}},setValue:function e(t){var n=this;if(n.valuesSpecialComments=null,t&&"string"==typeof t){var r=/(<!--@\w+?\s*".+?"-->)/gi,o=/(<!--%\w+?:(.+?)-->)/gi,a=t.match(r);a&&a.length>0&&(n.valuesSpecialComments=a.join("\r\n"),t=t.replace(r,"")),a=t.match(o),a&&a.length>0&&(i.forEach(a,function(e){var t=e.match(/<!--%(\w+?:.+?)-->/)[1];t=t.split(":"),"pageOrientation"===t[0]&&n.setOrientation(t[1])}),t=t.replace(o,""))}n.callParent([t])},getValue:function e(t){var n=this.callParent();return n="\x3c!--%pageOrientation:"+this.orientation+"--\x3e"+n,"UBDocument"===t&&this.valuesSpecialComments&&(n=this.valuesSpecialComments+n),n},isFocusableField:!0,isFocusable:function e(){return!this.readOnly}})},function(e,t,n){var i=n(37);Ext.define("UB.ux.UBMetaDiagram",{extend:"Ext.Panel",alias:"widget.UBMetaDiagram",width:"100%",height:"100%",layout:"fit",statics:{mixinPictures:{mStorage:'<i class="fa fa-database"></i>',dataHistory:'<i class="fa fa-clock-o"></i>',unity:'<i class="fa fa-toggle-off"></i>',tree:'<i class="fa fa-sitemap"></i>',fts:'<i class="fa fa-search"></i>',rls:'<i class="fa fa-tasks"></i>',als:'<i class="fa fa-table"></i>',aclRls:'<i class="fa fa-tasks">a</i>',audit:'<i class="fa fa-pencil-square-o"></i>',softLock:'<i class="fa fa-key"></i>',clobTruncate:"ct"}},initComponent:function e(){var t=this,n,r,o,a;t.addEvents("change"),t.items=t.items||[],t.initObjectTree(),Ext.EventManager.on(document,"mouseup",t.onmouseUpFunc,t),Ext.EventManager.on(document,"mousemove",t.onmousemoveFunc,t),t.idPrefix=Ext.id(null),t.containerId=n=t.idPrefix+"graph",r='<div id="'+n+'" class="graph-editor-holder" style="width: 100%; height: 100%;-moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;" tabindex="0"></div>',t.editPnl=Ext.create("Ext.panel.Panel",{region:"center",cls:"mx-graph-editor",flex:1,html:r,listeners:{boxready:function e(){i.initAndCall().then(function(){t.initMXEditor()})},resize:function e(){this.editor&&this.editor.graph&&this.editor.graph.sizeDidChange()},scope:t}}),t.toolbarId=n=t.idPrefix+"toolbar",o='<div id="'+n+'" tabindex="0"></div>',t.outlineId=n=t.idPrefix+"outline",a='<div id="'+n+'" ></div>',t.menuPnl=Ext.create("Ext.panel.Panel",{height:"100%",region:"west",split:!0,collapsible:!0,width:250,layout:{type:"border"},items:[{xtype:"tabpanel",region:"center",deferredRender:!1,split:!0,height:"auto",bodyStyle:"background:white;",items:[t.objectTree,{xtype:"panel",region:"center",autoRender:!0,title:UB.i18n("toolbar"),html:o,listeners:{boxready:function e(t){},scope:t}}]},{xtype:"panel",region:"south",split:!0,height:160,fit:2,html:a}]});var s=Ext.create("Ext.panel.Panel",{layout:{type:"border"},defaults:{split:!0},items:[t.menuPnl,t.editPnl]});t.items.push(s),t.callParent(arguments)},isDirty:function e(){return!!this.editor&&this.editor.isModified()},onmousemoveFunc:function e(t){var n=this;if(n.dragDropObj&&n.dragDropObj.dragElm){var i=t.getXY();Ext.get(n.dragDropObj.dragElm).position("absolute",n.dragDropObj.dragElm.style.zIndex,i[0],i[1])}},onmouseUpFunc:function e(t){var n=this,i,r,o;if(n.dragDropObj&&n.graphDivEl){if(n.dragDropObj.dragElm&&n.dragDropObj.dragElm.parentNode.removeChild(n.dragDropObj.dragElm),i=t.getX(),r=t.getY(),n.graphDivEl.getX()>i||n.graphDivEl.getX()+n.graphDivEl.getWidth()<i||n.graphDivEl.getY()>r||n.graphDivEl.getY()+n.graphDivEl.getHeight()<r)return void(n.dragDropObj=null);i=mxEvent.getClientX(t.browserEvent),r=mxEvent.getClientY(t.browserEvent),o=mxUtils.convertPoint(n.editor.graph.container,i,r),n.addObjectToDiagram(o,n.dragDropObj),n.dragDropObj=null}},addObjectToDiagram:function e(t,n){var i=this,r,o,a,s,l={},u,c,d=n.objectName,f=!1,h;if(Ext.Object.each(i.editor.graph.model.cells,function(e,t){var n=t.getAttribute("objectCode");return!n||(d.toUpperCase()===n.toUpperCase()?(f=!0,!1):void 0)},i),f)return $App.dialogError("Object exist in diagram").done(),!1;o=mxUtils.createXmlDocument(),a=o.createElement("ubObject"),a.setAttribute("label",d),a.setAttribute("objectCode",d),r=new mxCell(a,new mxGeometry(0,0,187,147),"verticalAlign=top;align=left;overflow=fill;html=1"),r.vertex=!0,s=$App.domainInfo.get(d),i.editor.addVertex(null,r,t.x,t.y),s.eachAttribute(function(e,t){if(Ext.String.startsWith(t,"mi_",!0))return!0;"Entity"===e.dataType&&"ID"!==t.toUpperCase()&&(h=l[e.associatedEntity],h||(l[e.associatedEntity]=h=[]),h.push({linkType:"relation",srcObj:d,srcProp:t,destObj:e.associatedEntity,destProp:"ID"}))}),s.mixins&&s.mixins.unity&&(h=l[s.mixins.unity.entity],h||(l[s.mixins.unity.entity]=h=[]),h.push({linkType:"inheritage",srcObj:d,srcProp:"ID",destObj:s.mixins.unity.entity,destProp:"ID"})),Ext.Object.each(i.editor.graph.model.cells,function(e,t){var n=t.getAttribute("objectCode");return!n||(!(u=$App.domainInfo.get(n))||(u.mixins&&u.mixins.unity&&u.mixins.unity.entity===d&&(c={linkType:"inheritage",srcObj:n,srcProp:"ID",destObj:d,destProp:"ID"},i.editor.graph.addEdge(i.createEdge(c),null,t,r)),l[n]&&Ext.Array.each(l[n],function(e){i.editor.graph.addEdge(i.createEdge(e),null,r,t)},i),void(n!==d&&u.eachAttribute(function(e,o){if(Ext.String.startsWith(o,"mi_",!0))return!0;"Entity"===e.dataType&&"ID"!==o.toUpperCase()&&e.associatedEntity===d&&(c={linkType:"relation",srcObj:n,srcProp:o,destObj:d,destProp:"ID"},i.editor.graph.addEdge(i.createEdge(c),null,t,r))}))))},i)},createEdge:function e(t){var n,i,r;return i=mxUtils.createXmlDocument(),r=i.createElement("ubObject"),r.setAttribute("linkType",t.linkType),r.setAttribute("srcObj",t.srcObj),r.setAttribute("srcProp",t.srcProp),r.setAttribute("destObj",t.destObj),r.setAttribute("destProp",t.destProp),"relation"===t.linkType&&(n=new mxCell(r,new mxGeometry(0,0,0,0),"endArrow=open;endSize=10;startArrow=diamondThin;startSize=10;startFill=0;edgeStyle=orthogonalEdgeStyle;"),n.geometry.setTerminalPoint(new mxPoint(0,0),!0),n.geometry.setTerminalPoint(new mxPoint(80,0),!0),n.geometry.setTerminalPoint(new mxPoint(160,0),!1),n.edge=!0),"inheritage"===t.linkType&&(n=new mxCell(r,new mxGeometry(0,0,0,0),"endArrow=block;endSize=10;endFill=0;startArrow=oval;startFill=0;startSize=7;edgeStyle=segmentEdgeStyle;fillColor=#0B31D9;strokeColor=#0B31D9;"),n.geometry.setTerminalPoint(new mxPoint(0,0),!0),n.geometry.setTerminalPoint(new mxPoint(80,0),!0),n.geometry.setTerminalPoint(new mxPoint(160,0),!1),n.edge=!0),n},initObjectTree:function e(){var t,n=this,i,r=[],o={};$App.domainInfo.eachEntity(function(e,t){var n=e.modelName,i=o[n];i?i.children.push({text:t,leaf:!0,icon:null,objCode:t}):(i={text:n,expanded:!1,children:[],icon:null},o[n]=i,r.push(i),i.children.push({text:t,leaf:!0,icon:null,objCode:t}))}),t={root:{expanded:!0,children:r}},i=Ext.create("Ext.data.TreeStore",t),n.objectTree=Ext.create("Ext.tree.Panel",{title:UB.i18n("entities"),flex:1,singleExpand:!0,region:"north",store:i,rootVisible:!1,listeners:{itemmousedown:function e(t,i,r,o,a){if(i.isLeaf()){var s,l,u,c,d;s=document.createElement("DIV"),d=n.getContainer().getEl(),document.documentElement.appendChild(s),l=Ext.get(s),u=Ext.get(r),s.style.border="1px solid black",s.style.opacity=1,s.style.backgroundColor="white",l.setWidth(u.getWidth()),l.setHeight(u.getHeight()),c=a.getXY(),l.position("absolute",d.dom.style.zIndex+2,c[0],c[1]),n.dragDropObj={objectName:i.get("text"),dragElm:s}}},scope:n}})},useBlobForData:!0,getDataBlob:function e(){var t=this;return t.useBlobForData||Ext.Error.raise("object does not use Blob"),t.dataBlob},updateDataBlob:function e(t){var n=this;n.useBlobForData||Ext.Error.raise("object does not use Blob"),n.dataBlob&&!Ext.isEmpty(this.objUrl)&&window.URL.revokeObjectURL(this.objUrl),n.data=null,n.dataBlob=t,n.objUrl=window.URL.createObjectURL(t),n.data=n.objUrl},onDestroy:function e(){var t=this;t.dataBlob=null,t.data=null,t.useBlobForData&&!Ext.isEmpty(t.objUrl)&&window.URL.revokeObjectURL(t.objUrl),t.objUrl=null,this.callParent()},setSrc:function e(t){var n=this,i=t.url,r=t.blobData,o;return o=function e(){if(n.changeFired=!0,n.editor){n.isInitEditor=!0;try{n.editor.open(n.objUrl)}finally{n.isInitEditor=!1}n.validateDiagram(),n.editor.setMode("select")}n.changeFired=!1},n.dataUrl=i,n.useBlobForData?r?(n.updateDataBlob(r),o(),Q.resolve(!0)):$App.connection.get(n.dataUrl,{responseType:"arraybuffer"}).then(function(e){var i,r=e.data;i=new Blob([r],{type:t.contentType}),n.updateDataBlob(i),o()}).fail(function(e){404===e.status&&(t.onContentNotFound?t.onContentNotFound():UB.showErrorWindow('<span style="color: red">'+UB.i18n("documentNotFound")+"<span/>"))}):(n.objUrl=n.dataUrl,o(),Q.resolve(!0))},validateDiagram:function e(){var t=this,n=t.editor.graph,i,r,o,a,s,l,u,c,d,f,h={},p,m={},g,y;Ext.Object.each(t.editor.graph.model.cells,function(e,t){if(!(o=t.getAttribute("objectCode")))return!0;m[o.toLowerCase()]=t}),Ext.Object.each(t.editor.graph.model.cells,function(e,v){if(!(o=v.getAttribute("objectCode")))return!0;if(!(i=$App.domainInfo.get(o)))return t.editor.graph.removeCells([v],!0),!0;y=!1;for(var b=v.getEdgeCount()-1;b>-1;b--){switch(a=v.getEdgeAt(b),s=a.getAttribute("srcObj")||"",l=a.getAttribute("srcProp")||"",u=a.getAttribute("destObj")||"",c=a.getAttribute("destProp")||"",d=a.getAttribute("linkType")||"relation",g="inheritage"===d,p=!1,o){case s:f=i.attr(l),r=$App.domainInfo.get(u),g?(p=!f||!(i.mixins&&i.mixins.unity&&i.mixins.unity.entity===u),y=!p):p=!f||"Entity"!==f.dataType||"ID"===l.toUpperCase()||f.associatedEntity.toLowerCase()!==u.toLowerCase()||Ext.String.startsWith(l.toLowerCase(),"mi_",!0),p=p||!m[u.toLowerCase()],f&&(h[l]=f);break;case u:f=i.attr(c),p=!f,p=p||!m[s.toLowerCase()],r=$App.domainInfo.get(s);break;default:f=null,p=!0}if(r||(p=!0),p){n.model.beginUpdate();try{n.cellsRemoved([a])}finally{n.model.endUpdate()}}}if(!y&&i.mixins&&i.mixins.unity&&m[i.mixins.unity.entity]){var x={linkType:"inheritage",srcObj:o,srcProp:"ID",destObj:i.mixins.unity.entity,destProp:"ID"};t.editor.graph.addEdge(t.createEdge(x),null,v,m[i.mixins.unity.entity])}Ext.Object.each(i.attributes,function(e,n){if(Ext.String.startsWith(e,"mi_",!0))return!0;if("Entity"===n.dataType&&"ID"!==e.toUpperCase()&&m[n.associatedEntity.toLowerCase()]&&!h[e]){var i={linkType:"relation",srcObj:o,srcProp:e,destObj:n.associatedEntity,destProp:"ID"};t.editor.graph.addEdge(t.createEdge(i),null,v,m[n.associatedEntity.toLowerCase()])}})},t)},getContainer:function e(){return this.up("basewindow")||this.up("basepanel")},initMXEditor:function e(){var t=mxUtils.load("models/adminui-pub/resources/config/ubmetaeditor.xml").getDocumentElement(),n=this,i,r,o,a;a=n.getContainer(),n.editor=i=new mxEditor(t),r=i.graph,n.graphDivEl=Ext.get(n.containerId),o=n.graphDivEl.dom,i.setGraphContainer(o),new Ext.Element(i.toolbar.toolbar.container).up("div.mxWindow").remove(),Ext.get(n.toolbarId).dom.appendChild(i.toolbar.toolbar.container),i.keyHandler.handler.target=n.getEl().dom,mxEvent.addListener(i.keyHandler.handler.target,"keydown",i.keyHandler.handler.keydownHandler),i.keyHandler.handler.isGraphEvent=function(e){return n.isGraphEvent(e,this)},i.setModified=function(e){i.modified=e,e&&n.graphChanged()},r.popupMenuHandler.factoryMethod=mxUtils.bind(this,function(e,t,n){var r=a.getEl().dom;return e.div.parent=r,e.zIndex=r.style.zIndex+1,e.div.style.zIndex=r.style.zIndex+1,i.createPopupMenu(e,t,n)}),n.initGraph(),i.graph.cellsDisconnectable=!1,i.graph.cellsCloneable=!1,i.graph.allowDanglingEdges=!1,i.graph.disconnectOnMove=!1,i.showOutline();var s=new Ext.Element(i.outline.div).down("div.mxWindowPane");if(Ext.get(n.outlineId).appendChild(s),i.outline.setVisible(!1),i._showTasks=i.showTasks,i.tasks&&(i.tasks.destroy(),i.tasks=null),i.showTasks=Ext.Function.bind(n.showTasks,n),i.refreshTasks=Ext.Function.bind(n.refreshTasks,n),i.properties=null,i.showProperties=Ext.Function.bind(n.showProperties,n),i.hideProperties=Ext.Function.bind(n.hideProperties,n),i.addAction("edit",function(e,t){if(t){var r=t.getAttribute("objectCode");r?n.showEntityForm(r):i.graph.isEnabled()&&i.graph.isCellEditable(t)&&i.graph.startEditingAtCell(t)}}),r.getTooltipForCell=n.getTooltipForCell,r.tooltipHandler.zIndex=a.getEl().dom.style.zIndex+1,r.setResizeContainer(!0),new mxRubberband(r),r.setPanning(!0),r.setTooltips(!0),n.objUrl){n.isInitEditor=!0;try{n.editor.open(n.objUrl)}finally{n.isInitEditor=!1}}},showEntityForm:function e(t){var n=this,i,r,o,a,s,l,u;if(n.editEntityFrm||(i=Ext.create("Ext.data.Store",{fields:["code","caption","size","dataType","associatedEntity","accessType","allowNull","isUnique","defaultValue","allowSort"],data:{attributes:[{}]},proxy:{type:"memory",reader:{type:"json",root:"attributes"}}}),r=Ext.create("Ext.data.Store",{fields:["icon","code","enabled"],proxy:{type:"memory",reader:{type:"json",root:"mixins"}}}),n.editEntityFrm=Ext.create("UB.view.BaseWindow",{title:"Entity",height:500,width:600,closeAction:"hide",autoDestroy:!1,modal:!0,stateful:!0,stateId:"ubMetaDiagrm_entityform",layout:{type:"border"},items:[{xtype:"tabpanel",deferredRender:!1,region:"center",items:[{title:UB.i18n("AsT\u0430ble"),layout:{type:"border"},items:[u=Ext.create("Ext.grid.Panel",{tbar:["Search",{xtype:"textfield",name:"searchField",hideLabel:!0,width:200,listeners:{change:{fn:function e(){l(this)},buffer:100}}}],region:"center",split:!0,itemId:"colGrid",flex:1,title:UB.i18n("Attributes"),store:i,columns:[{text:UB.i18n("code"),dataIndex:"code"},{text:UB.i18n("caption"),dataIndex:"caption"},{text:UB.i18n("dataType"),dataIndex:"dataType"},{text:UB.i18n("size"),width:60,dataIndex:"size"},{text:UB.i18n("associatedEntity"),dataIndex:"associatedEntity"},{text:UB.i18n("accessType"),dataIndex:"accessType"},{text:UB.i18n("allowNull"),width:50,dataIndex:"allowNull"},{text:UB.i18n("isUnique"),width:50,dataIndex:"isUnique"},{text:UB.i18n("defaultValue"),dataIndex:"defaultValue"},{text:UB.i18n("allowSort"),width:50,dataIndex:"allowSort"}],listeners:{select:function e(t,i){var r=n.editEntityFrmEditor.selEntity.attributes[i.get("code")];a.setValue(i.get("code")+" =\n"+JSON.stringify(r,null,"\t"))},scope:n}}),{xtype:"ubcodemirror",mode:"application/x-javascript",itemId:"edtAttr",width:250,region:"east",showLineNumbers:!1,split:!0},{height:120,region:"south",layout:{type:"border"},split:!0,items:[{xtype:"gridpanel",region:"center",split:!0,itemId:"mixGrid",flex:1,title:UB.i18n("Mixins"),store:r,columns:[{text:"-",dataIndex:"icon"},{text:UB.i18n("code"),dataIndex:"code"},{text:UB.i18n("enabled"),dataIndex:"enabled"}],listeners:{select:function e(t,i){s.setValue(i.get("code")+" =\n"+JSON.stringify(n.editEntityFrmEditor.selEntity.mixins[i.get("code")],null,"\t"))},scope:n}},{xtype:"ubcodemirror",mode:"application/x-javascript",itemId:"edtMixin",width:250,region:"east",showLineNumbers:!1,split:!0}]}]},{itemId:"myEditor",xtype:"ubcodemirror",mode:"application/x-javascript",title:UB.i18n("AsJSON"),height:"100%",style:{background:"white"},hideLabel:!1}]}]}),n.editEntityFrmEditor=n.editEntityFrm.down("[itemId=myEditor]"),n.editEntityFrmEditor.fColGrd=n.editEntityFrm.down("[itemId=colGrid]"),n.editEntityFrmEditor.fmixGrid=n.editEntityFrm.down("[itemId=mixGrid]"),a=n.editEntityFrm.down("[itemId=edtAttr]"),s=n.editEntityFrm.down("[itemId=edtMixin]"),l=function e(t){var n=u.getStore(),i=t.getValue();n.clearFilter(!0);var r=RegExp(i,"i");n.filter([{filterFn:function e(t){return r.test(t.get("code"))||r.test(t.get("caption"))||r.test(t.get("dataType"))||r.test(t.get("associatedEntity"))||r.test(t.get("size"))||r.test(t.get("accessType"))}}])}),o=$App.domainInfo.get(t),n.editEntityFrmEditor.selEntity=o,o){n.editEntityFrmEditor.setValue(JSON.stringify(o,null,"\t"));var c=[];o.eachAttribute(function(e,t){var n=Ext.clone(e);n.code=t,c.push(n)});var d=[];Ext.Object.each(o.mixins,function(e,t){var n=Ext.clone(t);n.code=e,n.icon=UB.ux.UBMetaDiagram.mixinPictures[e]||e,d.push(n)}),n.editEntityFrm.setTitle(t),n.editEntityFrmEditor.fColGrd.getStore().loadRawData({attributes:c},!1),n.editEntityFrmEditor.fmixGrid.getStore().loadRawData({mixins:d},!1),n.editEntityFrm.down("[itemId=edtAttr]").setValue(" "),n.editEntityFrm.down("[itemId=edtMixin]").setValue(" "),n.editEntityFrm.show()}},isGraphEvent:function e(t,n){var i=mxEvent.getSource(t);if(i===n.target||i.parentNode===n.target||null!==n.graph.cellEditor&&i===n.graph.cellEditor.textarea)return!0;for(var r=i;null!==r;){if(r===n.target)return!0;r=r.parentNode}for(r=i;null!==r;){if(r===n.graph.container)return!0;r=r.parentNode}return!1},getTooltipForCell:function e(t){var n,i;if(n=t.getAttribute("objectCode"))try{return i=$App.domainInfo.get(n),i.caption+": "+i.description}catch(e){return'Unknown entity "'+n+'"'}if(n=t.getAttribute("srcProp"))return"relation"===(t.getAttribute("linkType")||"relation")?t.getAttribute("srcObj")+"."+n+" -> "+t.getAttribute("destObj")+"."+t.getAttribute("destProp"):t.getAttribute("srcObj")+" inherit "+t.getAttribute("destObj")},graphChanged:function e(){this.isInitEditor||this.fireEvent("change",this)},initGraph:function e(){var t=this,n=t.editor,i=n.graph;mxVertexHandler.prototype.rotationEnabled=!0,mxVertexHandler.prototype.manageSizers=!0,mxVertexHandler.prototype.livePreview=!0,i.graphHandler.guidesEnabled=!0,i.allowLoops=!0,i.isHtmlLabel=function(e){var t=i.view.getState(e),n=t?t.style:i.getCellStyle(e);return n.html+""=="1"||n.whiteSpace+""=="wrap"},i.cellRenderer.getLabelValue=function(e){var t=mxCellRenderer.prototype.getLabelValue.apply(i.cellRenderer,arguments);return e.style.whiteSpace+""=="wrap"&&e.style.html+""!="1"&&(t=mxUtils.htmlEntities(t,!1)),t},i.convertValueToString=function(e){return Ext.isString(e.value)?e.value:Ext.isEmpty(e.getAttribute("objectCode"))?e.getAttribute("label"):t.generateObjHtml(e)};var r=i.removeCells;i.removeCells=function(e,t){e||(e=i.getDeletableCells(i.getSelectionCells()));for(var n=e.length-1;n>-1;){e[n].getAttribute("srcProp")&&e.splice(n,1),n--}r.call(i,e,t)}},generateObjHtml:function e(t){var n=this,i,r,o,a,s;r=t.getAttribute("objectCode"),n.htmCache||(n.htmCache={}),o=['<table width="100%" height="100%" style=" -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;" >','<tr><td style="vertical-align: top;" ><div  >','<table style="width:100%;" >','<tr><td colspan="2" style="text-align:center; background:#C1D3F5;padding:2px;">',r,"</td></tr>"];try{i=$App.domainInfo.get(r),i.eachAttribute(function(e,t){if(Ext.String.startsWith(t,"mi_",!0))return!0;a="Entity"===e.dataType,s="Enum"===e.dataType?"Enum "+e.enumGroup:a?"<B>"+e.associatedEntity+"</B>":e.dataType,o.push("<tr><td>",t,'</td><td style="padding:2px;">',s,"</td></tr>")});var l=[];_.forEach(i.mixins,function(e,t){e.enabled&&l.push(UB.ux.UBMetaDiagram.mixinPictures[t]||t)}),l.length&&o.push('<tr><td colspan="2" style="text-align:center; background:#C1D3F5;padding:2px;">'+l.join("&nbsp")+"</td></tr>")}catch(e){o.push('<tr><td colspan="2">Unknown entity "'+r+'"</td></tr>')}return o.push("</table></div></td></tr></table>"),o.join("")},getMixinShortName:function e(t){return"mStorage"===t?"S":t.substr(0,1).toUpperCase()},refreshTasks:function e(t){var n=this;null!==this.tasks&&(n.taskEl.innerHTML="",n.taskEl.createTasks(t))},showTasks:function e(){var t=this,n,i=t.editor.graph,r,o;if(null===t.editor.tasks){var a=document.createElement("div");a.style.padding="4px",a.style.paddingLeft="20px",r=Ext.widget("panel",{border:!0,flex:1}),n=Ext.create("Ext.Window",{title:"Tasks",width:200,height:400,closable:!0,closeAction:"hide",autoDestroy:!1,layout:"fit",items:[r]}).show(),t.taskWnd=n,n.ownerCt=t,n.registerWithOwnerCt();var s=r.getEl().dom;document.getElementById(s.id+"-innerCt").appendChild(a),t.taskEl=o=a;var l=mxUtils.bind(t,function(){t.taskEl.innerHTML="",t.editor.createTasks(t.taskEl)});i.getModel().addListener(mxEvent.CHANGE,l),i.getSelectionModel().addListener(mxEvent.CHANGE,l),i.addListener(mxEvent.ROOT,l),t.editor.tasks=n,t.editor.createTasks(a)}t.taskWnd.show()},showProperties:function e(t){var n=this,i=n.editor;if(t=t||i.graph.getSelectionCell(),null===t&&null===(t=i.graph.getCurrentRoot())&&(t=i.graph.getModel().getRoot()),null!==t){i.graph.stopEditing(!0),i.hideProperties();var r=i.createProperties(t);if(null!==r){var o=Ext.widget("panel",{border:!0,flex:1}),a=Ext.create("Ext.Window",{title:"Properties",width:250,height:400,closable:!1,layout:"fit",items:[o]}).show();a.ownerCt=n,a.registerWithOwnerCt();var s=o.getEl().dom;document.getElementById(s.id+"-innerCt").appendChild(r),i.properties=a}}},hideProperties:function e(){var t=this,n=t.editor;null!==n.properties&&(n.properties.close(),n.properties=null)},beforeDestroy:function e(){var t=this;t.editor&&t.editor.destroy(),t.tasksWnd&&t.tasksWnd.destroy(),t.editEntityFrmEditor=null,t.editEntityFrm&&t.editEntityFrm.destroy(),Ext.EventManager.un(document,"onmouseup",t.onmouseUpFunc,t),Ext.EventManager.un(document,"onmousemove",t.onmousemoveFunc,t),t.callParent(arguments)},actionHandler:function e(t){this.editor.execute(t.mxAction)},getValue:function e(){var t=this,n=new mxCodec,i=n.encode(t.editor.graph.getModel());return mxUtils.getXml(i)},resetOriginalValue:function e(){return null}})},function(e,t,n){var i=n(37);Ext.define("UB.ux.UBOrgChart",{extend:"Ext.Panel",alias:"widget.UBOrgChart",width:"100%",height:"100%",layout:"fit",loadData:function e(){var t=this;return this.xmInitPromise.then(function(){var e=void 0,n=t.up("basepanel");if(n&&n.record&&(e=n.record.get("ID")),e)return UB.Repository("org_diagram").attrs(["ID","orgunitID"]).selectById(e).then(function(e){return e&&(t.rootElementID=e.orgunitID),!t.rootElementID||UB.Repository("org_unit").attrs(["ID","mi_treePath"]).selectById(t.rootElementID).then(function(e){return e&&(t.rootTreePath=e.mi_treePath),!0})})}).then(t.doLoadData.bind(t))},doLoadData:function e(){var t=this,n=UB.Repository("org_unit").attrs(["ID","parentID","code","caption","unitType","mi_treePath"]).orderBy("mi_treePath");return t.rootTreePath&&(n=n.where("[mi_treePath]","startWith",t.rootTreePath)),n.selectAsStore().then(t.makeTree.bind(t))},treeData:[],makeTree:function e(t){var n=this,i={},r,o,a,s;n.treeData=[];var l=function e(t,n){n.ID=t.get("ID"),n.parentID=t.get("parentID"),n.caption=t.get("caption"),n.code=t.get("code"),n.unitType=t.get("unitType")};t.each(function(e){r=e.get("ID"),o=e.get("parentID"),s=i[r],s||(s=i[r]={child:[]}),l(e,s),n.rootElementID&&n.rootElementID===r&&(o=null,s.parentID=null),o?(a=i[o],a||(a=i[o]={child:[]}),a.child.push(s)):n.treeData.push(s)},n),n.allData=i},showElement:function e(t,n,i){return this.addChild(this.graph,t,n,!0,i)},showChild:function e(t,n,i,r,o){var a=this,s,l;i||(l=a.graph.getModel(),l.beginUpdate());try{Ext.Array.each(n.child,function(e,n){s=a.showElement(t,e),i&&(!r||r>o)&&a.showChild(s,e,r,o+1)},a)}finally{i||l.endUpdate()}},defaultLayout:"V",showTree:function e(){var t=this,n,i=t.graph.getModel(),r=1,o=1,a=!0;1===t.treeData.length?t.addChild(t.graph,null,t.treeData[0]):t.initRoot(t.treeData),i.beginUpdate();try{1===t.treeData.length?t.showChild(t.rootVarex,!0,!0,2,1):Ext.Array.each(t.treeData,function(e,i){n=t.showElement(t.rootVarex,e)},t)}finally{i.endUpdate()}t.autoLayout(t.rootVarex,t.defaultLayout),t.changeFired=!1,t.undoManager.clear()},initComponent:function e(){var t=this,n,r,o;t.layout="fit",this.expandImage=$App.getImagePath("expandLG.png"),this.collapseImage=$App.getImagePath("collapseLG.png"),this.appendImage=$App.getImagePath("download.png"),t.initMetaInfo(),t.tbar=t.createToolBar(),t.idPrefix=Ext.id(),t.containerId=n=t.idPrefix+"graph",r='<div id="'+n+'" class="graph-editor-holder" style="width: 100%; height: 100%; background-color: white; overflow: scroll; -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;" tabindex="0"></div>',t.outlineId=n=t.idPrefix+"outline",o='<div id="'+n+'" style="width: 100%; height: 100%; overflow: scroll;" ></div>',t.outlineWnd=Ext.create("Ext.Window",{title:UB.i18n("Overview"),width:200,height:200,closable:!1,layout:"fit",constrain:!0,items:[{html:o}]}),t.xmInitPromise=new Promise(function(e,n){t.mainPnl=Ext.create("Ext.panel.Panel",{flex:1,html:r,items:[t.outlineWnd,{xtype:"text",text:"text",degrees:90}],listeners:{boxready:function r(){i.initAndCall().then(function(){t.initGraph(),e(t)}).catch(function(e){return n(e)})},resize:function e(){t.graph&&t.graph.sizeDidChange()},scope:t}})}),t.items||(t.items=[]),t.items.push(t.mainPnl),t.callParent(arguments),t.isLoadContent=!1},beforeDestroy:function e(){this.outlineWnd&&this.outlineWnd.destroy(),this.toolbarWnd&&this.toolbarWnd.destroy(),this.rubberband&&this.rubberband.destroy(),this.keyHandler&&this.keyHandler.destroy(),this.toolbar&&this.toolbar.destroy(),this.outline&&this.outline.destroy(),this.graph&&this.graph.destroy(),this.callParent(arguments)},initGraph:function e(){var t=this,n,i,r,o,a,s,l;t.graphDivEl=Ext.get(t.containerId),s=t.up("basewindow")||$App.getViewport(),l=s.getEl().dom.style.zIndex||1,n=t.graphDivEl.dom,n.style.position="absolute",n.style.overflow="hidden",n.style.left="0px",n.style.top="0px",n.style.right="0px",n.style.bottom="0px";var u=t.mainPnl.getBox();t.outlineWnd.showAt(u.width-t.outlineWnd.width,0),t.outlineWnd.setXY([u.right-t.outlineWnd.width,u.top]),r=document.getElementById(t.outlineId),mxEvent.disableContextMenu(n),new mxDivResizer(n),new mxDivResizer(r),t.graph=i=new mxGraph(n),i.setCellsMovable(!0),i.setAutoSizeCells(!0),i.setPanning(!0),i.setTooltips(!0),i.centerZoom=!1,i.panningHandler.useLeftButtonForPanning=!0,i.panningHandler.selectOnPopup=!1,i.panningHandler.panningEnabled=!0,i.cellsDisconnectable=!1,i.cellsCloneable=!1,i.allowDanglingEdges=!1,i.disconnectOnMove=!1,i.gridEnabled=!1,t.isGraphChanged=!1,i.getModel().addListener(mxEvent.CHANGE,function(){t.graphChanged()}),t.installDblClickHandler(i),t.rubberband=new mxRubberband(i),t.outline=new mxOutline(i,r),i.setTooltips(!mxClient.IS_TOUCH),i.tooltipHandler.zIndex=l+100,t.undoManager=new mxUndoManager,t.installUndoHandler(i),i.setHtmlLabels(!0),o=i.getStylesheet().getDefaultVertexStyle(),o[mxConstants.STYLE_SHAPE]="label",o[mxConstants.STYLE_WHITE_SPACE]="wrap",o[mxConstants.STYLE_VERTICAL_ALIGN]=mxConstants.ALIGN_MIDDLE,o[mxConstants.STYLE_ALIGN]=mxConstants.ALIGN_LEFT,o[mxConstants.STYLE_SPACING_LEFT]=4,o[mxConstants.STYLE_GRADIENTCOLOR]="#7d85df",o[mxConstants.STYLE_STROKECOLOR]="#5d65df",o[mxConstants.STYLE_FILLCOLOR]="#adc5ff",o[mxConstants.STYLE_FONTCOLOR]="#1d258f",o[mxConstants.STYLE_FONTFAMILY]="Verdana",o[mxConstants.STYLE_FONTSIZE]="10",o[mxConstants.STYLE_FONTSTYLE]="1",o[mxConstants.STYLE_SHADOW]="1",o[mxConstants.STYLE_ROUNDED]="1",o[mxConstants.STYLE_GLASS]="1",o[mxConstants.STYLE_SPACING]=12,o=Ext.clone(o),o[mxConstants.STYLE_GRADIENTCOLOR]="#7DDF94",o[mxConstants.STYLE_STROKECOLOR]="#5DDF71",o[mxConstants.STYLE_FILLCOLOR]="#ADFFBD",i.getStylesheet().putCellStyle("org_staffunit",o),o=Ext.clone(o),o[mxConstants.STYLE_GRADIENTCOLOR]="#D5DF7D",o[mxConstants.STYLE_STROKECOLOR]="#D2DF5D",o[mxConstants.STYLE_FILLCOLOR]="#F7FFAD",i.getStylesheet().putCellStyle("org_department",o),o=Ext.clone(o),o[mxConstants.STYLE_GRADIENTCOLOR]="#7d85df",o[mxConstants.STYLE_STROKECOLOR]="#5d65df",o[mxConstants.STYLE_FILLCOLOR]="#adc5ff",i.getStylesheet().putCellStyle("org_organization",o),o=i.getStylesheet().getDefaultEdgeStyle(),o[mxConstants.STYLE_ROUNDED]=!0,o[mxConstants.STYLE_STROKEWIDTH]=3,o[mxConstants.STYLE_EDGE]=mxEdgeStyle.OrthConnector,t.keyHandler=new mxKeyHandler(i),a=new mxCompactTreeLayout(i,!1),a.useBoundingBox=!1,a.edgeRouting=!1,a.levelDistance=60,a.nodeDistance=16,a.isVertexMovable=function(e){return!0},t.verticalLayout=a,a=new mxCompactTreeLayout(i,!0),a.useBoundingBox=!1,a.edgeRouting=!1,a.levelDistance=60,a.nodeDistance=16,a.isVertexMovable=function(e){return!0},t.horisontalLayout=a,i.popupMenuHandler.factoryMethod=function(e,n,r){var o=s.getEl().dom,a=o.style.zIndex||9999999999999;return e.div.parent=o,e.zIndex=a+1,e.div.style.zIndex=a+1,t.createPopupMenu(i,e,n,r)};var c=i.getPreferredSizeForCell;i.getPreferredSizeForCell=function(e){var t=c.apply(this,arguments);return null!==t&&(t.width=Math.max(120,t.width-40)),t},i.cellRenderer.getTextScale=function(e){return Math.min(1,e.view.scale)},i.convertValueToString=function(e){return Ext.isString(e.value)?e.value:e.getAttribute("label")},i.getPreferredSizeForCell=Ext.bind(t.getPreferredSizeForCell,i),t.graph&&t.dataUrl&&!t.isActulData&&t.startLoadData().done(function(e){t.loadDataDefer&&t.loadDataDefer.resolve(e)},function(e){t.loadDataDefer.reject(e)})},installUndoHandler:function e(t){var n=mxUtils.bind(this,function(e,t){var n=t.getProperty("edit");this.undoManager.undoableEditHappened(n)});t.getModel().addListener(mxEvent.UNDO,n),t.getView().addListener(mxEvent.UNDO,n);var i=function e(n,i){var r=i.getProperty("edit").changes;t.setSelectionCells(t.getSelectionCellsForChanges(r))};this.undoManager.addListener(mxEvent.UNDO,i),this.undoManager.addListener(mxEvent.REDO,i)},initRoot:function e(){var t=this,n,i=t.graph,r,o,a,s;if(n=i.getDefaultParent(),i&&i.container){i.getModel().beginUpdate();try{a=mxUtils.createXmlDocument(),s=a.createElement("ubOrgChart"),s.setAttribute("label",UB.i18n("Organization")),s.setAttribute("unitType","ORG"),s.setAttribute("isRoot",!0),r=i.container.offsetWidth,o=i.insertVertex(n,"treeRoot",s,r/2-30,20,140,60),i.updateCellSize(o),t.addExpandOverlay(i,o,!0),t.addIconOverlay(o),o.isRoot=!0,t.rootVarex=o}finally{i.getModel().endUpdate()}}},installDblClickHandler:function e(t){t.addListener(mxEvent.DOUBLE_CLICK,mxUtils.bind(this,function(e,n){var i=n.getProperty("cell");i&&t.isEnabled()&&null!==this.dblClickAction&&(this.dblClickAction(i,n),t.tooltipHandler.hide(),n.consume())}))},dblClickAction:function e(t,n){var i=this,r=t.getAttribute("unitType"),o=t.getAttribute("ID"),a;(a=i.getEntityByUnitType(r))&&o&&i.openForm(a,o,null,function(e){i.refreshDiagram()})},getEntityByUnitType:function e(t){var n=this.orgUnity[t];return n?n.code:""},openForm:function e(t,n,i,r){this.openFormC({entityCode:t,instanceID:n,initialFieldValues:i,onClose:r})},openFormC:function e(t){var n,i,r,o,a,s=this,l=UB.core.UBAppConfig.systemEntities;a=$App.domainInfo.get(t.entityCode).hasMixin("dataHistory"),t.isModal=!!Ext.isEmpty(t.isModal)||t.isModal,n=UB.core.UBFormLoader.getFormByEntity(t.entityCode),n&&(i=n.get(l.form.fields.code),r=UB.i18n(n.get(l.form.fields.description))),o={cmdType:UB.core.UBCommand.commandType.showForm,formCode:i,description:r,entity:t.entityCode,instanceID:t.instanceID,initialFieldValues:t.initialFieldValues,customParams:t.customParams,isModal:t.isModal,callback:function e(n){if(t.onClose&&n){var i=n.up("window");i&&i.on({beforeclose:t.onClose,scope:s})}}},UB.core.UBApp.doCommand(o)},createToolBar:function e(){var t=this;return Ext.define("SelectPrinterFmt",{extend:"Ext.data.Model",fields:[{name:"ID",type:"object"},{name:"Caption",type:"string"}]}),{xtype:"toolbar",items:[{xtype:"button",text:UB.i18n("Undo"),iconCls:"icon-undo",handler:function e(){t.undoManager.undo()},scope:t},{xtype:"button",text:UB.i18n("Redo"),iconCls:"icon-redo",handler:function e(){t.undoManager.redo()},scope:t},{xtype:"button",text:UB.i18n("Zoom"),iconCls:"icon-zoom-in",handler:function e(){t.graph.zoomIn()},scope:t},{xtype:"button",text:UB.i18n("Zoom Out"),iconCls:"icon-zoom-out",handler:function e(){t.graph.zoomOut()},scope:t},{xtype:"button",text:UB.i18n("Actual Size"),iconCls:"icon-view11",handler:function e(){t.graph.zoomActual()},scope:t},{xtype:"combobox",store:Ext.create("Ext.data.Store",{model:"SelectPrinterFmt",data:[{ID:"A4P",Caption:UB.i18n("A4 portrait")},{ID:"A4L",Caption:UB.i18n("A4 landscape")},{ID:"A5P",Caption:UB.i18n("A5 portrait")},{ID:"A5L",Caption:UB.i18n("A5 landscape")}]}),forceSelection:!0,editable:!1,allowBlank:!1,displayField:"Caption",valueField:"Caption",value:UB.i18n("A4 portrait"),width:150,labelWidth:0,queryMode:"local",listeners:{select:function e(n,i){if(i.length>0)switch(i[0].get("ID")){case"A4P":t.printerFormat=mxConstants.PAGE_FORMAT_A4_PORTRAIT;break;case"A4L":t.printerFormat=mxConstants.PAGE_FORMAT_A4_LANDSCAPE;break;case"A5P":t.printerFormat=new mxRectangle(0,0,1652,1169);break;case"A5L":t.printerFormat=new mxRectangle(0,0,1169,1652)}},scope:t}},{xtype:"button",text:UB.i18n("Print"),iconCls:"icon-printer",handler:function e(){new mxPrintPreview(t.graph,1,t.printerFormat||null).open()},scope:t},{xtype:"button",text:UB.i18n("Poster Print"),iconCls:"icon-print",handler:function e(){Ext.Msg.prompt({msg:UB.i18n("Enter maximum page count"),prompt:!0,title:"",minWidth:Ext.Msg.minPromptWidth,buttons:Ext.Msg.OKCANCEL,callback:function e(n,i){if("ok"===n){var r=i;if(null!==r){var o=mxUtils.getScaleForPageCount(r,t.graph);new mxPrintPreview(t.graph,o,t.printerFormat||null).open()}}},scope:t,multiline:!1,value:"1"})},scope:t},{xtype:"button",text:UB.i18n("Select"),icon:"models/adminui-pub/resources/images/select.gif",handler:function e(){t.graph.panningHandler.useLeftButtonForPanning=!1,t.graph.setConnectable(!1)},scope:t},{xtype:"button",text:UB.i18n("Pan"),icon:"models/adminui-pub/resources/images/pan.gif",handler:function e(){t.graph.panningHandler.useLeftButtonForPanning=!0,t.graph.setConnectable(!1)},scope:t},{xtype:"button",text:UB.i18n("Select all"),handler:function e(){t.graph.selectAll()},scope:t}]}},createPopupMenu:function e(t,n,i){var r=this,o=t.getModel();if(r.isLoadContent||n.addItem(UB.i18n("New organizational chart"),"",function(){r.loadData().then(function(){r.showTree(),r.isLoadContent=!0})}),null!==i){if(o.isVertex(i))Ext.Object.each(r.orgUnity,function(e,t){n.addItem(UB.i18n("Create child")+" "+t.caption,"",function(){r.createChildElement(i,e)})},r),n.addSeparator(),n.addItem(UB.i18n("Open subordinate chart from this node"),"",function(){r.openDiagram(i)}),n.addSeparator(),n.addItem(UB.i18n("Remove all child"),"",function(){r.deleteSubtree(t,i),r.graph.removeCellOverlays(i),r.addIconOverlay(i),r.addAddOverlay(r.graph,i)}),n.addItem(UB.i18n("Select all child"),"",function(){r.selectAllChild(i)}),n.addSeparator(),n.addItem(UB.i18n("Align child to right"),"",function(){r.autoLayout(i,"H"),r.selectAllChild(i)}),n.addItem(UB.i18n("Align child down me"),"",function(){r.autoLayout(i,"V"),r.selectAllChild(i)});else{var a=i.getStyle()||"edgeStyle=orthogonalEdgeStyle;";a.indexOf("topToBottomEdgeStyle")<0&&n.addItem(UB.i18n("Format edge top to bottom"),"",function(){t.setCellStyle("edgeStyle=topToBottomEdgeStyle;",[i])}),a.indexOf("sideToSideEdgeStyle")<0&&n.addItem(UB.i18n("Format edge left to right"),"",function(){t.setCellStyle("edgeStyle=sideToSideEdgeStyle;",[i])}),a.indexOf("orthogonalEdgeStyle")<0&&n.addItem(UB.i18n("Format edge orthogonal"),"",function(){t.setCellStyle("edgeStyle=orthogonalEdgeStyle;",[i])})}n.addSeparator()}n.addItem(UB.i18n("Fit"),$App.getImagePath("zoom_in.png"),function(){t.fit()}),n.addItem(UB.i18n("Actual Size"),$App.getImagePath("view_1_1.png"),function(){t.zoomActual()}),n.addSeparator(),n.addItem(UB.i18n("Print"),$App.getImagePath("print.png"),function(){new mxPrintPreview(t,1).open()}),n.addItem(UB.i18n("Poster Print"),$App.getImagePath("print.png"),function(){var e=mxUtils.prompt(UB.i18n("Enter maximum page count"),"1");if(null!==e){var n=mxUtils.getScaleForPageCount(e,t);new mxPrintPreview(t,n).open()}})},setDetaileEdgeStyle:function e(t,n){var i=this,r=[],o,a=i.graph.model;i.graph.traverse(t,!0,function(e){if((o=a.getEdgeCount(e))>0)for(var t=0;t<o;t++){var n=a.getEdgeAt(e,t),i=a.getTerminal(n,!0)===e;i&&r.push(n)}return!0}),i.graph.setCellStyle("edgeStyle="+n+";",r)},autoLayout:function e(t,n){var i=this;switch(n){case"H":i.setDetaileEdgeStyle(t,"sideToSideEdgeStyle"),i.horisontalLayout.execute(i.graph.getDefaultParent(),t);break;case"V":i.setDetaileEdgeStyle(t,"topToBottomEdgeStyle"),i.verticalLayout.execute(i.graph.getDefaultParent(),t)}},addExpandOverlay:function e(t,n,i){var r=this,o=new mxCellOverlay(new mxImage(i?r.collapseImage:r.expandImage,24,24),i?UB.i18n("Collapse"):UB.i18n("Expand"));o.cursor="hand",o.align=mxConstants.ALIGN_CENTER,o.addListener(mxEvent.CLICK,mxUtils.bind(this,function(e,t){r.expandORCollapse(n,o)})),o.isExpandOvelay=!0,o.expanded=!i,t.addCellOverlay(n,o)},addAddOverlay:function e(t,n){var i=this,r;r=new mxCellOverlay(new mxImage(i.appendImage,24,24),UB.i18n("Append element")),r.cursor="hand",r.offset=new mxPoint(-4,8),r.align=mxConstants.ALIGN_RIGHT,r.verticalAlign=mxConstants.ALIGN_TOP,r.addListener(mxEvent.CLICK,mxUtils.bind(this,function(e,t){i.addChildElement(n,r)})),r.isAddOverlay=!0,t.addCellOverlay(n,r)},addIconOverlay:function e(t){var n=this,i,r,o,a,s;i=t.getAttribute("unitType"),a=t.getAttribute("label"),s=n.orgUnity[i],o=s?s.image:$App.getImagePath("office.png"),r=new mxCellOverlay(new mxImage(o,24,24),a),r.offset=new mxPoint(4,8),r.align=mxConstants.ALIGN_LEFT,r.verticalAlign=mxConstants.ALIGN_TOP,r.isIconOverlay=!0,n.graph.addCellOverlay(t,r)},updateCell:function e(t){this.graph.refresh(t)},getAddOvelay:function e(t){var n=this,i=null;return t.overlays&&0!==t.overlays.length?(Ext.Array.each(t.overlays,function(e){if(e.isAddOverlay)return i=e,!1},n),i):null},getExpandOvelay:function e(t){var n=this,i=null;return t.overlays&&0!==t.overlays.length?(Ext.Array.each(t.overlays,function(e){if(e.isExpandOvelay)return i=e,!1},n),i):null},addChildElement:function e(t,n){var i=this,r=t.getAttribute("ID"),o=i.allData[r],a=i.graph.getModel(),s,l,u,c,d={},f=0,h=[];if(l=i.findChildCell(t),Ext.Array.each(l,function(e){u=e.getAttribute("ID"),d[1*u]=e,f++}),o&&o.child.length>0){a.beginUpdate();try{c={x:t.geometry.x,y:t.geometry.y+120},Ext.Array.each(o.child,function(e){d[e.ID]||(i.showElement(t,e,c),h.push(t),c.x+=100)})}finally{a.endUpdate()}0===f&&i.autoLayout(t,i.defaultLayout),i.graph.removeCellOverlay(t,n),s=i.getExpandOvelay(t),s?s.expanded&&i.expandORCollapse(t):i.addExpandOverlay(i.graph,t,!0),0===f?i.selectAllChild(t):i.graph.setSelectionCells(h)}},expandORCollapse:function e(t,n){var i=this,r=t.getAttribute("ID"),o=i.allData[r],a;o&&(a=o.child),t.isRoot&&!r&&(a=i.treeData),a.length>0&&(i.hideOrShowCells(i.graph,t,n.expanded),n.expanded=!n.expanded,n.image.src=n.expanded?i.expandImage:i.collapseImage,n.tooltip=n.expanded?UB.i18n("Expand"):UB.i18n("Collapse")),i.updateCell(t)},hideOrShowCells:function e(t,n,i){var r=this,o=[],a,s=!1;return t.traverse(n,!0,function(e){return n!==e&&(o.push(e),s=s||!e.isVisible()),!0}),null===i&&(i=s),t.toggleCells(i,o,!0),i&&Ext.Array.each(o,function(e){(a=r.getExpandOvelay(e))&&a.expanded&&(a.image.src=r.collapseImage,r.updateCell(e))}),i},changeElementParent:function e(t,n,i){var r=this,o=r.graph.getModel(),a,s,l;if((a=o.getEdgeCount(t))>0)for(var u=0;u<a;u++)if(s=o.getEdgeAt(t,u),(l=o.getTerminal(s,!0))!==t){r.graph.cellsRemoved([s]);break}r.addElementEdge(t,n,i)},addChild:function e(t,n,i,r,o){var a,s,l,u,c=this,d=t.getModel(),f=t.getDefaultParent(),h;r||d.beginUpdate();try{a=mxUtils.createXmlDocument(),s=a.createElement("ubOrgChart"),s.setAttribute("label",i.caption),s.setAttribute("ID",i.ID),s.setAttribute("parentID",i.parentID),s.setAttribute("code",i.code),s.setAttribute("unitType",i.unitType),n||s.setAttribute("isRoot",!0),o&&(l=o.x,u=o.y),h=t.insertVertex(f,null,s,l,u),h.setStyle(c.getEntityByUnitType(i.unitType));var p=d.getGeometry(h),m=t.getPreferredSizeForCell(h);p.width=m.width,p.height=m.height,n?c.addElementEdge(h,n,i):(h.isRoot=!0,c.rootVarex=h),i.child.length>0&&c.addAddOverlay(t,h),c.addIconOverlay(h)}finally{r||d.endUpdate()}return h},addElementEdge:function e(t,n,i){var r=this.graph,o=r.getDefaultParent(),a=r.insertEdge(o,null,"",n,t);a.setAttribute("fromID",i.ID),a.fromID=i.ID,a.setGeometry(new mxGeometry(0,0,0,0)),a.geometry.relative=!0,a.geometry.setTerminalPoint(new mxPoint(0,0),!0),a.geometry.setTerminalPoint(new mxPoint(80,0),!0),a.geometry.setTerminalPoint(new mxPoint(160,0),!1)},selectAllChild:function e(t){var n=this,i=[];n.graph.traverse(t,!0,function(e){return t!==e&&i.push(e),!0}),n.graph.setSelectionCells(i)},deleteSubtree:function e(t,n){var i=[];t.traverse(n,!0,function(e){return n!==e&&i.push(e),!0}),t.removeCells(i)},getPreferredSizeForCell:function e(t){var n=100,i=null;if(null!==t){var r=this.view.getState(t),o=r?r.style:this.getCellStyle(t);if(null!==o&&!this.model.isEdge(t)){var a=o[mxConstants.STYLE_FONTSIZE]||mxConstants.DEFAULT_FONTSIZE,s=0,l=0;(this.getImage(r)||o[mxConstants.STYLE_IMAGE])&&o[mxConstants.STYLE_SHAPE]===mxConstants.SHAPE_LABEL&&(o[mxConstants.STYLE_VERTICAL_ALIGN]===mxConstants.ALIGN_MIDDLE&&(s+=parseFloat(o[mxConstants.STYLE_IMAGE_WIDTH])||mxLabel.prototype.imageSize),o[mxConstants.STYLE_ALIGN]!==mxConstants.ALIGN_CENTER&&(l+=parseFloat(o[mxConstants.STYLE_IMAGE_HEIGHT])||mxLabel.prototype.imageSize)),s+=2*(o[mxConstants.STYLE_SPACING]||0),s+=o[mxConstants.STYLE_SPACING_LEFT]||0,s+=o[mxConstants.STYLE_SPACING_RIGHT]||0,l+=2*(o[mxConstants.STYLE_SPACING]||0),l+=o[mxConstants.STYLE_SPACING_TOP]||0,l+=o[mxConstants.STYLE_SPACING_BOTTOM]||0;var u=this.getFoldingImage(r);null!==u&&(s+=u.width+8);var c=this.getLabel(t);if(c&&c.length>0){this.isHtmlLabel(t)||(c=c.replace(/\n/g,"<br>"));var d=mxUtils.getSizeForString(c,a,o[mxConstants.STYLE_FONTFAMILY]);d.width+s>100&&(d=mxUtils.getSizeForString(c,a,o[mxConstants.STYLE_FONTFAMILY],100));var f=d.width+s,h=d.height+l;if(!mxUtils.getValue(o,mxConstants.STYLE_HORIZONTAL,!0)){var p=h;h=f,f=p}this.gridEnabled&&(f=this.snap(f+this.gridSize/2),h=this.snap(h+this.gridSize/2)),i=new mxRectangle(0,0,f,h)}else{var m=4*this.gridSize;i=new mxRectangle(0,0,m,m)}}}return i},getValue:function e(){var t=this,n=new mxCodec,i=n.encode(t.graph.getModel());return mxUtils.getXml(i)},resetOriginalValue:function e(){return this.changeFired=!1,this.isGraphChanged=!1,null},graphChanged:function e(){var t=this;t.isLoadComlete&&(t.isGraphChanged=!0,t.changeFired||this.fireEvent("change",this,!0),t.changeFired=!0)},isDirty:function e(){return this.isGraphChanged},updateDataBlob:function e(t){var n=this;n.useBlobForData||Ext.Error.raise("object does not use Blob"),n.dataBlob&&!Ext.isEmpty(this.objUrl)&&window.URL.revokeObjectURL(this.objUrl),n.data=null,n.dataBlob=t,n.objUrl=window.URL.createObjectURL(t),n.data=n.objUrl},onDestroy:function e(){var t=this;t.dataBlob=null,t.data=null,t.useBlobForData&&!Ext.isEmpty(t.objUrl)&&window.URL.revokeObjectURL(t.objUrl),t.objUrl=null,this.callParent()},setSrc:function e(t){var n=this,i=t.url,r=t.blobData,o;if(t.rawValue)throw Error("The UBOrgChart component does not support rawValue");return n.dataUrl=i,n.useBlobForData&&r&&n.updateDataBlob(r),n.isActulData=!1,n.changeFired=!0,n.graph?o=n.startLoadData():(n.loadDataDefer=Q.defer(),o=n.loadDataDefer.promise,n.loadDataDefer.resolve(!0)),n.changeFired=!1,o},startLoadData:function e(){var t=this,n,i,r,o=Q.defer();if(t.dataUrl&&t.graph)return t.isLoadComlete=!1,t.getEl().mask(UB.i18n("loadingData")),$App.connection.get(t.dataUrl).then(function(e){if("string"==typeof(i=e.data)){var o=new DOMParser;if(i=o.parseFromString(i,"application/xml"),r=i.getElementsByTagName("parsererror"),r.length>0)throw Error(r[0].innerHTML)}return n=new mxCodec(i.documentElement.ownerDocument),n.decode(i.documentElement,t.graph.getModel()),this.baseUrl=t.dataUrl,t.isLoadComlete=!0,t.isLoadContent=!0,t.isGraphChanged=!1,t.undoManager.clear(),t.isActulData=!0,!0}).done(function(){try{t.loadData().then(function(){try{t.validateDiagram(),o.resolve()}finally{t.getEl().unmask()}})}catch(e){throw t.getEl().unmask(),o.reject(e),e}},function(e){o.reject(e),t.getEl().unmask()}),o.promise},initNewSrc:function e(){var t=this;return t.loadData().then(function(){t.showTree(),t.isLoadContent=!0,t.isLoadComlete=!0}),null},findParentCell:function e(t){var n=this,i=n.graph.getModel(),r,o,a;if((r=i.getEdgeCount(t))>0)for(var s=0;s<r;s++)if(o=i.getEdgeAt(t,s),(a=i.getTerminal(o,!0))!==t)return a;return null},findChildCell:function e(t){var n=this,i=n.graph.getModel(),r,o,a,s=[];if((r=i.getEdgeCount(t))>0)for(var l=0;l<r;l++)o=i.getEdgeAt(t,l),(a=i.getTerminal(o,!1))!==t&&s.push(a);return s},refreshDiagram:function e(){var t=this;return t.loadData().then(function(){return t.validateDiagram(!0)})},validateDiagram:function e(t){var n=this,i=n.graph.getModel(),r,o=!1,a=[],s,l,u,c,d=[],f={},h;if(n.rootVarex=null,Ext.Object.each(i.cells,function(e,t){if(t.vertex){if(r=t.getAttribute("ID"),r&&(r*=1),s=t.getAttribute("isRoot"),s&&(n.rootVarex=t,t.isRoot=!0),!r)return!0;l=n.findParentCell(t),u=l?l.getAttribute("ID")||null:null,u&&(u*=1),o=!0,c=n.allData[r],c?(t.getAttribute("label")!==c.caption&&t.setAttribute("label",c.caption),t.getAttribute("code")!==c.code&&t.setAttribute("code",c.code),t.getAttribute("unitType")!==c.unitType&&t.setAttribute("unitType",c.unitType),c.parentID!==u&&d.push(t),h=f[r],h?h.cell=t:f[r]=h={cell:t,child:[]},h=f[c.parentID||"root"],h?h.child.push(t):f[c.parentID||"root"]=h={child:[t]}):a.push(t)}}),Ext.Array.each(d,function(e){r=e.getAttribute("ID"),r&&(r*=1),c=n.allData[r],h=f[c.parentID],h?n.changeElementParent(e,h.cell,c):a.push(e)},n),n.graph.removeCells(a,!0),Ext.Object.each(f,function(e,i){if("root"===e)return n.updateCellOverlay(n.rootVarex,i.child,n.treeData.length,t),!0;(h=n.allData[e])&&n.updateCellOverlay(i.cell,i.child,h.child.length,t)},n),n.undoManager.clear(),!n.rootVarex)return void Ext.Msg.alert("",UB.i18n("Root is not found"));n.changeFired=!1,n.isGraphChanged=!1,n.isLoadComlete=!0},updateCellOverlay:function e(t,n,i,r){var o=this,a=!1,s;Ext.Array.each(n,function(e){if(e.isVisible())return a=!0,!1},o),r?(s=o.getAddOvelay(t),n.length===i||s||o.addAddOverlay(o.graph,t),0===i&&s&&o.graph.removeCellOverlay(t,s),s=o.getExpandOvelay(t),0===n.length&&s&&o.graph.removeCellOverlay(t,s)):(n.length!==i&&o.addAddOverlay(o.graph,t),i>0&&n.length>0&&o.addExpandOverlay(o.graph,t,a),o.addIconOverlay(t))},createNewDiagram:function e(t,n){return $App.connection.insert({fieldList:["ID","orgunitID","caption"],entity:"org_diagram",execParams:{orgunitID:t,caption:n}}).then(function(e){return e.serverFailure?null:e.resultData.data[0][0]})},openDiagram:function e(t){var n=this,i=this,r,o;r=1*t.getAttribute("ID"),o=t.getAttribute("label"),UB.Repository("org_diagram").attrs(["ID","orgunitID","caption"]).where("orgunitID","=",r).selectSingle().then(function(e){return e?e.ID:$App.dialogYesNo("","Chart for this item does not exist. Create a new one?").then(function(e){if(e)return i.createNewDiagram(r,o)})}).then(function(e){e&&n.openFormC({entityCode:"org_diagram",instanceID:e,isModal:!1})})},createChildElement:function e(t,n){var i=this,r,o;r=i.getEntityByUnitType(n),o=t.getAttribute("ID"),o=o?1*o:null,r&&i.openForm(r,null,{parentID:o},function(e){var n=e.down("basepanel");n&&n.record&&i.checkElementId(n.record.get("ID"),t)})},checkElementId:function e(t,n){var i=this;UB.Repository("org_unit").attrs(["ID","parentID","code","caption","unitType"]).selectById(t).then(function(e){e&&i.refreshDiagram().then(function(){var e=i.allData[1*n.getAttribute("ID")],r=i.allData[t],o=i.findChildCell(n),a=i.getAddOvelay(n);if(e.child.length===o.length+1){var s={x:n.geometry.x,y:n.geometry.y+120},l=i.graph.getModel();l.beginUpdate();try{i.showElement(n,r,s),a&&i.graph.removeCellOverlay(n,a)}finally{l.endUpdate()}}})})},initMetaInfo:function e(){var t=this,n,i,r;t.orgUnity={},$App.domainInfo.eachEntity(function(e,o){if(e.mixins&&(i=e.mixins.unity)&&i.enabled&&i.entity&&"org_unit"===i.entity.toLowerCase()&&i.defaults)switch(n=i.defaults.unitType,t.orgUnity[n]=r={code:o,unitType:n,caption:e.caption},n){case"ORG":r.image=$App.getImagePath("office.png");break;case"DEP":r.image=$App.getImagePath("user-group.png");break;default:r.image=$App.getImagePath("person.png")}})}})},function(e,t){Ext.define("UB.ux.UBOnlyOffice",{extend:"Ext.Panel",alias:"widget.UBOnlyOffice",width:"100%",height:"100%",layout:"fit",autoEl:"div",contentTypeMap:{"application/word":"text","application/excel":"spreadsheet"},_documentKey:null,_onlyOfficeObject:null,_onlyOfficeGetValueDefer:null,_onlyOfficeGetValuePromise:null,_initializationPromise:null,_placeholderID:null,_isModified:!1,readOnly:!0,initComponent:function e(){var t=this,n=t._getServerConfiguration();if(!n.isConfigured)return console.warn("OnlyOffice configuration is missed. Yet control were tried to bootstrap"),void t.callParent(arguments);t._placeholderID=t.id+"_placeholder",t.html=['<div style="width: 100%; height: 100%;" id="'+t._placeholderID+'"></div>'];var i="http://"+n.serverIP+"/web-apps/apps/api/documents/api.js";t._initializationPromise=t._loadScript(i),t.callParent(arguments)},getValue:function e(t){var n=this;return n._onlyOfficeGetValueDefer=Q.defer(),n._onlyOfficeObject.downloadAs(),n._onlyOfficeGetValueDefer.promise},setReadOnly:function e(t){this.readOnly=t,t&&console.log("UB.ux.UBOnlyOffice control set to readonly state")},isDirty:function e(){var t=this;return!t.readOnly&&t._isModified},checkDirty:function e(){var t=this;return!t.readOnly&&t._isModified},setSrc:function e(t){var n=this;return n._initializationPromise.then(function(){var e=n._mapContentTypeToDocumentType(t.contentType),i=n._getControlConfiguration(e,t.url,t.html);n._documentKey=i.document.key,n._onlyOfficeObject=new DocsAPI.DocEditor(n._placeholderID,i)})},_loadScript:function e(t){return Q.Promise(function(e,n){Ext.Loader.loadScript({url:t,onLoad:e,onError:n})})},_getServerConfiguration:function e(){var t=$App.connection.userData("onlyOfficeServer");return{isConfigured:_.isString(t),serverIP:t||""}},_getControlConfiguration:function e(t,n,i){var r=this,o=$App.connection.serverUrl+(n?n.replace("/getDocument","getDocumentOffice"):"getDocumentOffice"),a=(""+UB.MD5(new Date+"||"+o)).substr(20),s="UK",l=$App.connection.serverUrl+"notifyDocumentSaved",u=r.readOnly?"view":"edit";return{document:{key:a,title:i||"",url:o},documentType:t||"text",editorConfig:{mode:u,lang:"UK",callbackUrl:l,customization:{autosave:!0,forcesave:!0}},events:{onDocumentStateChange:function e(t){!0===t.data&&(r._isModified=!0,console.log("Changes in document detected. Current document marked as dirty"),r.fireEvent("change",r))},onDownloadAs:function e(t){r._onlyOfficeGetValueDefer.resolve(t.data)},onCollaborativeChanges:function e(t){console.log("onCollaborativeChanges")},onOutdatedVersion:function e(t){console.log("onOutdatedVersion")},onError:function e(t){console.log("onError")},onReady:function e(t){console.log("onReady")},onSaveEnd:function e(t){console.log("onSaveEnd")},onRequestEditRights:function e(t){console.log("onRequestEditRights")},onRequestHistory:function e(t){console.log("onRequestHistory")},onRequestHistoryData:function e(t){console.log("onRequestHistoryData")},onRequestHistoryClose:function e(t){console.log("onRequestHistoryClose")}}}},_mapContentTypeToDocumentType:function e(t){var n=this,i=n.contentTypeMap[t];return i||(console.warn('"UBOnlyOffice.js" - contentType passed in control is "'+t+'" and don\'t have corresponding mapping to onlyOffice type. So default type "text" will be used'),"text")}})},function(e,t,n){n(38),Ext.define("UB.ux.UBDetailGrid",{extend:"UB.view.EntityGridPanel",alias:"widget.ubdetailgrid",uses:["UB.core.UBApp","UB.core.UBCommand"],layout:"fit",readOnly:!1,masterFields:[],detailFields:[],forceDataLoad:!1,initComponent:function e(){var t=void 0;if(this.cmpInitConfig&&(console.warn("cmpInitConfig parameter is deprecated. You can set parameters from cmpInitConfig into UBDetailGrid config."),Ext.apply(this,this.cmpInitConfig)),this.disableAutoLoadStore=!0,t=this.cmdData&&this.cmdData.params?this.cmdData.params[0]:null,t&&!this.entityConfig&&(this.entityConfig=t),this.cmdData&&console.debug("UBDetailGrid: cmdData cfg parameter is deprecated. Use entityConfig"),this.cmdType&&"showList"!==this.cmdType)throw Error("UB.ux.UBDetailGrid show only grid");if(this.grid=this,this.gridCreated=!0,this.callParent(arguments),_.isFunction(this.customInit)&&this.customInit(),$App.domainInfo.get(this.entityConfig.entity).checkAttributeExist(this.detailFields,"UB.ux.UBDetailGrid, detailFields:"),this.addEvents("gridCreated"),this.isDesignMode)try{this.setValue(null)}catch(e){}},on:function e(t,n,i,r){"gridCreated"===t?(console.error("Deprecated. Grid is created immediately"),n.bind(i||this).apply([this])):this.callParent(arguments)},setValue:function e(t,n){var i=this;n&&$App.domainInfo.get(n).checkAttributeExist(i.masterFields,"UB.ux.UBDetailGrid, masterFields:"),i.masterFields&&i.detailFields&&(i.parentContext=i.parentContext||{},_.forEach(i.masterFields,function(e,r){if(!t.fields.findBy(function(t){return t.name===e}))throw Error('Master entity record does not contains field "'+e+'". This field used as parent field in UBDetailGrid. Detail entity = '+i.entityConfig.entity+", master entity "+n);i.parentContext[i.detailFields[r]]=t.get(e)})),i.onRefreshDetail(t)},onRefreshDetail:function e(t){var n=void 0;t&&t.isModel&&(n=this.store.ubRequest,n.whereList=UB.core.UBCommand.addMasterDetailRelation(n.whereList,this.masterFields,this.detailFields,t),(this.rendered||this.forceDataLoad)&&(this.rowEditing&&this.editingPlugin.editing&&this.editingPlugin.cancelEdit(),this.store.reload()))}})},function(e,t,n){n(2),n(4),Ext.define("UB.core.UBEnumManager",{singleton:!0,uses:[],getArrayStore:function e(t){var n=UB.core.UBUtil.getNameMd5("ubm_enum",t),i,r=UB.ux.data.UBStore.entityModelName(n);return Ext.ModelManager.getModel(r)||Ext.define(r,{extend:"Ext.data.Model",idProperty:"code",fields:["code","name","shortName","sortOrder"]}),i=Ext.create("Ext.data.ArrayStore",{model:r,autoDestroy:!0,data:this.getGroupData(t)}),i.sort("sortOrder"),i},getDictionary:function e(t,n){var i={};return UB.core.UBStoreManager.getEnumStore().each(function(e){e.get("eGroup")===t&&(i[e.get("code")]=e.get(n||"name"))}),i},getStore:function e(t){return this.getArrayStore(t)},getUBStore:function e(t,n){var i=Ext.create("UB.ux.data.UBStore",_.defaults(n||{},{ubRequest:{entity:"ubm_enum",method:UB.core.UBCommand.methodName.SELECT,fieldList:["eGroup","code","name","shortName","sortOrder"],whereList:{eGroup:{expression:"[eGroup]",condition:"equal",values:{eGroup:t}}},orderList:{byName:{expression:"name",order:"asc"}}},autoLoad:!1,autoDestroy:!0,disablePaging:!0,idProperty:"code"}));return i.load(),i},getGroupData:function e(t){var n=[];return UB.core.UBStoreManager.getEnumStore().each(function(e){e.get("eGroup")===t&&n.push([e.get("code"),e.get("name"),e.get("shortName"),e.get("sortOrder")])}),n},getById:function e(t,n){return UB.core.UBEnumManager.getStore(t).getById(n)}})},function(e,t,n){n(4),n(3),n(39),n(35),n(124),Ext.define("UB.ux.Multifilter",{extend:"Ext.toolbar.Toolbar",alias:"plugin.multifilter",border:!1,margin:"0 0 0 3",padding:0,cls:"ub-multi-filter",bodyStyle:"background: none;",filtersList:{},selectedColumn:null,init:function e(t){var n=this,i=0,r;n.gridOwner=t,n.gridOwner.on({afterrender:n.onParentAfterRenderer,columnmove:n.onGridChaged,columnhide:n.onGridChaged,columnshow:n.onGridChaged,selectionchange:function e(t,r,o){clearTimeout(i),i=setTimeout(function(){n.onSelectionChange(t,r,o)},350)},scope:n}),n.gridOwner.store.on({load:n.filtersDescription,filterchange:n.onFilterChange,scope:n}),n.fieldsConfig={},_.forEach(n.gridOwner.autoFilter?n.gridOwner.autoFilter.params||{}:{},function(e,t){n.fieldsConfig[t]=e}),_.forEach(n.gridOwner.extendedFieldList||[],function(e){e.filter&&(n.fieldsConfig[e.name]=e.filter)}),n.filterPrefix="context_"+Ext.id(),n.filtersPanel={},r=n.createSelectFilterMenu(function(e,t,i,r){Ext.suspendLayouts();try{n.hideAllPanel(),n.selectedColumn=t.column,n.createFilterPanel(t.column.dataIndex,t.column)}finally{Ext.resumeLayouts(!0)}n.topfilterPenel.layout.overflowHandler.menuItems.length>0&&n.showContexFilterPanel()}),n.buttonSelectFilter=new Ext.button.Button({tooltip:UB.i18n("Filter by"),glyph:UB.core.UBUtil.glyphs.faFilter,handler:function e(){r.showBy(n.buttonSelectFilter.el,n.menuAlign)}}),n.add(this.buttonSelectFilter)},getItemMargin:function e(){return"0 10 0 10"},createSelectFilterMenu:function e(t){var n=this,i=[],r,o,a,s={};return _.forEach(n.gridOwner.columns,function(e){if(!(n.fieldsConfig[e.dataIndex]||{}).disabled&&!1!==e.filterable){if(o=e.dataIndex.split("."),o.length>1&&!e.simpleFilter&&(a=n.gridOwner.store.ubRequest.fieldList,a.indexOf(o[0])>0))return void(s[o[0]]||(i.push({text:$App.domainInfo.get(n.gridOwner.entityName).getEntityAttribute(o[0]).caption,column:e}),s[o[0]]=!0));i.push({text:e.filterCaption||e.text||$App.domainInfo.get(n.gridOwner.entityName).getEntityAttribute(e.dataIndex).caption,column:e})}}),r=Ext.create("Ext.menu.Menu",{margin:"0 0 10 0",items:i,listeners:{click:function e(i,r,o,a){r.showAllItem&&UB.ux.UBPreFilter.makeFilters({options:n.gridOwner.autoFilter||{},entityCode:n.gridOwner.entityName,store:n.gridOwner.getStore(),onFilterReady:function e(){n.gridOwner.filtersDescription&&n.gridOwner.filtersDescription()}}),t.apply(n,arguments)}}})},initComponent:function e(){this.callParent()},onFilterChange:function e(t){t.totalRequired=!1},showContexFilterPanel:function e(){function t(e,t){var r;return i=$App.domainInfo.get(l.ubEntity).getEntityAttribute(e),r=n.getFilterControls(l.ubEntity,e,i),a=r[r.length-1],a.isButton&&(r.splice(r.length-1,1),s=a.handler,a.handler=function(){s(),o.close()}),r[0].hideLabel=!0,r.unshift(Ext.create("Ext.form.Label",{shrinkWrap:1,margin:"0 10 0 3",text:t||r[0].fieldLabel})),r}var n=this,i,r,o,a,s,l=n.activeFilterPanel,u,c,d;c=n.createSelectFilterMenu(function(e,n,i,r){Ext.suspendLayouts();try{d.removeAll(),d.add(t(n.column.dataIndex,n.column.filterCaption||n.column.text))}finally{Ext.resumeLayouts(!0)}}),u=new Ext.button.Button({tooltip:UB.i18n("search"),glyph:UB.core.UBUtil.glyphs.faFilter,handler:function e(){c.showBy(u.el,n.menuAlign)}}),r=t(l.ubAttrName,l.columnText),o=Ext.create("Ext.window.Window",{padding:"10 5 10 5",height:160,minWidth:550,modal:!0,overflowX:"scroll",layout:{type:"hbox",align:"middle"},title:UB.i18n("search"),items:[u,d=Ext.create("Ext.toolbar.Toolbar",{items:r})],buttons:[a,{xtype:"button",margin:"0 0 0 15",text:UB.i18n("cancel"),handler:function e(){o.close()}}]}),o.center(),o.show()},onParentAfterRenderer:function e(){var t=this,n=t.gridOwner,i,r=n.getView(),o=n.getDockedItems('toolbar[dock="top"]')[0];t.baseToolbar=o,t.topfilterPenel=Ext.create("Ext.toolbar.Toolbar",{border:0,margin:0,padding:0,flex:30,enableOverflow:!0,items:[t]}),t.topfilterPenel.layout&&(i=t.topfilterPenel.layout.overflowHandler)&&(i.getSuffixConfig=function(){var e=this.layout,n=e.owner,i=n.id;return this.menuTrigger=new Ext.button.Button({id:i+"-menu-trigger",cls:Ext.layout.container.Box.prototype.innerCls+" "+t.triggerButtonCls+" "+Ext.baseCSSPrefix+"toolbar-item",plain:n.usePlainButtons,ownerCt:n,ownerLayout:e,ui:n instanceof Ext.toolbar.Toolbar?"default-toolbar":"default",tooltip:UB.i18n("search"),glyph:UB.core.UBUtil.glyphs.faFilter,handler:function e(){t.activeFilterPanel&&t.showContexFilterPanel()}}),this.menuTrigger.getRenderTree()}),o.insert(o.items.getCount()-2,t.topfilterPenel),r&&r.on({itemkeydown:function e(n,i,r,o,a,s){if(!(a.isNavKeyPress()||a.isSpecialKey()||a.ctrlKey)){var l=t.down("field");if(l){var u=l.next();u?u.focus():l.focus()}}}})},hideAllPanel:function e(){var t=this;Ext.Object.each(t.filtersPanel,function(e,t){t.hide()})},getFilterControls:function e(t,n,i,r){var o=this,a,s;if(s=$App.domainInfo.get(t).getEntityAttribute(n,!0),s.customSettings&&s.customSettings.UIGridColumnClass)a=o.getEnumFilterInput(t,n,s.customSettings.UIGridColumnClass,r);else if(i.associatedEntity)a=o.getAssociationFilterInput(t,n,r);else if("Enum"===i.dataType)a=o.getEnumFilterInput(t,n);else{var l=UBDomain.getPhysicalDataType(i.dataType);switch(l){case"float":case"int":a=o.getNumericFilterInput(t,n,"float"===l||"currency"===l);break;case"date":a=o.getDateFilterInput(t,n);break;case"boolean":a=o.getBooleanFilterInput(t,n);break;default:a=o.getPlainTextFilter(t,n)}}return a},onGridChaged:function e(){this.clearFilterPanel()},clearFilterPanel:function e(){var t=this;_.forEach(t.filtersPanel||[],function(e,n){t.remove(e)}),t.filtersPanel={}},getInitParam:function e(t){return this.fieldsConfig[t]||null},createFilterPanel:function e(t,n){var i=this,r,o,a,s,l,u=i.gridOwner,c=u.entityName,d,f,h=!1;if(o=t.split("."),o.length>1&&!n.simpleFilter&&(l=u.store.ubRequest.fieldList,l.indexOf(o[0])>0&&(t=o[0],h=!0)),d=$App.domainInfo.get(c).attr(t),a=i.filtersPanel[t])return i.activeFilterPanel=a,void a.show();s=i.getFilterControls(c,t,d,void 0),s[0].hideLabel=!0,s.unshift(f=Ext.create("Ext.form.Label",{shrinkWrap:0,margin:"0 0 0 3",width:100,text:n.filterCaption||(h?d.caption:null)||n.text,style:"white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"})),f.on("afterrender",function(){Ext.create("Ext.tip.ToolTip",{target:this.getEl(),trackMouse:!0,html:this.text})},f),a=Ext.create("Ext.toolbar.Toolbar",{border:0,margin:0,padding:0,flex:2,items:s}),a.ubEntity=c,a.ubAttrName=t,a.columnText=n.filterCaption||n.text,i.filtersPanel[t]=a,i.add(a),i.activeFilterPanel=a},onSelectionChange:function e(t,n,i){var r=this,o,a=r.gridOwner,s=a.getSelectionModel().getCurrentPosition()||{},l,u;if(Ext.isDefined(s.column)&&n.length&&s.column!==r.selectedColumn&&(o=s.columnHeader)){u=r.gridOwner.getColumnManager().getHeaderAtIndex(s.column)||{},r.activeFilterPanel=null,Ext.suspendLayouts();try{if(r.hideAllPanel(),r.selectedColumn=s.column,!1===u.filterable)return;var c=o.dataIndex;if(!c)return;if(l=r.fieldsConfig[c]||{},l.disabled)return;r.createFilterPanel(c,u)}finally{Ext.resumeLayouts(!0)}}},getAssociationFilterInput:function e(t,n,i){return UB.ux.Multifilter.getAssociationFilterInputS(t,n,i,this)},getEnumFilterInput:function e(t,n,i,r){return UB.ux.Multifilter.getEnumFilterInputS(t,n,i,r,this)},getBooleanFilterInput:function e(t,n){return UB.ux.Multifilter.getBooleanFilterInputS(t,n,this)},getNumericFilterInput:function e(t,n,i){return UB.ux.Multifilter.getNumericFilterInputS(t,n,i,this)},getPlainTextFilter:function e(t,n){return UB.ux.Multifilter.getPlainTextFilterS(t,n,this)},getDateFilterInput:function e(t,n){return UB.ux.Multifilter.getDateFilterInputS(t,n,this)},clearFilter:function e(){var t=this,n=t.gridOwner.store,i=n.filters,r=t.filtersList,o=!1;t.selectedColumn=null,Ext.Object.each(r,function(e,t){var n=i.getByKey(e);n&&n.relatedFilter&&i.removeAtKey(n.relatedFilter.id),i.removeAtKey(e),o=!0,delete r[e]}),n.filters.length?(o&&n.filter(),t.gridOwner.onPrefilter()):n.clearFilter(),t.filtersDescription()},filtersDescription:function e(){var t=this,n=t.gridOwner,i=n.store,r=n.entityName,o=i.filters,a=UB.core.UBCommand.condition,s=[],l=!0,u={},c={},d=!1,f={};t.initBarControls(),t.filterPenelFilters.items.each(function(e){u[e.filterID]=1,c[e.filterID]=e},t),o.sort("property"),o.each(function(e){var n,i,o,h,p,m;if(l=!0,d=!1,e&&e.property&&e.id&&"between"!==e.condition&&e.id!==UB.core.UBCommand.whereListParentID&&!(e&&e.relatedFilter&&e.relatedFilter.id&&f[e.relatedFilter.id])){if(f[e.id]=1,i=$App.domainInfo.get(r).attr(e.property),n=i.caption,o=e.userValue||e.value,h=e.id&&e.id.substr(0,UB.ux.UBPreFilter.basePrefix.length)===UB.ux.UBPreFilter.basePrefix,m="match"===e.condition,p=!(e.id&&t.filtersList[e.id]),u[e.id]&&(u[e.id]=0,d=!0),m)n=UB.format(UB.i18n("ftsFilterName"),e.value),o="";else if(i.associatedEntity)o=e.text;else if("Enum"===i.dataType)o=e.text;else{var g=UBDomain.getPhysicalDataType(i.dataType),y;switch(g){case"date":if("period"===e.filterType)">="===e.operator?(e.value&&(o=UB.i18n("s")+" "+Ext.Date.format(e.value,"d-m-Y")),(y=e.relatedFilter.value)&&(o+=" "+UB.i18n("po")+" "+Ext.Date.format(e.isTime?UB.core.UBUtil.addDays(y,-1):y,"d-m-Y"))):l=!1;else if("to_date"===e.filterType)o=UB.i18n("po")+" "+Ext.Date.format(e.isTime?UB.core.UBUtil.addDays(e.value,-1):e.value,"d-m-Y");else if("from_date"===e.filterType)o=UB.i18n("s")+" "+Ext.Date.format(e.value,"d-m-Y");else if("date"===e.filterType)o=Ext.Date.format(e.value,"d-m-Y");else{var v={today:UB.i18n("today"),yesterday:UB.i18n("yesterday"),current_week:UB.i18n("current_week"),this_month:UB.i18n("this_month"),this_year:UB.i18n("this_year")};o=v[e.filterType],"<="!==e.operator&&"<"!==e.operator||(l=!1)}break;case"boolean":break;case"float":case"int":switch(e.filterType){case"range":">="===e.operator?(e.value&&(o=e.value+""),(y=e.relatedFilter.value)&&(o+=" - "+y)):l=!1;break;case"br":case"isNull":break;default:o=(e.operator||"")+e.value}break;case"string":o="equal"===e.filterType?e.userValue||e.value:UB.i18n(e.filterType)+" "+(e.userValue||e.value)}}if(Ext.isEmpty(o)&&e.condition===a.sqlecIsNull&&(o=UB.i18n("isNull")),l){var b=n+(o?": "+Ext.String.ellipsis(o,70):"")+' <b class="ub-rem-filter">&#x2716;</b>';d?c[e.id].setText(b):s.push(Ext.create("Ext.button.Button",{xtype:"button",text:b,filterID:e.id,filterValue:e.value,cls:p?"ub-btn-ftr-disabled":"ub-btn-ftr",scope:t,handler:function n(i){h?t.gridOwner.onPrefilter():p||(i.hide(),t.removeFilter(e.id))}}))}}}),t.filterPenelFilters.items.each(function(e){1===u[e.filterID]&&t.filterPenelFilters.remove(e,!0)},t),s.length+t.filterPenelFilters.items.getCount()>0?(Ext.Array.each(s,function(e){t.filterPenelFilters.add(e)},t),t.filterPenel.show(),t.filterPenel.mustBeVisibled=!0):(t.filterPenel.hide(),t.filterPenel.mustBeVisibled=!1),t.gridOwner.updateVisibleBBar()},initBarControls:function e(){var t=this,n=t.gridOwner;t.filterPenel||(t.filterPenel=Ext.create("Ext.toolbar.Toolbar",{cls:"ub-grid-info-panel",border:0,margin:0,padding:0,flex:1,items:[{xtype:"button",style:"text-weight: bolder",margin:"0 0 0 0",tooltip:UB.i18n("clear"),text:" <b>&#x2716;</b>",handler:t.clearFilter,scope:t},{xtype:"label",html:UB.i18n("filter")+": "},t.filterPenelFilters=Ext.create("Ext.toolbar.Toolbar",{cls:"ub-grid-info-panel",border:0,margin:0,padding:0,flex:1,enableOverflow:!0})]}),n.filterBar.add(t.filterPenel))},removeFilter:function e(t,n){var i=this,r=i.gridOwner.store,o=r.filters.getByKey(t);o&&o.relatedFilter&&r.filters.removeAtKey(o.relatedFilter.id),r.filters.removeAtKey(t),i.filtersList[t]=void 0,r.filters.length?r.filter():r.clearFilter()},storeFiltered:function e(){var t=this,n=t.gridOwner,i=n.getSelectionModel();if(!i.getSelection().length)return void i.setCurrentPosition({row:0,column:t.selectedColumn})},getPrevFilter:function e(t,n){var i=this,r=i.gridOwner.store,o;return o=r.filters.getByKey(t),o&&o.relatedFilter?[o,o.relatedFilter]:o},getFilterPrefix:function e(t){return this.filterPrefix+t},setFilter:function e(t,n){var i=this,r=i.gridOwner.store,o=i.getFilterPrefix(t);r&&(r.filters.removeAtKey(o),r.filters.removeAtKey(o+"_to"),r.filter(n),i.filtersList[o]=!0)},statics:{dateValidator:function e(t){if(!t)return!0;var n=/^\d{2}([.\/\-])\d{2}\1\d{4}$/;return!!t.match(n)||" "},getWeekRange:function e(t,n){var i=new Date,r,o;return r=UB.core.UBUtil.addDays(i,-1*((i.getDay()||7)-1)),o=UB.core.UBUtil.addDays(i,7-(i.getDay()||7)),n||(r=UB.core.UBUtil.truncTimeToUtcNull(r),o=UB.core.UBUtil.truncTimeToUtcNull(o)),[r,o]},getMonthRange:function e(t,n){var i=new Date,r=i.getFullYear(),o=i.getMonth(),a=new Date(r,o,1),s=UB.core.UBUtil.addDays(new Date(r,o+1,1),-1);return n||(a=UB.core.UBUtil.truncTimeToUtcNull(a),s=UB.core.UBUtil.truncTimeToUtcNull(s)),[a,s]},getYearRange:function e(t,n){var i=new Date,r=i.getFullYear(),o=new Date(r,0,1),a=UB.core.UBUtil.addDays(new Date(r+1,0,1),-1);return n||(o=UB.core.UBUtil.truncTimeToUtcNull(o),a=UB.core.UBUtil.truncTimeToUtcNull(a)),[o,a]},getfilterFuncIsNull:function e(t){return function(e){return null===e.get(t)}},isNullFilterType:"isNull",predefinedFilters:{today:"date",yesterday:"date",current_week:"date",this_month:"date",this_year:"date",isNull:"no_filter"},filterTypeWidth:150,getNumericFilterInputS:function e(t,n,i,r){var o=this,a,s,l,u,c,d,f=$App.domainInfo.get(t).attr(n),h,p,m,g,y,v=!1,b,x;a=r.getFilterPrefix(n),s=r.getPrevFilter(a,n),s&&Ext.isArray(s)?Ext.Array.each(s,function(e){switch(e.controlID){case"number":u=e;break;case"numberTo":l=e}}):u=s||{filterType:"equal"},r.getInitParam&&(y=r.getInitParam(n)),y=y||{},Ext.isEmpty(y.required)||(v=y.required),Ext.isEmpty(y.filterType)||(b=y.filterType),x=u?u.filterType:b||"equal",h={hideTrigger:!0,isFormField:r.isPreFilter,controlID:"number",allowDecimals:i,width:90,margin:r.getItemMargin(),labelWidth:100,withoutIndent:!0},r.isPreFilter&&(h.hideLabel=!0),Ext.isEmpty(y.valueFrom)||(h.value=y.valueFrom),Ext.isEmpty(y.value)||(h.value=y.value),u&&(h.value=u.value),p=Ext.create("Ext.form.field.Number",h),h={fieldLabel:" -",labelSeparator:"",isFormField:r.isPreFilter,hideTrigger:!0,controlID:"numberTo",width:115,margin:r.getItemMargin(),labelWidth:20,allowDecimals:i,withoutIndent:!0},Ext.isEmpty(y.valueTo)||(h.value=y.valueTo),l&&(h.value=l.value),m=Ext.create("Ext.form.field.Number",h),g=function e(t,i){return m.hide(),p.hide(),m.allowBlank=!0,p.allowBlank=!0,"no_filter"===i||"isNull"===i?(p.reset(),m.reset(),p.setValue(null),m.setValue(null)):(p.allowBlank=!v,p.show()),"no_filter"!==i||r.isPreFilter?"isNull"!==i||r.isPreFilter?void("range"===i?(m.allowBlank=!v,m.show()):(m.reset(),m.setValue(null))):void c():void r.removeFilter(a,n)};var E=Ext.create("Ext.form.ComboBox",{fieldLabel:f.caption,hideLabel:r.isPreFilter,labelWidth:100,isFormField:r.isPreFilter,store:o.createFilterItems("number",f.allowNull),queryMode:"local",displayField:"text",valueField:"type",margin:r.getItemMargin(),width:this.filterTypeWidth,value:x,forceSelection:!0,editable:!1,withoutIndent:!0,listeners:{change:function e(t,n,i,r){g(t,n)}},validator:function e(t){return!v||"no_filter"!==this.getValue()||UB.i18n("filterIsRequired")}});g(E,x),d=function e(){var t,i,r,s,l,u,c;if(s=UB.core.UBCommand.condition,r=E.getValue(),t=p.getValue(),u=m.getValue(),"no_filter"===r||Ext.isEmpty(t)&&r!==o.isNullFilterType)return null;switch(l={id:a,root:"data",controlID:"number",property:n,filterType:r,value:t},r){case"more":l.operator=">";break;case"less":l.operator="<";break;case"equal":l.operator="=";break;case"range":l.operator=">=",c=Ext.create("Ext.util.Filter",{id:a+"_to",root:"data",property:n,controlID:"numberTo",operator:"<=",filterType:r,value:u});break;case"isNull":l.filterFn=function(e){return null===e.get(n)},l.condition=s.sqlecIsNull}return i=Ext.create("Ext.util.Filter",l),c?(i.relatedFilter=c,c.relatedFilter=i,[i,c]):i},c=function e(){var t=d();t?r.setFilter(n,t):r.removeFilter(a,n)},r.isPreFilter?(r.initFilterControl(n,"value",p),r.initFilterControl(n,"valueto",m),r.initFilterControl(n,"filterType",E),r.initFilterFunc(n,d)):(p.on("specialkey",function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),c())},o),m.on("specialkey",function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),c())},o));var w=[E,p,m];return r.isPreFilter||w.push(this.createSearchButton(c)),w},getBooleanFilterInputS:function e(t,n,i){var r=this,o=$App.domainInfo.get(t).attr(n),a={addnoFilterValue:!0},s=i.getFilterPrefix(n),l=i.getPrevFilter(s,n),u,c,d;a.fieldLabel=o.caption,a.isFormField=i.isPreFilter,a.labelWidth=100,a.filterEmptyValue="no_filter",a.value=a.filterEmptyValue,a.margin=i.getItemMargin(),a.width=this.filterTypeWidth,a.withoutIndent=!0,a.addEmptyValue=o.allowNull,l&&(a.value=0===l.value?0:l.value||l.filterType||"no_filter"),i.isPreFilter&&(a.hideLabel=!0),u=Ext.widget("ubboolbox",a),c=function e(){var t=u.getValue(),i=UB.core.UBCommand.condition,o;return Ext.isEmpty(t)||"no_filter"===t?null:o="isNull"===t?Ext.create("Ext.util.Filter",{id:s,root:"data",property:n,filterType:t,filterFn:r.getfilterFuncIsNull(n),condition:i.sqlecIsNull,value:null,userValue:u.inputEl?u.inputEl.getValue():""}):Ext.create("Ext.util.Filter",{id:s,root:"data",property:n,filterType:t,exactMatch:!0,operator:"=",value:t,userValue:u.inputEl?u.inputEl.getValue():t})},d=function e(){var t=c();t?i.setFilter(n,t):i.removeFilter(s,n)},i.isPreFilter?(i.initFilterFunc(n,c),i.initFilterControl(n,null,u)):u.on("change",function(e,t){i.isPreFilter||d()},r);var f=[u];return i.isPreFilter||f.push(this.createSearchButton(d)),f},getEnumFilterInputS:function e(t,n,i,r,o){var a=this,s=$App.domainInfo.get(t).attr(n),l=UB.core.UBUtil.getComponentConfig4Enum(i||s.enumGroup,r),u=o.getFilterPrefix(n),c=o.getPrevFilter(u,n),d,f,h,p,m,g,y=!1,v,b,x,E,w;o.getInitParam&&(g=o.getInitParam(n)),g=g||{},Ext.isEmpty(g.required)||(y=g.required),Ext.isEmpty(g.filterType)||(v=g.filterType),b=c?c.filterType:v||"by_value",c&&"no_filter"===v&&Ext.isEmpty(c.value)&&(b="no_filter"),l.width=180,l.labelWidth=100,l.isFormField=o.isPreFilter,l.allowBlank=!y,l.withoutIndent=!0,l.margin=o.getItemMargin(),Ext.isEmpty(g.value)||(w=g.value),c&&(w=c.value,l.hidden="by_several_value"===c.filterType),l.disableModifyEntity=!0,l.hideEntityItemInContext=!0,d=Ext.widget(l.xtype,l),E=d,l.hidden=!c||"by_several_value"!==c.filterType||"no_filter"===b,x=Ext.widget("ubmultiselecbox",l),w&&(c&&"by_several_value"===c.filterType&&(E=x),E!==x&&_.isArray(c.value)||E.setValue(c.value)),m=function e(t,i){return d.hide(),x.hide(),d.allowBlank=!0,"no_filter"!==i||o.isPreFilter?"isNull"!==i||o.isPreFilter?("no_filter"!==i&&"isNull"!==i||(d.reset(),x.reset()),void("by_several_value"===i?(x.allowBlank=!y,x.show()):(d.allowBlank=!y,d.show()))):void p():(d.reset(),x.reset(),void o.removeFilter(u,n))},f=Ext.create("Ext.form.ComboBox",{fieldLabel:s.caption,hideLabel:o.isPreFilter,isFormField:o.isPreFilter,labelWidth:100,store:a.createFilterItems("association",s.allowNull),queryMode:"local",displayField:"text",valueField:"type",value:b,margin:o.getItemMargin(),width:this.filterTypeWidth,forceSelection:!0,editable:!1,withoutIndent:!0,listeners:{change:function e(t,n,i,r){m(t,n)}},validator:function e(t){return!y||"no_filter"!==this.getValue()||UB.i18n("filterIsRequired")}}),m(f,b),h=function e(){var t=d.getValue(),i=UB.core.UBCommand.condition,r,o,s;if(o=f.getValue(),t="by_several_value"===o?x.getValue():d.getValue(),"no_filter"===o||Ext.isEmpty(t)&&o!==a.isNullFilterType)return null;switch(s={id:u,root:"data",filterType:o,property:n},o){case"isNull":s.filterFn=a.getfilterFuncIsNull(n),s.condition=i.sqlecIsNull,s.value=null;break;case"by_value":s.text=d.getDisplayValue(),s.anyMatch=!0,s.value=t;break;case"by_several_value":s.text=x.getDisplayValue(),s.condition=i.sqlecIn,s.value=t}return r=Ext.create("Ext.util.Filter",s)},p=function e(){var t=h();t?o.setFilter(n,t):o.removeFilter(u,n)},o.isPreFilter?(o.initFilterFunc(n,h),o.initFilterControl(n,"filterType",f),o.initFilterControl(n,null,d),o.initFilterControl(n,"multi",x)):(d.on("change",function(e,t){e.findRecordByDisplay(t)&&p()},a),x.on("specialkey",function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),p())},a),x.on("itemSelected",function(){p()},a));var C=[f,d,x];return o.isPreFilter||C.push(this.createSearchButton(p)),C},getAssociationFilterInputS:function e(t,n,i,r){var o=this,a=$App.domainInfo.get(t).attr(n),s=UB.core.UBUtil.getComponentConfig4Entity(a.associatedEntity,i),l=r.getFilterPrefix(n),u=r.getPrevFilter(l,n),c,d,f,h,p,m,g,y,v=!1,b,x,E;i=i||{},r.getInitParam&&(y=r.getInitParam(n)),y=y||{},Ext.isEmpty(y.required)||(v=y.required),Ext.isEmpty(y.filterType)||(b=y.filterType),x=(u?u.filterType:null)||b||"by_value",u&&"no_filter"===b&&Ext.isEmpty(u.value)&&(x="no_filter"),s.width=180,s.labelWidth=100,s.isFormField=r.isPreFilter,s.allowBlank=!v,s.withoutIndent=!0,s.margin=r.getItemMargin(),Ext.isEmpty(y.value)||(E=y.value),u&&(E=u.value,s.hidden="by_several_value"===u.filterType),s.hidden=s.hidden||"no_filter"===x,s.disableModifyEntity=!0,s.hideEntityItemInContext=!0,c=Ext.widget(s.xtype,s),f=c,s.hidden=!u||"by_several_value"!==u.filterType||"no_filter"===x,d=Ext.widget("ubmultiselecbox",s),E&&(u&&"by_several_value"===u.filterType&&(f=d),f.setValueById?f.setValueById(u.value):f.setValue(u.value)),g=function e(t,i){return c.hide(),d.hide(),c.allowBlank=!0,"no_filter"!==i||r.isPreFilter?"isNull"!==i||r.isPreFilter?("no_filter"!==i&&"isNull"!==i||(c.reset(),d.reset()),void("by_several_value"===i?(d.allowBlank=!v,d.show()):(c.allowBlank=!v,c.show()))):void h():(c.reset(),d.reset(),void r.removeFilter(l,n))},m=Ext.create("Ext.form.ComboBox",{fieldLabel:a.caption,isFormField:r.isPreFilter,hideLabel:r.isPreFilter,labelWidth:100,store:o.createFilterItems("association",a.allowNull),queryMode:"local",displayField:"text",valueField:"type",value:x,margin:r.getItemMargin(),width:this.filterTypeWidth,forceSelection:!0,editable:!1,withoutIndent:!0,listeners:{change:function e(t,n,i,r){g(t,n)}}}),m.setValue(x),p=function e(){var t,i=UB.core.UBCommand.condition,r,s,u;if(s=m.getValue(),t="by_several_value"===s?d.getValue():c.getValue(),"no_filter"===s||Ext.isEmpty(t)&&s!==o.isNullFilterType)return null;switch(u={id:l,root:"data",filterType:s,property:n},s){case"isNull":u.filterFn=o.getfilterFuncIsNull(n),u.condition=i.sqlecIsNull,u.value=null;break;case"by_value":"Many"===a.dataType?(u.condition=i.sqlecIn,u.value=[t]):(u.anyMatch=!0,u.value=t),u.text=c.getDisplayValue();break;case"by_several_value":u.text=d.getDisplayValue(),u.condition=i.sqlecIn,u.value=t}return r=Ext.create("Ext.util.Filter",u)},h=function e(){var t=p();t?r.setFilter(n,t):r.removeFilter(l,n)},r.isPreFilter?(r.initFilterFunc(n,p),r.initFilterControl(n,"filterType",m),r.initFilterControl(n,null,c),r.initFilterControl(n,"multi",d)):(c.on("change",function(e,t){e.findRecordByDisplay(t)&&h()},o),c.on("specialkey",function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),h())},o),d.on("specialkey",function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),h())},o),d.on("itemSelected",function(){h()},o));var w=[m,c,d];return r.isPreFilter||w.push(this.createSearchButton(h)),w},filterTypeStores:{},createFilterItems:function e(t,n){var i=this,r=[{type:"no_filter",text:"no_filter"}],o=t+(n+""),a;if(!(a=i.filterTypeStores[o])){switch(t){case"date":r.push({type:"today",text:"today"},{type:"yesterday",text:"yesterday"},{type:"current_week",text:"current_week"},{type:"this_month",text:"this_month"},{type:"this_year",text:"this_year"},{type:"from_date",text:"from_date"},{type:"to_date",text:"to_date"},{type:"date",text:"date"},{type:"period",text:"period"});break;case"string":r.push({type:"startWith",text:"startWith"},{type:"contains",text:"contains"},{type:"equal",text:"equal"});break;case"number":r.push({type:"more",text:"more"},{type:"less",text:"less"},{type:"equal",text:"equal"},{type:"range",text:"range"});break;case"association":r.push({type:"by_value",text:"by_value"},{type:"by_several_value",text:"by_several_value"})}n&&r.push({type:"isNull",text:"isNull"}),_.forEach(r,function(e){e.text=UB.i18n(e.text)}),i.filterTypeStores[o]=a=Ext.create("Ext.data.Store",{fields:["type","text"],data:r})}return a},createSearchButton:function e(t){return Ext.create("Ext.button.Button",{scale:"medium",glyph:UB.core.UBUtil.glyphs.faBinoculars,tooltip:UB.i18n("search"),margin:"0 0 0 8",handler:t})},getPlainTextFilterS:function e(t,n,i){var r=this,o,a=$App.domainInfo.get(t).attr(n),s,l,u,c,d,f,h,p=!1,m,g,y;s=i.getFilterPrefix(n),l=i.getPrevFilter(s,n),i.getInitParam&&(h=i.getInitParam(n)),h=h||{},Ext.isEmpty(h.required)||(p=h.required),Ext.isEmpty(h.filterType)||(m=h.filterType),g=l?l.filterType:m||"contains",l&&"no_filter"===m&&Ext.isEmpty(l.value)&&(g="no_filter"),u={isFormField:i.isPreFilter,labelCls:"ub-overflow-elips",labelWidth:100,enforceMaxLength:!0,margin:i.getItemMargin(),maxLength:a.size||2e3,withoutIndent:!0},Ext.isEmpty(h.value)||(u.value=h.value),l&&(u.value=l.value),i.isPreFilter&&(u.hideLabel=!0),u.enforceMaxLength=!!UB.appConfig.maxSearchLength,u.enforceMaxLength&&(u.maxLength=UB.appConfig.maxSearchLength),c=Ext.create("Ext.form.field.Text",u),o=function e(t,r){return c.hide(),c.allowBlank=!0,"no_filter"!==r||i.isPreFilter?"isNull"!==r||i.isPreFilter?void("no_filter"===r||"isNull"===r?c.reset():(c.allowBlank=!p,c.show())):void d():void i.removeFilter(s,n)},y=a.caption;var v=Ext.create("Ext.form.ComboBox",{fieldLabel:y,hideLabel:i.isPreFilter,isFormField:i.isPreFilter,labelWidth:100,margin:i.getItemMargin(),store:r.createFilterItems("string",a.allowNull),queryMode:"local",displayField:"text",valueField:"type",width:this.filterTypeWidth,value:g,forceSelection:!0,editable:!1,withoutIndent:!0,listeners:{afterrender:function e(t){Ext.create("Ext.tip.ToolTip",{target:t.getEl(),html:y})},change:function e(t,n,i,r){o(t,n)}},validator:function e(t){return!p||"no_filter"!==this.getValue()||UB.i18n("filterIsRequired")}});o(v,g),f=function e(){var t,i,o,a,l,u;if(l=UB.core.UBCommand.condition,a=v.getValue(),t=c.getValue(),"no_filter"===a||(!t||!t.trim())&&a!==r.isNullFilterType)return null;switch(u={id:s,root:"data",property:n,filterType:a,value:t,userValue:t},a){case"contains":i=RegExp(UB.Utils.escapeForRegexp(t),"i"),u.filterFn=function(e){var t=e.get(n);return t&&null!==t.match(i)},u.condition=l.sqlecLike;break;case"startWith":u.filterFn=function(e){var i=e.get(n);return i&&0===i.toLowerCase().indexOf(t)},u.condition=l.sqlecStartWith;break;case"equal":i=RegExp("^"+UB.Utils.escapeForRegexp(t)+"$","i"),u.filterFn=function(e){var t=e.get(n);return i.test(t)},u.condition=l.sqlecEqual;break;case"isNull":u.filterFn=function(e){return null===e.get(n)},u.condition=l.sqlecIsNull;break;case"no_filter":return null}return o=Ext.create("Ext.util.Filter",u)},d=function e(){var t=f();t?i.setFilter(n,t):i.removeFilter(s,n)},i.isPreFilter?(i.initFilterFunc(n,f),i.initFilterControl(n,null,c),i.initFilterControl(n,"filterType",v)):c.on("specialkey",function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),d())},r);var b=[v,c];return i.isPreFilter||b.push(this.createSearchButton(d)),b},getOnChangeHandler:function e(t,n,i){return function(e,t){var n,i;e.isValid()&&("fromDate"===e.dateRole?(e.relatedPiker.setMinValue(t),n=t,i=e.relatedPiker.getValue()||0):(e.relatedPiker.setMaxValue(t),i=t,n=e.relatedPiker.getValue()||0))}},getDateFilterInputS:function e(t,n,i){var r=this,o,a=i.getFilterPrefix(n),s=i.getPrevFilter(a,n),l=$App.domainInfo.get(t).attr(n),u,c,d,f,h,p,m,g,y,v,b=!1,x,E,w,C,_;_=l.dataType,C="DateTime"===_,i.getInitParam&&(v=i.getInitParam(n)),v=v||{},Ext.isEmpty(v.required)||(b=v.required),Ext.isEmpty(v.filterType)||(x=v.filterType),s&&Ext.isArray(s)?Ext.Array.each(s,function(e){switch(u=e,e.controlID){case"date":m=e;break;case"dateFrom":g=e;break;case"dateTo":y=e}}):(u=s||{filterType:x||"date"},m=u),u=u||{filterType:x||"date"},E=u.filterType||x||"date",C&&("date"===u.filterType||"today"===u.filterType||"yesterday"===u.filterType)&&g&&(m=g),u&&"no_filter"===x&&Ext.isEmpty(u.valueFrom)&&Ext.isEmpty(u.value)&&(E="no_filter"),w=null,Ext.isEmpty(v.valueFrom)||(w=v.valueFrom),g&&(w=g.value),c=this.getOnChangeHandler(a,n,i),d=Ext.widget("ubdatefield",{isFormField:i.isPreFilter,value:w,hidden:"period"!==E,allowBlank:!b,dateRole:"fromDate",fieldType:_,withoutIndent:!0,margin:i.getItemMargin(),listeners:{scope:i,change:c}}),w=null,Ext.isEmpty(v.valueTo)||(w=v.valueTo),y&&(w=C?UB.core.UBUtil.addDays(y.value,-1):y.value),f=Ext.widget("ubdatefield",{labelWidth:10,isFormField:i.isPreFilter,labelSeparator:"",fieldLabel:" -",value:w,allowBlank:!b,dateRole:"toDate",hidden:"period"!==E,fieldType:_,withoutIndent:!0,margin:i.getItemMargin(),listeners:{scope:i,change:c}}),w=null,Ext.isEmpty(v.value)||(w=v.value),m&&(w=m.value,C&&"to_date"===u.filterType&&(w=UB.core.UBUtil.addDays(w,-1))),h=Ext.widget("ubdatefield",{isFormField:i.isPreFilter,value:w,allowBlank:!b,fieldType:_,margin:i.getItemMargin(),withoutIndent:!0,hidden:!("date"===E||"from_date"===E||"to_date"===E)}),d.relatedPiker=f,f.relatedPiker=d;var B=function e(t,r){return d.hide(),f.hide(),h.hide(),d.reset(),f.reset(),h.reset(),d.allowBlank=!0,f.allowBlank=!0,h.allowBlank=!0,"no_filter"===r?void(i.isPreFilter||i.removeFilter(a,n)):"isNull"===r?void(i.isPreFilter||p()):"period"===r?(d.allowBlank=!b,f.allowBlank=!b,d.show(),void f.show()):"date"===r||"from_date"===r||"to_date"===r?(h.allowBlank=!b,void h.show()):void 0},U=Ext.create("Ext.form.ComboBox",{fieldLabel:l.caption,hideLabel:i.isPreFilter,isFormField:i.isPreFilter,labelWidth:100,store:r.createFilterItems("date",l.allowNull),queryMode:"local",displayField:"text",valueField:"type",margin:i.getItemMargin(),width:this.filterTypeWidth,value:E,forceSelection:!0,withoutIndent:!0,editable:!1,validator:function e(){return!b||"no_filter"!==this.getValue()||UB.i18n("filterIsRequired")},listeners:{change:function e(t,n,i,r){B(t,n)}}});B(U,E),o=function e(){var t,i,o,s,l,u,c,p,m,g=[],y;switch(y=UB.core.UBCommand.condition,t=U.getValue(),i=d.getValue(),s=f.getValue(),o=h.getValue(),t){case"no_filter":return null;case"today":l=new Date,C?(l=UB.core.UBUtil.truncTime(l),c=[l,UB.core.UBUtil.addDays(l,1)],l=null):(l=UB.core.UBUtil.truncTimeToUtcNull(l),u="=");break;case"yesterday":l=UB.core.UBUtil.addDays(new Date,-1),C?(c=[UB.core.UBUtil.truncTime(l),UB.core.UBUtil.truncTime(new Date)],l=null):(l=UB.core.UBUtil.truncTimeToUtcNull(l),u="=");break;case"current_week":C?(c=UB.ux.Multifilter.getWeekRange(_,!0),c[0]=UB.core.UBUtil.truncTime(c[0]),c[1]=UB.core.UBUtil.addDays(UB.core.UBUtil.truncTime(c[1]),1)):c=UB.ux.Multifilter.getWeekRange(_);break;case"this_month":C?(c=UB.ux.Multifilter.getMonthRange(_,!0),c[0]=UB.core.UBUtil.truncTime(c[0]),c[1]=UB.core.UBUtil.addDays(UB.core.UBUtil.truncTime(c[1]),1)):c=UB.ux.Multifilter.getMonthRange(_);break;case"this_year":C?(c=UB.ux.Multifilter.getYearRange(_,!0),c[0]=UB.core.UBUtil.truncTime(c[0]),c[1]=UB.core.UBUtil.addDays(UB.core.UBUtil.truncTime(c[1]),1)):c=UB.ux.Multifilter.getYearRange(_);break;case"from_date":l=UB.core.UBUtil.truncTimeToUtcNull(o),C&&(l=UB.core.UBUtil.truncTime(o)),u=">=";break;case"to_date":l=UB.core.UBUtil.truncTimeToUtcNull(o),u="<=",C&&(u="<",l=UB.core.UBUtil.addDays(UB.core.UBUtil.truncTime(o),1));break;case"date":C?(l=UB.core.UBUtil.truncTime(o),c=[l,UB.core.UBUtil.addDays(l,1)],l=null):(l=UB.core.UBUtil.truncTimeToUtcNull(o),u="=");break;case"period":c=[UB.core.UBUtil.truncTimeToUtcNull(i),UB.core.UBUtil.truncTimeToUtcNull(s)],C&&(c=[UB.core.UBUtil.truncTime(i),UB.core.UBUtil.addDays(UB.core.UBUtil.truncTime(s),1)]);break;case"isNull":g.push(Ext.create("Ext.util.Filter",{id:a,root:"data",filterType:t,property:n,filterFn:r.getfilterFuncIsNull(n),condition:y.sqlecIsNull,value:null}))}return l&&g.push(Ext.create("Ext.util.Filter",{id:a,root:"data",filterType:t,property:n,operator:u,controlID:"date",exactMatch:!0,isTime:C,value:l})),c&&c[0]&&c[1]&&(p=Ext.create("Ext.util.Filter",{id:a,root:"data",filterType:t,property:n,controlID:"dateFrom",operator:">=",isTime:C,value:c[0]}),m=Ext.create("Ext.util.Filter",{id:a+"_to",root:"data",property:n,filterType:t,controlID:"dateTo",operator:C?"<":"<=",isTime:C,value:c[1]}),p.relatedFilter=m,m.relatedFilter=p,g.push(p,m)),g},p=function e(){var t=o();t?i.setFilter(n,t):i.removeFilter(a,n)},i.isPreFilter?(i.initFilterFunc(n,o),i.initFilterControl(n,"date",h),i.initFilterControl(n,"fromDate",d),i.initFilterControl(n,"toDate",f),i.initFilterControl(n,"filterType",U)):(h.on("specialkey",function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),p())},r),d.on("specialkey",function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),p())},r),f.on("specialkey",function(e,t){t.getKey()===t.ENTER&&(t.stopEvent(),p())},r));var I=[U,d,f,h];return i.isPreFilter||I.push(this.createSearchButton(p)),I}}})},function(e,t,n){n(23),Ext.define("UB.ux.form.field.UBMultiSelectBox",{extend:"UB.ux.form.field.UBBaseComboBox",alias:"widget.ubmultiselecbox",multiSelect:!0,initComponent:function e(){var t=this;t.displayTpl='<tpl for=".">{[Ext.String.ellipsis(typeof values === "string" ? values : values["'+t.displayField+'"], 16)]}<tpl if="xindex < xcount">'+t.delimiter+"</tpl></tpl>",t.callParent(arguments),t.addEvents("itemSelected")},initContextMenu:function e(){var t=this;t.callParent(arguments),t.editItemButton&&(t.editItemButton.disable(),t.editItemButton.hide()),t.showLookupButton&&(t.showLookupButton.disable(),t.showLookupButton.hide()),t.addItemButton&&(t.addItemButton.disable(),t.addItemButton.hide())},editItem:function e(){},showLookup:function e(){},queryDelay:500,afterRender:function e(){var t=this,n;t.callParent(arguments),n=Ext.get(t.getInputId()),n.dom.readOnly=!0},onTriggerClick:function e(){function t(){var e=u.getSelectionModel();d=!0,l.each(function(t){var i,o=-1;i=r.findRecord(n.valueField,t.get(n.valueField)),i&&(o=r.indexOf(i)),o>=0&&e.select(o,!0,!0)},n),d=!1}var n=this,i,r,o,a,s,l,u,c,d=!1,f;n.store.ubRequest?(f=Ext.clone(n.store.ubRequest),f.orderList=[{expression:n.displayField,order:"ASC"}],r=Ext.create("UB.ux.data.UBStore",{ubRequest:f,autoLoad:!1,autoDestroy:!0}),r.load(),r.on("load",function(){u&&t()})):(r=Ext.create("Ext.data.Store",{model:n.store.model,sorters:[{property:n.displayField}],proxy:{type:"memory",enablePaging:!0},autoLoad:!1,autoDestroy:!0}),r.load(),r.add(n.store.getRange(0,n.store.getCount()-1))),o=Ext.widget("toolbar",{dock:"bottom",border:"1 0 0 0",cls:"ub-grid-info-panel",style:"border-top-width: 1px !important;",items:[Ext.widget("tbfill"),Ext.widget("tbseparator"),n.pagingBar=Ext.create("UB.view.PagingToolbar",{isPagingBar:!0,cls:"ub-grid-info-panel",border:0,margin:0,padding:"0 0 0 5",width:180,store:r})]}),n.store.ubRequest||o.hide(),s=new Ext.util.DelayedTask(function(){""===a.getValue()?(r.filters.removeAtKey("searchTask"),r.clearFilter()):r.filter({id:"searchTask",property:n.displayField,condition:UB.core.UBCommand.condition.sqlecLike,value:a.getValue()})},n),a=Ext.widget("textfield",{labelWidth:60,fieldLabel:UB.i18n("filter")}),a.on("change",function(e,t){s.delay(n.queryDelay)}),l=Ext.create("Ext.data.Store",{model:n.store.model,sorters:[{property:n.displayField}],proxy:{type:"memory"}});var h=n.getValue();if(h&&h.length>0)if(n.store.ubRequest){f=Ext.clone(n.store.ubRequest),delete f.orderList,f.whereList=f.whereList||{};var p={};p[n.valueField]=h,f.whereList["selectedItems"+(new Date).getTime()]={condition:"in",expression:"["+n.valueField+"]",values:p},Ext.create("UB.ux.data.UBStore",{ubRequest:f}).load().done(function(e){l.add(e.getRange(0,e.getCount()-1)),t()})}else _.forEach(h,function(e){var t=n.store.findRecord(n.valueField,e);t&&l.add(t)});i=Ext.create("Ext.window.Window",{padding:"5 5 0 5",height:450,width:550,modal:!0,stateful:!!n.store.ubRequest,stateId:"nultiselect_"+(n.store.ubRequest?n.store.ubRequest.entity:""),layout:"fit",title:UB.i18n("selectElements")+(n.fieldLabel?" - "+n.fieldLabel:""),items:[{layout:{type:"hbox",align:"stretch"},items:[c=Ext.widget("grid",{xtype:"grid",hideHeaders:!0,flex:1,title:UB.i18n("selectedElements"),store:l,tbar:{items:[]},columns:[{name:"id",width:25,dataIndex:n.valueField,renderer:function e(t){return'<a style="color: #141b9b; cursor:pointer;" class="fa fa-times"></a>'}},{name:"name",dataIndex:n.displayField,flex:1}],listeners:{cellclick:function e(t,i,o,a,s,c,d,f){if(0===o){l.remove(a);var h=-1,p=u.getSelectionModel(),m=r.findRecord(n.valueField,a.get(n.valueField));m&&(h=r.indexOf(m)),h>=0&&p.deselect(h,!0)}},scope:n}}),{xtype:"splitter"},u=Ext.widget("grid",{selModel:{selType:"checkboxmodel",checkOnly:!0,pruneRemoved:!1,showHeaderCheckbox:!0,listeners:{select:function e(t,n,i){d||l.add(n)},deselect:function e(t,i,r){if(!d){var o=l.findRecord(n.valueField,i.get(n.valueField));o&&l.remove(o)}},scope:n}},hideHeaders:!0,flex:1,title:UB.i18n("allElements"),store:r,hideActionToolbar:!0,tbar:{items:[a]},bbar:o,columns:[{name:"name",dataIndex:n.displayField,flex:1}]})]}],buttons:[{text:UB.i18n("clear"),glyph:UB.core.UBUtil.glyphs.faEraser,handler:function e(){l.removeAll(),d=!0,u.getSelectionModel().deselectAll(!0),d=!1}},{text:UB.i18n("selectAll"),tooltip:UB.i18n("selectAllOnPage"),handler:function e(){var t=u.getSelectionModel(),i=[],r;t.selectAll(!0),t.selected.each(function(e){(r=l.findRecord(n.valueField,e.get(n.valueField)))||i.push(e)}),l.add(i)}},{xtype:"panel",flex:1},{text:UB.i18n("ok"),glyph:UB.core.UBUtil.glyphs.faCheck,handler:function e(){n.setValue(l.getRange(0,l.getCount()-1)),i.close(),n.fireEvent("itemSelected",n)}},{text:UB.i18n("cancel"),glyph:UB.core.UBUtil.glyphs.faTimes,handler:function e(){i.close()}}]}),i.center(),i.show(),t(),i.on("close",function(){s.cancel()})},setValueById:function e(t,n,i,r){function o(e,o){a.setValue(o?null:e||t),n&&a.resetOriginalValue(),s.resumeEvent("clear"),a.lastQuery=null,i&&Ext.callback(i,r||a,[a])}var a=this;if(Ext.isEmpty(t))return n&&a.resetOriginalValue(),void(i&&Ext.callback(i,r||a,[a]));var s=a.getStore();s.on({load:{fn:function e(){if(0===s.getCount()){var n=$App.domainInfo.get(a.getEntity());n.hasMixin("mStorage")&&n.mixin("mStorage").safeDelete||n.hasMixin("dataHistory")?$App.connection.select({entity:a.getEntity(),fieldList:s.ubRequest.fieldList,__allowSelectSafeDeleted:!0,ID:t}).done(function(e){if(!s.isDestroyed){var t=Ext.create(s.model);if(!UB.ux.data.UBStore.resultDataRow2Record(e,t))return void o(null,!0);if(UB.ux.data.UBStore.resetRecord(t),s.add(t,!0),o(t),a.fieldCls+=" ub-combo-deleted",a.rendered){Ext.get(a.getInputId()).addCls("ub-combo-deleted")}a.phantomSelectedElement=!0,a.tipPhantomElement=Ext.create("Ext.tip.ToolTip",{target:a.getInputId(),html:UB.i18n("elementIsNotActual")})}}):o(null,!0)}else 1===s.getCount()?o(s.getAt(0)):o()},single:!0}}),s.suspendEvent("clear"),s.filter(new Ext.util.Filter({id:a.userFilterId,root:"data",property:"ID",condition:t&&_.isArray(t)?"in":"equal",value:t}))}})},function(e,t){Ext.define("UB.view.PagingToolbar",{extend:"Ext.toolbar.Paging",alias:"widget.pagingtb",requires:["Ext.data.Store"],baseWidth:130,width:160,initComponent:function e(){var t=this;t.beforePageText="",t.lastTotalCount=null,t.callParent(),t.store&&t.store.on("load",t.onStoreLoad,t),t.child("#first").hide(),t.child("#last").hide(),t.child("#afterTextItem").hide(),t.child("#refresh").hide(),t.child("#inputItem").hide(),t.child("#inputItem").setMinValue(1),t.addEvents("totalChanged")},onStoreLoad:function e(){this.onLoad()},getPagingItems:function e(){function t(){n.lastTotalCount=null,n.store.ubRequest.options||(n.store.ubRequest.options={}),n.store.ubRequest.options.totalRequired=!0}var n=this,i;return i=n.callParent(arguments),n.buttonCount=Ext.create("Ext.Button",{focusOnToFront:!1,iconCls:"ub-sum-row-icon",tooltip:UB.i18n("calcRowCount"),handler:n.calcTotalRow,scope:n,margin:"0 0 0 0",hidden:!!n.autoCalcTotal}),n.labelCtrl=Ext.create("Ext.form.Label",{text:"",hidden:!n.autoCalcTotal,cls:"ub-total-row",listeners:{boxready:function e(){n.labelCtrl.getEl().set({"data-qtip":UB.i18n("totalRowCount")})}}}),n.store.on("refresh",function(){n.autoCalcTotal&&(n.store.totalCount<0&&null===n.lastTotalCount&&(n.labelCtrl.hide(),n.buttonCount.show(),n.autoCalcTotal=!1),n.store.totalCount>=0&&(n.lastTotalCount=n.store.totalCount),n.setTotal(null!==n.lastTotalCount?n.lastTotalCount:n.store.totalCount))},n),n.store.on("beforereload",t,n),n.store.filters.on("add",t,n),n.store.filters.on("clear",t,n),n.store.filters.on("remove",t,n),n.store.filters.on("replace",t,n),n.buttonPage=Ext.create("Ext.Button",{focusOnToFront:!1,tooltip:UB.i18n("currentPageNumber"),text:"1",handler:function e(){n.selectPage()},scope:n,cls:"UB-paging-toolbar-page",margin:"0 0 0 0"}),i[0].hiden=!0,i[4].hiden=!0,i[5].hiden=!0,i[8].hiden=!0,i[10].hiden=!0,i.push("-",n.buttonCount,n.labelCtrl),i.splice(6,1),i.splice(8,1),i.splice(5,0,n.buttonPage),i.splice(2,2),i},onLoad:function e(){var t=this,n,i,r;if(t.callParent(),(r=t.store.getCount())>0)n=t.getPageData(),i=UB.format(t.afterPageText,n.total<0?"?":n.pageCount),t.child("#inputItem").setDisabled(t.store.pageSize>r&&1===n.currentPage);else{if(t.store.currentPage>1){var o=t.child("#inputItem");o.setDisabled(!1),o.setValue(t.store.currentPage),t.child("#first").setDisabled(!1),t.child("#prev").setDisabled(!1)}t.child("#inputItem").setDisabled(!0)}if(t.child("#afterTextItem").setText(i),t.buttonPage.setText(parseInt(t.store.currentPage,10).toLocaleString()),t.store.currentPage<=1&&r<t.store.pageSize)return t.buttonCount.hide(),t.setTotal(r),void(t.rendered&&Ext.AbstractComponent.updateLayout(t,!0));void 0!==t.store.totalCount&&t.store.totalCount>=0&&(t.buttonCount.hide(),t.setTotal(t.store.totalCount),t.lastTotalCount=t.store.totalCount),!t.autoCalcTotal&&t.labelCtrl.isVisible()&&(t.labelCtrl.hide(),t.buttonCount.show(),t.setWidth(t.baseWidth+t.buttonCount.getWidth()),t.fireEvent("totalChanged",null)),t.rendered&&Ext.AbstractComponent.updateLayout(t,!0)},selectPage:function e(t){function n(e){i.store.loadPage(e.itemNum)}var i=this,r=[],o,a,s=!1,l,u=7,c=3,d;o=t||(i.store.currentPage-3>0?i.store.currentPage-3:1),a=o+7,d=null!==i.lastTotalCount?i.lastTotalCount:i.store.totalCount,void 0!==d&&d>0&&(l=d/i.store.pageSize,Math.floor(l)!==l&&(l+=1),l=Math.floor(l),a=l,o>a&&(o=a-7>0?a-7:1),a>o+7-1?a=o+7-1:s=!0),o>1&&(r.push({text:1,itemNum:1,handler:n}),o>2&&r.push({text:"...",handler:function e(){i.selectPage(o-7<=0?1:o-7)}}));for(var f=o;f<=a;f++)r.push({text:f,itemNum:f,disabled:i.store.currentPage===f,handler:n});s||(r.push({text:"...",handler:function e(){i.selectPage(a)}}),l&&r.push({xtype:"label",text:l,disabled:!0})),i.contextMenu?(i.contextMenu.removeAll(),i.contextMenu.add(r)):i.contextMenu=Ext.create("Ext.menu.Menu",{width:60,minWidth:60,cls:"ub-paging-tb-menu",plain:!0,margin:"0 0 5 0",items:r}),r.length>0&&i.contextMenu.showBy(i.buttonPage)},calcTotalRow:function e(){var t=this,n=t.store;n.ubRequest.options||(n.ubRequest.options={}),n.ubRequest.options.totalRequired=!0,t.autoCalcTotal=!0,n.load(),t.buttonCount.hide()},decreaseTotal:function e(){"number"==typeof this.lastTotal&&this.setTotal(this.lastTotal-1)},updateTotal:function e(){this.setTotal(this.lastTotal||0)},setTotal:function e(t){var n=this;n.labelCtrl.setText(t||0===t?Ext.util.Format.number(parseInt(t,10),"0,000"):"-"),n.labelCtrl.show(),n.setWidth(n.baseWidth+(n.labelCtrl.rendered?n.labelCtrl.getWidth():0)),n.fireEvent("totalChanged",t),n.store.ubRequest&&n.store.ubRequest.options&&(n.store.ubRequest.options.totalRequired=!1),n.lastTotal=t},readPageFromInput:function e(t){var n=this.getInputItem();return n.getValue()<=0?(n.setValue(t.currentPage),!1):this.callParent(arguments)},getPageData:function e(){var t=this.store,n=t.getTotalCount();return{total:n,currentPage:t.currentPage,pageCount:n<0?t.currentPage+1:Math.ceil(n/t.pageSize),fromRecord:(t.currentPage-1)*t.pageSize+1,toRecord:Math.min(t.currentPage*t.pageSize,n)}},moveNext:function e(){var t=this,n=t.getPageData(),i=n.pageCount,r=t.store.currentPage+1;(n.total<0||r<=i)&&!1!==t.fireEvent("beforechange",t,r)&&t.store.nextPage()},onPagingKeyDown:function e(t,n){var i=this,r=n.getKey(),o=i.getPageData(),a=n.shiftKey?10:1,s;r===n.RETURN?(n.stopEvent(),!1!==(s=i.readPageFromInput(o))&&!1!==i.fireEvent("beforechange",i,s)&&i.store.loadPage(s)):r===n.HOME?(n.stopEvent(),s=1,t.setValue(s)):r!==n.UP&&r!==n.PAGE_UP&&r!==n.DOWN&&r!==n.PAGE_DOWN||(n.stopEvent(),(s=i.readPageFromInput(o))&&(r!==n.DOWN&&r!==n.PAGE_DOWN||(a*=-1),(s+=a)>=1&&t.setValue(s)))}})},function(e,t,n){n(127),n(128),n(129),n(130),Ext.define("Ext.ux.exporter.Exporter",{uses:["Ext.ux.exporter.Base64","Ext.ux.exporter.Button","Ext.ux.exporter.csvFormatter.CsvFormatter","Ext.ux.exporter.wikiFormatter.WikiFormatter","Ext.ux.exporter.excelFormatter.ExcelFormatter","Ext.ux.exporter.htmlFormatter.HtmlFormatter","Ext.ux.exporter.xlsxFormatter.XlsxFormatter"],statics:{exportAny:function e(t,n,i){var r="export";t.is?t.is("gridpanel")?r+="Grid":t.is("treepanel")?r+="Tree":(r+="Store",t=t.getStore()):r+="Store",this[r](t,this.getFormatterByName(n),i)},exportGrid:function e(t,n,i){i=i||{},n=this.getFormatterByName(n);var r=Ext.Array.filter(t.columns,function(e){return!e.hidden&&!e.disableExport});r=r.sort(function(e,t){return e.getIndex()<t.getIndex()?-1:1}),Ext.applyIf(i,{title:t.title,columns:r}),this.doFormat(n,t.store,i)},exportStore:function e(t,n,i){i=i||{},n=this.getFormatterByName(n),Ext.applyIf(i,{columns:t.fields?t.fields.items:t.model.prototype.fields.items}),this.doFormat(n,t,i)},doFormat:function e(t,n,r){var o=r.callback;if(Ext.getBody().mask(UB.i18n("pleaseWait")),r.callback=function(e){Ext.getBody().unmask(),o.call(r.scope,e)},n.buffered||n.pageSize&&n.pageSize>0){var a,s,l,u={},c,d;d=r.entityName,s=Ext.apply(Ext.clone(n.ubRequest),{options:{start:0,totalRequired:!0}}),l=UB.ux.data.proxy.UBProxy.ubFilterToWhereList(n.filters.getRange(),d),s.whereList=s.whereList||{},Ext.Object.merge(s.whereList,l);var f,h=100,p;if(n.sorters&&(p=n.sorters.length)>0)for(s.orderList={},i=0;i<p;++i)f=n.sorters.get(i),s.orderList["x"+h++]={expression:f.property,order:"ASC"===f.direction?"asc":"desc"};delete s.limit,$App.connection.select(s).done(function(e){Ext.Array.each(s.fieldList,function(e,t){u[e]=t},this),c={data:e.resultData.data},c.dataFieldsMap=u,c.isRawData=!0,c.ubRequest=n.ubRequest,c.model=n.model,t.format(c,r)})}else t.format(n,r)},exportTree:function e(t,n,i){i=i||{},n=this.getFormatterByName(n);var r=t.store||i.store;Ext.applyIf(i,{title:t.title}),this.doFormat(n,r,i)},getFormatterByName:function e(t){return t=t||"csv",t=Ext.isString(t)?Ext.create("Ext.ux.exporter."+t+"Formatter."+Ext.String.capitalize(t)+"Formatter"):t}}})},function(e,t){Ext.define("Ext.ux.exporter.Formatter",{format:Ext.emptyFn,constructor:function e(t){t=t||{},Ext.applyIf(t,{})}})},function(e,t){Ext.define("Ext.ux.exporter.csvFormatter.CsvFormatter",{extend:"Ext.ux.exporter.Formatter",contentType:"data:text/csv;base64,",separator:",",extension:"csv",lineSeparator:"\n",capitalizeHeaders:!1,format:function e(t,n){var i;this.columns=n.columns||(t.fields?t.fields.items:t.model.prototype.fields.items),this.entityName=n.entityName,this.eAttributes={},Ext.each(n.columns,function(e,t){this.eAttributes[e.dataIndex]=$App.domainInfo.get(this.entityName).getEntityAttribute(e.dataIndex)},this),i=this.getHeaders()+this.lineSeparator+this.getRows(t),n.callback.call(n.scope,i)},getHeaders:function e(t){var n=[];return Ext.each(this.columns,function(e){var t;t=void 0!=e.text?e.text:e.name?e.name.replace(/_/g," "):"",this.capitalizeHeaders&&(t=Ext.String.capitalize(t)),n.push(t)},this),n.join(this.separator)},getRows:function e(t){var n=[];return t.isRawData?Ext.Array.each(t.data,function(e,i){n.push(this.getCells(e,i,t))},this):t.each(function(e,i){n.push(this.getCells(e,i,t))},this),n.join(this.lineSeparator)},getCells:function e(t,n,i){var r=[],o=this;return Ext.each(this.columns,function(e,n){var a,s=e.name||e.dataIndex;if(!s)return!0;if(i.isRawData)switch(a=t[i.dataFieldsMap[e.dataIndex]],o.eAttributes[e.dataIndex].dataType){case UBDomain.ubDataTypes.Date:case UBDomain.ubDataTypes.DateTime:a=new Date(a);break;case UBDomain.ubDataTypes.Float:case UBDomain.ubDataTypes.Currency:a=parseFloat(a);break;case UBDomain.ubDataTypes.Int:a=parseInt(a,10)}else a=t.get(s);_.isFunction(e.renderer)&&(a=e.renderer(a),a=Ext.String.htmlDecode(a)),a='"'+a+'"',r.push(a)}),r.join(this.separator)}})},function(e,t){Ext.define("Ext.ux.exporter.htmlFormatter.HtmlFormatter",{extend:"Ext.ux.exporter.Formatter",contentType:"data:text/Html;base64,",separator:"",extension:"html",lineSeparator:"<br>",lineSeparator1:"</tr><tr>",startHtml:"<!DOCTYPE html><html><head><meta charset='utf-8'><title></title></head><style>.TD:hover{background: lightblue;color: #000000;}caption{text-align: center;font-size: 22px;font-weight: bolder;font-style: italic}td{border: 1px solid black; font-size: 14px}table{border: 2px double black;border-collapse: collapse;}</style><body><table style='width:",startCaption:"px'><caption>",endCaption:"</caption>",end:"</table></body></html>",capitalizeHeaders:!1,format:function e(t,n){var i,r;this.columns=n.columns||(t.fields?t.fields.items:t.model.prototype.fields.items),this.entityName=n.entityName,r=$App.domainInfo.get(this.entityName),this.eAttributes={},Ext.each(n.columns,function(e,t){this.eAttributes[e.dataIndex]=r.getEntityAttribute(e.dataIndex)},this),i=this.startHtml+this.styleGridTable()+this.startCaption+this.gridTitleHtml(n)+this.endCaption+this.extHtml()+this.getRows(t)+this.end,n.callback.call(n.scope,i)},extHtml:function e(){return new Ext.XTemplate("<tr>",'<tpl for=".">','<td style=" width:{width}px; text-align: center; font-weight: bold;font-size: 18px; background: lightblue ">{text}</td>',"</tpl>","</tr>","<tr>").apply(this.columns)},gridTitleHtml:function e(t){var n=[];return n.push(t.title),n.join(this.separator)},getHeaders:function e(){var t=[];return Ext.each(this.columns,function(e){var n;n=void 0!=e.text?e.text:e.name?e.name.replace(/_/g," "):"",this.capitalizeHeaders&&(n=Ext.String.capitalize(n)),t.push(n)},this),t.join(this.separator)},styleGridTable:function e(){var t=[],n=0;return Ext.each(this.columns,function(e){var i;i=void 0!=e.width?e.width:e.width?e.width.replace(/_/g," "):"",this.capitalizeHeaders&&(i=Ext.String.capitalize(i)),t.push(i),n+=i},this),n},getRows:function e(t){var n=[];return t.isRawData?Ext.Array.each(t.data,function(e,i){n.push(this.getCells(e,i,t))},this):t.each(function(e,i){n.push(this.getCells(e,i,t))},this),n.join(this.lineSeparator1)},getCells:function e(t,n,i){var r=this,o=[];return Ext.each(this.columns,function(e,n){var a,s=e.name||e.dataIndex;if(!s)return!0;if(i.isRawData)switch(a=t[i.dataFieldsMap[e.dataIndex]],r.eAttributes[e.dataIndex].dataType){case UBDomain.ubDataTypes.Date:case UBDomain.ubDataTypes.DateTime:a=new Date(a);break;case UBDomain.ubDataTypes.Float:case UBDomain.ubDataTypes.Currency:a=parseFloat(a);break;case UBDomain.ubDataTypes.Int:a=parseInt(a,10)}else a=t.get(s);_.isFunction(e.renderer)&&(a=e.renderer(a)),a='<td class="TD">'+(a||"")+"</td>",o.push(a)}),o.join(this.separator)}})},function(e,t,n){Ext.define("Ext.ux.exporter.xlsxFormatter.XlsxFormatter",{extend:"Ext.ux.exporter.Formatter",contentType:"data:application/vnd.ms-excel;base64,",extension:"xls",sharedStrings:{item:[],count:0},format:function e(t,i){function r(e){var t=T[e.name];if(t)switch(t.dataType){case UBDomain.ubDataTypes.Date:case UBDomain.ubDataTypes.DateTime:return x;case UBDomain.ubDataTypes.Float:return S;case UBDomain.ubDataTypes.Currency:return k;case UBDomain.ubDataTypes.Int:return D;case UBDomain.ubDataTypes.String:case UBDomain.ubDataTypes.Text:return U;default:return I}switch(e.type.type){case"date":return x;case"float":return S;case"int":return D;default:return I}}function o(e){var t=T[e.name],n=UBDomain.ubDataTypes;if(t)switch(t.dataType){case n.Date:case n.DateTime:return 12;case n.Float:case n.Currency:return 13;case n.Int:case n.Boolean:return 10;case n.String:return t.size<11?10:t.size<17?16:t.size<26?25:30;case n.Text:return 50}switch(e.type.type){case"date":return 12;case"string":return 25;case"float":return 13;default:return 18}}function a(e){var t;return Ext.each(m,function(n){if(n.name===e)return t=n,0},this),t}function s(e,t,n){var i;if(E)switch(T[e.dataIndex].dataType){case UBDomain.ubDataTypes.Date:case UBDomain.ubDataTypes.DateTime:case UBDomain.ubDataTypes.Float:case UBDomain.ubDataTypes.Currency:case UBDomain.ubDataTypes.Int:i=t}i||(_.isFunction(e.renderer)?(i=e.renderer(t),i=Ext.String.htmlDecode(i)):i=t),n.push({value:i})}var l=this;if(window&&!window.isserver&&!Ext.ux.exporter.xlsxFormatter.XlsxFormatter.libsLoaded)return void n.e(3).then(n.bind(null,175)).then(function(e){window.XLSX=e,Ext.ux.exporter.xlsxFormatter.XlsxFormatter.libsLoaded=!0,l.format(t,i)});var u,c,d,f,h,p,m,g,y=[],v,b,x,E,w,C,B,U,I,S,k,D,A,T,P,F=window.XLSX;u=new F.XLSXWorkbook,u.useSharedString=!0,E=i.metaobject,A=i.entityName,E||(E=$App.domainInfo.get(A)),B=u.style,c=B.fonts.add({code:"def",name:"Calibri",fontSize:11,scheme:"minor"}),B.fonts.add({code:"defBold",name:"Calibri",fontSize:11,scheme:"minor",bold:!0}),v=B.borders.add({left:{style:"thin"},right:{style:"thin"},top:{style:"thin"},bottom:{style:"thin"}}),B.alignments.add({code:"Hright",horizontal:"right"}),B.alignments.add({code:"Hcenter",horizontal:"center",wrapText:"1"}),B.alignments.add({code:"HVcenter",horizontal:"center",vertical:"center",wrapText:"1"}),B.alignments.add({code:"wrapText",wrapText:"1"}),B.formats.add({code:"floatFormat",formatCode:"#,##0.0000_ ;[Red]\\-#,##0.0000\\ "}),B.formats.add({code:"sumFormat",formatCode:"#,##0.00_ ;[Red]\\-#,##0.00\\ "}),B.formats.add({code:"intFormat",formatCode:"#,##0_ ;[Red]\\-#,##0\\ "}),x=B.getStyle({font:c,border:v,format:F.XLSXStyle.indexDefFormateDate,code:"DefDateStyle"}),S=B.getStyle({font:c,border:v,alignment:B.alignments.named.Hright,format:B.formats.named.floatFormat}),k=B.getStyle({font:c,border:v,alignment:B.alignments.named.Hright,format:B.formats.named.sumFormat}),D=B.getStyle({font:c,border:v,alignment:B.alignments.named.Hright,format:B.formats.named.intFormat}),d=B.getStyle({font:c}),I=B.getStyle({font:c,border:v}),U=B.getStyle({font:c,border:v,alignment:B.alignments.named.wrapText}),w=B.getStyle({font:B.fonts.named.defBold,alignment:B.alignments.named.HVcenter}),C=B.getStyle({font:B.fonts.named.defBold,fill:"EBEDED",border:v,alignment:B.alignments.named.HVcenter}),T={},Ext.each(i.columns,function(e,t){T[e.dataIndex]=E.getEntityAttribute(e.dataIndex)},this),f=u.addWorkSheet({caption:i.title,name:i.title}),h=Ext.ModelManager.getModel(t.model),m=h.getFields(),p=[],g=[],P={},Ext.each(i.columns,function(e,t){P[e.dataIndex]=a(e.dataIndex)},this),f.addMerge({colFrom:1,colTo:i.columns.length}),f.addRow({value:i.title,column:1,style:w},{},{height:40}),y.push({column:0,width:1}),Ext.each(i.columns,function(e,t){var n=P[e.dataIndex];y.push({column:t+1,width:o(n)}),p.push({column:t+1,style:r(n)}),b=Ext.String.capitalize(e.text||n.name||"").replace(/_/g," "),g.push({column:t+1,value:b,style:C})},this),f.setColsProperties(y),f.addRow(g,null,{height:30}),t.isRawData?Ext.Array.each(t.data,function(e,n){var r=t.ubRequest.fieldList;g=[];var o=0;Ext.each(i.columns,function(n){s(n,e[t.dataFieldsMap[n.dataIndex]],g)},this),f.addRow(g,p)},this):t.each(function(e,t){g=[];var n=0;Ext.each(i.columns,function(t){s(t,e.get(t.dataIndex),g)},this),f.addRow(g,p)},this),u.render().then(function(e){i.callback.call(i.scope,e)})}})},function(e,t){Ext.define("UB.view.GridSummary",{extend:"Ext.container.Container",alias:"widget.gridsummury",cls:"x-grid-row-summary",baseCls:Ext.baseCSSPrefix+"grid-footer-ct",defaultType:"panel",dock:"bottom",layout:{type:"hbox",align:"stretch"},height:30,style:{backgroundColor:"#ffffff !important"},border:"1 0 0 0",summaryDataOnClient:!1,initComponent:function e(){var t=this;t.createItems(),t.callParent(arguments)},createItems:function e(){var t=this,n=t.grid;t.items=[],n.on("boxready",function(){var e=[],i=[n.columns.length];_.forEach(n.columns,function(e){i[e.getIndex()]=e}),_.forEach(i,function(t){e.push(Ext.create("Ext.Component",{baseColumn:t,border:"1 1 0 0",cls:"x-grid-cell-summary x-grid-cell x-grid-cell-inner",style:{textAlign:"count"===t.summaryType?"right":t.align||"left"},width:t.getWidth()}))}),t.items.addAll(e),t.updateLayout()},t),n.on("columnresize",function(e,n,i){t.items.each(function(e){if(e.baseColumn===n)return e.setWidth(n.getWidth()),!1})}),n.on("columnhide",function(e,n,i){t.items.each(function(e){if(e.baseColumn===n)return e.hide(),!1})}),n.on("columnshow",function(e,n,i){t.items.each(function(e){if(e.baseColumn===n)return e.setWidth(n.getWidth()),e.show(),!1})}),n.on("columnmove",function(e,n,i,r,o){0!==t.items.getCount()&&t.items.each(function(e,o){if(e.baseColumn===n){Ext.suspendLayouts();try{t.items.remove(e),t.items.insert(r>i?r-1:r,e)}finally{Ext.resumeLayouts()}return t.updateLayout(),!1}})}),n.getStore().on("load",t.dataBind,t)},dataBind:function e(){var t=this,n=t.grid,i=void 0,r=[],o=void 0,a=!1;if(t.items&&0!==t.items.length)if(n.summaryDataOnClient){var s=n.getStore();t.items.each(function(e){var t=void 0,n=void 0;e.baseColumn.summaryType&&(t=s[e.baseColumn.summaryType](e.baseColumn.fieldName)||0,n=e.getEl(),n.setHTML("count"===e.baseColumn.summaryType?Ext.util.Format.numberRenderer("0,000")(t):e.baseColumn.renderer?e.baseColumn.renderer(t):t),e.toolTipe||(e.toolTipe=Ext.create("Ext.tip.ToolTip",{target:n,trackMouse:!0,html:UB.i18n(e.baseColumn.summaryType+"ST")})))})}else i=Ext.clone(n.getStore().ubRequest),i.fieldList=[],t.items.each(function(e){e.baseColumn.summaryType&&("count"===e.baseColumn.summaryType?a||(i.fieldList.push("count([ID])"),r.push("ID"),a=!0):(r.push(e.baseColumn.fieldName),i.fieldList.push(e.baseColumn.summaryType+"(["+e.baseColumn.fieldName+"])")))}),delete i.options,delete i.orderList,o=UB.ux.data.proxy.UBProxy.ubFilterToWhereList(n.getStore().filters,i.entity)||{},UB.apply(o,i.whereList),Object.keys(o).length?i.whereList=o:delete i.whereList,$App.connection.select(i).done(function(e){var n={};!e.resultData||e.resultData.rowCount<1||(_.forEach(r,function(t,i){n[t]=e.resultData.data[0][i]}),t.items.each(function(e){var t=void 0,i=void 0;e.baseColumn.summaryType&&(t=n["count"===e.baseColumn.summaryType?"ID":e.baseColumn.fieldName]||0,i=e.getEl(),i.setHTML("count"===e.baseColumn.summaryType?Ext.util.Format.numberRenderer("0,000")(t):e.baseColumn.renderer?e.baseColumn.renderer(t):t),e.toolTipe||(e.toolTipe=Ext.create("Ext.tip.ToolTip",{target:i,trackMouse:!0,html:UB.i18n(e.baseColumn.summaryType+"ST")})))}))})}})},function(e,t){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Ext.define("UB.view.ColumnFavorites",{extend:"Ext.grid.column.Action",alias:"widget.columnfavorites",width:40,align:"center",minWidthChar:6,maxWidthChar:7,sortable:!0,header:"",cls:"ub-favorites-header",tdCls:"ub-favorites-td",disableExport:!0,allowedCategoryCount:2,updateDelay:1,defaultRenderer:function e(t,n,i,r,o,a,s){var l=this,u=Ext.baseCSSPrefix,c=l.origScope||l,d=l.items;d[0].iconCls="ub-favorites-img "+l.getCls(t),i.baseValue=t;for(var f=_.isFunction(l.origRenderer)?l.origRenderer.apply(c,arguments)||"":"",h=0,p=d.length;h<p;h++){var m=d[h],g=m.disabled||!!m.isDisabled&&m.isDisabled.call(m.scope||c,s,r,o,m,i),y=g?null:m.tooltip||(m.getTip?m.getTip.apply(m.scope||c,arguments):null);m.hasActionConfiguration||(m.stopSelection=l.stopSelection,m.disable=Ext.Function.bind(l.disableAction,l,[h],0),m.enable=Ext.Function.bind(l.enableAction,l,[h],0),m.hasActionConfiguration=!0),f+='<div role="button" alt="'+(m.altText||l.altText)+'" class="'+u+"action-col-icon "+u+"action-col-"+h+" "+(g?u+"item-disabled":" ")+" "+(_.isFunction(m.getClass)?m.getClass.apply(m.scope||c,arguments):m.iconCls||l.iconCls||"")+'"'+(y?' data-qtip="'+y+'"':"")+" ></div>"}return f},constructor:function e(t){var n=this;t||(t={}),t.items=[{tagName:"div",autoEl:"div",iconCls:"ub-favorites-img",handler:function e(){n.onFavoritesClick.apply(n,arguments)}}],n.filterCaption=UB.i18n("gridFavoritesCaption"),n.callParent([t])},initComponent:function e(){this.timers={};var t=$App.connection.appConfig.uiSettings.adminUI.favoriteCategoryCount;t&&(this.allowedCategoryCount=t),this.callParent(arguments)},onFavoritesClick:function e(t,n,i,r,o){var a=this,s=t.getStore(),l=s.getAt(n),u=l.baseValue,c=s.ubRequest.entity,d=$App.domainInfo.get(c).getEntityAttributeInfo(this.dataIndex,-1),f=this.dataIndex.split(".");f=d.attributeCode===f[0]?"ID":f.slice(0,f.length-2).join(".");var h=l.get(f);if(!h)throw Error('You must add column "'+f+'" to fieldList');var p=parseInt(u&&u[0],10)||0,m=u&&u[1]||"0",g=(p+1)%a.allowedCategoryCount,y=g+m;a.timers[h]&&clearTimeout(a.timers[h]),a.updateCls(o.target,u,y),l.baseValue=y,a.timers[h]=setTimeout(function(){delete a.timers[h],a.startUpdateFavorites(h,u,y,o.target,d,l)},a.updateDelay||300)},updateCls:function e(t,n,i){var r=Ext.fly(t);r.removeCls(this.getCls(n)),r.addCls(this.getCls(i))},getCls:function e(t){switch(t&&t[0]){case"1":return"ub-favorites-img-yellow";case"2":return"ub-favorites-img-green";case"3":return"ub-favorites-img-red";default:return"ub-favorites-img-empty"}},startUpdateFavorites:function e(t,n,i,r,o,a){var s=this,l=o.attribute.associatedEntity,u=o.attribute.associationAttr,c=void 0;c=n?UB.Repository(l).attrs(["ID",u,"ubUser","code"]).where(u,"=",t).where("ubUser","=",$App.connection.userData("userID")).select():$App.connection.addNew({entity:l,fieldList:["ID",u,"ubUser","code"]}).then(function(e){return UB.LocalDataStore.selectResultToArrayOfObjects(e)}),c.then(function(e){var o=e[0]||{};o.code=i,o.instanceID=t,o.ubUser=$App.connection.userData("userID");var u={entity:l,method:"00"===o.code?"delete":n&&o.ID?"update":"insert",execParams:o};return $App.connection.query(u).catch(function(){s.updateCls(r,n,a.baseValue),a.baseValue=n})})},statics:{prepareConditions:function e(t,i,r){var o=i.split("."),a="favFtrUsr"+o[0],s=i.split(".");s=r.attributeCode===s[0]?"ID":s.slice(0,s.length-2).join(".");for(var l=!1,u=0;u<t.fieldList.length;u++){var c=t.fieldList[u];if(c.name===s||"object"===(void 0===c?"undefined":n(c))&&c.name===s){l=!0;break}}l||t.fieldList.push({name:s,visibility:!1});var d=o.slice(0,o.length-1).join(".")+".ubUser";t.whereList||(t.whereList={}),t.joinAs||(t.joinAs=[]);var f={};f[d]=$App.connection.userData("userID"),t.whereList[a]={expression:"["+d+"]",condition:"equal",values:f},t.joinAs.push(a)}}})},function(e,t){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Ext.define("UB.view.ColumnCategories",{extend:"Ext.grid.column.Action",alias:"widget.columncategories",width:40,align:"center",minWidthChar:6,maxWidthChar:7,sortable:!0,header:"",cls:"ub-favorites-header",tdCls:"ub-favorites-td",disableExport:!0,updateDelay:500,defaultRenderer:function e(t,n,i,r,o,a,s){var l=this,u=Ext.baseCSSPrefix,c=l.origScope||l,d=l.items,f=d.length,h=0,p,m,g,y;for(i.baseValue=t,l.items[0].iconCls="ub-favorites-img "+l.getCls(t),m=_.isFunction(l.origRenderer)?l.origRenderer.apply(c,arguments)||"":"";h<f;h++)p=d[h],g=p.disabled||!!p.isDisabled&&p.isDisabled.call(p.scope||c,s,r,o,p,i),y=g?null:p.tooltip||(p.getTip?p.getTip.apply(p.scope||c,arguments):null),p.hasActionConfiguration||(p.stopSelection=l.stopSelection,p.disable=Ext.Function.bind(l.disableAction,l,[h],0),p.enable=Ext.Function.bind(l.enableAction,l,[h],0),p.hasActionConfiguration=!0),m+='<div role="button" alt="'+(p.altText||l.altText)+'" class="'+u+"action-col-icon "+u+"action-col-"+h+" "+(g?u+"item-disabled":" ")+" "+(_.isFunction(p.getClass)?p.getClass.apply(p.scope||c,arguments):p.iconCls||l.iconCls||"")+'"'+(y?' data-qtip="'+y+'"':"")+" ></div>";return m},constructor:function e(t){var n=this;t||(t={}),t.items=[{tagName:"div",tooltip:UB.i18n("FavoritesToolTip"),iconCls:"ub-favorites-img ub-favorites-img-empty",handler:function e(){n.onFavoritesClick.apply(n,arguments)}}],n.filterCaption=UB.i18n("gridCategoryCaption"),n.callParent([t])},initComponent:function e(){var t=this;t.timers={},t.callParent(arguments)},onFavoritesClick:function e(t,n,i,r,o){var a=this,s,l,u=t.getStore(),c=u.getAt(n),d,f,h,p;if(l=c.baseValue,f=u.ubRequest.entity,h=$App.domainInfo.get(f,!0).getEntityAttributeInfo(this.dataIndex,-1),p=this.dataIndex.split("."),p=h.attributeCode===p[0]?"ID":p.slice(0,p.length-2).join("."),!(s=c.get(p)))throw Error('You must add column "'+p+'" to fieldList');switch(l){case"1":d="2";break;case"2":d="3";break;case"3":d="0";break;default:d="1"}a.timers[s]&&clearTimeout(a.timers[s]),a.updateCls(o.target,l,d),c.baseValue=d,a.timers[s]=setTimeout(function(){delete a.timers[s],a.startUpdateFavorites(s,l,d,o.target,h,c)},a.updateDelay||300)},updateCls:function e(t,n,i){var r=this,o=Ext.fly(t);o.removeCls(r.getCls(n)),o.addCls(r.getCls(i))},getCls:function e(t){switch(t){case"1":return"ub-favorites-img-yellow";case"2":return"ub-favorites-img-green";case"3":return"ub-favorites-img-red";default:return"ub-favorites-img-empty"}},startUpdateFavorites:function e(t,n,i,r,o,a){var s=this,l,u=o.attribute.associatedEntity,c=o.attribute.associationAttr;l=n?UB.Repository(u).attrs(["ID",c,"ubUser","code"]).where("instanceID","=",t).select():$App.connection.addNew({entity:u,fieldList:["ID",c,"ubUser","code"]}).then(function(e){return UB.LocalDataStore.selectResultToArrayOfObjects(e)}),l.then(function(e){var o=e[0]||{},l;return o.code=i,o.instanceID=t,o.ubUser=$App.connection.userData("userID"),l={entity:u,method:"0"===o.code?"delete":n&&o.ID?"update":"insert",execParams:o},$App.connection.run(l).catch(function(){s.updateCls(r,n,a.baseValue),a.baseValue=n})})},statics:{prepareConditions:function e(t,i,r){var o=i.split("."),a="favFtrUsr"+o[0],s,l={},u,c,d,f;for(u=i.split("."),u=r.attributeCode===u[0]?"ID":u.slice(0,u.length-2).join("."),t.fieldList.indexOf(u)<0&&t.fieldList.push(u),f=!1,c=0;c<t.fieldList.length;c++)if(d=t.fieldList[c],d.name===u||"object"===(void 0===d?"undefined":n(d))&&d.name===u){f=!0;break}f||t.fieldList.push({name:u,visibility:!1}),s=o.slice(0,o.length-1).join(".")+".ubUser",t.whereList||(t.whereList={}),t.joinAs||(t.joinAs=[]),l[s]=$App.connection.userData("userID"),t.whereList[a]={expression:"["+s+"]",condition:"equal",values:l},t.joinAs.push(a)}}})},function(e,t){Ext.define("UB.view.Table",{extend:"Ext.view.Table",alias:"widget.ubtableview",renderRows:function e(t,n,i){var r=this;r.callParent(arguments),r.hideEndRow||i.push('<tr class="ub-grid-row-end" ><td class="ub-grid-row-cell-end" colspan="'+r.ownerCt.getVisibleColumnManager().getColumns().length+'">'+r.getEndRowHtml()+"</td></tr>")},getEndRowHtml:function e(){return""}})},function(e,t){Ext.define("UB.view.InputDateWindow",{extend:"Ext.window.Window",alias:"widget.inputdatewindow",padding:1,autoShow:!0,autoDestroy:!0,closable:!1,border:0,layout:"fit",modal:!0,initComponent:function e(){var t=this,n=Ext.create("Ext.form.field.Date",{allowBlank:!1,blankText:UB.i18n("obazatelnoePole"),fieldLabel:UB.i18n("aktualnoS"),anchor:"100%",value:new Date,listeners:{scope:t,specialkey:function e(n,i,r){switch(i.getKey()){case i.ENTER:t.onButtonClick();break;case i.ESC:t.close()}}}}),i=Ext.create("Ext.form.Panel",{frame:!0,items:[n]});Ext.apply(t,{title:UB.i18n("aktualnoS"),defaultFocus:n,items:[i],fieldDate:n,buttons:[{text:Ext.MessageBox.buttonText.ok,scope:t,handler:t.onButtonClick},{text:Ext.MessageBox.buttonText.cancel,scope:t,handler:t.close}]}),t.callParent(arguments)},onButtonClick:function e(t,n){var i=this,r=i.fieldDate.getValue();Ext.callback(i.callback,i.callback,[r]),i.close()}})},function(e,t,n){n(137),Ext.define("UB.ux.UBDetailTree",{extend:"Ext.tree.Panel",alias:"widget.ubdetailtree",cls:"ub-tree",useArrows:!0,hideHeaders:!0,layout:"fit",localXY:[0,0],behaviors:{},expandedNodes:{},lastSelectionId:null,mixins:{ubPanelMixin:"UB.core.UBPanelMixin"},statics:{actionId:{addNew:"addNew",edit:"edit",deleteItem:"deleteItem",refresh:"refresh",up:"up",down:"down"},eventId:{addnew:"addnew",edit:"edit",deleteItem:"deleteitem",afterdel:"afterdel",refresh:"refresh",up:"up",down:"down"}},listeners:{resize:function e(){this.editPanel.resizer&&(this.editPanel.resizer.resizeTracker.maxHeight=this.getHeight()),this.editPanel.setHeight(Math.min(this.getHeight(),this.editPanel.getHeight()))}},readOnly:!1,initComponent:function e(){var t=this;t.columns=[{xtype:"ubdetailtreecolumn",width:"100%",dataIndex:"text",sortable:!1,hideable:!1,draggable:!1,resizable:!1,templates:null,renderer:function e(t,n,i){var r,o=this.templates[i.raw.nodeType];if(!o){var a=Ext.util.Format.format(UB.i18n("neNaidenShablon"),i.raw.ID,i.raw.nodeType);throw UB.showErrorWindow(a),Error(a)}return r=o.apply(i.raw)}}],t.editPanel=Ext.widget({xtype:"panel",header:!1,dock:"bottom",hidden:!0,resizable:!0,resizeHandles:"n",minHeight:200,layout:"fit",parent:this,listeners:{show:function e(){this.resizer.resizeTracker.maxHeight=this.parent.getHeight()},remove:function e(){var n=t.getDockedItems('toolbar[dock="top"]')[0];this.hide(),n&&n.enable(),t.editing=!1}}}),t.actions=t.actions||{},t.preprocessPanel(),t.dockedItems=t.dockedItems||[],t.dockedItems.push(t.editPanel),t.callParent(arguments),t.on({beforeselect:t.onBeforeSelect,scope:t})},addBaseActions:function e(){var t=this,n=UB.ux.UBDetailTree.actionId,i=UB.ux.UBDetailTree.eventId;t.actions[n.addNew]=new Ext.Action({actionId:n.addNew,glyph:UB.core.UBUtil.glyphs.faPlusCircle,cls:"add-new-action",tooltip:UB.i18n("dobavit"),eventId:i.addnew,disabled:!0,menu:[],scope:t}),t.actions[n.refresh]=new Ext.Action({actionId:n.refresh,glyph:UB.core.UBUtil.glyphs.faRefresh,cls:"refresh-action",tooltip:UB.i18n("obnovit"),eventId:i.refresh,handler:t.onAction,scope:t}),t.actions[n.edit]=new Ext.Action({actionId:n.edit,glyph:UB.core.UBUtil.glyphs.faEdit,cls:"edit-action",tooltip:UB.i18n("redaktirovat"),eventId:i.edit,handler:t.onAction,scope:t}),t.actions[n.deleteItem]=new Ext.Action({actionId:n.deleteItem,glyph:UB.core.UBUtil.glyphs.faTrashO,cls:"delete-action",tooltip:UB.i18n("Delete"),eventId:i.deleteItem,handler:t.onAction,scope:t}),t.actions[n.up]=new Ext.Action({actionId:n.up,glyph:UB.core.UBUtil.glyphs.faUp,cls:"up-action",hidden:!0,eventId:i.up,handler:t.onAction,scope:t}),t.actions[n.down]=new Ext.Action({actionId:n.down,glyph:UB.core.UBUtil.glyphs.faDown,cls:"down-action",hidden:!0,eventId:i.down,handler:t.onAction,scope:t})},addBaseDockedItems:function e(){var t=this,n=UB.ux.UBDetailTree.actionId,i=[t.actions[n.refresh],t.actions[n.addNew],t.actions[n.edit],t.actions[n.deleteItem],t.actions[n.up],t.actions[n.down]];t.dockedItems=[{xtype:"toolbar",dock:"top",items:i}]},addBaseListeners:function e(){var t=this,n=UB.ux.UBDetailTree.eventId;t.on("itemdblclick",t.onEditItem,t),t.on(n.addnew,t.onAddItem,t),t.on(n.edit,t.onEditItem,t),t.on(n.deleteItem,t.onDeleteItem,t),t.on(n.refresh,t.reloadTree,t),t.on(n.up,t.moveUp,t),t.on(n.down,t.moveDown,t),t.readOnly&&t.setReadOnly(t.readOnly)},hideAction:function e(t){var n=this,i;(i=n.actions[t])&&(i.blocked=!0,i.disable(),i.hide())},showAction:function e(t){var n=this,i;(i=n.actions[t])&&(i.blocked=!0,i.setDisabled(!1),i.show())},setReadOnly:function e(t){var n=this;n.readOnly=t,t?(n.hideAction("addNew"),n.hideAction("deleteItem"),n.hideAction("edit")):(n.showAction("addNew"),n.showAction("deleteItem"),n.showAction("edit"))},onAction:function e(t){var n=this;Ext.callback(n.eventHandler,n,[n,t.eventId]),n.fireEvent(t.eventId,t)},onBeforeSelect:function e(t,n){var i=this,r=UB.ux.UBDetailTree.actionId,o=n.raw.nodeType,a=i.behaviors[o];if(!i.editing&&(i.lastSelectionId=n.raw.ID,a)){if(i.actions[r.edit].setDisabled(!a.onEdit),Ext.isDefined(n.raw.deletable)||(n.raw.deletable=!0),i.actions[r.deleteItem].setDisabled(!n.raw.deletable),a.allowedMove){var s=n.parentNode;s&&s.childNodes&&(i.actions[r.up].setDisabled(s.childNodes.indexOf(n)<=0),i.actions[r.down].setDisabled(s.childNodes.indexOf(n)>=s.childNodes.length-1))}else i.actions[r.up].setDisabled(!0),i.actions[r.down].setDisabled(!0);var l=i.actions[r.addNew];if(!a.allowedChildren||!a.allowedChildren.length)return void l.disable();l.enable(),l.each(function(e){var t=e.menu;t.removeAll(!0),Ext.Array.each(a.allowedChildren||[],function(e){t.add({xtype:"menuitem",text:i.behaviors[e].title,handler:function t(){var n=i.actions[r.addNew].items[0];i.fireEvent(n.eventId,n,e)}})})})}},applyData:function e(t,n,i){var r=this,o=UB.ux.UBDetailTree.actionId,a=i.some(function(e){return e.allowedMove});r.actions[o.up].setHidden(!a),r.actions[o.down].setHidden(!a),r.behaviors={},Ext.Array.each(i,function(e){r.behaviors[e.nodeType]=e}),r.setTemplates(n),r.expandNode(t),r.setRootNode(t),r.rendered&&r.getView().scrollBy(r.localXY);var s=r.editing;if(r.editing=!1,r.lastSelectionId){var l=null;r.getRootNode().cascadeBy(function(e){e&&e.raw.ID===r.lastSelectionId&&(l=e)},!0),l&&r.getSelectionModel().select([l])}else r.getSelectionModel().select([r.getRootNode()]);r.editing=s,r.unmaskTree(),r.fireEvent("applyData"),this.on("afterrender",function(){r.getSelectionModel().select([r.getRootNode()])})},setTemplates:function e(t){this.columns[0].templates=t},expandNode:function e(t){var n=this,i=n.expandedNodes||{},r={};(function e(t){var n,o,a;if(i[t.ID]&&(t.expanded=!0),r[t.ID]=!0,t.children)for(a=t.children,n=0,o=a.length;n<o;++n)e(a[n])})(t),Ext.Object.each(i,function(e){r[e]||delete i[e]})},onDeleteItem:function e(){var t=this,n=t.behaviors,i=t.getSelectionModel().getSelection()[0];i&&Ext.Msg.confirm({title:UB.i18n("deletionDialogConfirmCaption"),msg:UB.i18n("vyUvereny"),buttons:Ext.Msg.YESNO,icon:Ext.Msg.QUESTION,scope:t,fn:function e(r,o,a){var s,l=UB.core.UBCommand.methodName.DELETE,u=n[i.raw.nodeType].entity;"yes"===r&&(s={entity:u,method:l,execParams:{ID:i.raw.ID}},t.maskTree(),UB.core.UBService.runList([s],Ext.Function.bind(t.afterDelete,t,[u],!0),t))}})},afterDelete:function e(t,n,i){var r=this;t.serverFailure?r.unmaskTree():(r.lastSelectionId=null,r.reloadTree(),r.fireEvent(UB.ux.UBDetailTree.eventId.afterdel))},onEditItem:function e(){var t=this,n=t.up("basepanel"),i=t.getSelectionModel().getSelection()[0],r=i?i.parentNode:null,o=t.getRootNode(),a=t.editPanel,s=t.getDockedItems('toolbar[dock="top"]')[0],l,u={},c;c=n?n.saveForm():Q.resolve(1),c.then(function(e){if(!(e<0)&&(i&&i.raw&&(u=t.behaviors[i.raw.nodeType]),!t.editing&&i&&(o!==i||t.rootVisible)&&u.onEdit)){l=i.raw.ID;var n={};switch(t.formViewType){case"window":n={instanceID:l,entity:u.entity,formCode:u.onEdit,method:"select",cmdType:UB.core.UBCommand.commandType.showForm,isModal:!0,sender:t,eventHandler:Ext.Function.bind(t.eventHandler,t,[],!0),customParams:{parentNode:r}},u.onEditTitle&&(n.description=u.onEditTitle),UB.core.UBApp.doCommand(n);break;default:a.show().expand(),n={instanceID:l,entity:u.entity,formCode:u.onEdit,method:"select",cmdType:UB.core.UBCommand.commandType.showForm,isModal:!0,sender:t,cmpInitConfig:{closable:!0},eventHandler:Ext.Function.bind(t.eventHandler,t,[],!0),target:a,customParams:{parentNode:r}},u.onEditTitle&&(n.description=u.onEditTitle),UB.core.UBApp.doCommand(n),s.disable(),t.editing=!0}}})},onAddItem:function e(t,n){var i=this,r=i.up("basepanel"),o=i.editPanel,a=i.getSelectionModel().getSelection()[0],s=i.getRootNode(),l=i.getDockedItems('toolbar[dock="top"]')[0],u=i.behaviors[n],c={},d;d=r?r.saveForm():Q.resolve(1),d.then(function(e){if(!(e<0)){a.expand(),c[u.parentField]=a.raw.ID,c.docID=s.raw.ID;var t={};switch(i.formViewType){case"window":t={formCode:u.onAdd,cmdType:UB.core.UBCommand.commandType.showForm,entity:u.entity,initValue:c,isModal:!0,sender:i,eventHandler:Ext.Function.bind(i.eventHandler,i,[],!0),customParams:{parentNode:a}},u.onAddTitle&&(t.description=u.onAddTitle),UB.core.UBApp.doCommand(t);break;default:o.show().expand(),t={formCode:u.onAdd,cmdType:UB.core.UBCommand.commandType.showForm,entity:u.entity,cmpInitConfig:{closable:!0},initValue:c,sender:i,eventHandler:Ext.Function.bind(i.eventHandler,i,[],!0),target:o,customParams:{parentNode:a}},u.onAddTitle&&(t.description=u.onAddTitle),UB.core.UBApp.doCommand(t),l.disable(),i.editing=!0}}})},expandToCurrentNode:function e(t){if(t){for(var n=t.parentNode;n&&n!==this.getRootNode();)n.expand(),n=n.parentNode;return!0}return!1},eventHandler:function e(t,n){"aftersave"===n?this.reloadTree():"afterdelete"===n&&(this.lastSelectionId=null,this.reloadTree())},reloadTree:function e(){var t=this,n={},i=t.getRootNode(),r=function e(t){var i,r,o;if(n[t.raw.ID]=t.isExpanded(),t.childNodes)for(o=t.childNodes,i=0,r=o.length;i<r;++i)e(o[i])};if(t.maskTree(),i&&(r(i),t.expandedNodes=n,t.rendered)){var o=t.getView().el.dom;t.localXY=[o.scrollLeft,o.scrollTop]}t.fireEvent("reloadtree")},maskTree:function e(){var t=this;t.rendered&&t.getEl().mask(UB.i18n("loadingData"))},unmaskTree:function e(){var t=this;t.rendered&&t.getEl().unmask()},moveUp:function e(){var t=this.getSelectionModel().getSelection()[0],n=t.parentNode;if(n){var i=n.childNodes.indexOf(t);if(i>0){var r=n.childNodes[i-1];this.doExchange(t,r,t.raw.orderEntity)}}},moveDown:function e(){var t=this.getSelectionModel().getSelection()[0],n=t.parentNode;if(n){var i=n.childNodes.indexOf(t);if(i<n.childNodes.length-1&&-1!==i){var r=n.childNodes[i+1];this.doExchange(t,r,t.raw.orderEntity)}}},doExchange:function e(t,n,i){var r=this,o,a;if(i){a=i,o=$App.domainInfo.get(a).hasMixin("softLock");var s=t.raw.orderIndex;t.raw.orderIndex=n.raw.orderIndex,n.raw.orderIndex=s,UB.core.UBService.runList([{entity:a,method:"update",lockType:o?"ltTemp":void 0,execParams:{ID:t.raw.orderKeyField,orderIndex:t.raw.orderIndex,mi_modifyDate:t.raw.mi_modifyDate}},{entity:a,method:"update",lockType:o?"ltTemp":void 0,execParams:{ID:n.raw.orderKeyField,orderIndex:n.raw.orderIndex,mi_modifyDate:n.raw.mi_modifyDate}}],function(e){if(!e.serverFailure){r.reloadTree();var t=e[0];t&&t.resultLock&&t.resultLock.success&&UB.ux.LockManager.checkUnlock(a,t.resultLock.lockValue),t=e[1],t&&t.resultLock&&t.resultLock.success&&UB.ux.LockManager.checkUnlock(a,t.resultLock.lockValue)}},r)}}})},function(e,t){Ext.define("UB.ux.UBDetailTreeColumn",{extend:"Ext.grid.column.Column",alias:"widget.ubdetailtreecolumn",tdCls:Ext.baseCSSPrefix+"grid-cell-treecolumn",autoLock:!0,lockable:!1,draggable:!1,hideable:!1,treePrefix:Ext.baseCSSPrefix+"tree-",elbowPrefix:Ext.baseCSSPrefix+"tree-elbow-",expanderCls:Ext.baseCSSPrefix+"tree-expander",imgText:'<img src="{1}" class="{0}" />',initComponent:function e(){var t=this;t.origRenderer=t.renderer||t.defaultRenderer,t.origScope=t.scope||window,t.renderer=t.treeRenderer,t.scope=t,t.callParent()},treeRenderer:function e(t,n,i,r,o,a,s){var l=this,u=[],c=UB.format,d=i.getDepth(),f=l.treePrefix,h=l.elbowPrefix,p=l.expanderCls,m=l.imgText,g=l.origRenderer.apply(l,arguments),y=Ext.BLANK_IMAGE_URL,v=i.get("cls"),b=l.getChildCls?l.getChildCls()+" ":"",x=i.raw.iconCls,E=i.raw.title;for(E=E?"<legend><span>"+i.raw.title+"</span></legend>":void 0,g=x?'<fieldset class="ub-tree-node"><legend><span role="img" class="ub-tree-node-icon '+x+'">&nbsp</span><span class="ub-tree-node-title-withicon">'+i.raw.title+"</span></legend>"+g+"</fieldset>":'<fieldset class="ub-tree-node">'+E+g+"</fieldset>";i;)(!i.isRoot()||i.isRoot()&&s.rootVisible)&&(i.getDepth()===d?(u.unshift(c(m,b+f+"icon"+(i.get("icon")?"-inline ":"")+(i.get("iconCls")||""),i.get("icon")||y)),i.isLast()?i.isExpandable()?u.unshift(c(m,b+" x-tree-icon "+h+"end-plus "+p,y)):u.unshift(c(m,b+" x-tree-icon "+h+"end",y)):i.isExpandable()?u.unshift(c(m,b+" x-tree-icon "+h+"plus "+p,y)):u.unshift(c(m,b+" x-tree-icon "+f+"elbow",y))):i.isLast()||0===i.getDepth()?u.unshift(c(m,b+" x-tree-icon "+h+"empty",y)):0!==i.getDepth()&&u.unshift(c(m,b+" x-tree-icon "+h+"line",y))),i=i.parentNode;return u.push(g),v&&(n.tdCls+=" "+v),u.join("")},defaultRenderer:Ext.identityFn})},function(e,t,n){var i=n(1);Ext.define("UB.ux.UBBadge",{extend:Ext.Component,mixins:[Ext.form.field.Field],alias:"widget.ub-badge",statics:{setupRenderer:function e(t,n,r,o,a){var s=i.find(t,["name",n]);if(s){a||(a=UB.ux.UBBadge.getCssMap(r));var l=null==o?UB.ux.UBBadge._invertedEnums[r]:o;s.format=UB.ux.UBBadge.formatEnum(r,a,l)}},formatEnum:function e(t,n,i){return n||(n=UB.ux.UBBadge.getCssMap(t)),function(e,r){return null==e?null:(UB.ux.UBBadge.styleBadgeColumn(r),UB.ux.UBBadge.renderEnum(t,e,n,i))}},styleBadgeColumn:function e(t,n){t.innerCls=n||"ub-badge-parent-paddings"},renderEnum:function e(t,n,i,r){var o=t?UB.core.UBEnumManager.getById(t,n):null;return UB.ux.UBBadge.renderBadge(o?o.data.name:n,i&&i[n]?i[n]:"default",r)},renderBadge:function e(t,n,r){return null==t?null:Ext.String.format('<span style="margin-left: 3px; " class="ub-badge-component {2}ub-badge-{0}">{1}</span>',n,i.escape(UB.i18n(t)),r?"ub-badge-invert ":"")},getCssMap:function e(t){if(!UB.ux.UBBadge._enumClasses.hasOwnProperty(t))throw Error("Cannot setup renderer for field, because no css maps available for enum group "+t+".");return UB.ux.UBBadge._enumClasses[t]},isEnumInverted:function e(t){return!!UB.ux.UBBadge._invertedEnums[t]},setCssMap:function e(t,n,i){UB.ux.UBBadge._enumClasses[t]=n,i&&(UB.ux.UBBadge._invertedEnums[t]=!0)},_enumClasses:{},_invertedEnums:{}},tpl:'<tpl><span<tpl if="invert"> class="ub-badge-component ub-badge-field ub-badge-{cssClass} ub-badge-invert"></tpl><tpl if="!invert"> class="ub-badge-component ub-badge-field ub-badge-{cssClass}"></tpl>{text}</span></tpl>',enumGroup:"",cssMap:null,defaultCssClass:"default",invert:null,config:{value:null,readOnly:!0},applyReadOnly:function e(){return!0},initComponent:function e(){this.on("added",function(){"x-toolbar"!==this.up().componentCls&&this.addCls("ub-badge-parent-paddings")},this,{single:!0}),this.callParent(arguments),this.text&&this.cssClass&&this.update({cssClass:this.cssClass,text:this.text,invert:this.invert})},applyValue:function e(t){!this.enumGroup&&this.attributeName&&(this.enumGroup=this._determineEnumGroup()),null==this.invert&&(this.invert=!!UB.ux.UBBadge._invertedEnums[this.enumGroup]);var n=this.enumGroup?UB.core.UBEnumManager.getById(this.enumGroup,t):null,i=this.cssMap||this.enumGroup?UB.ux.UBBadge.getCssMap(this.enumGroup):{};return this.update({cssClass:i[t]||this.defaultCssClass,text:n?n.data.name:t,invert:this.invert}),t},_determineEnumGroup:function e(){var t=this.up("basepanel");if(!t||!t.domainEntity)return console.warn("Impossible to determine enumGroup, because control is not inside basepanel or the paneldoes not have entity set."),null;var n=t.domainEntity.attributes[this.attributeName];return n?n.enumGroup?n.enumGroup:(console.warn("Impossible to determine enumGroup, because attribute "+this.attributeName+" is no enum"),null):(console.warn("Impossible to determine enumGroup, because entity does not have attribute "+this.attributeName),null)}}),Ext.define("UB.ux.UBBadgeField",{extend:Ext.form.field.Base,alias:"widget.ub-badge-field",enumGroup:"",cssMap:null,defaultCssClass:"default",invert:null,initComponent:function e(){this.callParent(arguments),!this.map&&this.enumGroup&&(this.map=UB.ux.UBBadge.getCssMap(this.enumGroup)),null===this.invert&&(this.invert=this.enumGroup&&UB.ux.UBBadge.isEnumInverted(this.enumGroup)),this.on("afterrender",function(){this._node=this.inputEl.dom.parentNode,this._renderBadge()}),this.on("change",function(){this._renderBadge()})},beforeDestroy:function e(){delete this._node,this.callParent(arguments)},_renderBadge:function e(){this._node.innerHTML=UB.ux.UBBadge.renderEnum(this.enumGroup,this.getValue(),this.map,this.invert)}})},function(e,t,n){n(41),Ext.define("UB.ux.form.field.UBDictComboBox",{extend:"UB.ux.form.field.UBComboBox",alias:"widget.ubdictcombobox",initComponent:function e(){var t=this;t.allowCustomText=!0,t.forceSelection=!1,t.on("focus",t.oncbFocus,t),t.callParent(arguments),t.addEvents("beforeAutoSave","afterAutoSave","beforeShowDictionary")},messageFillOtherAttribute:"doYouWantFillOtherAttr",doQueryFillOtherAttribute:!0,oncbFocus:function e(){this.onFocusRawValue=this.getRawValue()},getValue:function e(t){var n=this,i,r;return i=n.callParent(arguments),r=n.getRawValue(),!i&&r?-1*(new Date).getTime():i},setValue:function e(t){var n=this,i,r,o,a,s;if(i=Ext.Array.from(t),n.valueModels&&n.valueModels.length>0&&i.length===n.valueModels.length){for(s=!0,r=0;r<n.valueModels.length;r++)if(o=n.valueModels[r],o=o.get(n.valueField),a=i[r],Ext.isObject(a)&&a.isModel&&(a=a.get(n.valueField)),o!==a){s=!1;break}if(s)return}n.clearIsPhantom(),n.callParent(arguments)},onBlur:function e(t){var n=this,i,r,o=n.getPicker();if(n.callParent(arguments),o&&o.el&&t.relatedTarget)for(i=0,r=t.relatedTarget;i<11&&r;){if(o.el.dom===r)return r=Ext.dom.Element.get(t.relatedTarget),r.un({blur:this.onPickerBlur,scope:n}),void r.on({blur:this.onPickerBlur,scope:n});r=r.parentElement,i++}Ext.defer(n.checkOnBlur,20,n)},checkOnBlur:function e(){var t=this,n=t.getRawValue(),i=null,r,o,a;if(!t.isDestroyed&&(r=t.getStore(),o=r.entityName,t.getValue()<0&&t.onFocusRawValue!==n)){if(t.store.each(function(e){if(n===e.get(t.displayField))return i=e.get(t.valueField),!1},t),i)return void t.setValue(i);a={},a[t.displayField]=n,$App.connection.select({entity:o,fieldList:[t.valueField,t.displayField],whereList:{valExpr:{expression:"["+t.displayField+"]",condition:"equal",values:a}}}).done(function(e){if(e&&e.resultData.data.length){var n=r.add(UB.core.UBCommand.resultDataRow2Object(e),!0);return void t.setValue(n[0])}t.doQueryFillOtherAttribute&&$App.dialogYesNo("",UB.format(UB.i18n(t.messageFillOtherAttribute),t.getFieldLabel(),$App.domainInfo.get(o,!0).getEntityCaption())).done(function(e){e&&Ext.defer(function(){this.addDictItem({caption:this.getRawValue()})},10,t)})})}},addDictItem:function e(){var t=this,n,i=t.getStore(),r=i.entityName,o=t.displayField;n={cmdType:UB.core.UBCommand.commandType.showForm,entity:r,store:i,isModal:!0,sender:t,onClose:function e(n){n&&(t.setValueById(n),t.editItemButton.setDisabled(!1))}},n.initValue={},t.staticValues&&Ext.applyIf(n.initValue,t.staticValues),n.initValue[o]=t.getRawValue(),t.fieldsCloneText&&_.forEach(Ext.Array.from(t.fieldsCloneText,!1),function(e){n.initValue[e]=t.getRawValue()}),t.fireEvent("beforeShowDictionary",t,n),UB.core.UBApp.doCommand(n)},onBeforeSaveForm:function e(t){t.push([this.orderNumber||Number.MAX_VALUE,this.onBeforeSaveFormRun.bind(this)])},onBeforeSaveFormRun:function e(){var t=this,n,i,r,o,a;if(!(!(a=t.getValue())||a>0||a&&a instanceof Array&&0===a.length))return o=[t.displayField,t.valueField],n=t.store.ubRequest.entity,r={},t.staticValues&&(Ext.applyIf(r,t.staticValues),o=o.concat(Object.keys(t.staticValues))),r[t.displayField]=t.getRawValue(),i=$App.connection.addNew({entity:n,execParams:r,fieldList:o}).then(function(e){var i=e.resultData.data[0],r=e.resultData.fields,o={},a;return _.forEach(r,function(e,t){o[e]=i[t]}),t.fieldsCloneText&&_.forEach(Ext.Array.from(t.fieldsCloneText,!1),function(e){o[e]=t.getRawValue()}),a={entity:n,execParams:o,fieldList:r},t.fireEvent("beforeAutoSave",t,a),$App.connection.insert(a).then(function(e){if(e&&e.resultData.data.length){t.editItemButton.setDisabled(!1);var n=t.getStore().add(UB.core.UBCommand.resultDataRow2Object(e),!0);t.setValue(n[0]),t.fireEvent("afterAutoSave",t,n[0])}})})},onValueChange:function e(){var t=this,n=t.getValue(),i=!n||n<=0;t.editItemButton&&t.editItemButton.setDisabled(i)},saveItem:function e(){this.onBeforeSaveFormRun()}})},function(e,t,n){n(141),Ext.define("UB.ux.form.field.UBDateTime",{extend:"Ext.ux.form.DateTimeField",alias:"widget.ubdatetimefield",minWidth:160,showToday:!1,minValue:new Date(1901,1,1),constructor:function e(t){var n=this;t=t||{},t.width||(t.width=(t.fieldLabel?t.labelWidth||n.labelWidth||100:0)+160),t.fieldLabel&&(n.minWidth=t.width),n.maxWidth=t.maxWidth||t.width,n.callParent([t])}}),Ext.override(Ext.picker.Date,{handleTabClick:function e(t){var n=this,i=n.getSelectedDate(n.activeDate),r=n.handler;!n.disabled&&i&&i.dateValue&&!Ext.fly(i.parentNode).hasCls(n.disabledCellCls)&&(n.doCancelFocus=!1===n.focusOnSelect,n.setValue(new Date(i.dateValue)),delete n.doCancelFocus,n.fireEvent("select",n,n.value),r&&r.call(n.scope||n,n,n.value),n.onSelect())}})},function(e,t,n){n(142),Ext.define("Ext.ux.form.DateTimeField",{extend:"Ext.form.field.Date",alias:"widget.datetimefield",requires:["Ext.ux.DateTimePicker"],initComponent:function e(){this.format=this.format+" "+(this.useSeconds?"H:i:s":"H:i"),this.callParent()},createPicker:function e(){var t=this,n=Ext.String.format;return Ext.create("Ext.ux.DateTimePicker",{ownerCt:t.ownerCt,useSeconds:t.useSeconds,renderTo:document.body,floating:!0,hidden:!0,focusOnShow:!0,minDate:t.minValue,maxDate:t.maxValue,disabledDatesRE:t.disabledDatesRE,disabledDatesText:t.disabledDatesText,disabledDays:t.disabledDays,disabledDaysText:t.disabledDaysText,format:t.format,showToday:t.showToday,minText:n(t.minText,t.formatDate(t.minValue)),maxText:n(t.maxText,t.formatDate(t.maxValue)),listeners:{scope:t,select:t.onSelect},keyNavConfig:{esc:function e(){t.collapse()}}})},onExpand:function e(){var t=this,n=this.getValue();if(!n&&t.defaultTime)if(n=new Date,"string"==typeof t.defaultTime){var i=t.defaultTime.split(":");n.setHours(parseInt(i[0],10)),n.setMinutes(parseInt(i[1],10)),i.length>2&&n.setMilliseconds(parseInt(i[2],10))}else"function"==typeof t.defaultTime?t.defaultTime(t,n):(n.setHours(t.defaultTime.getHours()),n.setMinutes(t.defaultTime.getMinutes()),n.setMilliseconds(t.defaultTime.getMilliseconds()));this.picker.setValue(Ext.isDate(n)?n:new Date)}})},function(e,t,n){n(143),Ext.define("Ext.ux.DateTimePicker",{extend:"Ext.picker.Date",alias:"widget.datetimepicker",todayText:"Today",timeLabel:"Time",requires:["Ext.ux.form.TimePickerField"],initComponent:function e(){var t=this.value||new Date;this.callParent(),this.value=t},onRender:function e(t,n){this.timefield||(this.timefield=Ext.create("Ext.ux.form.TimePickerField",{fieldLabel:this.timeLabel,useSeconds:this.useSeconds,labelWidth:36,value:Ext.Date.format(this.value,"H:i:s")})),this.timefield.ownerCt=this,this.timefield.on("change",this.timeChange,this),this.callParent(arguments);var i=Ext.get(Ext.DomQuery.selectNode("table",this.el.dom)),r=Ext.core.DomHelper.insertBefore(i,{tag:"div",style:"border:0px;",children:[{tag:"div",cls:"x-datepicker-footer ux-timefield"}]},!0);this.timefield.render(this.el.child("div div.ux-timefield"));var o=this.getEl().parent("div.x-layer");o&&o.setStyle("height",o.getHeight()+31)},timeChange:function e(t,n,i){this.value=this.fillDateTime(this.value)},fillDateTime:function e(t){if(this.timefield){var n=this.timefield.getRawValue();t.setHours(n.h),t.setMinutes(n.m),t.setSeconds(n.s)}return t},changeTimeFiledValue:function e(t){this.timefield.un("change",this.timeChange,this),this.timefield.setValue(this.value),this.timefield.on("change",this.timeChange,this)},setValue:function e(t){return this.value=t,this.changeTimeFiledValue(t),this.update(this.value)},getValue:function e(){return this.fillDateTime(this.value)},handleDateClick:function e(t,n){var i=this,r=i.handler;t.stopEvent(),i.disabled||!n.dateValue||Ext.fly(n.parentNode).hasCls(i.disabledCellCls)||(i.doCancelFocus=!1===i.focusOnSelect,i.setValue(this.fillDateTime(new Date(n.dateValue))),delete i.doCancelFocus,i.fireEvent("select",i,i.value),r&&r.call(i.scope||i,i,i.value),i.onSelect())},selectToday:function e(){var t=this,n=t.todayBtn,i=t.handler;return n&&!n.disabled&&(t.setValue(new Date),t.fireEvent("select",t,t.value),i&&i.call(t.scope||t,t,t.value),t.onSelect()),t},selectedUpdate:function e(t){var n=new Date(t.getFullYear(),t.getMonth(),t.getDate());this.callParent([n])}})},function(e,t,n){n(144),Ext.define("Ext.ux.form.TimePickerField",{extend:"Ext.form.field.Base",alias:"widget.uxtimepicker",alternateClassName:"Ext.form.field.TimePickerField",requires:["Ext.form.field.Number","Ext.ux.form.field.PadNumber"],inputType:"hidden",style:"padding:4px 0 0 0;margin-bottom:0px",msgTarget:"none",value:null,initComponent:function e(){var t=this;t.useSeconds&&(t.margin="0 0 0 0"),t.spinnerCfg=t.spinnerCfg||{columnWidth:t.useSeconds?.333:.5,margin:t.useSeconds?"0 0 0 0":"0 15px 0 0"},t.value=t.value||"00:00:00",t.callParent(),t.spinners=[];var n=Ext.apply({},t.spinnerCfg,{readOnly:t.readOnly,disabled:t.disabled,style:"float: left",listeners:{change:{fn:t.onSpinnerChange,scope:t}}});t.hoursSpinner=Ext.create("Ext.ux.form.field.PadNumber",Ext.apply({},n,{minValue:0,maxValue:23})),t.minutesSpinner=Ext.create("Ext.ux.form.field.PadNumber",Ext.apply({},n,{minValue:0,maxValue:59})),t.useSeconds?(t.secondsSpinner=Ext.create("Ext.ux.form.field.PadNumber",Ext.apply({},n,{minValue:0,maxValue:59})),t.spinners.push(t.hoursSpinner,t.minutesSpinner,t.secondsSpinner)):t.spinners.push(t.hoursSpinner,t.minutesSpinner),t.on("render",t.addSpinners,t)},addSpinners:function e(){var t=this,n,i;n=Ext.dom.Query.select("td",this.getEl().dom)[1],i=Ext.get(n),Ext.create("Ext.container.Container",{layout:"column",border:!1,frame:!1,items:t.spinners,renderTo:i}),Ext.core.DomHelper.append(i,{tag:"div",cls:"x-form-clear-left"}),this.setRawValue(this.value)},_valueSplit:function e(t){Ext.isDate(t)&&(t=Ext.Date.format(t,"H:i:s"));var n=t.split(":");return{h:n.length>0?n[0]:0,m:n.length>1?n[1]:0,s:n.length>2?n[2]:0}},onSpinnerChange:function e(){this.rendered&&this.fireEvent("change",this,this.getValue(),this.getRawValue())},callSpinnersFunction:function e(t,n){for(var i=0;i<this.spinners.length;i++)this.spinners[i][t](n)},getRawValue:function e(){if(this.rendered)return{h:this.hoursSpinner.getValue(),m:this.minutesSpinner.getValue(),s:this.useSeconds?this.secondsSpinner.getValue():0};var t=this.value||new Date;return this._valueSplit(t)},setRawValue:function e(t){t=this._valueSplit(t),this.hoursSpinner&&(this.hoursSpinner.setValue(t.h),this.minutesSpinner.setValue(t.m),this.useSeconds&&this.secondsSpinner.setValue(t.s))},getValue:function e(){var t=this.getRawValue();return Ext.String.leftPad(t.h,2,"0")+":"+Ext.String.leftPad(t.m,2,"0")+":"+Ext.String.leftPad(t.s,2,"0")},setValue:function e(t){this.value=Ext.isDate(t)?Ext.Date.format(t,"H:i:s"):t,this.rendered&&(this.setRawValue(this.value),this.validate())},disable:function e(){this.callParent(arguments),this.callSpinnersFunction("disable",arguments)},enable:function e(){this.callParent(arguments),this.callSpinnersFunction("enable",arguments)},setReadOnly:function e(){this.callParent(arguments),this.callSpinnersFunction("setReadOnly",arguments)},clearInvalid:function e(){this.callParent(arguments),this.callSpinnersFunction("clearInvalid",arguments)},isValid:function e(t){return this.hoursSpinner.isValid(t)&&this.minutesSpinner.isValid(t)&&(!this.useSeconds||this.secondsSpinner.isValid(t))},validate:function e(){return this.hoursSpinner.validate()&&this.minutesSpinner.validate()&&(!this.useSeconds||this.secondsSpinner.validate())}})},function(e,t){Ext.define("Ext.ux.form.field.PadNumber",{extend:"Ext.form.field.Number",alias:"widget.padnumberfield",padSymbol:"0",padLength:2,rawToValue:function e(t){var n=this.callParent(arguments);return null===n&&(n=0),parseFloat(n)},padLeft:function e(t,n,i){return Array(n-(t+"").length+1).join(i||"0")+t},valueToRaw:function e(t){var n=this.callParent(arguments);return this.padLeft(n,this.padLength,this.padSymbol)}})},function(e,t){Ext.define("UB.ux.form.UBFieldSet",{extend:"Ext.form.FieldSet",alias:"widget.ubfieldset",margin:"5 0 5 0",padding:"5 0 5 0",border:"0 0 0 0 ",createLegendCt:function e(){var t=this,n;return n=t.callParent(arguments),n.items.length>1&&(n.items=[n.items[1],n.items[0]]),n},glyphCollapsed:61701,glyph:61703,createToggleCmp:function e(){var t=this;return t.toggleCmp=Ext.widget({xtype:"component",autoEl:{tag:"div"},height:15,width:35,id:t.id+"-legendToggle",style:"float: left; font-size: 1.4em; padding-left: 12px; cursor: pointer;",scope:t}),t.toggleCmp.on("boxready",function(){t.toggleCmp.getEl().on("click",t.toggle,t)}),t.collapsed?t.toggleCmp.addCls(["fa","fa-angle-right"]):t.toggleCmp.addCls(["fa","fa-angle-down"]),t.toggleCmp},toggle:function e(){var t=this;t.callParent(arguments),t.collapsed?(t.toggleCmp.removeCls("fa-angle-down"),t.toggleCmp.addCls("fa-angle-right")):(t.toggleCmp.removeCls("fa-angle-right"),t.toggleCmp.addCls("fa-angle-down"))}})},function(e,t,n){n(16),n(22),n(147),n(3),n(2),Ext.define("UB.ux.data.proxy.UBProxy",{extend:"Ext.data.proxy.Server",alias:"proxy.ubproxy",uses:["UB.view.ErrorWindow"],constructor:function e(t){return Ext.apply(this,{reader:{type:"ubarray",root:"data",totalProperty:"total"}}),this.callParent(arguments),this.addListener("exception",this.onException,this),this},allLoaded:!1,statics:{ubFilterToWhereList:function e(t,n){var i={},r=this,o;return o=function e(t,o){if(!t.disabled&&t.filterFn){var a=r.ubFiltersItemToUBWhereListItem(t,$App.domainInfo.get(n).attr(t.property).dataType);switch(t.condition){case"match":i.match=a;break;case"between":i.between=a;break;default:i["x"+o]=a}}},t instanceof Ext.util.MixedCollection?t.each(o):Ext.each(t||[],o),i},ubFiltersItemToUBWhereListItem:function e(t,n){var i=UB.core.UBCommand.condition,r={values:{}};if(r.expression="["+t.property+"]",n===UBDomain.ubDataTypes.String&&(t.exactMatch?r.condition=i.sqlecEqual:t.startWith?r.condition=i.sqlecStartWith:r.condition=i.sqlecLike),t.operator)switch(t.operator){case">=":r.condition=i.sqlecMoreEqual;break;case"<=":r.condition=i.sqlecLessEqual;break;case"<":r.condition=i.sqlecLess;break;case"=":r.condition=i.sqlecEqual;break;case">":r.condition=i.sqlecMore;break;case"!=":r.condition=i.sqlecNotEqual;break;default:r.condition=i.sqlecEqual}switch(t.condition&&(r.condition=t.condition),r.condition=r.condition||i.sqlecEqual,r.values[t.property]=t.value,t.condition){case"match":r={condition:"match",values:{any:t.value}};break;case"between":r={condition:"between",values:{v1:t.valueFrom,v2:t.valueTo}}}return r}},onException:function e(t,n,i){throw Error({errMsg:i.getError()})},doRequest:function e(t,n,i){var r=this,o=Ext.clone(t.ubRequest),a,s,l,u,c,d=[],f=function e(r){t.resultSet=r,t.setCompleted(),t.setSuccessful(),i=i||{},i.isDestroyed||Ext.callback(n,i,[t])};if("read"!==t.action)throw Error("unsupported operation for UBProxy: "+t.action);l=r.operationFilter2WhereList(t,o.entity,d)||{},UB.apply(l,o.whereList),Object.keys(l).length?o.whereList=l:delete o.whereList,u=r.operationOrder2OrderList(t)||{},UB.apply(u,o.orderList),Object.keys(u).length?o.orderList=u:delete o.orderList,s=t.limit&&t.limit>0?t.limit:void 0,a=t.start&&t.start>0?t.start:void 0,(a||s)&&(o.options=o.options||{},a&&(o.options.start=a),s&&(o.options.limit=s),s&&!a&&(o.options.start=0)),$App.connection.select(o).done(function(e){c=r.getReader().read({data:e.resultData.data}),d.length>0&&r.applyFilterFn(c,d),c.total=e.total,c.totalRecords=c.total,c.resultLock=e.resultLock,c.resultAls=e.resultAls,f(c)},function(e){t.setException(e),i.isDestroyed||Ext.callback(n,i,[t])})},applyFilterFn:function e(t,n){var i,r,o,a=[],s;for(i=0;i<t.records.length;i++){for(r=t.records[i],s=!0,o=0;o<n.length;o++)if(!0!==n[o](r)){s=!1;break}s&&a.push(r)}t.records=a,t.count=a.length,console.warn("Attention! Filter using the function works without paging")},operationFilter2WhereList:function e(t,n,i){var r,o,a,s,l=100,u;if(t.filters&&(r=t.filters.length)>0)for(a={},o=0;o<r;++o)if(s=t.filters[o],i&&s.initialConfig.filterFn&&!s.initialConfig.property)i.push(s.initialConfig.filterFn);else{if(!s.disabled&&!s.property)throw Error("invalid filter");u=UB.ux.data.proxy.UBProxy.ubFiltersItemToUBWhereListItem(s,$App.domainInfo.get(n).attr(s.property).dataType),a["x"+l++]=u}return a},operationOrder2OrderList:function e(t){var n,i,r,o=t.sorters,a=100;if(o&&(n=o.length)>0)for(r={},i=0;i<n;++i)r["x"+a++]={expression:o[i].property,order:"ASC"===o[i].direction?"asc":"desc"};return r}})},function(e,t){Ext.define("UB.ux.data.reader.UBArray",{extend:"Ext.data.reader.Array",alias:"reader.ubarray",readRecords:function e(t){var n;return!Ext.isDefined(this.proxy.totalRecCount)&&Ext.isDefined(t.__totalRecCount)&&(this.proxy.totalRecCount=t.__totalRecCount),n={data:t.data,total:this.proxy.totalRecCount},this.callParent([n])}})},function(e,t,n){n(17),Ext.define("UB.view.DocumentVersions",{extend:"UB.view.BaseWindow",height:600,width:800,modal:!0,commandCode:"DocumentVersions",layout:{type:"fit"},constructor:function e(){this.callParent(arguments)},initComponent:function e(){var t=this,n,i,r=[],o,a,s;if(t.maxDeepRevisions=10,t.title=UB.i18n("formShowDocRevisions")+" "+t.docContainerBase.initialConfig.fieldLabel,n=t.docRecord.get(t.docAttribute),t.documentInfo={},n&&(t.documentInfo=Ext.JSON.decode(n),i=t.documentInfo.revision),t.revisionItems=[],r.push({xtype:"label",text:UB.i18n(i>1?"selectDocRevision":"onlyCurrentVersionExists"),margin:"0 0 0 10"}),s=i-t.maxDeepRevisions>0?i-t.maxDeepRevisions:1,i>1)for(var l=s;l<=i;l++)o=Ext.widget("button",{style:"text-weight: bolder",margin:"0 0 0 5",text:l+(l===i?" "+UB.i18n("isLastDocRevision"):""),revisionNum:l,handler:t.loadRevision,scope:t}),r.push(o),t.revisionItems.push(o);t.tBar=Ext.widget("toolbar",{dock:"top",cls:"ub-grid-info-panel",items:r}),t.items=t.items||[],a=Ext.merge({useRevision:!0,expanded:!0},t.docContainerBase.initialConfig),a.hidden=!1,t.documentConainer=Ext.create("UB.ux.UBDocument",a),t.items.push(t.documentConainer),t.callParent(arguments),t.addDocked([t.tBar])},loadRevision:function e(t){var n=this;n.documentInfo.revision=t.revisionNum,n.documentInfo.origName=UB.i18n("revisionNum")+t.revisionNum,n.documentConainer.setValue(Ext.JSON.encode(n.documentInfo),n.instanceID,!0),t.addCls("ub-buttondown"),Ext.Array.each(n.revisionItems,function(e){e.revisionNum!==t.revisionNum&&e.removeCls("ub-buttondown")})}})},function(e,t){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Ext.ns("UB.ux.LockManager"),function(){UB.ux.LockManager.lockTimeout=4e4,UB.ux.LockManager.entities={},UB.ux.LockManager.schedulers={},UB.ux.LockManager.getMasterID=function(e,t,n,i,r){},UB.ux.LockManager.getContext=function(e,t,i){var r,o,a,s,l,u,c;if(a=$App.domainInfo.get(e),a.checkMixin("softLock"),s=a.mixins.softLock,o=s.lockEntity,c=s.lockIdentifier.split("."),r=this.entities[o],r||(r=this.entities[o]={}),"object"!==(void 0===t?"undefined":n(t)))u=t;else{if(t.fields.indexOfKey(c[0])<0)throw Error("Form record of "+e+" entity must have "+c[0]+" in fieldList");u=t.get(c[0])}return l=r[u],!l&&i&&(l=r[u]=[]),{idCtx:l,lockEntity:o,id:u,hasEntityALS:!!a.mixins.als}},UB.ux.LockManager.existLock=function(e,t){var n,i,r,o;return i=$App.domainInfo.get(e),i.checkMixin("softLock"),n=i.mixins.softLock,!!(r=this.entities[n.lockEntity])&&((o=r[t])&&o.length>0)},UB.ux.LockManager.addLock=function(e){var t=this,n,i,r;return n=t.getContext(e.entity,e.instance,!0),i=n.idCtx,r=new Date,n.lockIdentifier=e.lockIdentifier,n.lockID=r.getTime()+"_"+i.length,n.onLockLoss=e.onLockLoss,n.scope=e.scope,n.entity=e.entity,i.push(n),t.initUpdateLock(n),n},UB.ux.LockManager.checkUnlock=function(e,t){var n=this,i;i=n.addLock({entity:e,instance:t,scope:n}),!0===n.deleteLock(i)&&$App.connection.query({entity:e,method:UB.core.UBCommand.methodName.UNLOCK,ID:t},!0)},UB.ux.LockManager.deleteLock=function(e){var t=this,n,i,r,o;if(!(n=this.entities[e.lockEntity]))return!1;if(!(i=n[e.id]))return!1;for(r=0;r<i.length;r++)if(i[r].lockID===e.lockID){i.splice(r,1);break}return 0===i.length&&(t.stopUpdateLock(e),delete n[e.id],!0)},UB.ux.LockManager.initUpdateLock=function(e){var t=this,n;e.schedulerID=e.lockEntity+e.id,(n=t.schedulers[e.schedulerID])||(t.schedulers[e.schedulerID]=n={lockCtx:e},n.updateLockID=setInterval(function(){t.updateLock(e)},t.lockTimeout))},UB.ux.LockManager.stopUpdateLock=function(e){var t=this,n;e.schedulerID&&(n=t.schedulers[e.schedulerID])&&(clearInterval(n.updateLockID),delete t.schedulers[e.schedulerID])},UB.ux.LockManager.fireOnLockLoss=function(e){var t=this,n,i,r,o;if(!(n=t.entities[e.lockEntity]))return!1;if(!(i=n[e.id]))return!1;for(r=0;r<i.length;r++)o=i[r],o.onLockLoss&&Ext.callback(o.onLockLoss,o.scope||t,[o])},UB.ux.LockManager.updateLock=function(e){var t=this;$App.connection.query({entity:e.lockEntity,method:"renewLock",lockID:e.lockIdentifier}).then(function(n){if(!n.resultLock.success){if(n.resultLock.lockUser!==$App.connection.userLogin())throw new UB.UBError(UB.i18n("lockedBy")+" "+n.resultLock.lockUser);t.fireOnLockLoss(e),t.stopUpdateLock(e)}}).catch(function(n){t.fireOnLockLoss(e)})},UB.ux.LockManager.forceUpdateAllLock=function(){var e=this,t,n,i,r,o,a;for(t in e.entities)if(e.entities.hasOwnProperty(t)){i=e.entities[t];for(n in i)i.hasOwnProperty(n)&&(r=i[n])&&r.lentgth>0&&(a=r[0],e.stopUpdateLock(a),e.updateLock(a),e.initUpdateLock(a))}}}()},function(e,t){Ext.define("UB.view.UBForm",{extend:"Ext.form.Basic",constructor:function e(t,n){this.callParent([t,n]),this.getFields()},getFields:function e(){var t=this;if(!t.formFields){var n,i=[],r;t.formFields=new Ext.util.MixedCollection,n=t.owner.query("form"),Ext.each(n,function(e){e!==t.owner&&Ext.each(e.query("[isFormField]"),function(e){i.push(e)},t)},t),r=t.owner.query(t.monitor.selector),Ext.each(i,function(e){var t=r.indexOf(e);t>=0&&r.splice(t,1)},t),t.formFields.addAll(r)}return t.formFields},onFieldAdd:function e(t){var n=this;n.owner===t.up("form")&&(n.callParent(arguments),n.formFields&&n.formFields.addAll([t]))},onFieldRemove:function e(t){var n=this;n.owner===t.up("form")&&(n.callParent(arguments),n.formFields&&n.formFields.push(t))}})},function(e,t,n){n(18),Ext.define("UB.ux.form.HtmlEditor",{extend:"UB.ux.UBTinyMCETextArea",alias:"widget.ubhtmleditor",overflowX:"auto",overflowY:"auto",minHeight:65,pageWidth:793,initComponent:function e(){var t=this;Ext.getBody().getSize(),t.elementStyle=t.elementStyle||"width: "+t.pageWidth+"px;",t.tinyMCEConfig=Ext.apply({paste_postprocess:UB.ux.UBReportEditor.paste_postprocess,statusbar:!1,menubar:!1,toolbar:!1,toolbar1:!1,toolbar2:!1,toolbar3:!1,setup:t.onsetup.bind(t)},t.tinyMCEConfig||{}),t.callParent(arguments)},fieldSubTpl:['<div id="{id}_editButton" style="visibility: hidden; z-index: 2; text-align: right; position: absolute; left: -10px; top: 10px;"></div>','<div id="{id}_mframe" role="{role}" tabindex="0" {inputAttrTpl} style="width:100%; owerflow-x:auto; overflow-y: hidden;" >','<textarea id="{id}" tabindex="0"  ','<tpl if="name"> name="{name}"</tpl>','<tpl if="rows"> rows="{rows}" </tpl>','<tpl if="cols"> cols="{cols}" </tpl>','<tpl if="placeholder"> placeholder="{placeholder}"</tpl>','<tpl if="size"> size="{size}"</tpl>','<tpl if="maxLength !== undefined"> maxlength="{maxLength}"</tpl>','<tpl if="readOnly"> readonly="readonly"</tpl>','<tpl if="disabled"> disabled="disabled"</tpl>','<tpl if="tabIdx"> tabIndex="{tabIdx}"</tpl>',' class="{fieldCls} {typeCls} {inputCls}" ','<tpl if="fieldStyle"> style="{fieldStyle}"</tpl>',' autocomplete="off">\n','<tpl if="value">{[Ext.util.Format.htmlEncode(values.value)]}</tpl>',"</textarea>","</div>",{disableFormats:!0}],afterRender:function e(){var t=this,n=Ext.getBody().getSize(),i,r,o,a;t.callParent(arguments),t.mainFrame=r=Ext.get(t.getInputId()+"_mframe"),t.mainFrame.dom.select=function(){},i=Ext.get(t.getInputId()),i.dom.tabindex=0,a=i.getHeight()-20,a<t.minHeight&&(a=t.minHeight),r.setHeight(a),i.on("resize",function(){r.setHeight(i.getHeight()-20)}),i.setWidth(t.pageWidth),i.setHeight(n.height),i.setStyle("owerflow-y","hidden"),i.setStyle("owerflow-x","hidden"),t.editBtn=Ext.get(t.getInputId()+"_editButton"),t.editBtn.dom.style.position="relative",t.editBtn.dom.style.height="0px",t.initContextMenu(),o=r.parent(),o.on("mouseover",function(){t.editBtn.isVisible()||t.readOnly||(t.editBtnCtrl.hide(),t.editBtn.hide(),t.editBtn.show(),t.editBtnCtrl.show())}),o.on("mouseleave",function(){t.hasInputFocus||t.editBtn.hide()}),t.on("focus",function(){t.readOnly||(t.editBtnCtrl.hide(),t.hasInputFocus=!0,t.editBtn.hide(),t.editBtn.show(),t.editBtnCtrl.show())},t),t.on("blur",function(){t.hasInputFocus=!1,Ext.defer(function(){t.editBtn.hide()},100)},t)},getFocusEl:function e(){return this.iframe},initEditor:function e(){this.callParent(arguments)},onsetup:function e(t){var n=this,i=Ext.getBody().getSize(),r;t.on("init",function(){n.iframe=r=Ext.get(n.getInputId()+"_ifr"),n.iframe.dom.tabindex=0,n.iframe.dom.select=function(){},r.setWidth(n.pageWidth),r.setHeight(i.height)})},getSubTplMarkup:function e(){return this.callParent(arguments)},editContent:function e(){function t(e){var t,n,i;t=Ext.widget("panel",{border:!0,flex:1}),n=Ext.create("UB.view.BaseWindow",{title:"PDF",width:800,height:600,modal:!0,layout:{type:"vbox",align:"stretch"},items:[t]}),i=Ext.create("UB.ux.UBObject"),i.setXSize({width:"100%",height:"100%"}),t.add(i),i.setSrc({url:e,contentType:"application/pdf"}),n.show()}function n(e){PDF.init().done(function(){PDF.csPrintToPdf.requireFonts({fonts:[{fontName:"TimesNewRoman",fontStyle:"Normal"},{fontName:"TimesNewRoman",fontStyle:"Bold"},{fontName:"TimesNewRoman",fontStyle:"Italic"}],onLoad:function n(){var i=Ext.create("PDF.csPrintToPdf",{font:{name:"TimesNewRoman",size:10,type:"Normal"},margin:{top:11,right:8,bottom:8,left:20},bottomColontitle:{height:8,font:{size:7,wide:0}},listeners:{initColontitle:function e(t,n){n.colontitle.isTop?(n.align=PDF.csPrintToPdf.alignType.center,n.text="test report - page "+n.pageNumber+" of "+n.totalPages):(n.align=PDF.csPrintToPdf.alignType.center,n.text=" page "+n.pageNumber+" of "+n.totalPages)}}});i.writeHtml({html:e}),t(i.output("blobUrl"))}})})}var i=this,r=Ext.getBody().getSize(),o,a;o=Ext.create("UB.view.BaseWindow",{title:UB.i18n("redaktirovat"),modal:!0,maximizable:!0,maximized:!1,width:r.width,height:r.height,style:{background:"#959596"},overflowX:"auto",overflowY:"auto",stateful:!0,stateId:"HtmlEditorForm",layout:{type:"hbox",pack:"center",align:"stretch"},items:[a=Ext.create("UB.ux.UBTinyMCETextArea",{width:i.pageWidth,tinyMCEConfig:i.tinyMCEEditorConfig,value:i.getRawValue()})],buttons:[{disabled:!window.PDF,text:UB.i18n("preViewInPDF"),handler:function e(){n(a.getValue())}},{xtype:"panel",flex:1},{text:UB.i18n("Change"),glyph:UB.core.UBUtil.glyphs.faSave,handler:function e(){var t=a.getValue();i.setValue(t),o.close()}},{text:UB.i18n("cancel"),glyph:UB.core.UBUtil.glyphs.faTimes,handler:function e(){o.close()}}],listeners:{afterrender:function e(){},beforeclose:function e(){}}}),o.show(),a.updateLayout()},initContextMenu:function e(){var t=this;t.editBtnCtrl=Ext.create("Ext.Button",{renderTo:t.editBtn,cls:"ub-btn-flat ub-btn-rounded",tooltip:UB.i18n("redaktirovat"),focusOnToFront:!1,style:"z-index: 3;",glyph:UB.core.UBUtil.glyphs.faPencil,handler:t.editContent,scope:t})},isFocusableField:!0,isFocusable:function e(){return!this.readOnly},setValue:function e(){this.callParent(arguments)}})},function(e,t){Ext.define("UB.view.UploadFileAjax",{extend:"Ext.window.Window",alias:"widget.uploadfileajax",uses:["UB.core.UBLocalStorageManager","UB.core.UBService","UB.core.UBApp","UB.view.ErrorWindow"],padding:1,uploadData:!0,initComponent:function e(){this.fieldFile=Ext.create("Ext.form.field.File",{name:"document",allowBlank:!1,blankText:UB.i18n("obazatelnoePole"),fieldLabel:UB.i18n("vyberiteFayl"),anchor:"100%",buttonText:"",buttonConfig:{iconCls:"iconAttach"},listeners:{afterrender:function e(t){t.getEl().dom.addEventListener("change",this.onFileSelect,!1),t.inputEl.on("click",function(){this.button.fileInputEl.dom.click()},t)},scope:this}}),this.progressBar=Ext.create("Ext.ProgressBar"),this.form=Ext.create("Ext.form.Panel",{frame:!0,method:"POST",waitTitle:UB.i18n("pleaseWait"),waitMsgTarget:!0,items:[this.fieldFile,this.progressBar]}),Ext.apply(this,{autoShow:!0,title:UB.i18n("fayl"),border:0,layout:"fit",modal:!0,stateful:!0,stateId:UB.core.UBLocalStorageManager.getKeyUI("UploadFileWindowP_window"),defaultFocus:this.fieldFile,items:[this.form],buttons:[{text:UB.i18n("load"),scope:this,handler:this.upLoad}]}),this.callParent()},onFileSelect:function e(t){},upLoad:function e(t){function n(e){e.loaded<e.total?u?s.updateProgress(e.loaded/e.total,UB.i18n("loadingData"),!0):u=e.loaded/e.total<.3:l||(s.reset(),l=!0,s.wait({duration:3e4,text:UB.i18n("Transformation"),animate:!0}))}var i=t.up("window"),r,o,a,s,l=!1,u=!1;if(r=this.fieldFile.fileInputEl.dom,s=this.progressBar,0!==r.files.length){if(t.disable(),a=r.files[0],!this.uploadData)return Ext.callback(i.callback,i.scope,[a]),void i.close();o={entity:this.entityName,attribute:this.attribute,origName:a.name,filename:a.name,id:this.instanceID},$App.connection.post("setDocument",a,{params:o,headers:{"Content-Type":"application/octet-stream"},onProgress:n}).then(function(e){Ext.callback(i.callback,i.scope,[e.data])}).fin(function(){i.close()})}}})},function(e,t){Ext.define("UB.ux.form.UBPlanFactContainer",{extend:"Ext.container.Container",alias:"widget.ubplanfactcontainer",layout:{type:"vbox",align:"left"},initComponent:function e(){var t=this;if(t.callParent(arguments),t.items.each(function(e){switch(e.controlType){case"plan":t.planControl=e;break;case"fact":t.factControl=e;break;default:throw Error('You must set value property "controlType" for UBPlanFactContainer. The value must be "plan" "fact".')}"plan"===e.controlType&&(t.planControl=e),"fact"===e.controlType&&(t.factControl=e)}),!t.factControl)throw Error('You must specify "fact" control for UBPlanFactContainer. To do this, a value of "fact" for the property controlType.');if(!t.planControl)throw Error('You must specify "plan" control for for UBPlanFactContainer. To do this, a value of "fact" for the property controlType.');t.factControl.hide(),t.on("afterrender",t.onAfterRender,t,{single:!0})},initContextMenu:function e(){var t=this,n=[];n.push({text:UB.i18n("showPlanAndFact"),itemID:"editItem",handler:function e(){t.planControl.show(),t.factControl.show()},scope:t}),t.contextMenu=Ext.create("Ext.menu.Menu",{items:n})},adminRoles:"admins",onAfterRender:function e(){var t=this,n=($App.connection.userData("roles")||"").split(","),i=(t.adminRoles||"").split(","),r=!1;t.onDataBind(),t.setEventBind();for(var o=0;o<n.length;o++)if(i.indexOf(n[o])>=0){r=!0;break}r&&(t.initContextMenu(),t.getEl().on("contextmenu",function(e,n){e.stopEvent(),t.contextMenu.showAt(e.getXY())},t))},setEventBind:function e(){var t=this,n;n=t.up("basepanel"),n||console.error(" The UB.ux.form.field.UBCompositeComboBox must be in the UB.view.BasePanel"),n.binder&&n.binder.updateFormFields(),n.on("formDataReady",t.onDataBind,t)},onDataBind:function e(){var t=this;t.factControl.getValue()?(t.planControl.hide(),t.factControl.show()):(t.planControl.show(),t.factControl.hide())}})},function(e,t,n){n(3),Ext.define("UB.view.CommandBuilder.EntitiesComboBox",{extend:"UB.ux.form.field.UBBaseComboBox",alias:"widget.commandbuilderentitiescombobox",requires:["Ext.data.ArrayStore"],initComponent:function e(){this.valueField=this.displayField="name",this.store=Ext.create("Ext.data.ArrayStore",{fields:[{name:this.valueField,type:"string"}]}),Ext.apply(this,{queryMode:"local"}),this.callParent(arguments),this.addListener("render",this.loadEntities,this)},loadEntities:function e(t,n){var i=[];$App.domainInfo.eachEntity(function(e,t){i.push([t])}),this.getStore().loadData(i)}})},function(e,t){Ext.define("UB.view.CommandBuilder.CommandTypeComboBox",{extend:"Ext.form.field.ComboBox",alias:"widget.commandbuildercommandtypecombobox",requires:["Ext.data.ArrayStore"],initComponent:function e(){this.valueField="id",this.displayField="description",this.store=Ext.create("Ext.data.ArrayStore",{fields:[{name:this.valueField,type:"int"},{name:this.displayField,type:"string"}],data:[[0,UB.core.UBCommand.commandType.showList],[1,UB.core.UBCommand.commandType.showForm]]}),Ext.apply(this,{queryMode:"local",editable:!1,width:150}),this.callParent(arguments)}})},function(e,t,n){n(4),n(2),Ext.define("UB.view.CommandBuilder.FormsComboBox",{extend:"Ext.form.field.ComboBox",alias:"widget.commandbuilderformscombobox",initComponent:function e(){this.valueField=this.displayField="Code",this.store=UB.core.UBStoreManager.getFormStore(),Ext.apply(this,{queryMode:"local",editable:!1,width:150}),this.callParent(arguments)}})},function(e,t){Ext.define("UB.view.CommandBuilder.EntityTreePanel",{extend:"Ext.tree.Panel",alias:"widget.commandbuilderentitytreepanel",requires:["Ext.data.TreeStore"],store:Ext.create("Ext.data.TreeStore"),rootVisible:!1,useArrows:!0,cls:"no-leaf-icons no-parent-icons",initComponent:function e(){this.callParent(arguments),this.entityName&&this.setRootNode(UB.core.UBUtil.getEntityAttributesTree(this.entityName))},setEntity:function e(t){this.entityName=t,$App.connection.domain.has(t)&&this.setRootNode(UB.core.UBUtil.getEntityAttributesTree(this.entityName))}})},function(e,t){Ext.define("UB.view.CommandBuilder.AttributesGridPanel",{extend:"Ext.grid.Panel",alias:"widget.commandbuilderattributesgridpanel",requires:["Ext.data.Model","Ext.data.Store","Ext.ModelManager","UB.core.UBAppConfig"],initComponent:function e(){var t=UB.ux.data.UBStore.entityModelName("CommandBuilderAttributesGridPanelModel");Ext.ModelManager.getModel(t)||Ext.define(t,{extend:"Ext.data.Model",idProperty:"name",fields:[{name:"name",type:"string"},{name:"caption",type:"string"}]}),Ext.apply(this,{store:Ext.create("Ext.data.Store",{model:t}),columns:[{dataIndex:"caption",header:"caption",flex:1},{dataIndex:"name",header:"name",flex:1}],multiSelect:!0,menu:Ext.create("Ext.menu.Menu",{items:[{text:UB.i18n("Delete"),iconCls:"iconDelete",scope:this,handler:this.deleteRecord}]}),listeners:{itemcontextmenu:function e(t,n,i,r,o,a){o.stopEvent(),this.menu.showAt(o.xy)}}}),this.callParent(arguments)},getData:function e(){var t=[];return this.getStore().each(function(e){t.push(e.get("name"))}),t.join(",")},setData:function e(t){this.getStore().loadData(t)},addRecord:function e(t){this.getStore().add(t)},deleteRecord:function e(){var t=this.getSelectionModel(),n=t.getSelection();t.hasSelection()&&this.getStore().remove(n)}})},function(e,t){Ext.define("UB.ux.form.field.AdvancedTextArea",{extend:"Ext.form.field.TextArea",alias:"widget.advancedtextarea",insertAtCursor:function e(t){var n=this.inputEl.dom,i,r;void 0!==document.selection?(n.focus(),i=document.selection.createRange(),i.text=t):(r=n.selectionStart,n.value=n.value.substring(0,r)+t+n.value.substring(r))}})},function(e,t,n){n(4),n(3),n(17),Ext.define("UB.ux.UBPreFilter",{uses:["UB.view.ErrorWindow","UB.view.BasePanel"],statics:{basePrefix:"pre_",storeKeyPrefix:"admin:ub:filterLastConfig:",makeFilters:function e(t){return Ext.create("UB.ux.UBPreFilter",t)}},isPreFilter:!0,constructor:function e(t){var n=this;n.filters=t.filters,n.entityCode=t.entityCode,n.onFilterReady=t.onFilterReady,n.onCancel=t.onCancel,n.store=t.store,n.scope=t.scope,n.options=t.options||{},n.configName=t.configName||n.options.code||n.entityCode,n.initParams=n.options.params||{},n.customForm=t.customForm,n.customView=t.customView,n.enableFts=!1!==n.options.enableFts,n.filterPrefix=n.store&&n.store.filterFormId?n.store.filterFormId:UB.ux.UBPreFilter.basePrefix+Ext.id(),n.controls={},n.filtersFunc={},n.resultFilters={},!Ext.isEmpty(n.filters)&&Ext.isArray(n.filters)&&Ext.Array.each(n.filters,function(e){var t=n.resultFilters[e.property];t=t?[t,e]:e,n.resultFilters[e.property]=t}),n.customForm||(n.createFilterForm(),n.filterWin.show(),n.filterWin.down("form").getEl().on("keydown",function(e){e.getKey()===Ext.EventObject.ENTER&&n.searchHandler()}))},updateStoreFilters:function e(){var t=this,n=[];t.store&&(t.store.filterFormId=t.filterPrefix,t.store.filters.each(function(e){e.id.substr(0,4)===UB.ux.UBPreFilter.basePrefix&&n.push(e)}),Ext.Array.each(n,function(e){t.store.filters.removeAtKey(e.id)}),t.filters.length>0?t.store.filter(t.filters):t.store.clearFilter())},deleteConfig:function e(){var t=this,n;if(n=t.configBox.getRawValue(),Ext.isEmpty(n))return void $App.dialogError("doNotSelectedConfigName");$App.dialogYesNo("attention","deleteConfirm").done(function(e){e&&t.deleteSettings(n,function(){t.configBox.clearValue(),t.refreshConfig()})})},saveConfig:function e(){var t=this,n,i={},r;if(n=t.configBox.getRawValue(),Ext.isEmpty(n))return void $App.dialogError("doNotSelectedConfigName");Ext.Object.each(t.controls,function(e,n){var r={};Ext.Object.each(n,function(e,t){r[e]=t.getValue()},t),i[e]=r},t),r=JSON.stringify(i),t.saveSettings(n,r,!1).done(function(){localStorage.setItem(UB.ux.UBPreFilter.storeKeyPrefix+t.configName,n),t.refreshConfig()})},getInitParam:function e(t){return this.initParams?this.initParams[t]:null},setInitParams:function e(){var t=this;Ext.Object.each(t.controls,function(e,n){Ext.Object.each(n,function(n,i){if("filterType"===n){var r,o=t.initParams[e];o&&o.filterType&&(r=o.filterType),r&&i.setValue(r)}},t)},t)},clearAllFilter:function e(){var t=this,n=UB.ux.Multifilter.predefinedFilters;Ext.Object.each(t.controls,function(e,i){Ext.Object.each(i,function(i,r){if("filterType"!==i)r.clearValue&&r.clearValue(),r.setValue(null),r.filterEmptyValue&&r.setValue(r.filterEmptyValue);else{var o,a=t.initParams[e];a&&a.filterType&&(o=a.filterType),o||(o=n[r.getValue()]),o&&r.setValue(o)}},t)},t)},doLoadConfig:function e(t,n){var i=this;i.filterWin.down("form").isDirty()?$App.dialogYesNo("attention","filterWasChangedConfirm").done(function(e){e?i.loadConfig():t&&t.call(i,n)}):i.loadConfig()},loadConfig:function e(){var t=this,n,i;if(n=t.configBox.getRawValue(),Ext.isEmpty(n))return void $App.dialogError("doNotSelectedConfigName");i=function e(t,n){if(Ext.isEmpty(n))t.clearValue&&t.clearValue(),t.setValue(null);else if(t.setValueById)t.setValueById(n);else try{"DateTime"===t.fieldType&&Ext.isString(n)&&(n=new Date(n)),t.setValue(n)}catch(e){t.clearValue()}t&&t.resetOriginalValue&&t.resetOriginalValue()},t.loadSettings(n).done(function(e){var r;if(0!==e.getCount()){r=e.getAt(0);var o=JSON.parse(r.get("filter"));Ext.isObject(o)&&(t.clearAllFilter(),Ext.Object.each(o,function(e,n){var r=t.controls[e];r?(n.filterType&&r.filterType&&i(r.filterType,n.filterType),Ext.Object.each(n,function(e,t){if("filterType"!==e){var n=r[e];n&&i(n,t)}},t)):UB.logError("!!!! filter not found for attribute "+t.entityCode+"."+e+" in filter "+t.configName)},t),localStorage.setItem(UB.ux.UBPreFilter.storeKeyPrefix+t.configName,n))}})},loadSettings:function e(t){var n=this,i;return i=UB.Repository("ubs_filter").attrs(["ID","code","name","filter","isGlobal","owner","mi_modifyDate"]).where("code","=",n.configName),t&&(i=i.where("name","=",t)),i.selectAsStore()},saveSettings:function e(t,n,i){var r=this;return Ext.isEmpty(i)&&(i=!1),r.loadSettings(t).then(function(e){var o,a;return 0!==e.getCount()?(o=e.getAt(0),a={fieldList:["ID","filter","mi_modifyDate"],entity:"ubs_filter",method:UB.core.UBCommand.methodName.UPDATE,execParams:{ID:o.get("ID"),filter:n}},a.execParams.mi_modifyDate=o.get("mi_modifyDate"),$App.connection.update(a)):$App.connection.insert({fieldList:["code","name","filter","isGlobal"],entity:"ubs_filter",execParams:{code:r.configName,name:t,filter:n,isGlobal:i?1:0}})})},deleteSettings:function e(t,n){var i=this;i.loadSettings(t).done(function(e){var t;0!==e.getCount()&&(t=e.getAt(0),$App.connection.doDelete({entity:"ubs_filter",execParams:{ID:t.get("ID"),mi_modifyDate:t.get("mi_modifyDate")}}).done(function(){n&&n.call(i)}))})},refreshConfig:function e(){var t=this,n=t.configBox.getValue();return t.loadSettings().then(function(e){e.autoLoad=!1,e.remoteSort=!1,e.remoteFilter=!1,e.remoteGroup=!1,t.configBox.bindStore(e),t.configBox.findRecordByValue(n)&&t.configBox.setValue(n)})},reCalcFilters:function e(){var t=this,n,i,r,o;t.filters=[],t.ftsTextBox&&t.ftsTextBox.getValue()&&(t.filters.push({id:t.getFilterPrefix("ftsText"),root:"data",property:"ID",filterType:"match",condition:"match",value:t.ftsTextBox.getValue()}),(n=t.filtersFunc[t.ftsRecordDateAttr])&&(i=n(),i.length>0&&(r=i[0].value,o=i.length>1?i[1].value:i[0].value,t.filters.push({id:t.getFilterPrefix("ftsBetween"),root:"data",property:"ID",filterType:"between",condition:"between",valueFrom:r,valueTo:o})))),Ext.Object.each(t.filtersFunc,function(e,n){var i=n.call();i&&(Ext.isArray(i)?Ext.Array.each(i,function(e){t.filters.push(e)}):t.filters.push(i))},t)},initFilterControl:function e(t,n,i){var r=this.controls[t]||{};r[n||"main"]=i,this.controls[t]=r,i&&i.resetOriginalValue&&i.resetOriginalValue()},initFilterFunc:function e(t,n){this.filtersFunc[t]=n},searchHandler:function e(){var t=this;t.filterWin.down("form").isValid()&&(t.reCalcFilters(),t.updateStoreFilters(),t.onFilterReady&&t.onFilterReady.call(t.scope||t,t.filters,t.filterPrefix),t.filterWin.isFilterReady=!0,t.filterWin.close(),t.filterWin=null)},createFilterForm:function e(){var t,n=this;n.filterWin=t=Ext.create("UB.view.BaseWindow",{title:UB.i18n("filterForm"),height:500,width:600,modal:!0,stateful:!0,stateId:"ubFilterForm_"+n.entityCode+"_"+n.configName,layout:{type:"fit"},items:[{xtype:"form",layout:{type:"fit"},items:n.createFilters()}],dockedItems:[{xtype:"toolbar",dock:"top",padding:"0 0 0 5",layout:{type:"hbox",align:"middle"},items:[n.configBox=Ext.widget("ubbasebox",{queryMode:"local",displayField:"name",valueField:"name",fieldLabel:UB.i18n("configurationName")}),{xtype:"button",tooltip:UB.i18n("load"),scale:"medium",glyph:UB.core.UBUtil.glyphs.faOpen,margin:"5 0 0 0",handler:function e(){n.doLoadConfig()}},{xtype:"button",tooltip:UB.i18n("save"),scale:"medium",glyph:UB.core.UBUtil.glyphs.faSave,margin:"5 0 0 0",handler:function e(){n.saveConfig()}},{xtype:"button",tooltip:UB.i18n("fDelete"),scale:"medium",glyph:UB.core.UBUtil.glyphs.faTrashO,margin:"5 5 0 0",handler:function e(){n.deleteConfig()}}]}],buttons:[{glyph:UB.core.UBUtil.glyphs.faBinoculars,text:UB.i18n("search"),handler:n.searchHandler,scope:n},{text:UB.i18n("clear"),glyph:UB.core.UBUtil.glyphs.faEraser,handler:function e(){n.clearAllFilter()}},{text:UB.i18n("cancel"),glyph:UB.core.UBUtil.glyphs.faClose,handler:function e(){t.close()}}]}),n.filterWin.on("close",function(){n.filterWin.isFilterReady||n.onCancel&&n.onCancel.call(n.scope||n)},n),n.refreshConfig().done(function(){n.loadLastConfig()})},loadLastConfig:function e(){var t=this,n;if((n=localStorage.getItem(UB.ux.UBPreFilter.storeKeyPrefix+t.configName))&&Ext.isString(n)&&!t.store){t.configBox.isInternalChange=!0;try{t.configBox.findRecordByValue(n)&&t.configBox.setValue(n)}finally{t.configBox.isInternalChange=!1}t.configBox.getValue()&&t.loadConfig()}},createFtsPanel:function e(t){var n=this,i=[],r=t.mixins.fts.ftsRecordDateAttr,o;return o=n.getPrevFilter(n.getFilterPrefix("ftsText")),n.ftsRecordDateAttr=r,n.ftsTextBox=Ext.create("Ext.form.field.Text",{fieldLabel:UB.i18n("ftsTextFieldLabel"),enableKeyEvents:!0,value:o?o.value:null,listeners:{keyup:function e(t,i){i.getKey()===i.ENTER&&n.searchHandler()},scope:n}}),i.push({layout:"hbox",defaults:{margins:"0 5 0 0"},width:"100%",fit:1,margin:"0 0 10 0",collapsible:!1,border:!1,bodyBorder:!1,items:[n.ftsTextBox]}),{title:UB.i18n("ftsSearchGroup"),padding:"5 0 0 5",flex:1,layout:{type:"vbox",align:"stretch"},autoScroll:!0,items:i}},createFilters:function e(){var t=this,n,i,r,o=$App.domainInfo.get(t.entityCode),a=[],s=t.options.groups,l=t.options.componentsReady,u={},c;return t.enableFts&&o.mixins&&o.mixins.fts&&(c=t.createFtsPanel(o)),s&&Ext.isArray(s)?(Ext.Array.each(s,function(e){e.fields&&Ext.isArray(e.fields)&&(i=[],Ext.Array.each(e.fields,function(e){(r=o.attr(e))&&(n=t.createFilter(r,e))&&(u[e]=n,i.push(n))}),a.push({title:UB.i18n(e.caption),padding:"5 0 0 5",flex:1,layout:{type:"vbox",align:"stretch"},autoScroll:!0,items:i}))}),l&&l(u),c&&a.push(c),{flex:1,xtype:"tabpanel",cls:"ub-basepanel",isForValidate:!0,layout:{type:"vbox",align:"stretch"},autoScroll:!0,padding:"5 0 0 5",items:a}):(Ext.Object.each(o.attributes,function(e,i){i.defaultView&&(n=t.createFilter(i,e))&&(u[e]=n,a.push(n))}),l&&l(u),c?(i=[{title:UB.i18n("UbPreFilterMainGroup"),padding:"5 0 0 5",flex:1,layout:{type:"vbox",align:"stretch"},autoScroll:!0,items:a},c],{flex:1,xtype:"tabpanel",cls:"ub-basepanel",isForValidate:!0,layout:{type:"vbox",align:"stretch"},autoScroll:!0,padding:"5 0 0 5",items:i}):{isForValidate:!0,layout:{type:"vbox",align:"stretch"},autoScroll:!0,padding:"5 0 0 5",items:a})},createFilter:function e(t,n){var i=this,r=[],o,a=i.entityCode,s,l={},u;if(u=i.initParams[n]||{},o=$App.domainInfo.get(a).getEntityAttribute(n,!0),o.customSettings&&o.customSettings.UIGridColumnClass)r=i.getEnumFilterInput(a,n,o.customSettings.UIGridColumnClass),r[1].flex=100,r[2].flex=100;else if(t.associatedEntity)r=i.getAssociationFilterInput(a,n,u),r[1].flex=100,r[2].flex=100;else if("Enum"===t.dataType)r=i.getEnumFilterInput(a,n,void 0,u),r[1].flex=100,r[2].flex=100;else{var c=UBDomain.getPhysicalDataType(t.dataType);switch(c){case"float":case"int":r=i.getNumericFilterInput(a,n,"float"===c||"currency"===c);break;case"date":r=i.getDateFilterInput(a,n);break;case"boolean":r=i.getBooleanFilterInput(a,n);break;default:r=i.getPlainTextFilter(a,n),r[1].flex=100}}return u.caption&&(r[0].fieldLabel=u.caption),0===r.length?null:(s=r[0],s.hideLabel=!0,r.unshift({xtype:"label",shrinkWrap:2,margin:"0 0 0 3",width:110,text:r[0].fieldLabel}),i.customView?Ext.Object.each(i.customView,function(e,t){l[e]=t}):l={layout:{type:"hbox"},defaults:{margins:"0 5 0 0"},width:"100%",fit:1,margin:"0 0 10 0",collapsible:!1,border:!1,bodyBorder:!1},l.items=r,l)},getBaseFilter:function e(t){return this.resultFilters[t]},getPrevFilter:function e(t,n){var i=this,r=[];return i.store?i.store.filterFormId?(r=i.store.filters.getByKey(t),r&&r.relatedFilter?[r,r.relatedFilter]:r):(this.store.filters.each(function(e){e.property===n&&r.push(e)}),0===r.length?null:1===r.length?r[0]:r):n?this.getBaseFilter(n):null},getFilterPrefix:function e(t){return this.filterPrefix+t},getItemMargin:function e(){return Ext.form.field.Base.prototype.margin},getAssociationFilterInput:function e(t,n,i){return UB.ux.Multifilter.getAssociationFilterInputS(t,n,i,this)},getEnumFilterInput:function e(t,n,i,r){return UB.ux.Multifilter.getEnumFilterInputS(t,n,i,r,this)},getNumericFilterInput:function e(t,n,i){return UB.ux.Multifilter.getNumericFilterInputS(t,n,i,this)},getPlainTextFilter:function e(t,n){return UB.ux.Multifilter.getPlainTextFilterS(t,n,this)},getDateFilterInput:function e(t,n){return UB.ux.Multifilter.getDateFilterInputS(t,n,this)},getBooleanFilterInput:function e(t,n){return UB.ux.Multifilter.getBooleanFilterInputS(t,n,this)}})},function(e,t,n){n(14),n(2),n(3),n(15),Ext.define("UB.view.ToolbarMenuButton",{extend:"UB.view.ToolbarWidget",alias:"widget.ubtoolbarmenubutton",statics:{minWidthScreen:1024},initComponent:function e(){this.items=[Ext.create("Ext.button.Button",{border:0,padding:1,scale:"large",glyph:UB.core.UBUtil.glyphs.faBars,cls:"ub-menu-button",handler:this.buttonClick,scope:this}),{xtype:"label",text:UB.i18n("menu")},{xtype:"tbseparator"}],this.callParent(arguments),this.on("destroy",this.onDestroy,this),$App.on("desktopChanged",function(){var e,t=$App.getViewport();t.on("resize",this.viewPortResize,this),t.getWidth()<=UB.view.ToolbarMenuButton.minWidthScreen&&(e=this.getLeftPanel())&&e.isVisible()&&e.hide(),this.initViewPortResize=!0},this)},viewPortResize:function e(t,n){var i=this.getLeftPanel(),r;i&&(r=i.isHidden(),n<=UB.view.ToolbarMenuButton.minWidthScreen&&!r&&i.hide(),n>UB.view.ToolbarMenuButton.minWidthScreen&&!this.innerHide&&r&&i.show())},onDestroy:function e(){var t=this,n;t.dynPanel&&(t.dynPanel.un("itemclickstart",t.itemClickStart,t),!t.dynPanel.isDestroyed&&t.dynPanel.destroy&&t.dynPanel.destroy()),t.dynPanel=null,t.leftPanel=null,n=UB.core.UBApp.getViewport(),this.initViewPortResize&&n&&(n.un("resize",t.viewPortResize,t),this.initViewPortResize=!1)},getLeftPanel:function e(){var t=this,n;return t.leftPanel||(n=UB.core.UBApp.getViewport(),t.leftPanel=n.getLeftPanel()),t.leftPanel},buttonClick:function e(){var t=this,n,i,r,o;i=UB.core.UBApp.getViewport(),n=t.getLeftPanel(),r=i.getBox(),r.width<=UB.view.ToolbarMenuButton.minWidthScreen?(o=t.getBox(),t.dynPanel||(t.dynPanel=Ext.create("UB.view.LeftPanel",{floating:{shadow:!0,shim:!0},closeAction:"hide",height:r.height-o.bottom,width:300,border:!0,flex:1}),t.dynPanel.on("blur",function(){this.close()},t),t.dynPanel.on("itemclickstart",t.itemClickStart,t)),t.dynPanel.isVisible()?t.dynPanel.hide():t.dynPanel.showAt(0,o.bottom+1),Ext.getDoc().on("mousedown",t.onMouseDown,t,{buffer:20})):n.isVisible()?(n.hide(),t.innerHide=!0):(n.show(),t.innerHide=!1)},itemClickStart:function e(){var t=this;t.dynPanel&&t.dynPanel.hide()},onMouseDown:function e(t){this.dynPanel||Ext.getDoc().un("mousedown",this.onMouseDown,this);var n,i=t.getXY(),r=i[0],o=i[1];n=this.dynPanel.getBox(),(r<n.x||r>n.x+n.width||o<n.y||o>n.y+n.height)&&(t.within(this.getEl())||this.dynPanel.hide(),Ext.getDoc().un("mousedown",this.onMouseDown,this))}})},function(e,t,n){n(44),n(163),n(21),Ext.define("UB.view.FullTextSearchWidget",{extend:"UB.view.ToolbarWidget",alias:"widget.ubfulltextsearchwidget",requires:["Ext.form.field.Text","Ext.data.Store","Ext.button.Button"],uses:["UB.core.UBApp"],selectPeriod:function e(){var t=this;UB.view.SelectPeriodDialog.getPeriod({description:UB.i18n("selectPeriod"),dateFrom:t.periodContext.dateFrom,dateTo:t.periodContext.dateTo,disableDayPanel:!0}).then(function(e){e&&(t.periodContext=e,t.periodContext.dateFrom=UB.core.UBUtil.truncTimeToUtcNull(t.periodContext.dateFrom),t.periodContext.dateTo=UB.core.UBUtil.truncTimeToUtcNull(t.periodContext.dateTo),t.periodBtn.setText(t.periodContext.periodCaption))})},initComponent:function e(){var t=this,n={ftsDefault:1};if(t.ftsConnectionList=[{code:"ftsDefault",name:UB.i18n("ftsConnectionftsDefault")}],t.periodContext={dateFrom:null,dateTo:null},t.periodContext.periodCaption=UB.view.SelectPeriodDialog.getPeriodCaption(t.periodContext.dateFrom,t.periodContext.dateTo),$App.domainInfo.eachEntity(function(e){var i;e.hasMixin("fts")&&(i=e.mixins.fts.connectionName)&&(n[i]||(n[i]=UB.i18n("ftsConnection"+i),t.ftsConnectionList.push({code:i,name:n[i]})))}),t.periodBtn=Ext.create("Ext.button.Button",{border:!1,text:t.periodContext.periodCaption,tooltip:UB.i18n("ftsChkFilterPeriod"),margin:0,padding:"6 1 6 1",style:{backgroundColor:"white"},handler:t.selectPeriod,scope:t}),t.ftsConnection=t.ftsConnectionList[0].code,t.setActiveConnection=function(e,n){t.ftsConnection=e,t.selectConnection.setText(n)},t.ftsConnectionList.length>1){var i=[];t.ftsConnectionList.forEach(function(e){i.push({text:e.name,handler:t.setActiveConnection.bind(t,e.code,e.name)})}),t.selectConnection=Ext.create("Ext.button.Button",{border:!1,text:t.ftsConnectionList[0].name,tooltip:UB.i18n("selectFtsConnection"),margin:0,padding:"6 1 6 1",style:{backgroundColor:"white"},arrowCls:"",menu:{items:i}})}t.textBox=Ext.create("Ext.form.field.Text",{enableKeyEvents:!0,border:!1,margin:0,padding:1,width:60,emptyText:UB.i18n("search"),style:"color: black; border-width: 0px;",fieldStyle:"border-width: 0px;",listeners:{focus:function e(t){t.setWidth(150)},blur:function e(t){t.setWidth(60)},keyup:function e(n,i){i.getKey()===i.ENTER&&t.searchButtonClick()},scope:t}}),t.searchButton=Ext.create("Ext.button.Button",{border:!1,padding:"6 1 6 3",style:{backgroundColor:"white"},glyph:UB.core.UBUtil.glyphs.faSearch,handler:t.searchButtonClick,scope:t}),t.items=[{xtype:"panel",layout:"hbox",style:{background:"white"},items:[t.searchButton,t.textBox]}],t.selectConnection&&t.items[0].items.push(t.selectConnection),t.items[0].items.push(t.periodBtn),t.callParent(arguments)},updateSnippet:function e(t,n){function i(e,t){var i;return t=t.split(".")[0],i=_.find(n.attributes,function(e,n){return n.toLowerCase()===t}),'<br/><span style="color: blue">'+(i?i.caption||i.description:t)+"</span>&nbsp"}var r=this;if(r.snippetRe||(r.snippetRe=RegExp("Z(.*?)Z:","gim")),t)return t.replace(r.snippetRe,i)},searchButtonClick:function e(){var t=this,n=t.textBox.getValue(),i,r,o;n&&(o=[{name:"ID",visibility:!1},{name:"entity",visibility:!1},{name:"entitydescr",visibility:!0,description:UB.i18n("ftsFieldCaption")},{name:"snippet",visibility:!0,description:UB.i18n("ftsFieldSnippet"),format:function e(n,i,r){var o=r.get("entity");return n=t.updateSnippet(n,$App.domainInfo.get(o)),i&&Ext.isString(n)&&n.length>15&&(i.tdAttr='data-qtip="'+Ext.String.htmlEncode(n)+'"'),n}}],r={entity:"fts_"+t.ftsConnection,method:"fts",fieldList:UB.core.UBUtil.convertFieldListToNameList(o),whereList:{match:{condition:"match",values:{any:n}}}},t.periodContext&&t.periodContext.dateFrom&&t.periodContext.dateTo&&(r.whereList.between={condition:"between",values:{v1:t.periodContext.dateFrom,v2:t.periodContext.dateTo}}),r.fieldList=o,i=Ext.getCmp("FullTextSearchWidgetResult"),i&&i.close(),$App.doCommand({cmdType:"showList",tabId:"FullTextSearchWidgetResult",target:$App.viewport.centralPanel,hideActions:["addNewByCurrent","addNew","prefilter","edit","del","newVersion","history","accessRight","audit","itemSelect","showPreview","commandLink","itemLink","optimizeWidth"],description:UB.format(UB.i18n("fullTextSearchWidgetResultTitle"),n),cmpInitConfig:{disableSearchBar:!0,onDeterminateForm:function e(t){var n,i,r,o=t.getSelectionModel().getSelection();if(o.length&&(n=""+o[0].get("entity"),i=UB.core.UBFormLoader.getFormByEntity(n)))return r={formCode:i.get("code"),description:i.get("description")?UB.i18n(""+i.get("description")):"",entityName:n,instanceID:o[0].get("ID")}}},cmdData:{params:[r]}}))}})},function(e,t,n){n(42),n(17),Ext.define("UB.view.SelectPeriodDialog",{singleton:!0,requires:["Ext.form.RadioGroup","Ext.panel.Panel","Ext.form.field.Checkbox","Ext.form.field.ComboBox","Ext.form.field.Number","Ext.tab.Panel"],getPeriodCaption:function e(t,n){if(!t||!n)return UB.i18n("emptyPeriod");t=UB.core.UBUtil.truncTime(t),n=UB.core.UBUtil.truncTime(n);var i=this,r;return r=i.parsePeriod(t,n),r.oneDay?Ext.Date.format(t,"d.m.Y"):r.oneMonth?Ext.Date.monthNames[t.getMonth()]+" "+t.getFullYear():r.oneYear?r.period.yearStart+UB.i18n("yearShort"):r.firtsDateYear&&r.lastDateYear?r.period.yearStart+" - "+r.period.yearEnd+UB.i18n("yearShort"):r.firstDateMonth&&r.lastDateMonth&&r.isOneYear?Ext.Date.monthNames[r.period.monthStart-1]+" - "+Ext.Date.monthNames[r.period.monthEnd-1]+" "+r.period.yearStart+UB.i18n("yearShort"):r.firstDateMonth&&r.lastDateMonth?Ext.Date.monthNames[r.period.monthStart-1]+" "+r.period.yearStart+UB.i18n("yearShort")+" - "+Ext.Date.monthNames[r.period.monthEnd-1]+" "+r.period.yearEnd+UB.i18n("yearShort"):Ext.Date.format(t,"d.m.Y")+" -"+Ext.Date.format(n,"d.m.Y")},parsePeriod:function e(t,n){var i={};return i.period={},i.oneDay=!0,i.oneYear=!0,i.oneMonth=!0,i.oneQuarter=!0,t&&n?(t=UB.core.UBUtil.truncTime(t),n=UB.core.UBUtil.truncTime(n),i.firstDateMonth=Ext.Date.getFirstDateOfMonth(t).getTime()===t.getTime(),i.lastDateMonth=Ext.Date.getLastDateOfMonth(n).getTime()===n.getTime(),i.firstDateQuarter=i.firstDateMonth&&Math.floor(t.getMonth()/3)===t.getMonth()/3,i.lastDateQuarter=i.firstDateMonth&&Math.floor((n.getMonth()+1)/3)===(n.getMonth()+1)/3,i.firtsDateYear=i.firstDateMonth&&0===t.getMonth(),i.lastDateYear=i.firstDateMonth&&11===n.getMonth(),i.oneDay=t.getTime()===n.getTime(),i.isOneYear=t.getFullYear()===n.getFullYear(),i.oneMonth=i.oneYear&&t.getMonth()===n.getMonth(),i.oneQuarter=i.oneYear&&Math.floor(t.getMonth()/3)===Math.floor((n.getMonth()+1)/3),i.oneYear=i.isOneYear&&i.firtsDateYear&&i.lastDateYear,i.period.yearStart=t.getFullYear(),i.period.yearEnd=n.getFullYear(),i.firtsDateYear&&i.lastDateYear?i.period.type="year":i.firstDateQuarter&&i.lastDateQuarter?i.period.type="month":i.firstDateMonth&&i.lastDateMonth?i.period.type="month":i.period.type="date",i.period.quarterStart=Math.floor(t.getMonth()/3),i.period.quarterEnd=Math.floor((n.getMonth()+1)/3),i.period.monthStart=t.getMonth()+1,i.period.monthEnd=n.getMonth()+1,i):(i.period.type="none",i)},getPeriod:function e(t){function n(n,i){if(i){var o=e(i);r(o.dateFrom||new Date,o.dateTo||new Date)}switch(t.disableDayPanel&&"date"===n&&(n="month"),n){case"none":m.setActiveTab(m.down("#emptyPeriod"));break;case"date":m.setActiveTab(l);break;case"month":m.setActiveTab(p);break;case"year":m.setActiveTab(w)}}function i(e){d.getValue()<c.getValue()&&("from"===e?d.setValue(c.getValue()):c.setValue(d.getValue())),h.getValue()<f.getValue()&&d.getValue()===c.getValue()&&("from"===e?h.setValue(f.getValue()):f.setValue(h.getValue()))}function e(e){var t=null,n,i,r;switch(e||y.getValue().period){case"none":t={dateFrom:null,dateTo:null,periodCaption:UB.i18n("emptyPeriod")};break;case"date":n=l.down("#twoDay").getValue(),t={dateFrom:a.getValue(),dateTo:r=n?s.getValue():a.getValue(),periodCaption:UB.view.SelectPeriodDialog.getPeriodCaption(a.getValue(),r)};break;case"month":n=p.down("#twoMonth").getValue(),i=new Date(c.getValue(),f.getValue()-1,1),r=n?Ext.Date.getLastDateOfMonth(new Date(d.getValue(),h.getValue()-1,1)):Ext.Date.getLastDateOfMonth(new Date(c.getValue(),f.getValue()-1,1)),t={dateFrom:i,dateTo:r,periodCaption:UB.view.SelectPeriodDialog.getPeriodCaption(i,r)};break;case"year":n=w.down("#twoYear").getValue(),t={dateFrom:i=new Date(C.getValue(),0,1),dateTo:r=Ext.Date.getLastDateOfMonth(new Date(n?_.getValue():C.getValue(),11,1)),periodCaption:UB.view.SelectPeriodDialog.getPeriodCaption(i,r)}}return t}function r(e,t){e=UB.core.UBUtil.truncTime(e),t=UB.core.UBUtil.truncTime(t);var n=o.parsePeriod(e,t);l.down("#twoDay").setValue(!n.oneDay),a.setValue(e),s.setValue(t),p.down("#twoMonth").setValue(!n.oneMonth),c.setValue(n.period.yearStart),d.setValue(n.period.yearEnd),f.setValue(n.period.monthStart),h.setValue(n.period.monthEnd),w.down("#twoYear").setValue(!n.isOneYear),C.setValue(n.period.yearStart),_.setValue(n.period.yearEnd)}var o=this,a,s,l,u,c,d,f,h,p,m,g,y,v,b,x,E,w,C,_,B=Q.defer();return u=[{code:1,name:Ext.Date.monthNames[0]},{code:2,name:Ext.Date.monthNames[1]},{code:3,name:Ext.Date.monthNames[2]},{code:4,name:Ext.Date.monthNames[3]},{code:5,name:Ext.Date.monthNames[4]},{code:6,name:Ext.Date.monthNames[5]},{code:7,name:Ext.Date.monthNames[6]},{code:8,name:Ext.Date.monthNames[7]},{code:9,name:Ext.Date.monthNames[8]},{code:10,name:Ext.Date.monthNames[9]},{code:11,name:Ext.Date.monthNames[10]},{code:12,name:Ext.Date.monthNames[11]}],v=t.dateFrom||Ext.Date.getFirstDateOfMonth(new Date),b=t.dateTo||Ext.Date.getFirstDateOfMonth(new Date),x=o.parsePeriod(t.dateFrom,t.dateTo),y=Ext.widget("radiogroup",{fieldLabel:UB.i18n("periodType"),labelAlign:"top",allowBlank:!1,header:!1,columns:1,vertical:!0,items:[{boxLabel:UB.i18n("periodNone"),name:"period",checked:"none"===x.period.type,inputValue:"none"},{boxLabel:UB.i18n("periodYear"),name:"period",checked:"year"===x.period.type,inputValue:"year"},{boxLabel:UB.i18n("periodMonth"),name:"period",checked:"month"===x.period.type,inputValue:"month"},{boxLabel:UB.i18n("periodDate"),name:"period",checked:"date"===x.period.type,hidden:t.disableDayPanel,inputValue:"date"}],listeners:{change:function e(t,i,r){n(i.period,r.period)}}}),a=Ext.widget("ubdatefield",{labelWidth:20,width:150,allowBlank:!1,fieldType:"Date",listeners:{change:function e(t,n,i){var r=s.getValue();r&&Ext.isDate(n)&&n.getTime()>r.getTime()&&s.setValue(n)}}}),s=Ext.widget("ubdatefield",{labelWidth:10,width:150,labelSeparator:"",fieldLabel:" -",hidden:!!x.oneDay,allowBlank:!1,fieldType:"Date",listeners:{change:function e(t,n,i){var r=a.getValue();r&&Ext.isDate(n)&&n.getTime()<r.getTime()&&a.setValue(n)}}}),l=Ext.widget("panel",{layout:"vbox",items:[{xtype:"checkbox",itemId:"twoDay",boxLabel:UB.i18n("periodChkTwoDay"),value:!x.oneDay,listeners:{change:function e(t,n){s.setVisible(n)},scope:o}},{layout:"hbox",items:[a,s]},{flex:1}]}),f=Ext.create("Ext.form.field.ComboBox",{allowBlank:!1,valueField:"code",forceSelection:!0,editable:!1,displayField:"name",store:Ext.create("Ext.data.Store",{fields:["code","name"],data:u}),listeners:{change:function e(t,n,r){i("from")}}}),c=Ext.widget("numberfield",{width:100,minWidth:100,minValue:1900,listeners:{change:function e(t,n,r){i("from")}}}),h=Ext.create("Ext.form.field.ComboBox",{allowBlank:!1,forceSelection:!0,editable:!1,valueField:"code",displayField:"name",store:Ext.create("Ext.data.Store",{fields:["code","name"],data:u}),listeners:{change:function e(t,n,r){i("to")}}}),d=Ext.widget("numberfield",{minValue:1900,minWidth:100,width:100,listeners:{change:function e(t,n,r){i("to")}}}),p=Ext.widget("container",{layout:"vbox",items:[{xtype:"checkbox",itemId:"twoMonth",boxLabel:UB.i18n("periodChkTwoMonth"),value:!x.oneMonth,listeners:{change:function e(t,n){p.down("#monthTo").setVisible(n)},scope:o}},{flex:1,layout:"hbox",items:[{layout:"vbox",padding:2,flex:1,items:[c,f]},{itemId:"monthTo",hidden:!!x.oneMonth,padding:2,flex:1,layout:"vbox",items:[d,h]}]}]}),C=Ext.widget("numberfield",{minValue:1900,minWidth:100,width:100,listeners:{change:function e(t,n,i){n>_.getValue()&&_.setValue(n)}}}),_=Ext.widget("numberfield",{minValue:1900,minWidth:100,width:100,listeners:{change:function e(t,n,i){n<C.getValue()&&C.setValue(n)}},hidden:x.isOneYear}),w=Ext.widget("container",{layout:"vbox",items:[{xtype:"checkbox",itemId:"twoYear",boxLabel:UB.i18n("periodChkTwoYear"),value:!x.isOneYear,listeners:{change:function e(t,n){_.setVisible(n)},scope:o}},{flex:1,layout:"hbox",items:[C,_]}]}),E=function t(){var n=e();g.close(),B.resolve(n)},m=Ext.widget("tabpanel",{itemId:"workPanel",tabBar:{hidden:!0},items:[{padding:"20 0 0 5",itemId:"emptyPeriod",html:UB.i18n("emptyPeriod")},w,p,l]}),g=Ext.create("UB.view.BaseWindow",{title:t.description?UB.i18n(t.description):UB.i18n("selectPeriod"),height:300,width:650,closable:!1,minimizable:!1,maximizable:!1,modal:!0,autoShow:!0,overflowY:"auto",overflowX:"auto",layout:{type:"hbox",align:"stretch"},items:[{xtype:"container",width:130,layout:"fit",items:[y]},{xtype:"container",flex:1,layout:"fit",items:[m]}],buttons:[{text:UB.i18n("vybrat"),glyph:UB.core.UBUtil.glyphs.faCheck,handler:E,scope:o},{text:UB.i18n("cancel"),glyph:UB.core.UBUtil.glyphs.faTimes,handler:function e(){g.close(),B.resolve(null)}}]}),r(v,b),n(x.period.type),g.show(),B.promise}})},function(e,t){Ext.define("UB.ux.tree.Column",{extend:"Ext.grid.column.Column",alias:"widget.ubtreecolumn",tdCls:Ext.baseCSSPrefix+"grid-cell-treecolumn",autoLock:!0,lockable:!1,draggable:!1,hideable:!1,textCls:"",innerCls:"ub_tree_inner-col",isTreeColumn:!0,cellTpl:['<tpl for="lines">','<span class="{parent.lineCLS}{#}" ></span>',"</tpl>",'<tpl if="iconCls">','<span class="ub_tree_icon ub_tree_depth ub_tree_depth_{depth} {iconCls}"></span>',"</tpl>",'<span class="ub_tree_text ub_tree_depth ub_tree_depth_{depth} ','<tpl if="isNode">ub_tree_text_group</tpl>',' {textCls}">{value}</span>','<tpl if="isNode"><span class=','"ub_tree_group ub_tree_depth ub_tree_depth_{depth} fa <tpl if="expanded">fa-angle-down<tpl else>fa-angle-left</tpl>"',"></span>",'<tpl else><span class="ub_tree_group ub_tree_depth ub_tree_depth_{depth}"></tpl>'],initComponent:function e(){var t=this,n=t.renderer;"string"==typeof n&&(n=Ext.util.Format[n]),t.origRenderer=n,t.origScope=t.scope||window,t.renderer=t.treeRenderer,t.scope=t,t.callParent()},treeRenderer:function e(t,n,i,r,o,a,s){var l=this,u=i.get("cls"),c;return u&&(n.tdCls+=" "+u),c=l.initTemplateRendererData(t,n,i,r,o,a,s),l.getTpl("cellTpl").apply(c)},initTemplateRendererData:function e(t,n,i,r,o,a,s){for(var l=this,u=l.origRenderer,c=i.data,d=i.parentNode,f=s.rootVisible,h=s.showTreeLines,p=[],m;d&&(f||d.data.depth>0);)m=d.data,p[f?m.depth:m.depth-1]=m.isLast?0:1,d=d.parentNode;return{record:i,baseIconCls:l.iconCls,iconCls:c.iconCls,icon:c.icon,checkboxCls:l.checkboxCls,checked:c.checked,elbowCls:l.elbowCls,expanderCls:l.expanderCls,textCls:l.textCls,leaf:c.leaf,expanded:c.expanded,isNode:i.hasChildNodes(),depth:i.getDepth(),expandable:i.isExpandable(),isLast:c.isLast,blankUrl:Ext.BLANK_IMAGE_URL,href:c.href,hrefTarget:c.hrefTarget,lines:p,metaData:n,childCls:l.getChildCls?l.getChildCls()+" ":"",lineCLS:h?"ub_tree_line_visible ub_tree_line_visible":"ub_tree_line ub_tree_line",value:u?u.apply(l.origScope,arguments):t}}})},function(e,t,n){n(2),n(4),n(47),n(46),Ext.define("UB.view.LeftPanel",{extend:"Ext.panel.Panel",alias:"widget.ubleftpanel",uses:["UB.core.UBApp"],layout:{type:"vbox",align:"stretch"},cls:"ub-left-panel",initComponent:function e(){var t=this,n,i,r=[],o,a,s,l,u,c;t.items=t.items||[],t.desktopStore=n=UB.core.UBStoreManager.getDesktopStore(),c=UB.core.UBApp.getDesktop(),a=function e(t){s.setText(t.text),s.selectedItemID=t.itemID,UB.core.UBApp.setDesktop(t.itemID)},o=n.getCount()>0?n.getAt(0):null;for(var d=0;d<n.getCount();d++)i=n.getAt(d),1===i.get("isDefault")&&(o=i),c===i.get("ID")&&(u=i),r.push({text:i.get("caption"),itemID:i.get("ID"),handler:a});t.items.push(s=Ext.create("Ext.button.Button",{text:u?u.get("caption"):o?o.get("caption"):"--",cls:"ub-desktop-button",selectedItemID:u?u.get("ID"):o?o.get("ID"):null,tooltip:UB.i18n("selectDesktop"),iconCls:"ub-desktop-button-image",arrowCls:"no",iconAlign:"right",menu:l=Ext.create("Ext.menu.Menu",{items:r})})),t.items.push(t.navPnl=Ext.create("UB.view.NavigationPanel",{flex:1})),this.addEvents("itemclickstart"),t.navPnl.on("itemclickstart",this.itemClickStart,this),this.callParent(arguments),t.on("resize",function(e,t){l.setWidth(t)}),t.on("destroy",this.onDestroy(),this)},itemClickStart:function e(t){this.fireEvent("itemclickstart",t)},onDestroy:function e(){this.navPnl&&this.navPnl.on("itemclickstart",this.itemClickStart,this),this.navPnl=null}})},function(e,t){Ext.onReady(function(){Ext.define("Ext.ux.form.CheckboxGroupFix",{override:"Ext.form.CheckboxGroup",initComponent:function e(){var t=this;t.invalidCls=t.invalidCls?t.invalidCls:Ext.baseCSSPrefix+"form-invalid",t.callParent(arguments)}})})},function(e,t){Ext.define("UB.ux.UBToolTipOverride",{override:"Ext.tip.ToolTip",getTargetXY:function e(){var t=this,n=this.callParent(arguments),i=Ext.getBody().getViewSize();return t.targetXY&&n[1]+t.getHeight()>i.height&&(n[1]=t.targetXY[1]-15-t.getHeight()),n}})},function(e,t){Ext.define("UB.view.cryptoUI.ReadPK",{extend:"Ext.window.Window",alias:"widget.readpkwindow",uses:["UB.core.UBApp","UB.core.UBAppConfig"],statics:{getPkParam:function e(){var t=Ext.create("UB.view.cryptoUI.ReadPK",{}),n=new Promise(function(e,n){t.deferred={resolve:e,reject:n}});return t.show(),n}},layout:"anchor",buttonAlign:"center",width:500,plain:!0,modal:!0,closable:!1,header:!0,resizable:!1,listeners:{afterRender:function e(t,n){this.keyNav=Ext.create("Ext.util.KeyNav",this.el,{enter:this.submitForm,scope:this})}},initComponent:function e(){var t=this;t.title=UB.i18n("ReadPkTitle"),t.items=[],t.buttons=[{text:UB.i18n("ok"),scope:this,minWidth:150,margins:"0 0 10 0",handler:function e(){this.submitForm()}},{text:UB.i18n("\u0441ancel"),scope:this,minWidth:150,margins:"0 0 10 0",handler:function e(){t.deferred.reject(new UB.UBAbortError),t.close()}}],t.fieldFile=Ext.create("Ext.form.field.File",{margin:"10 40 10 40",name:"document",allowBlank:!1,allowOnlyWhitespace:!1,labelClsExtra:"fa fa-user-secret fa-2x",blankText:UB.i18n("obazatelnoePole"),requireText:UB.i18n("Select private key file"),labelWidth:40,labelSeparator:"",fieldLabel:" ",anchor:"100%",buttonText:"",buttonConfig:{iconCls:"iconAttach"},listeners:{afterrender:function e(n){n.getEl().dom.addEventListener("change",t.onFileSelect,!1),n.inputEl.on("click",function(){this.button.fileInputEl.dom.click()},n)},scope:this}}),t.textFieldPassword=Ext.create("Ext.form.field.Text",{margin:"10 40 10 40",allowBlank:!1,labelClsExtra:"fa fa-key fa-2x",requireText:UB.i18n("parol"),fieldLabel:" ",labelSeparator:"",labelWidth:40,inputType:"password",anchor:"100%",listeners:{keyup:{fn:$App.passwordKeyUpHandler}},enableKeyEvents:!0}),t.pnl=Ext.create("Ext.form.Panel",{header:!1,padding:"20 50 30 50",layout:{type:"vbox",align:"stretch"},items:[t.fieldFile,t.textFieldPassword]}),t.items.push(t.pnl),t.callParent(arguments)},onFileSelect:function e(t){},submitForm:function e(){var t=this;if(!t.fieldFile.isValid()||!t.textFieldPassword.isValid())return void UB.showErrorWindow(UB.i18n("SelectPKAndPassMsg"));t.deferred.resolve({keyFile:t.fieldFile.fileInputEl.dom.files[0],password:t.textFieldPassword.getValue()}),t.close()}})},function(e,t){Ext.define("UB.view.cryptoUI.SelectCert",{extend:"Ext.window.Window",alias:"widget.selectcertwindow",uses:["UB.core.UBApp","UB.core.UBAppConfig"],statics:{getCertificates:function e(){var t=Ext.create("UB.view.cryptoUI.SelectCert",{}),n=new Promise(function(e,n){t.deferred={resolve:e,reject:n}});return t.show(),n}},layout:"anchor",buttonAlign:"center",width:500,plain:!0,modal:!0,closable:!1,header:!1,resizable:!1,listeners:{afterRender:function e(t,n){this.keyNav=Ext.create("Ext.util.KeyNav",this.el,{enter:this.submitForm,scope:this})}},initComponent:function e(){var t=this;t.items=[],t.buttons=[{text:UB.i18n("enter"),scope:this,minWidth:150,margins:"0 0 10 0",handler:function e(){this.submitForm()}},{text:UB.i18n("Cancel"),scope:this,minWidth:150,margins:"0 0 10 0",handler:function e(){t.deferred.reject(new UB.UBAbortError),t.close()}}],t.fieldFile=Ext.create("Ext.form.field.File",{margin:"10 80 10 80",name:"document",allowBlank:!1,blankText:UB.i18n("obazatelnoePole"),labelWidth:40,labelSeparator:"",fieldLabel:UB.i18n("Certificates "),anchor:"100%",buttonText:"",buttonConfig:{iconCls:"iconAttach"},listeners:{afterrender:function e(n){n.getEl().dom.addEventListener("change",t.onFileSelect,!1),n.inputEl.on("click",function(){this.button.fileInputEl.dom.click()},n)},scope:this}}),t.pnl=Ext.create("Ext.panel.Panel",{header:!1,padding:"20 50 30 50",layout:{type:"vbox",align:"stretch"},items:[t.fieldFile,{xtype:"component",padding:"50 0 0 0",autoEl:{tag:"div",html:UB.i18n("useCertAuthenticatinUploadCert")}}]}),t.items.push(t.pnl),t.callParent(arguments)},onFileSelect:function e(t){},submitForm:function e(){var t=this;t.deferred.resolve({certFiles:t.fieldFile.fileInputEl.dom.files}),t.close()}})},function(e,t){Ext.define("UB.view.UBDropZone",{singleton:!0,requires:["Ext.util.Observable"],mixins:{observable:"Ext.util.Observable"},currentDropTargetConfig:[],enterLaveBalance:0,visible:!1,_enabled:!0,constructor:function e(){var t=this;t.mixins.observable.constructor.call(t)},setEnabled:function e(t){this._enabled=t,t||this.hide()},isEnabled:function e(){return this._enabled},addZoneHandlers:function e(t,n,i){var r=function e(t){var n=t.dataTransfer;t.stopPropagation(),t.preventDefault(),n.dropEffect="copy"};i.dragoverHandler=i.dragoverHandler||r,n.addEventListener("dragenter",function(e){t.dzEnter(),n.className="ub-dz-placeholder ub-dz-placeholder-accept",e.stopPropagation(),e.preventDefault()}),n.addEventListener("dragover",function(e){return i.dragoverHandler(e)}),n.addEventListener("dragleave",function(e){var i=n.getBoundingClientRect();t.dzLeave(),(e.clientX>i.left+i.width||e.clientX<i.left||e.clientY>i.top+i.height||e.clientY<i.top)&&(n.className="ub-dz-placeholder"),e.stopPropagation(),e.preventDefault()}),n.addEventListener("drop",function(e){var n=!1;return e.stopPropagation(),i.dropHandler?(n=i.dropHandler(e),t.hide(),n):(UB.logError("no handler passed to UBDropZone config: "+JSON.stringify(i)),!1)})},init:function e(){var t=document.body,n=this,i,r;n.mask=i=document.createElement("div"),i.className="ub-mask",i.style.display="none",t.appendChild(i),i.addEventListener("dragenter",function(e){n.dzEnter(),e.preventDefault()}),i.addEventListener("dragleave",function(e){n.dzLeave(),e.preventDefault()}),n.content=r=document.createElement("div"),r.className="ub-dz-body",t.appendChild(r),r.addEventListener("dragenter",function(e){n.dzEnter(),e.stopPropagation(),e.preventDefault()}),r.addEventListener("dragleave",function(e){n.dzLeave(),e.stopPropagation(),e.preventDefault()}),t.addEventListener("dragenter",function(e){if(n._enabled){var t=e.dataTransfer,i,o;e.preventDefault(),!n.isVisible()&&t.types.length>0&&-1!==_.indexOf(t.types,"Files")&&(n.fireEvent("configureDropZone",n.currentDropTargetConfig),n.currentDropTargetConfig.length&&(UB.logDebug("add     inner content"),_.forEach(n.currentDropTargetConfig,function(e){i=document.createElement("div"),i.className="ub-dz-placeholder",i.id="ub-dz-item-"+o,i.innerHTML=UB.format('<i class="{0}"></i><br>{1}</div>',e.iconCls||"fa fa-dropbox fa-5x",UB.i18n(e.message)),r.appendChild(i),n.addZoneHandlers(n,i,e)}),n.show()))}}),t.addEventListener("dragover",function(e){var t;if(n._enabled)return e.preventDefault(),t=e.dataTransfer,t.dropEffect="none",!1})},clearContent:function e(){for(var t=this,n=t.content,i=n.childNodes.length-1;i>=0;i--)n.removeChild(n.childNodes[i]);t.currentDropTargetConfig=[]},dzEnter:function e(){return++this.enterLaveBalance},dzLeave:function e(){return--this.enterLaveBalance,0===this.enterLaveBalance&&this.hide(),this.enterLaveBalance},hide:function e(){this.mask.style.display="none",this.content.style.display="none",this.clearContent(),this.visible=!1,this.enterLaveBalance=0},show:function e(){this.enterLaveBalance=0,this.mask.style.display="inline",this.content.style.display="inline",this.visible=!0},isVisible:function e(){return this.visible}})}]);