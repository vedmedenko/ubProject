{"version":3,"file":"ub-pub.min.js","sources":["webpack:///ub-pub.min.js"],"sourcesContent":["!function e(t,r){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=r(require(\"lodash\")):\"function\"==typeof define&&define.amd?define([\"lodash\"],r):\"object\"==typeof exports?exports.UB=r(require(\"lodash\")):t.UB=r(t._)}(this,function(e){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function t(){return e.default}:function t(){return e};return t.d(r,\"a\",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p=\"\",t(t.s=11)}([function(t,r){t.exports=e},function(e,t,r){\"use strict\";var n,o,i,s=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e};!function(r,a){\"object\"===s(t)?e.exports=t=a():(o=[],n=a,void 0!==(i=\"function\"==typeof n?n.apply(t,o):n)&&(e.exports=i))}(void 0,function(){var e=e||function(e,t){var r={},n=r.lib={},o=n.Base=function(){function e(){}return{extend:function t(r){e.prototype=this;var n=new e;return r&&n.mixIn(r),n.hasOwnProperty(\"init\")||(n.init=function(){n.$super.init.apply(this,arguments)}),n.init.prototype=n,n.$super=this,n},create:function e(){var t=this.extend();return t.init.apply(t,arguments),t},init:function e(){},mixIn:function e(t){for(var r in t)t.hasOwnProperty(r)&&(this[r]=t[r]);t.hasOwnProperty(\"toString\")&&(this.toString=t.toString)},clone:function e(){return this.init.prototype.extend(this)}}}(),i=n.WordArray=o.extend({init:function e(r,n){r=this.words=r||[],this.sigBytes=n!=t?n:4*r.length},toString:function e(t){return(t||a).stringify(this)},concat:function e(t){var r=this.words,n=t.words,o=this.sigBytes,i=t.sigBytes;if(this.clamp(),o%4)for(var s=0;s<i;s++){var a=n[s>>>2]>>>24-s%4*8&255;r[o+s>>>2]|=a<<24-(o+s)%4*8}else if(n.length>65535)for(var s=0;s<i;s+=4)r[o+s>>>2]=n[s>>>2];else r.push.apply(r,n);return this.sigBytes+=i,this},clamp:function t(){var r=this.words,n=this.sigBytes;r[n>>>2]&=4294967295<<32-n%4*8,r.length=e.ceil(n/4)},clone:function e(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function t(r){for(var n=[],o=function t(r){var r=r,n=987654321,o=4294967295;return function(){n=36969*(65535&n)+(n>>16)&o,r=18e3*(65535&r)+(r>>16)&o;var t=(n<<16)+r&o;return t/=4294967296,(t+=.5)*(e.random()>.5?1:-1)}},s=0,a;s<r;s+=4){var u=o(4294967296*(a||e.random()));a=987654071*u(),n.push(4294967296*u()|0)}return new i.init(n,r)}}),s=r.enc={},a=s.Hex={stringify:function e(t){for(var r=t.words,n=t.sigBytes,o=[],i=0;i<n;i++){var s=r[i>>>2]>>>24-i%4*8&255;o.push((s>>>4).toString(16)),o.push((15&s).toString(16))}return o.join(\"\")},parse:function e(t){for(var r=t.length,n=[],o=0;o<r;o+=2)n[o>>>3]|=parseInt(t.substr(o,2),16)<<24-o%8*4;return new i.init(n,r/2)}},u=s.Latin1={stringify:function e(t){for(var r=t.words,n=t.sigBytes,o=[],i=0;i<n;i++){var s=r[i>>>2]>>>24-i%4*8&255;o.push(String.fromCharCode(s))}return o.join(\"\")},parse:function e(t){for(var r=t.length,n=[],o=0;o<r;o++)n[o>>>2]|=(255&t.charCodeAt(o))<<24-o%4*8;return new i.init(n,r)}},c=s.Utf8={stringify:function e(t){try{return decodeURIComponent(escape(u.stringify(t)))}catch(e){throw Error(\"Malformed UTF-8 data\")}},parse:function e(t){return u.parse(unescape(encodeURIComponent(t)))}},l=n.BufferedBlockAlgorithm=o.extend({reset:function e(){this._data=new i.init,this._nDataBytes=0},_append:function e(t){\"string\"==typeof t&&(t=c.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function t(r){var n=this._data,o=n.words,s=n.sigBytes,a=this.blockSize,u=4*a,c=s/u;c=r?e.ceil(c):e.max((0|c)-this._minBufferSize,0);var l=c*a,h=e.min(4*l,s);if(l){for(var f=0;f<l;f+=a)this._doProcessBlock(o,f);var p=o.splice(0,l);n.sigBytes-=h}return new i.init(p,h)},clone:function e(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),h=n.Hasher=l.extend({cfg:o.extend(),init:function e(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function e(){l.reset.call(this),this._doReset()},update:function e(t){return this._append(t),this._process(),this},finalize:function e(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function e(t){return function(e,r){return new t.init(r).finalize(e)}},_createHmacHelper:function e(t){return function(e,r){return new f.HMAC.init(t,r).finalize(e)}}}),f=r.algo={};return r}(Math);return e})},function(e,t,r){\"use strict\";function n(e,t,r){this.name=\"UBError\",this.detail=t,this.code=r,this.message=e||\"UBError\",Error.captureStackTrace?Error.captureStackTrace(this,n):this.stack=Error().stack}function o(e,t){this.name=\"UBAbortError\",this.detail=t,this.code=\"UBAbortError\",this.message=e||\"UBAbortError\",Error.captureStackTrace?Error.captureStackTrace(this,o):this.stack=Error().stack}var i=r(0);e.exports.apply=function(e,t){return Array.prototype.forEach.call(arguments,function(t){t&&t!==e&&Object.keys(t).forEach(function(r){e[r]=t[r]})}),e};var s=/{(\\d+)}/g;e.exports.format=function(e,t){var r=i.toArray(arguments).slice(1);return e.replace(s,function(e,t){return r[t]})},e.exports.ns=function(e){var t=window,r=void 0,n=void 0,o=void 0,i=void 0;for(r=e.split(\".\"),o=0,i=r.length;o<i;o++)n=r[o],t[n]||(t[n]={}),t=t[n];return t},e.exports.iso8601Parse=function(e){return e?new Date(e):null},e.exports.iso8601ParseAsDate=function(e){var t=e?new Date(e):null;return t&&t.setTime(t.getTime()+60*t.getTimezoneOffset()*1e3),t},e.exports.booleanParse=function(e){return\"boolean\"==typeof e?e:void 0===e||null===e||\"\"===e?null:1===e},e.exports.base64FromAny=function(e){return new Promise(function(t,r){var n=new FileReader,o=e instanceof Blob?e:new Blob([e]);n.addEventListener(\"loadend\",function(){t(n.result.split(\",\",2)[1])}),n.addEventListener(\"error\",function(e){r(e)}),n.readAsDataURL(o)})};var a=\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\",u=[];!function(){for(var e=0,t=a.length-1;e<t;e++)u.push(a[e])}();var c=new Uint8Array(256);!function(){for(var e=0,t=a.length;e<t;e++)c[a[e].charCodeAt(0)]=e}(),e.exports.base64toArrayBuffer=function(e){var t=.75*e.length,r=e.length,n=0,o=void 0,i=void 0,s=void 0,a=void 0;\"=\"===e[e.length-1]&&(t--,\"=\"===e[e.length-2]&&t--);for(var u=new ArrayBuffer(t),l=new Uint8Array(u),h=0;h<r;h+=4)o=c[e.charCodeAt(h)],i=c[e.charCodeAt(h+1)],s=c[e.charCodeAt(h+2)],a=c[e.charCodeAt(h+3)],l[n++]=o<<2|i>>4,l[n++]=(15&i)<<4|s>>2,l[n++]=(3&s)<<6|63&a;return u},n.prototype=Error(),n.prototype.constructor=n,e.exports.UBError=n,o.prototype=Error(),o.prototype.constructor=o,e.exports.UBAbortError=o,e.exports.log=function e(t){console&&console.log.apply(console,arguments)},e.exports.logError=function e(t){console&&console.error.apply(console,arguments)},e.exports.logWarn=function e(t){console&&console.warn.apply(console,arguments)},e.exports.logDebug=console.info.bind(console);var l=\"undefined\"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():\"nodeJS\";e.exports.userAgent=l.toLowerCase(),e.exports.isChrome=/\\bchrome\\b/.test(l),e.exports.isWebKit=/webkit/.test(l),e.exports.isGecko=!/webkit/.test(l)&&/gecko/.test(l),e.exports.isOpera=/opr|opera/.test(l),e.exports.isMac=/macintosh|mac os x/.test(l),e.exports.isSecureBrowser=/\\belectron\\b/.test(l)},function(e,t,r){\"use strict\";function n(e){var t=s[e];if(void 0!==t||null==e)return t;if(\"undefined\"==typeof $App)return e;if(null==$App.domainInfo)return e;var r=e.split(\".\");if(r.length>2)return e;var n=$App.domainInfo.entities[r[0]];if(!n)return e;if(1===r.length)return s[e]=n.caption,n.caption;var o=n.attributes[r[1]];return o?(s[e]=o.caption,o.caption):e}function o(e){i.merge(s,e)}var i=r(0),s={monkeyRequestsDetected:\"Your request has been processed, but we found that it is repeated several times. Maybe you key fuse?\"};e.exports={i18n:n,i18nExtend:o}},function(e,t,r){\"use strict\";function n(){n.init.call(this)}function o(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function i(e,t,r){if(t)e.call(r);else for(var n=e.length,o=f(e,n),i=0;i<n;++i)o[i].call(r)}function s(e,t,r,n){if(t)e.call(r,n);else for(var o=e.length,i=f(e,o),s=0;s<o;++s)i[s].call(r,n)}function a(e,t,r,n,o){if(t)e.call(r,n,o);else for(var i=e.length,s=f(e,i),a=0;a<i;++a)s[a].call(r,n,o)}function u(e,t,r,n,o,i){if(t)e.call(r,n,o,i);else for(var s=e.length,a=f(e,s),u=0;u<s;++u)a[u].call(r,n,o,i)}function c(e,t,r,n){if(t)e.apply(r,n);else for(var o=e.length,i=f(e,o),s=0;s<o;++s)i[s].apply(r,n)}function l(e){var t=this._events;if(t){var r=t[e];if(\"function\"==typeof r)return 1;if(r)return r.length}return 0}function h(e,t){for(var r=t,n=r+1,o=e.length;n<o;r+=1,n+=1)e[r]=e[n];e.pop()}function f(e,t){for(var r=Array(t);t--;)r[t]=e[t];return r}n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.init=function(){this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events={},this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function e(t){if(\"number\"!=typeof t||t<0||isNaN(t))throw new TypeError(\"n must be a positive number\");return this._maxListeners=t,this},n.prototype.getMaxListeners=function e(){return o(this)},n.prototype.emit=function e(t){var r,n,o,l,h,f,p=\"error\"===t;if(f=this._events)p=p&&null==f.error;else if(!p)return!1;if(p){if((r=arguments[1])instanceof Error)throw r;var d=Error('Uncaught, unspecified \"error\" event. ('+r+\")\");throw d.context=r,d}if(!(n=f[t]))return!1;var y=\"function\"==typeof n;switch(o=arguments.length){case 1:i(n,y,this);break;case 2:s(n,y,this,arguments[1]);break;case 3:a(n,y,this,arguments[1],arguments[2]);break;case 4:u(n,y,this,arguments[1],arguments[2],arguments[3]);break;default:for(l=Array(o-1),h=1;h<o;h++)l[h-1]=arguments[h];c(n,y,this,l)}return!0},n.prototype.addListener=function e(t,r){var n,i,s;if(\"function\"!=typeof r)throw new TypeError(\"listener must be a function\");return i=this._events,i?(i.newListener&&(this.emit(\"newListener\",t,r.listener?r.listener:r),i=this._events),s=i[t]):(i=this._events={},this._eventsCount=0),s?(\"function\"==typeof s?s=i[t]=[s,r]:s.push(r),s.warned||(n=o(this))&&n>0&&s.length>n&&(s.warned=!0,console.error(\"(node) warning: possible EventEmitter memory leak detected. %d %s listeners added. Use emitter.setMaxListeners() to increase limit.\",s.length,t),console.trace())):(s=i[t]=r,++this._eventsCount),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function e(t,r){function n(){this.removeListener(t,n),o||(o=!0,r.apply(this,arguments))}if(\"function\"!=typeof r)throw new TypeError(\"listener must be a function\");var o=!1;return n.listener=r,this.on(t,n),this},n.prototype.removeListener=function e(t,r){var n,o,i,s;if(\"function\"!=typeof r)throw new TypeError(\"listener must be a function\");if(!(o=this._events))return this;if(!(n=o[t]))return this;if(n===r||n.listener&&n.listener===r)0==--this._eventsCount?this._events={}:(delete o[t],o.removeListener&&this.emit(\"removeListener\",t,r));else if(\"function\"!=typeof n){for(i=-1,s=n.length;s-- >0;)if(n[s]===r||n[s].listener&&n[s].listener===r){i=s;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events={},this;delete o[t]}else h(n,i);o.removeListener&&this.emit(\"removeListener\",t,r)}return this},n.prototype.removeAllListeners=function e(t){var r,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events={},this._eventsCount=0):n[t]&&(0==--this._eventsCount?this._events={}:delete n[t]),this;if(0===arguments.length){for(var o=Object.keys(n),i=0,s;i<o.length;++i)\"removeListener\"!==(s=o[i])&&this.removeAllListeners(s);return this.removeAllListeners(\"removeListener\"),this._events={},this._eventsCount=0,this}if(\"function\"==typeof(r=n[t]))this.removeListener(t,r);else if(r)do{this.removeListener(t,r[r.length-1])}while(r[0]);return this},n.prototype.listeners=function e(t){var r,n,o=this._events;return o?(r=o[t],n=r?\"function\"==typeof r?[r]:f(r,r.length):[]):n=[],n},n.listenerCount=function(e,t){return\"function\"==typeof e.listenerCount?e.listenerCount(t):l.call(e,t)},n.prototype.listenerCount=l,e.exports=n},function(e,t,r){\"use strict\";function n(e,t){function r(e){var r=e.expression||\"\";if(\"custom\"===e.condition)throw Error('Condition \"custom\" is not supported for cached instances.');if(r=(r.replace(/(\\[)|(])/gi,\"\")||\"\").trim(),-1===(n=t.indexOf(r)))throw Error(\"Filtering by field \"+r+\" is not allowed, because it is not in fieldList\");i=o.values(e.values)[0],a.push(s(n,e.condition,i))}Object.keys(e);var n=void 0,i=void 0,s=void 0,a=[],u=function e(t){return t?(\"\"+t).replace(/[-[\\]{}()*+?.,\\\\^$|#\\s]/g,\"\\\\$&\"):\"\"},c=e.whereList;s=function e(t,r,n){var o=void 0;switch(r){case\"like\":return o=RegExp(u(n),\"i\"),function(e){var r=e[t];return r&&o.test(r)};case\"equal\":return function(e){return e[t]===n};case\"notEqual\":return function(e){return e[t]!==n};case\"more\":return function(e){return e[t]>n};case\"moreEqual\":return function(e){return e[t]>=n};case\"less\":return function(e){return e[t]<n};case\"lessEqual\":return function(e){return e[t]<=n};case\"isNull\":return function(e){return null===e[t]};case\"notIsNull\":return function(e){return null!==e[t]};case\"notLike\":return o=RegExp(u(n),\"i\"),function(e){var r=e[t];return r&&!o.test(r)};case\"startWith\":return function(e){var r=e[t];return r&&0===r.indexOf(n)};case\"notStartWith\":return function(e){var r=e[t];return r&&0!==r.indexOf(n)};case\"in\":return function(e){var r=e[t];return r&&n.indexOf(r)>=0};case\"notIn\":return function(e){var r=e[t];return r&&n.indexOf(r)<0};default:throw Error(\"Unknown whereList condition\")}};var l=e.ID;return l&&r({expression:\"[ID]\",condition:\"equal\",values:{ID:l}}),o.forEach(c,r),a}var o=r(0);e.exports.doFilterAndSort=function(e,t){var r=void 0,n=this.doFiltration(e,t),o=n.length;return this.doSorting(n,e,t),t.options&&(r=t.options.start||0,n=t.options.limit?n.slice(r,r+t.options.limit):n.slice(r)),{resultData:{data:n,fields:e.fields},total:o}},e.exports.byID=function(e,t){return this.doFilterAndSort(e,{ID:t})},e.exports.doFiltration=function(e,t){var r=void 0,o=void 0,i=e.data,s=!!t.ID,a=n(t,e.fields),u=a.length;if(0===u)return i;for(var c=[],l=i.length,h=-1;++h<l;){for(o=!0,r=-1;++r<u&&!0===o;)o=a[r](i[h]);if(o&&(c.push(i[h]),s))return c}return c},e.exports.doSorting=function(e,t,r){var n=[];if(r.orderList){o.each(r.orderList,function(e){var r=t.fields.indexOf(e.expression);if(r<0)throw Error(\"Ordering by \"+e.expression+\" attribute that don't present in fieldList not allowed\");n.push({idx:r,modifier:\"desc\"===e.order?-1:1})});var i=n.length;if(i){var s=function e(t,r){for(var o=0,s=-1;++s<i&&0===o;){var a=n[s].idx;t[a]!==r[a]&&(o=null===t[a]&&null!==r[a]?1:null===r[a]&&null!==t[a]?-1:null===r[a]&&null===t[a]?0:t[a]>r[a]?1:-1,o*=n[s].modifier)}return o};e.sort(s)}}},e.exports.selectResultToArrayOfObjects=function(e,t){var r=e.resultData.data,n=e.resultData.fields,i=r.length,s=i?Array(i):[];t&&o.forEach(t,function(e,t){var r=n.indexOf(t);r>=0&&(n[r]=e)});for(var a=0;a<i;a++)s[a]=o.zipObject(n,r[a]);return s},e.exports.flatten=function(e,t){var r=[],n=t.fields,o=-1,i=-1,s=0,a=[],u=t.data.length,c=void 0,l=void 0,h=void 0;if(!e||!e.length)throw Error(\"fieldList not exist or empty\");for(1===e.length&&\"*\"===e[0]&&(e=t.fields),e.forEach(function(e){if(-1===(c=n.indexOf(e)))throw Error(\"Invalid field list. Attribute \"+e+\" not found in local data store\");r.push(c)}),h=e.length,a.length=u*(h+1);++i<h;)a[s]=e[s],s++;for(;++o<u;)for(i=-1,l=t.data[o];++i<h;)a[s++]=l[r[i]];return{fieldCount:h,rowCount:u,values:a}},e.exports.arrayOfObjectsToSelectResult=function(e,t){var r=[];return e.forEach(function(e){var n=[];t.forEach(function(t){n.push(e[t])}),r.push(n)}),r}},function(e,t,r){\"use strict\";function n(e){return(e||\"\").toLowerCase()}function o(e){var t={},r=void 0,o=void 0,i=void 0;return e?(e.split(\"\\n\").forEach(function(e){i=e.indexOf(\":\"),r=n(e.substr(0,i).trim()),o=e.substr(i+1).trim(),r&&(t[r]?t[r]+=\", \"+o:t[r]=o)}),t):t}function i(e){var t=\"object\"===(void 0===e?\"undefined\":m(e))?e:void 0;return function(r){return t||(t=o(e)),r?t[n(r)]:t}}function s(e,t,r){return\"function\"==typeof r?r(e,t):(r.forEach(function(r){e=r(e,t)}),e)}function a(e,t,r){var n=Promise.resolve(e);return\"function\"==typeof r?n.then(function(e){return r(e,t)}):(r.forEach(function(e){n=n.then(function(r){return e(r,t)})}),n)}function u(e){return e>=200&&e<300}function c(e,t,r){var n=Object.keys(e);return n.forEach(function(n){t.call(r,e[n],n)}),n}function l(e,t,r){var n=Object.keys(e).sort();return n.forEach(function(n){t.call(r,e[n],n)}),n}function h(e,t){if(!t)return e;var r=[];return l(t,function(e,t){null!=e&&(Array.isArray(e)||(e=[e]),e.forEach(function(e){\"object\"===(void 0===e?\"undefined\":m(e))&&(e=JSON.stringify(e)),r.push(encodeURIComponent(t)+\"=\"+encodeURIComponent(e))}))}),e+(-1===e.indexOf(\"?\")?\"?\":\"&\")+r.join(\"&\")}function f(e){var t=S,r={transformRequest:t.transformRequest,transformResponse:t.transformResponse},o=function e(r){var o=t.headers,i=v.apply({},r.headers),s=void 0,a=void 0,u=void 0,l=function e(t){c(t,function(e,r){if(\"function\"==typeof e){var n=e();n?t[r]=n:delete t[r]}})};o=v.apply({},o.common,o[n(r.method)]),l(o),l(i);e:for(s in o){a=n(s);for(u in i)if(n(u)===a)continue e;i[s]=o[s]}return i},l=o(e);v.apply(r,e),r.headers=l,r.method=r.method?r.method.toUpperCase():\"GET\";var h=void 0,f=void 0,d=void 0;return h=function e(t){return a(t.data,t.headers,r.transformResponse).then(function(e){return t.data=e,u(t.status)?t:Promise.reject(t)})},f=function e(r){l=r.headers;var o=s(r.data,i(l),r.transformRequest),a=b;if(b=Date.now(),r.data){if(E===r.url&&\"string\"==typeof o&&g===o&&b-a<100)throw new v.UBError(\"monkeyRequestsDetected\");g=o,E=r.url}else c(l,function(e,t){\"content-type\"===n(t)&&delete l[t]});return!r.withCredentials&&t.withCredentials&&(r.withCredentials=t.withCredentials),!r.timeout&&t.timeout&&(r.timeout=t.timeout),p(r,o,l).then(h,h)},d=Promise.resolve(r),x.filter(function(e){return!!e.request||!!e.requestError}).map(function(e){return{success:e.request,failure:e.requestError}}).concat({success:f}).concat(x.filter(function(e){return!!e.response||!!e.responseError}).map(function(e){return{success:e.response,failure:e.responseError}})).forEach(function(e){d=d.then(e.success,e.failure)}),d}function p(e,t,r){var n=h(e.url,e.params);return new Promise(function(o,s){var a=new T,l=-1,h=void 0,f=void 0;A.push(e),a.open(e.method,n,!0),c(r,function(e,t){e&&a.setRequestHeader(t,e)}),a.onreadystatechange=function(){if(4===a.readyState){var t=void 0,r=void 0;-1!==h&&(r=a.getAllResponseHeaders(),t=a.responseType?a.response:a.responseText),f&&clearTimeout(f),h=h||a.status,a=null,h=Math.max(1223===h?204:h,0);var n=A.indexOf(e);-1!==n&&A.splice(n,1),(u(h)?o:s)({data:t,status:h,headers:i(r),config:e})}},e.onProgress&&(a.upload?a.upload.onprogress=e.onProgress:a.onprogress=e.onProgress),e.withCredentials&&(a.withCredentials=!0),e.responseType&&(a.responseType=e.responseType),a.send(t||null),e.timeout>0&&(f=setTimeout(function(){h=-1,a&&a.abort()},e.timeout))})}function d(e,t){return f(v.apply(t||{},{method:\"GET\",url:e}))}function y(e,t,r){return f(v.apply(r||{},{method:\"POST\",url:e,data:t}))}var m=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},v=r(2),g=void 0,b=Date.now(),E=void 0;f.allowRequestReiteration=function(){g=null};var w={\"Content-Type\":\"application/json;charset=utf-8\"},S={transformRequest:[function(e){return e&&\"object\"===(void 0===e?\"undefined\":m(e))&&\"\"+e!=\"[object File]\"&&\"\"+e!=\"[object ArrayBuffer]\"?JSON.stringify(e):e}],transformResponse:[function(e,t){return\"string\"==typeof e&&(t(\"content-type\")||\"\").indexOf(\"json\")>=0&&(e=JSON.parse(e)),e}],headers:{common:{Accept:\"application/json, text/plain, */*\"},post:w,put:w,patch:w},timeout:12e4},x=[],A=[],T=XMLHttpRequest;e.exports={interceptors:x,pendingRequests:A,xhrDefaults:S,xhr:f,get:d,post:y}},function(e,t,r){\"use strict\";function n(e,t){var r=this;if(this.dbName=e.toLowerCase(),!i)return this.__inMemoryCache={},this;var n=new Promise(function(e,n){var s=i.open(r.dbName,t||1);s.onerror=function e(t){n(t)},s.onblocked=function(){n({errMsg:\"databaseIsBlocked\",errDetails:\"we need to upgrade database, but some other browser tab also open it\"})},s.onsuccess=function t(){e(s.result)},s.onupgradeneeded=function e(t){var r=t.target.result,n=t.target.transaction;console.debug('upgrading database \"'+r.name+'\" from version '+t.oldVersion+\" to version \"+t.newVersion+\"...\"),o.stores.forEach(function(e){r.objectStoreNames.contains(e)?n.objectStore(e).clear():r.createObjectStore(e)})}});this.ready=function(){return n}}var o={name:\"UB\",stores:[\"permanent\",\"session\",\"userData\"],version:1},i=\"undefined\"!=typeof window&&window.indexedDB;n.SESSION=\"session\",n.PERMANENT=\"permanent\",n.cacheTypes={None:\"None\",Entity:\"Entity\",Session:\"Session\",SessionEntity:\"SessionEntity\"},n.prototype.onTransactionComplete=function(e){},n.prototype.onTransactionAbort=function(e){window.console&&window.console.error(\"IDB transaction aborted: \"+(e.target.error.message||e.target.errorCode))},n.prototype.onTransactionError=function(e){window.console&&window.console.error(\"IDB transaction failed: \"+e.target.errorCode)},n.prototype.get=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"userData\";if(!i){var r=this.__inMemoryCache[t];return Promise.resolve(r?r[e]:void 0)}var n=this;return this.ready().then(function(r){var o=r.transaction([t],\"readwrite\");return o.oncomplete=n.onTransactionComplete,o.onabort=n.onTransactionAbort,o.onerror=n.onTransactionError,new Promise(function(r,n){var i=o.objectStore(t).get(e);i.onsuccess=function e(){r(i.result)},i.onerror=function e(){n({errMsg:i.error.name})}})})},n.prototype.getAllKeys=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"userData\";if(!i){var t=this.__inMemoryCache[e],r=[];if(t)for(var n in t)r.push(t[n]);return Promise.resolve(r)}var o=this;return this.ready().then(function(t){var r=t.transaction([e],\"readwrite\");return r.oncomplete=o.onTransactionComplete,r.onabort=o.onTransactionAbort,r.onerror=o.onTransactionError,new Promise(function(t,n){var o=[],i=r.objectStore(e).openCursor();i.onsuccess=function(e){var r=e.target.result;r?(o.push(r.key),r.continue()):t(o)},i.onerror=function(e){n(e.target.result)}})})},n.prototype.put=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"userData\";if(!i){var r=this.__inMemoryCache[t];return r||(r=this.__inMemoryCache[t]={}),Array.isArray(e)||(e=[e]),e.forEach(function(e){r[e.key]=void 0===e.value?null:e.value}),Promise.resolve(!0)}var n=this;return this.ready().then(function(r){var o=r.transaction([t],\"readwrite\");return o.oncomplete=n.onTransactionComplete,o.onabort=n.onTransactionAbort,o.onerror=n.onTransactionError,new Promise(function(r,n){var i=void 0;Array.isArray(e)?e.forEach(function(s,a){i=o.objectStore(t).put(void 0===s.value?null:s.value,s.key),i.onerror=function(e){n(e.target.result)},i.onsuccess=function(t){a===e.length-1&&r(t.target.result)}}):(i=o.objectStore(t).put(void 0===e.value?null:e.value,e.key),i.onsuccess=i.onerror=function(e){r(e.target.result)})})})},n.prototype.clear=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:\"userData\";if(!i)return this.__inMemoryCache[e]={},Promise.resolve(!0);var t=this;return this.ready().then(function(r){var n=r.transaction([e],\"readwrite\");return n.oncomplete=t.onTransactionComplete,n.onabort=t.onTransactionAbort,n.onerror=t.onTransactionError,new Promise(function(t,r){var o=n.objectStore(e).clear();o.onsuccess=function(e){t(e.target.result)},o.onerror=function(e){r(e.target.result)}})})},n.prototype.remove=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:\"userData\";if(!i){var r=this.__inMemoryCache[t];return r&&(Array.isArray(e)?delete r[e]:e.forEach(function(e){delete r[e]})),Promise.resolve(!0)}var n=this;return this.ready().then(function(r){var o=r.transaction([t],\"readwrite\");return o.oncomplete=n.onTransactionComplete,o.onabort=n.onTransactionAbort,o.onerror=n.onTransactionError,new Promise(function(r,n){var i=void 0;\"string\"==typeof e?(i=o.objectStore(t).delete(e),i.onsuccess=i.onerror=function(e){r(e.target.result)}):Array.isArray(e)?e.length?e.forEach(function(s,a){i=o.objectStore(t).delete(s),i.onerror=function(e){n(e.target.result)},i.onsuccess=function(t){a===e.length-1&&r(t.target.result)}}):r(!0):n({errMsg:\"invalid key for UBCache.remove call\"})})})},n.prototype.removeIfMach=function(e,t){var r=this;return r.getAllKeys(t).then(function(n){var o=n.filter(function(t){return e.test(t)});return r.remove(o,t)})},e.exports=n},function(e,t,r){\"use strict\";var n,o,i,s=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e};!function(a,u){\"object\"===s(t)?e.exports=t=u(r(1)):(o=[r(1)],n=u,void 0!==(i=\"function\"==typeof n?n.apply(t,o):n)&&(e.exports=i))}(void 0,function(e){return function(t){var r=e,n=r.lib,o=n.WordArray,i=n.Hasher,s=r.algo,a=[],u=[];!function(){function e(e){for(var r=t.sqrt(e),n=2;n<=r;n++)if(!(e%n))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var n=2,o=0;o<64;)e(n)&&(o<8&&(a[o]=r(t.pow(n,.5))),u[o]=r(t.pow(n,1/3)),o++),n++}();var c=[],l=s.SHA256=i.extend({_doReset:function e(){this._hash=new o.init(a.slice(0))},_doProcessBlock:function e(t,r){for(var n=this._hash.words,o=n[0],i=n[1],s=n[2],a=n[3],l=n[4],h=n[5],f=n[6],p=n[7],d=0;d<64;d++){if(d<16)c[d]=0|t[r+d];else{var y=c[d-15],m=(y<<25|y>>>7)^(y<<14|y>>>18)^y>>>3,v=c[d-2],g=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;c[d]=m+c[d-7]+g+c[d-16]}var b=l&h^~l&f,E=o&i^o&s^i&s,w=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),S=(l<<26|l>>>6)^(l<<21|l>>>11)^(l<<7|l>>>25),x=p+S+b+u[d]+c[d],A=w+E;p=f,f=h,h=l,l=a+x|0,a=s,s=i,i=o,o=x+A|0}n[0]=n[0]+o|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+a|0,n[4]=n[4]+l|0,n[5]=n[5]+h|0,n[6]=n[6]+f|0,n[7]=n[7]+p|0},_doFinalize:function e(){var r=this._data,n=r.words,o=8*this._nDataBytes,i=8*r.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=t.floor(o/4294967296),n[15+(i+64>>>9<<4)]=o,r.sigBytes=4*n.length,this._process(),this._hash},clone:function e(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});r.SHA256=i._createHelper(l),r.HmacSHA256=i._createHmacHelper(l)}(Math),e.SHA256})},function(e,t,r){\"use strict\";var n,o,i,s=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e};!function(a,u){\"object\"===s(t)?e.exports=t=u(r(1)):(o=[r(1)],n=u,void 0!==(i=\"function\"==typeof n?n.apply(t,o):n)&&(e.exports=i))}(void 0,function(e){return function(t){function r(e,t,r,n,o,i,s){var a=e+(t&r|~t&n)+o+s;return(a<<i|a>>>32-i)+t}function n(e,t,r,n,o,i,s){var a=e+(t&n|r&~n)+o+s;return(a<<i|a>>>32-i)+t}function o(e,t,r,n,o,i,s){var a=e+(t^r^n)+o+s;return(a<<i|a>>>32-i)+t}function i(e,t,r,n,o,i,s){var a=e+(r^(t|~n))+o+s;return(a<<i|a>>>32-i)+t}var s=e,a=s.lib,u=a.WordArray,c=a.Hasher,l=s.algo,h=[];!function(){for(var e=0;e<64;e++)h[e]=4294967296*t.abs(t.sin(e+1))|0}();var f=l.MD5=c.extend({_doReset:function e(){this._hash=new u.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function e(t,s){for(var a=0;a<16;a++){var u=s+a,c=t[u];t[u]=16711935&(c<<8|c>>>24)|4278255360&(c<<24|c>>>8)}var l=this._hash.words,f=t[s+0],p=t[s+1],d=t[s+2],y=t[s+3],m=t[s+4],v=t[s+5],g=t[s+6],b=t[s+7],E=t[s+8],w=t[s+9],S=t[s+10],x=t[s+11],A=t[s+12],T=t[s+13],C=t[s+14],_=t[s+15],O=l[0],D=l[1],L=l[2],N=l[3];O=r(O,D,L,N,f,7,h[0]),N=r(N,O,D,L,p,12,h[1]),L=r(L,N,O,D,d,17,h[2]),D=r(D,L,N,O,y,22,h[3]),O=r(O,D,L,N,m,7,h[4]),N=r(N,O,D,L,v,12,h[5]),L=r(L,N,O,D,g,17,h[6]),D=r(D,L,N,O,b,22,h[7]),O=r(O,D,L,N,E,7,h[8]),N=r(N,O,D,L,w,12,h[9]),L=r(L,N,O,D,S,17,h[10]),D=r(D,L,N,O,x,22,h[11]),O=r(O,D,L,N,A,7,h[12]),N=r(N,O,D,L,T,12,h[13]),L=r(L,N,O,D,C,17,h[14]),D=r(D,L,N,O,_,22,h[15]),O=n(O,D,L,N,p,5,h[16]),N=n(N,O,D,L,g,9,h[17]),L=n(L,N,O,D,x,14,h[18]),D=n(D,L,N,O,f,20,h[19]),O=n(O,D,L,N,v,5,h[20]),N=n(N,O,D,L,S,9,h[21]),L=n(L,N,O,D,_,14,h[22]),D=n(D,L,N,O,m,20,h[23]),O=n(O,D,L,N,w,5,h[24]),N=n(N,O,D,L,C,9,h[25]),L=n(L,N,O,D,y,14,h[26]),D=n(D,L,N,O,E,20,h[27]),O=n(O,D,L,N,T,5,h[28]),N=n(N,O,D,L,d,9,h[29]),L=n(L,N,O,D,b,14,h[30]),D=n(D,L,N,O,A,20,h[31]),O=o(O,D,L,N,v,4,h[32]),N=o(N,O,D,L,E,11,h[33]),L=o(L,N,O,D,x,16,h[34]),D=o(D,L,N,O,C,23,h[35]),O=o(O,D,L,N,p,4,h[36]),N=o(N,O,D,L,m,11,h[37]),L=o(L,N,O,D,b,16,h[38]),D=o(D,L,N,O,S,23,h[39]),O=o(O,D,L,N,T,4,h[40]),N=o(N,O,D,L,f,11,h[41]),L=o(L,N,O,D,y,16,h[42]),D=o(D,L,N,O,g,23,h[43]),O=o(O,D,L,N,w,4,h[44]),N=o(N,O,D,L,A,11,h[45]),L=o(L,N,O,D,_,16,h[46]),D=o(D,L,N,O,d,23,h[47]),O=i(O,D,L,N,f,6,h[48]),N=i(N,O,D,L,b,10,h[49]),L=i(L,N,O,D,C,15,h[50]),D=i(D,L,N,O,v,21,h[51]),O=i(O,D,L,N,A,6,h[52]),N=i(N,O,D,L,y,10,h[53]),L=i(L,N,O,D,S,15,h[54]),D=i(D,L,N,O,p,21,h[55]),O=i(O,D,L,N,E,6,h[56]),N=i(N,O,D,L,_,10,h[57]),L=i(L,N,O,D,g,15,h[58]),D=i(D,L,N,O,T,21,h[59]),O=i(O,D,L,N,m,6,h[60]),N=i(N,O,D,L,x,10,h[61]),L=i(L,N,O,D,d,15,h[62]),D=i(D,L,N,O,w,21,h[63]),l[0]=l[0]+O|0,l[1]=l[1]+D|0,l[2]=l[2]+L|0,l[3]=l[3]+N|0},_doFinalize:function e(){var r=this._data,n=r.words,o=8*this._nDataBytes,i=8*r.sigBytes;n[i>>>5]|=128<<24-i%32;var s=t.floor(o/4294967296),a=o;n[15+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),r.sigBytes=4*(n.length+1),this._process();for(var u=this._hash,c=u.words,l=0;l<4;l++){var h=c[l];c[l]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8)}return u},clone:function e(){var e=c.clone.call(this);return e._hash=this._hash.clone(),e}});s.MD5=c._createHelper(f),s.HmacMD5=c._createHmacHelper(f)}(Math),e.MD5})},function(e,t,r){\"use strict\";function n(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}function o(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}function i(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(5),u=r(17),c=function(e){function t(e,r){n(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));return i.connection=e,i}return i(t,e),s(t,[{key:\"selectAsObject\",value:function e(t){return this.connection.select(this.ubql()).then(function(e){return a.selectResultToArrayOfObjects(e,t)})}},{key:\"selectAsArray\",value:function e(){return this.connection.select(this.ubql())}},{key:\"selectAsStore\",value:function e(t){return this.selectAsObject(t)}},{key:\"select\",value:function e(t){return this.selectAsObject(t)}},{key:\"selectSingle\",value:function e(t){return this.selectAsObject(t).then(function(e){return e[0]})}},{key:\"selectScalar\",value:function e(){return this.selectAsArray().then(function(e){return e.resultData.rowCount>0?e.resultData.data[0][0]:void 0})}},{key:\"selectById\",value:function e(t,r){return this.where(\"[ID]\",\"=\",t).selectSingle()}}]),t}(u);e.exports=c},function(e,t,r){\"use strict\";var n=r(3),o=r(2),i=r(6),s=r(12),a=r(18),u=r(10),c=r(7),l=r(5),h=r(8),f=r(9),p=r(19);e.exports={i18n:n.i18n,i18nExtend:n.i18nExtend,format:o.format,apply:o.apply,ns:o.ns,booleanParse:o.booleanParse,iso8601Parse:o.iso8601Parse,iso8601ParseAsDate:o.iso8601ParseAsDate,base64FromAny:o.base64FromAny,base64toArrayBuffer:o.base64toArrayBuffer,UBError:o.UBError,UBAbortError:o.UBAbortError,xhr:i.xhr,get:i.get,post:i.post,UBNativeMessage:p,UBConnection:s,UBCache:c,connect:s.connect,ClientRepository:u,LocalDataStore:l,log:o.log,logError:o.logError,logWarn:o.logWarn,logDebug:o.logDebug,userAgent:o.userAgent,isChrome:o.isChrome,isWebKit:o.isWebKit,isGecko:o.isGecko,isOpera:o.isOpera,isMac:o.isMac,isSecureBrowser:o.isSecureBrowser,inject:a.inject,addResourceVersion:a.addResourceVersion,SHA256:h,MD5:f}},function(e,t,r){\"use strict\";function n(e,t){if(t)throw new c.UBError(\"Access deny\");return Promise.resolve({authSchema:T,login:A})}function o(e){return JSON.parse('\"'+e.match(/<<<(.*)>>>/)[1]+'\"')}function i(e){function t(e,t,r){var n=new f(e,t,r),o=n.userData;return o.lang&&-1!==this.appConfig.supportedLanguages.indexOf(o.lang)||(o.lang=this.appConfig.defaultLang),n}var r=e.host||\"http://localhost:888\",i=e.appName||\"/\",s=e.requestAuthParams,h=void 0,p=void 0,d=void 0;u.call(this),a.assign(this,u.prototype),this.ubNotifier=null,this.appConfig={},this.preferredLocale=\"en\",this.domain=null,\"/\"!==i.charAt(0)&&(i=\"/\"+i),s||(s=n),p=r+i,this.serverUrl=p,h=\"undefined\"!=typeof window&&window.location.origin===r?i:p,\"/\"!==h.charAt(h.length-1)&&(h+=\"/\"),this.baseURL=h,this.appName=i,this.allowSessionPersistent=e.allowSessionPersistent&&\"undefined\"!=typeof localStorage,this.allowSessionPersistent&&(this.__sessionPersistKey=this.serverUrl+\":storedSession\"),this.cache=null,this._pendingCachedEntityRequests={},this.lastLoginName=\"\",this._bufferedRequests=[],this._bufferTimeoutID=0,this.isAuthorized=function(){return void 0!==d},this.userLogin=function(){return this.userData(\"login\")},this.userLang=function(){return this.userData(\"lang\")},this.userData=function(e){var t=this.isAuthorized()?d.userData:{lang:\"en\",login:A};return e?t[e]:t},this.authorize=function(e){var r=this;if(d)return Promise.resolve(d);if(this.allowSessionPersistent&&!e){var n=localStorage.getItem(this.__sessionPersistKey);if(n)try{var o=JSON.parse(n);return d=t.call(this,o.data,o.secretWord,o.authSchema),r.emit(\"authorized\",r,d),Promise.resolve(d)}catch(e){localStorage.removeItem(this.__sessionPersistKey)}}return this._pendingAuthPromise?this._pendingAuthPromise:(this.exchangeKeysPromise=null,this._pendingAuthPromise=s(this,e).then(function(e){return r.doAuth(e).then(function(t){return r._pendingAuthPromise=null,d=t,r.emit(\"authorized\",r,t,e),t}).catch(function(e){return r._pendingAuthPromise=null,e&&e instanceof c.UBAbortError||r.emit(\"authorizationFail\",e,r),r.authorize(!0)})}),this._pendingAuthPromise)},this.authorizationClear=function(){this.lastLoginName=this.userLogin(),d=void 0},this.authHandshakeUBIP=function(e){return e.login?this.post(x,\"\",{headers:{Authorization:e.authSchema+\" \"+e.login}}):Promise.reject({errMsg:\"invalid user name\"})},this.authHandshakeOpenIDConnect=function(e){return Promise.resolve(e).then(function(e){return e.authSchema=\"UB\",e})},this.authHandshakeUB=function(e){var t=this,r=void 0;return e.login&&e.password?this.post(x,\"\",{params:{AUTHTYPE:e.authSchema,userName:e.login}}).then(function(n){var o=void 0,s=void 0,a=void 0,u={params:{AUTHTYPE:e.authSchema,userName:e.login,password:\"\"}},c=\"\"+v((new Date).toISOString().substr(0,16));u.params.clientNonce=c,n.data.connectionID&&(u.params.connectionID=n.data.connectionID);var l=n.data.realm;if(l){if(!(o=n.data.nonce))throw Error(\"invalid LDAP auth response\");n.data.useSasl?(s=g(e.login.split(\"\\\\\")[1].toUpperCase()+\":\"+l+\":\"+e.password),s.concat(m.enc.Utf8.parse(\":\"+o+\":\"+c)),a=\"\"+g(s),r=a):(a=window.btoa(e.password),r=a)}else{if(!(o=n.data.result))throw Error(\"invalid auth response\");s=\"\"+v(\"salt\"+e.password);var h=\"/\"===i?\"/\":i.replace(/\\//g,\"\");a=\"\"+v(h.toLowerCase()+o+c+e.login+s),r=s}return u.params.password=a,t.post(x,\"\",u).then(function(e){return e.secretWord=r,e})}):Promise.reject({errMsg:\"invalid user name or password\"})},this.authHandshakeCERT=function(){throw Error('authHandshakeCERT should be injected by \"nm-dstu\" model')},this.doAuth=function(e){var r=this;if(e.authSchema=e.authSchema||\"UB\",this.isAuthorized())return Promise.reject({errMsg:\"invalid auth call\",errDetails:\"contact developers\"});var n=void 0;switch(e.authSchema){case T:n=Promise.resolve({data:{result:\"0+0\",uData:JSON.stringify({login:A})},secretWord:\"\"});break;case\"UB\":n=this.authHandshakeUB(e);break;case\"CERT\":n=this.authHandshakeCERT(e);break;case\"UBIP\":n=this.authHandshakeUBIP(e);break;case\"OpenIDConnect\":n=this.authHandshakeOpenIDConnect(e);break;case\"Negotiate\":n=this.post(x,\"\",{params:{USERNAME:\"\",AUTHTYPE:e.authSchema}}).then(function(e){return e.secretWord=e.data.logonname,e});break;default:n=Promise.reject({errMsg:\"invalid authentication schema \"+e.authSchema})}return n=n.then(function(n){var o=t.call(r,n.data,n.secretWord,e.authSchema);return r.allowSessionPersistent&&localStorage.setItem(r.__sessionPersistKey,JSON.stringify({data:n.data,secretWord:n.secretWord,authSchema:n.authSchema})),o},function(t){if(t instanceof Error)throw t;var n=t.data||t,i={errMsg:n.errMsg,errCode:n.errCode,errDetails:n.errMsg};403===t.status?i.errMsg=\"UB\"===e.authSchema?\"msgInvalidUBAuth\":\"msgInvalidCertAuth\":i.errMsg||(i.errMsg=\"unknownError\"),0===t.status&&(i.errDetails=\"network error\"),/<<<.*>>>/.test(i.errMsg)&&(i.errMsg=o(i.errMsg));var s=r.serverErrorByCode(i.errCode);throw s&&(i.errDetails=s+\" \"+i.errDetails,l(s)!==s&&(i.errMsg=s)),r.allowSessionPersistent&&localStorage.removeItem(r.__sessionPersistKey),new c.UBError(i.errMsg,i.errDetails,i.errCode)})},this.recordedXHRs=[],this.recorderEnabled=!1}function s(e){var t=this.config=a.clone(e),r=new i({host:t.host,appName:t.path||\"/\",requestAuthParams:t.onCredentialRequired,allowSessionPersistent:e.allowSessionPersistent});return t.onAuthorizationFail&&r.on(\"authorizationFail\",t.onAuthorizationFail),t.onNeedChangePassword&&r.on(\"passwordExpired\",t.onNeedChangePassword),t.onAuthorized&&r.on(\"authorized\",t.onAuthorized),r.getAppInfo().then(function(e){r.appConfig=a.defaults(a.clone(e),{applicationName:\"UnityBase\",applicationTitle:\"UnityBase\",loginWindowTopLogoURL:\"\",loginWindowBottomLogoURL:\"\",themeName:\"UBGrayTheme\",userDbVersion:null,defaultLang:\"en\",supportedLanguages:[\"en\"],uiSettings:{}}),r.ubNotifier=new b(r);var n=null;return _&&(n=_.getItem(r.appName+\"preferredLocale\")),n||(n=r.appConfig.defaultLang),-1===r.appConfig.supportedLanguages.indexOf(n)&&(n=r.appConfig.defaultLang),r.preferredLocale=n,!t.onGotApplicationConfig||t.onGotApplicationConfig(r)}).then(function(){return r.initCache(r.appConfig.userDbVersion)}).then(function(){return r.authorize()}).then(function(){var e=r.userData(\"lang\");_&&_.setItem(r.appName+\"preferredLocale\",e),r.preferredLocale=e;var n=r.getDomainInfo();return t.onGotApplicationDomain&&(n=n.then(function(e){return t.onGotApplicationDomain(e)})),n}).then(function(e){return r.domain=e,r})}var a=r(0),u=r(4),c=r(2),l=r(3).i18n,h=r(6),f=r(13),p=r(5),d=r(14),y=r(7),m=r(1),v=r(8),g=r(9),b=r(16),E=r(10),w=/(\\/|^)(auth|getAppInfo)(\\/|\\?|$)/,S=20,x=\"auth\",A=\"anonymous\",T=\"None\";i.prototype.initCache=function(e){return this.cache=new y(this.baseURL,e),this.cachedSessionEntityRequested={},this.cache.clear(y.SESSION)},i.prototype.cacheKeyCalculate=function(e,t){var r=[this.userLogin().toLowerCase(),this.userLang(),e];return Array.isArray(t)&&r.push(\"\"+g(JSON.stringify(t))),r.join(\"#\").replace(/[\\\\:.]/g,\"#\")},i.prototype.cacheOccurrenceRefresh=function(e,t){var r=this,n=Promise.resolve(!0);if(t===y.cacheTypes.Session||t===y.cacheTypes.SessionEntity){var o=this.domain.get(e);if(o&&o.hasMixin(\"unity\")){var i=o.mixin(\"unity\"),s=this.domain.get(i.entity);s&&i.entity!==e&&s.cacheType!==y.cacheTypes.None&&(n=n.then(function(){return r.cacheOccurrenceRefresh(i.entity,s.cacheType)}))}var a=r.cacheKeyCalculate(e),u=RegExp(\"^\"+a);Object.keys(r.cachedSessionEntityRequested).filter(function(e){return u.test(e)}).forEach(function(e){delete r.cachedSessionEntityRequested[e]}),t===y.cacheTypes.Session&&(n=n.then(function(){return r.cache.removeIfMach(u,y.SESSION)}))}return n},i.prototype.cacheOccurrenceRemove=function(e,t){var r=this,n=r.cacheKeyCalculate(e),o=RegExp(\"^\"+n);Object.keys(r.cachedSessionEntityRequested).filter(function(e){return o.test(e)}).forEach(function(e){delete r.cachedSessionEntityRequested[e]});var i=t===y.cacheTypes.Session?y.SESSION:y.PERMANENT;return r.cache.removeIfMach(o,i)},i.prototype.cacheClearAll=function(){var e=this;return Object.keys(e.cachedSessionEntityRequested).forEach(function(t){delete e.cachedSessionEntityRequested[t]}),Promise.all([e.cache.clear(y.SESSION),e.cache.clear(y.PERMANENT)])},i.prototype.get=function(e,t){return this.xhr(a.assign({},t,{method:\"GET\",url:e}))},i.prototype.post=function(e,t,r){return this.xhr(a.assign({},r,{method:\"POST\",url:e,data:t}))},i.prototype.checkChannelEncryption=function(e,t){return!0},i.prototype.xhr=function(e){var t=this,r=a.assign({headers:{}},e),n=r.url,i=void 0;return t.recorderEnabled&&t.recordedXHRs.push(e),(n.length<t.baseURL.length||n.substring(0,t.baseURL.length)!==t.baseURL)&&(r.url=t.baseURL+r.url),w.test(n)?i=h.xhr(r):(i=t.authorize().then(function(e){return t.checkChannelEncryption(e,r)}),i=i.then(function(){return t.authorize().then(function(e){var t=e.authHeader();return t&&(r.headers.Authorization=t),h.xhr(r)})}).catch(function(r){var n=\"\";if(401===r.status){if(t.allowSessionPersistent&&localStorage.removeItem(t.__sessionPersistKey),c.logDebug(\"unauth: %o\",r),t.isAuthorized()&&t.authorizationClear(),!r.config.url||!/\\/logout/.test(r.config.url))return h.xhr.allowRequestReiteration(),t.xhr(e);t.lastLoginName=\"\"}if(r.data&&r.data.hasOwnProperty(\"errCode\")){var i=r.data.errCode,s=n=r.data.errMsg;if(/<<<.*>>>/.test(n)&&(n=l(o(n))),72===i&&t.emit(\"passwordExpired\",t))throw new c.UBAbortError;throw new c.UBError(n,s,i)}throw r})),i},i.prototype.getAppInfo=function(){var e=this;return e.get(\"getAppInfo\").then(function(t){var r=t.data;return Object.defineProperty(e,\"trafficEncryption\",{enumerable:!0,writable:!1,value:r.trafficEncryption||!1}),Object.defineProperty(e,\"serverCertificate\",{enumerable:!0,writable:!1,value:r.serverCertificate||\"\"}),Object.defineProperty(e,\"encryptionKeyLifetime\",{enumerable:!0,writable:!1,value:r.encryptionKeyLifetime||0}),Object.defineProperty(e,\"authMethods\",{enumerable:!0,writable:!1,value:r.authMethods}),Object.defineProperty(e,\"simpleCertAuth\",{enumerable:!0,writable:!1,value:r.simpleCertAuth||!1}),Object.defineProperty(e,\"supportedWSProtocols\",{enumerable:!0,writable:!1,value:r.supportedWSProtocols||[]}),Object.defineProperty(e,\"serverVersion\",{enumerable:!0,writable:!1,value:r.serverVersion||\"\"}),c.apply(e.appConfig,r.uiSettings.adminUI),r})},i.prototype.getDomainInfo=function(){var e=this;return e.get(\"getDomainInfo\",{params:{v:4,userName:this.userLogin()}}).then(function(t){var r=t.data,n=new d(r);return e.domain=n,n})},i.prototype.processBuffer=function e(){var t=this._bufferedRequests;this._bufferTimeoutID=0,this._bufferedRequests=[],this.post(\"ubql\",a.map(t,\"request\")).then(function(e){t.forEach(function(t,r){t.deferred.resolve(e.data[r])})},function(e){t.forEach(function(t){t.deferred.reject(e)})})},i.prototype.query=function e(t,r){var n=this;return r?(this._bufferTimeoutID||(this._bufferTimeoutID=setTimeout(n.processBuffer.bind(n),20)),new Promise(function(e,r){n._bufferedRequests.push({request:t,deferred:{resolve:e,reject:r}})})):n.post(\"ubql\",[t]).then(function(e){return e.data[0]})},i.prototype.run=i.prototype.query,i.prototype.convertResponseDataToJsTypes=function(e){if(e.entity&&e.resultData&&!e.resultData.notModified&&e.resultData.fields&&e.resultData.data&&e.resultData.data.length){var t=this.domain.get(e.entity).getConvertRules(e.resultData.fields),r=t.length,n=e.resultData.data;if(r)for(var o=0,i=n.length;o<i;o++)for(var s=0;s<r;s++){var a=t[s].index;n[o][a]=t[s].convertFn(n[o][a])}}return e.resultLock&&e.resultLock.lockTime&&(e.resultLock.lockTime=c.iso8601Parse(e.resultLock.lockTime)),e},i.prototype.doFilterAndSort=function(e,t){return p.doFilterAndSort(e,t)},i.prototype.addNew=function(e){var t=this;return e.method=\"addnew\",t.query(e,!0).then(t.convertResponseDataToJsTypes.bind(t))},i.prototype.invalidateCache=function(e){var t=this,r=t.domain.get(e.entity).cacheType;return r===y.cacheTypes.none?e:t.cacheOccurrenceRefresh(e.entity,r).then(function(){return e})},i.prototype.update=function(e,t){var r=this;return e.method=e.method||\"update\",r.query(e,t).then(r.convertResponseDataToJsTypes.bind(r)).then(r.invalidateCache.bind(r))},i.prototype.insert=function(e,t){var r=this;return e.method=e.method||\"insert\",r.query(e,t).then(r.convertResponseDataToJsTypes.bind(r)).then(r.invalidateCache.bind(r))},i.prototype.doDelete=function(e,t){var r=this;return e.method=e.method||\"delete\",r.query(e,t).then(r.invalidateCache.bind(r))},i.prototype.select=function(e,t){var r=this,n=void 0;t=t||!0===e.__mip_disablecache;var o=t||e.ID||e.bypassCache?y.cacheTypes.None:r.domain.get(e.entity).cacheType;return e.method||(e.method=\"select\"),o!==y.cacheTypes.None?this._doSelectForCacheableEntity(e,o):n=this.query(e,!0).then(this.convertResponseDataToJsTypes.bind(this)).then(function(t){var r={};if(c.apply(r,t),t.__totalRecCount)r.total=t.__totalRecCount;else if(t.resultData&&t.resultData.data){var n=t.resultData.data.length;if(e.options){var o=e.options||{},i=o.start?o.start:0,s=o.limit||0;r.total=n<s?i+n:-1}else r.total=n}return r})},i.prototype._doSelectForCacheableEntity=function(e,t){var r=this,n=this.cacheKeyCalculate(e.entity,e.fieldList),o=t===y.cacheTypes.Session?y.SESSION:y.PERMANENT;return this.cache.get(n+\":v\",o).then(function(i){var s=void 0;if(!i||i&&t===y.cacheTypes.Entity||i&&t===y.cacheTypes.SessionEntity&&r.cachedSessionEntityRequested[n]!==i){var a={};Object.keys(e).forEach(function(t){-1===[\"whereList\",\"orderList\",\"options\"].indexOf(t)&&(a[t]=e[t])}),a.version=i||\"-1\";s=(r._pendingCachedEntityRequests[n]?r._pendingCachedEntityRequests[n]:r._pendingCachedEntityRequests[n]=r.query(a,!0)).then(function(e){return delete r._pendingCachedEntityRequests[n],e},function(e){throw delete r._pendingCachedEntityRequests[n],e}).then(r.convertResponseDataToJsTypes.bind(r)).then(function(e){return r._cacheVersionedResponse(e,o,n)})}else s=r.cache.get(n,o);return s}).then(function(t){return r.doFilterAndSort(t,e)})},i.prototype._cacheVersionedResponse=function(e,t,r){var n=this;return e.resultData.notModified?(this.cachedSessionEntityRequested[r]=e.version,this.cache.get(r,t)):this.cache.put([{key:r+\":v\",value:e.version},{key:r,value:e.resultData}],t).then(function(){return n.cachedSessionEntityRequested[r]=e.version,e.resultData})},i.selectResultToArrayOfObjects=p.selectResultToArrayOfObjects,i.prototype.runTrans=function e(t){return this.post(\"ubql\",t).then(function(e){return e.data})};var C=[\"entity\",\"attribute\",\"ID\",\"id\",\"isDirty\",\"forceMime\",\"fileName\",\"store\",\"revision\"];i.prototype.getDocument=function(e,t){var r=a.defaults({},t),n={url:\"getDocument\",method:r.bypassCache?\"POST\":\"GET\"};return t&&t.resultIsBinary&&(n.responseType=\"arraybuffer\"),r.bypassCache?(n.data=a.clone(e),Object.keys(n.data).forEach(function(e){-1===C.indexOf(e)&&(delete n.data[e],c.logDebug('invalid parameter \"'+e+'\" passed to getDocument request'))})):n.params=e,this.xhr(n).then(function(e){return e.data})},i.prototype.hexa8=f.prototype.hexa8,i.prototype.crc32=f.prototype.crc32,i.prototype.logout=function(){if(this.allowSessionPersistent&&localStorage.removeItem(this.__sessionPersistKey),!this.isAuthorized())return Promise.resolve(!0);var e=this.post(\"logout\",{});if(this._pki){var t=this;e=e.then(function(){return new Promise(function(e){setTimeout(function(){t._pki.closePK(),e(!0)},20)})})}return e},i.prototype.serverErrorCodes={1:\"ubErrNotImplementedErrnum\",2:\"ubErrRollbackedErrnum\",3:\"ubErrNotExecutedErrnum\",4:\"ubErrInvaliddataforrunmethod\",5:\"ubErrInvaliddataforrunmethodlist\",6:\"ubErrNoMethodParameter\",7:\"ubErrMethodNotExist\",8:\"ubErrElsAccessDeny\",9:\"ubErrElsInvalidUserOrPwd\",10:\"ubErrElsNeedAuth\",11:\"ubErrNoEntityParameter\",13:\"ubErrNoSuchRecord\",14:\"ubErrInvalidDocpropFldContent\",15:\"ubErrEntityNotExist\",16:\"ubErrAttributeNotExist\",17:\"ubErrNotexistEntitymethod\",18:\"ubErrInvalidSetdocData\",19:\"ubErrSoftlockExist\",20:\"ubErrNoErrorDescription\",21:\"ubErrUnknownStore\",22:\"ubErrObjdatasrcempty\",23:\"ubErrObjattrexprbodyempty\",24:\"ubErrNecessaryfieldNotExist\",25:\"ubErrRecordmodified\",26:\"ubErrNotexistnecessparam\",27:\"ubErrNotexistfieldlist\",28:\"ubErrUpdaterecnotfound\",29:\"ubErrNecessaryparamnotexist\",30:\"ubErrInvalidstoredirs\",31:\"ubErrNofileinstore\",32:\"ubErrAppnotsupportconnection\",33:\"ubErrAppnotsupportstore\",34:\"ubErrDeleterecnotfound\",35:\"ubErrNotfoundlinkentity\",36:\"ubErrEntitynotcontainmixinaslink\",37:\"ubErrEssnotinherfromessaslink\",38:\"ubErrInstancedatanameisreadonly\",39:\"ubErrManyrecordsforsoftlock\",40:\"ubErrNotfoundidentfieldsl\",41:\"ubErrInvalidlocktypevalue\",42:\"ubErrLockedbyanotheruser\",43:\"ubErrInvalidwherelistinparams\",44:\"ubErrRecnotlocked\",45:\"ubErrManyrecordsforchecksign\",46:\"ubErrNotfoundparamnotrootlevel\",47:\"ubErrCantcreatedirlogmsg\",48:\"ubErrCantcreatedirclientmsg\",49:\"ubErrConnectionNotExist\",50:\"ubErrDirectUnityModification\",51:\"ubErrCantdelrecthisvalueusedinassocrec\",52:\"ubErrAssocattrnotfound\",53:\"ubErrAttrassociationtoentityisempty\",54:\"ubErrNotfoundconforentityinapp\",55:\"ubErrNewversionrecnotfound\",56:\"ubErrElsAccessDenyEntity\",57:\"ubErrAlsAccessDenyEntityattr\",58:\"ubErrDatastoreEmptyentity\",67:\"ubErrTheServerHasExceededMaximumNumberOfConnections\",69:\"ubErrFtsForAppDisabled\",72:\"ubErrElsPwdIsExpired\",73:\"ELS_USER_NOT_FOUND\",74:\"VALUE_MUST_ME_UNIQUE\"},i.prototype.serverErrorByCode=function(e){return this.serverErrorCodes[e]},i.prototype.Repository=function(e){return new E(this,e)},i.prototype.SHA256=v;var _=\"undefined\"!=typeof window&&window.localStorage;e.exports={UBConnection:i,connect:s}},function(e,t,r){\"use strict\";function n(e,t,r){var n=e,i=o(n.result.split(\"+\")[0]),a=n.uData?JSON.parse(n.uData):{lang:\"en\",login:\"anonymous\"},u=n.result,c=t||\"\",l=\"undefined\"!=typeof ncrc32?ncrc32(0,u+c):null;a.login||(a.login=n.logonname),Object.defineProperty(this,\"sessionID\",{enumerable:!0,writable:!1,value:i}),this.logonname=n.logonname,this.userData=a,this.authSchema=r||\"UB\",this.signature=function(){switch(this.authSchema){case\"None\":return\"\";case\"UBIP\":return this.logonname;default:var e=Math.floor((new Date).getTime()/1e3),t=o(e);return i+t+o(\"undefined\"!=typeof ncrc32?ncrc32(l,t):s(u+c+t))}},this.isAnonymous=function(){return\"None\"===this.authSchema},this.authHeader=function(){return this.isAnonymous()?\"\":(\"Negotiate\"===this.authSchema?\"UB\":this.authSchema)+\" \"+this.signature()}}n.prototype.hexa8=function e(t){for(var r=parseInt(t,10),n=isNaN(r)?\"00000000\":r.toString(16);n.length<8;)n=\"0\"+n;return n};var o=n.prototype.hexa8,i={};n.prototype.crc32=function e(t,r,n,o){t+=\"\",r=r||79764919,n=n||4294967295,o=o||4294967295;var s=n,a=i[r];a||(a=i[r]=function e(){var t=void 0,n=void 0,o=void 0,i=[],s=function e(t,r){for(var n=0;r;)n=2*n+t%2,t/=2,t-=t%1,r--;return n};for(t=255;t>=0;t--){for(o=s(t,32),n=0;n<8;n++)o=(2*o^(o>>>31)%2*r)>>>0;i[t]=s(o,32)}return i}());for(var u=0,c=t.length;u<c;u++){var l=t.charCodeAt(u);if(l>255)throw new RangeError;s=(s/256^a[s%256^l])>>>0}return(s^o)>>>0};var s=n.prototype.crc32;e.exports=n},function(e,t,r){\"use strict\";(function(t){function n(e){var t=this,r=Object.keys(e.domain),n=void 0===e.entityMethods;this.entities={},this.connections=e.connections;for(var i=0,s=r.length;i<s;i++){var u=r[i],c=e.domain[u];if(c.i18n&&c.i18n.attributes&&Array.isArray(c.i18n.attributes)){for(var l=c.i18n.attributes,h={},f=0,p=l.length;f<p;f++){var d=l[f],y=d.name;if(!y)throw Error(\"Invalid localization JSON for entity \"+u);delete d.name,h[y]=d}c.i18n.attributes=h}t.entities[u]=n?new a(c,c.entityMethods||{},c.i18n,u,t):new a(c,e.entityMethods[u]||{},e.i18n[u],u,t)}this.models={},Object.keys(e.models).forEach(function(r){var n=e.models[r];t.models[r]=new o(n,r)}),this.forceMIMEConvertors=e.forceMIMEConvertors}function o(e,t){this.name=t,this.path=e.path,e.needInit&&(this.needInit=e.needInit),e.needLocalize&&(this.needLocalize=e.needLocalize),this.order=e.order,this.moduleName=e.moduleName,this.clientRequirePath=e.moduleSuffix&&e.moduleName?this.moduleName+\"/\"+e.moduleSuffix:this.moduleName||this.path,e.realPublicPath&&(this.realPublicPath=e.realPublicPath)}function i(){}function s(e){this.selectName=e.selectName||\"\",this.execName=e.execName||this.selectName,this.pkGenerator=e.pkGenerator}function a(e,t,r,o,a){var u=this,c=this,l=void 0,h=void 0,E=void 0,w=void 0;if(r&&b.merge(e,r),Object.defineProperty(this,\"domain\",{enumerable:!1,value:a}),this.code=o,this.modelName=e.modelName,this.name=e.name,e.caption&&(this.caption=e.caption),e.description&&(this.description=e.description),e.documentation&&(this.documentation=e.documentation),e.descriptionAttribute&&(this.descriptionAttribute=e.descriptionAttribute),e.cacheType&&(this.cacheType=e.cacheType),e.dsType&&(this.dsType=e.dsType),this.sqlAlias=e.sqlAlias,this.connectionName=e.connectionName,this.isFTSDataTable=!0===e.isFTSDataTable,this.connectionConfig=this.connectionName&&this.domain.connections?b.find(this.domain.connections,{name:this.connectionName}):void 0,this.mapping=void 0,e.mapping){var S=Object.keys(e.mapping);if(S.forEach(function(e){if(!n.dialectsPriority[e])throw Error(\"Invalid dialect \"+e+\" in \"+u.code+\" mapping\")}),S.length){var x=this;w=n.dialectsPriority[this.connectionConfig.dialect],b.forEach(w,function(t){if(e.mapping[t])return x.mapping=new s(e.mapping[t]),!1})}}this.dbKeys=e.dbKeys&&Object.keys(e.dbKeys).length?e.dbKeys:void 0,this.dbExtensions=e.dbExtensions&&Object.keys(e.dbExtensions).length?e.dbExtensions:void 0,this.attributes=new i,b.forEach(e.attributes,function(e,t){var r=new f(e,t,c);\"mi_dateTo\"===r.code&&\"undefined\"!=typeof window&&(r.allowNull=!0),c.attributes[t]=r}),l=Object.keys(e.mixins||{}),this.mixins={},l.forEach(function(t){switch(h=e.mixins[t],E=r&&r.mixins?r.mixins[t]:null,t){case\"mStorage\":c.mixins[t]=new d(h,E,t);break;case\"dataHistory\":c.mixins[t]=new y(h,E,t);break;case\"aclRls\":c.mixins[t]=new m(h,E,t);break;case\"fts\":c.mixins[t]=new v(h,E,t);break;case\"als\":c.mixins[t]=new g(h,E,t);break;default:c.mixins[t]=new p(h,E,t)}}),this.entityMethods=t||{}}function u(e){return e?new Date(e):null}function c(e){var t=e?new Date(e):null;return t&&t.setTime(t.getTime()+60*t.getTimezoneOffset()*1e3),t}function l(e){return\"boolean\"==typeof e?e:void 0===e||null===e||\"\"===e?null:1===e||\"1\"===e}function h(e){this.expressionType=e.expressionType,this.expression=e.expression}function f(e,t,r){if(this.code=t,this.name=e.name,Object.defineProperty(this,\"entity\",{enumerable:!1,value:r}),this.dataType=e.dataType||\"String\",this.associatedEntity=e.associatedEntity,this.associationAttr=e.associationAttr,this.caption=e.caption||\"\",this.description=e.description||\"\",this.documentation=e.documentation||\"\",this.size=e.size||0,this.allowNull=!1!==e.allowNull,this.allowSort=!1!==e.allowSort,this.isUnique=!0===e.isUnique,this.defaultValue=e.defaultValue,this.readOnly=!0===e.readOnly,this.isMultiLang=!0===e.isMultiLang,this.cascadeDelete=!0===e.cascadeDelete,this.enumGroup=e.enumGroup,this.customSettings=e.customSettings||{},this.associationManyData=e.associationManyData,this.storeName=e.storeName,this.generateFK=!1!==e.generateFK,this.defaultView=!1!==e.defaultView,this.mapping=void 0,e.mapping){var o=this,i=Object.keys(e.mapping);if(i.forEach(function(e){if(!n.dialectsPriority[e])throw Error(\"Invalid dialect \"+e+\" in \"+r.code+\".\"+o.code+\" mapping\")}),i.length){var s=n.dialectsPriority[this.entity.connectionConfig.dialect];b.forEach(s,function(t){if(e.mapping[t])return o.mapping=new h(e.mapping[t]),!1})}}this.physicalDataType=n.getPhysicalDataType(this.dataType||\"String\")}function p(e,t,r){this.code=r,b.assign(this,e),t&&b.assign(this,t)}function d(e,t,r){p.apply(this,arguments)}function y(e,t,r){p.apply(this,arguments)}function m(e,t,r){p.apply(this,arguments)}function v(e,t,r){p.apply(this,arguments)}function g(e,t,r){p.apply(this,arguments)}var b=r(0);n.prototype.isEntityMethodsAccessible=function(e,t){var r=this.entities[e];return!!r&&(Array.isArray(t)?r.haveAccessToMethods(t):r.haveAccessToMethod(t))},n.prototype.get=function(e,t){var r=this.entities[e];if(!1!==t&&!r)throw Error('Entity with code \"'+e+'\" does not exists or not accessible');return r},n.prototype.has=function(e){return!!this.entities[e]},n.prototype.eachEntity=function(e){return b.forEach(this.entities,e)},n.prototype.filterEntities=function(e){return b.isFunction(e)?b.filter(this.entities,e):b.filter(this.entities,function(t){var r=!0;for(var n in e)e.hasOwnProperty(n)&&(r=r&&t[n]===e[n]);return r})},n.ubDataTypes={String:\"String\",Int:\"Int\",BigInt:\"BigInt\",Float:\"Float\",Currency:\"Currency\",Boolean:\"Boolean\",DateTime:\"DateTime\",Text:\"Text\",ID:\"ID\",Entity:\"Entity\",Document:\"Document\",Many:\"Many\",TimeLog:\"TimeLog\",Enum:\"Enum\",BLOB:\"BLOB\",Date:\"Date\"},n.prototype.ubDataTypes=n.ubDataTypes,n.ExpressionType={Field:\"Field\",Expression:\"Expression\"},n.ubMixins={dataHistory:\"dataHistory\",mStorage:\"mStorage\",unity:\"unity\",treePath:\"treePath\"},n.ubServiceFields={dateFrom:\"mi_datefrom\",dateTo:\"mi_dateto\"},n.EntityDataSourceType={Normal:\"Normal\",External:\"External\",System:\"System\",Virtual:\"Virtual\"},n.EntityCacheTypes={None:\"None\",Entity:\"Entity\",Session:\"Session\",SessionEntity:\"SessionEntity\"},n.dialectsPriority={MSSQL2012:[\"MSSQL2012\",\"MSSQL\",\"AnsiSQL\"],MSSQL2008:[\"MSSQL2008\",\"MSSQL\",\"AnsiSQL\"],MSSQL:[\"MSSQL\",\"AnsiSQL\"],Oracle11:[\"Oracle11\",\"Oracle\",\"AnsiSQL\"],Oracle10:[\"Oracle10\",\"Oracle\",\"AnsiSQL\"],Oracle9:[\"Oracle9\",\"Oracle\",\"AnsiSQL\"],Oracle:[\"Oracle\",\"AnsiSQL\"],PostgreSQL:[\"PostgreSQL\",\"AnsiSQL\"],AnsiSQL:[\"AnsiSQL\"],Firebird:[\"Firebird\",\"AnsiSQL\"],SQLite3:[\"SQLite3\",\"AnsiSQL\"]},n.getPhysicalDataType=function(e){var t=n.ubDataTypes,r={};return this.physicalTypeMap||(r[t.Int]=\"int\",r[t.Entity]=\"int\",r[t.ID]=\"int\",r[t.BigInt]=\"int\",r[t.String]=\"string\",r[t.Text]=\"string\",r[t.Enum]=\"string\",r[t.Float]=\"float\",r[t.Currency]=\"float\",r[t.Boolean]=\"boolean\",r[t.Date]=\"date\",r[t.DateTime]=\"date\",this.physicalTypeMap=r),this.physicalTypeMap[e]||\"auto\"},o.prototype.needInit=!1,o.prototype.needLocalize=!1,o.prototype.realPublicPath=\"\",i.prototype.asJSON=function(){var e={};return b.forEach(this,function(t,r){t.asJSON?e[r]=t.asJSON():e[r]=t}),e},a.prototype.caption=\"\",a.prototype.description=\"\",a.prototype.documentation=\"\",a.prototype.descriptionAttribute=\"\",a.prototype.cacheType=\"None\",a.prototype.dsType=\"Normal\",a.prototype.getEntityCaption=function(){return this.caption||this.description},a.prototype.attr=function(e,t){var r=this.attributes[e];return r||t||(r=this.getEntityAttribute(e)),r},a.prototype.getAttribute=function(e){var t=this.attributes[e];if(!t)throw Error(\"Attribute \"+this.code+\".\"+e+\" doesn't exist\");return t},a.prototype.eachAttribute=function(e){return b.forEach(this.attributes,e)},a.prototype.mixin=function(e){return this.mixins[e]},a.prototype.hasMixin=function(e){var t=this.mixins[e];return\"audit\"===e?!t||!!t&&t.enabled:!!t&&t.enabled},a.prototype.checkMixin=function(e){if(!this.hasMixin(e))throw Error(\"Entity \"+this.code+\" does not have mixin \"+e)},a.prototype.asJSON=function(){var e={code:this.code};return b.forEach(this,function(t,r){\"domain\"!==r&&(t.asJSON?e[r]=t.asJSON():e[r]=t)}),e},a.prototype.haveAccessToMethod=function(e){return UB.isServer&&t.isServer?App.els(this.code,e):1===this.entityMethods[e]},a.prototype.filterAttribute=function(e){return b.isFunction(e)?b.filter(this.attributes,e):b.filter(this.attributes,function(t){var r=!0;for(var n in e)e.hasOwnProperty(n)&&(r=r&&t[n]===e[n]);return r})},a.prototype.haveAccessToAnyMethods=function(e){var r=this,n=e||[],o=!1;return n.forEach(function(e){o=UB.isServer&&t.isServer?o||App.els(r.code,e):o||1===r.entityMethods[e]}),o},a.prototype.haveAccessToMethods=function(e){var r=this,n=!0;return(e||[]).forEach(function(e){n=UB.isServer&&t.isServer?n&&App.els(r.code,e):n&&1===r.entityMethods[e]}),n},a.prototype.getConvertRules=function(e){var t=this,r=[],o=n.ubDataTypes;return e.forEach(function(e,n){var i=t.attr(e);i&&(i.dataType===o.DateTime?r.push({index:n,convertFn:u}):i.dataType===o.Date?r.push({index:n,convertFn:c}):i.dataType===o.Boolean&&r.push({index:n,convertFn:l}))}),r},a.prototype.getDescriptionAttribute=function(){var e=this.descriptionAttribute||\"caption\";if(!this.attr(e))throw Error(\"Missing description attribute for entity \"+this.code);return e},a.prototype.getEntityAttributeInfo=function(e,t){var r=this,n=e.split(\".\"),o=-(n.length-1),i=[],s=this.code,a=void 0,u=void 0;if(t&&t>0)return{entity:s,attribute:r.attr(n[0]),attributeCode:n[0]};for(;r&&n.length;){if(r&&1===n.length)return i=n[0].split(\"@\"),i.length>1&&(r=this.domain.get(i[1]),e=i[0]),{entity:s,attribute:r.attr(e),attributeCode:e};if(u=n.shift(),i=u.split(\"@\"),i.length>1&&(s=i[1],r=this.domain.get(s),u=i[0]),!(a=r.attr(u)))return;if(o===(t||0))return{entity:s,attribute:a,attributeCode:u};if(e=n[0],\"Enum\"===a.dataType&&\"name\"===e)return{entity:s,attribute:a,attributeCode:u};s=a.associatedEntity,r=a.getAssociatedEntity(),o+=1}},a.prototype.getEntityAttribute=function(e,t){var r=this,n=e.split(\".\"),o=-(n.length-1),i=[],s=void 0,a=void 0;if(t&&t>0)return r.attributes[n[0]];for(;r&&n.length;){if(r&&1===n.length)return i=n[0].split(\"@\"),i.length>1&&(r=this.domain.get(i[1]),e=i[0]),r.attributes[e];if(a=n.shift(),i=a.split(\"@\"),i.length>1&&(r=this.domain.get(i[1]),a=i[0]),!(s=r.attributes[a]))return;if(o===(t||0))return s;if(e=n[0],\"Enum\"===s.dataType){if(\"name\"===e)return s;r=this.domain.get(\"ubm_enum\")}else r=this.domain.get(s.associatedEntity);o+=1}},a.prototype.getAttributeNames=function(e){var t=[];return e?(b.forEach(this.filterAttribute(e),function(e){t.push(e.code)}),t):Object.keys(this.attributes)},a.prototype.getEntityRequirements=function(e){var t=[];e=e||this.getAttributeNames();for(var r=0,n=e.length;r<n;++r){var o=e[r].split(\".\"),i=this.getEntityAttribute(o[0]);if(\"Entity\"===i.dataType)if(o.length>1){var s=[o.slice(1).join(\".\")];t=b.union(t,i.getAssociatedEntity().getEntityRequirements(s))}else t=b.union(t,[i.associatedEntity])}return t},a.prototype.checkAttributeExist=function(e,t){var r=this;e=b.isArray(e)?e:[e],b.forEach(e,function(e){if(!r.getEntityAttributeInfo(e))throw Error(t+(t?\" \":\"\")+'The entity \"'+r.code+'\" does not have attribute \"'+e+'\"')})},a.prototype.getEntityDescription=function(){return this.description||this.caption},f.prototype.getAssociatedEntity=function(){return this.associatedEntity?this.entity.domain.get(this.associatedEntity):null},f.prototype.asJSON=function(){var e={};return b.forEach(this,function(t,r){\"entity\"!==r&&(t.asJSON?e[r]=t.asJSON():e[r]=t)}),e},p.prototype.enabled=!0,d.prototype=Object.create(p.prototype),d.prototype.constructor=d,d.prototype.simpleAudit=!1,d.prototype.safeDelete=!1,y.prototype=Object.create(p.prototype),y.prototype.constructor=y,y.prototype.historyType=\"common\",m.prototype=Object.create(p.prototype),m.prototype.constructor=m,m.prototype.aclRlsUseUnityName=!1,m.prototype.aclRlsSelectionRule=\"exists\",v.prototype=Object.create(p.prototype),v.prototype.constructor=v,v.prototype.scope=\"connection\",v.prototype.dataProvider=\"mixin\",g.prototype=Object.create(p.prototype),g.prototype.constructor=g,g.prototype.alsOptimistic=!0,n.UBEntity=a,n.UBModel=o,n.UBEntity.UBEntityAttribute=f,e.exports=n}).call(t,r(15))},function(e,t){function r(){throw Error(\"setTimeout has not been defined\")}function n(){throw Error(\"clearTimeout has not been defined\")}function o(e){if(h===setTimeout)return setTimeout(e,0);if((h===r||!h)&&setTimeout)return h=setTimeout,setTimeout(e,0);try{return h(e,0)}catch(t){try{return h.call(null,e,0)}catch(t){return h.call(this,e,0)}}}function i(e){if(f===clearTimeout)return clearTimeout(e);if((f===n||!f)&&clearTimeout)return f=clearTimeout,clearTimeout(e);try{return f(e)}catch(t){try{return f.call(null,e)}catch(t){return f.call(this,e)}}}function s(){d&&y&&(d=!1,y.length?p=y.concat(p):m=-1,p.length&&a())}function a(){if(!d){var e=o(s);d=!0;for(var t=p.length;t;){for(y=p,p=[];++m<t;)y&&y[m].run();m=-1,t=p.length}y=null,d=!1,i(e)}}function u(e,t){this.fun=e,this.array=t}function c(){}var l=e.exports={},h,f;!function(){try{h=\"function\"==typeof setTimeout?setTimeout:r}catch(e){h=r}try{f=\"function\"==typeof clearTimeout?clearTimeout:n}catch(e){f=n}}();var p=[],d=!1,y,m=-1;l.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];p.push(new u(e,t)),1!==p.length||d||o(a)},u.prototype.run=function(){this.fun.apply(null,this.array)},l.title=\"browser\",l.browser=!0,l.env={},l.argv=[],l.version=\"\",l.versions={},l.on=c,l.addListener=c,l.once=c,l.off=c,l.removeListener=c,l.removeAllListeners=c,l.emit=c,l.prependListener=c,l.prependOnceListener=c,l.listeners=function(e){return[]},l.binding=function(e){throw Error(\"process.binding is not supported\")},l.cwd=function(){return\"/\"},l.chdir=function(e){throw Error(\"process.chdir is not supported\")},l.umask=function(){return 0}},function(e,t,r){\"use strict\";function n(e){function t(e){u&&(f=new WebSocket(h+\"?SESSION_SIGNATURE=\"+e.signature(),\"ubNotifier\"),f.onopen=function(e){c(\"connected to\",e.target.url,\"protocol:\",e.target.protocol),n.emit(\"connected\",e.target.url,e.target.protocol)},f.onmessage=function(e){var t;c(\"Got a raw data\",e.data);try{t=JSON.parse(e.data)}catch(t){console.error(\"ubNotifier: Invalid command from server:\",e.data)}var r=t.command,o=t.params,i;switch(c(\"Got a command\",r,\"with params\",o),r){case\"accepted\":for(p=!0;(i=d.shift())&&p;)n.sendCommand(i.command,i.params);d=[],n.emit(\"accepted\",o.connectionID);break;case\"error\":c(\"Got an error from server\",o),n.emit(\"error\",o);break;default:c(\"Emit event \",r,\"with params\",o),n.emit(r,o)}},f.onclose=function(e){p=!1,c(\"Connection closed. Code:\",e.code,\"Reason:\",e.reason),n.emit(\"disconnected\",e.code,e.reason)})}function r(r,n){p=!1,-1!==e.supportedWSProtocols.indexOf(s)?t(n):console.warn(\"ubNotifier: protocol not supported\")}var n=this,u=-1!==e.supportedWSProtocols.indexOf(s)&&\"undefined\"!=typeof WebSocket;this.supported=u,i.call(this),o.assign(this,i.prototype);var c=function e(){},l=!1;Object.defineProperty(n,\"debugMode\",{get:function e(){return l},set:function e(t){l!==t&&(l=t,c=l?console.debug.bind(console,\"ubNotifier\"):function(){})},enumerable:!0,configurable:!0});var h=\"ws\"+e.serverUrl.slice(4)+\"ws\",f=null,p=!1,d=[];this.sendCommand=function(e,t){u&&(p?f.send(JSON.stringify({command:e,params:t})):(d.push({command:e,params:t}),d.length>a&&d.shift()))},e.on(\"authorized\",r)}var o=r(0),i=r(4),s=\"ubNotifier\",a=100;e.exports=n},function(e,t,r){\"use strict\";function n(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}for(var o=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},i=(function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}()),s=r(0),a=/\\[.*]/,u={equal:\"isNull\",notEqual:\"notIsNull\",custom:\"custom\"},c=[],l=0;l<100;l++)c.push(\"c\"+l);var h=function(){function e(t){n(this,e),this.fieldList=[],this.groupList=[],this.whereList={},this._whereLength=0,this.logicalPredicates=[],this.joinAs=[],this.orderList=[],this.options={},this.method=\"select\",this.__description=\"\",this.__misc={},this.entityName=t}return i(e,[{key:\"using\",value:function e(t){return this.method=t,this}},{key:\"attrs\",value:function e(t){for(var r=arguments.length,n=0;n<r;n++){var o=arguments[n];Array.isArray(o)?this.fieldList=this.fieldList.concat(o):this.fieldList.push(o)}return this}},{key:\"where\",value:function t(r,n,i,l){var h=void 0;if(!l)for(l=c[++this._whereLength];this.whereList[l];)l+=\"_\";var f=n,p=e.prototype.WhereCondition;if(n=p[n],r&&\"custom\"!==n&&!a.test(r)&&(r=\"[\"+r+\"]\"),!n)throw Error(\"Unknown conditions\");if((\"in\"===n||\"notIn\"===n)&&i instanceof e)h=n,n=\"subquery\",i=i.ubql();else if(\"subquery\"===n)h=f,i instanceof e&&(i=i.ubql());else if(\"in\"!==n&&\"notIn\"!==n||null!==i&&void 0!==i)if(\"in\"!==n||Array.isArray(i))if(\"in\"!==n||i&&i.length)if(\"notIn\"!==n||i&&i.length){if(null===i&&(\"isNull\"!==n||\"notIsNull\"!==n)){var d=n;if(i=void 0,!(n=u[d]))throw Error(\"Condition \"+d+\"is passed to CustomRepository.where but value is null\");console.warn(\"Condition \"+d+\"is passed to CustomRepository.where but value is null -> condition transformed to \"+n+\". Check your logic\")}}else console.warn('Condition \"notIn\" is passed to CustomRepository.where but value is empty array -> condition transformed to \"1=1\". Check your logic'),r=\"1\",n=p.equal,i={a:1};else console.warn('Condition \"in\" is passed to CustomRepository.where but value is empty array -> condition transformed to \"0=1\". Check your logic'),r=\"0\",n=p.equal,i={a:1};else console.debug('Condition \"in\" is passed to CustomRepository.where but values is not an array -> condition transformed to equal. Check your logic'),n=p.equal;else console.warn('Condition \"in\" is passed to CustomRepository.where but values is null or undefined -> condition transformed to (0=1). Check your logic'),r=\"0\",n=p.equal,i={a:1};if(\"in\"===n&&1===i.length&&(n=p.equal,i=i[0]),void 0!==i&&(\"object\"!==(void 0===i?\"undefined\":o(i))||Array.isArray(i)||s.isDate(i))){var y={};y[l]=i,i=y}var m={expression:r,condition:n};return\"subquery\"===n&&(m.subQueryType=h),void 0!==i&&(m.values=i),this.whereList[l]=m,this}},{key:\"exists\",value:function e(t,r){return this.where(\"\",\"exists\",t,r)}},{key:\"notExists\",value:function e(t,r){return this.where(\"\",\"notExists\",t,r)}},{key:\"correlation\",value:function e(t,r,n,o){return a.test(t)||(t=\"[\"+t+\"]\"),n||(n=\"=\"),this.where(t+n+\"[{master}.\"+r+\"]\",\"custom\",void 0,o)}},{key:\"logic\",value:function e(t){return this.logicalPredicates.push(t),this}},{key:\"join\",value:function e(t){return this.joinAs.push(t),this}},{key:\"joinCondition\",value:function e(t,r,n,o){if(!o)for(o=c[++this._whereLength];this.whereList[o];)o+=\"_\";return this.where(t,r,n,o),this.joinAs.push(o),this}},{key:\"orderBy\",value:function e(t,r){return r=r||\"asc\",this.orderList.push({expression:t,order:r}),this}},{key:\"orderByDesc\",value:function e(t){return this.orderList.push({expression:t,order:\"desc\"}),this}},{key:\"groupBy\",value:function e(t){return Array.isArray(t)?this.groupList=this.groupList.concat(t):s.isString(t)&&this.groupList.push(t),this}},{key:\"start\",value:function e(t){return this.options.start=t,this}},{key:\"limit\",value:function e(t){return this.options.limit=t,this}},{key:\"describe\",value:function e(t){return this.__description=t,this}},{key:\"ubql\",value:function e(){var t=this.orderList.length,r={entity:this.entityName,method:this.method,fieldList:this.fieldList};if(this.groupList.length>0&&(r.groupList=this.groupList),Object.keys(this.whereList).length&&(r.whereList=this.whereList),t>0){r.orderList={};for(var n=0;n<t;n++)r.orderList[n]=this.orderList[n]}return Object.keys(this.options).length&&(r.options=this.options),this.logicalPredicates.length&&(r.logicalPredicates=this.logicalPredicates),this.joinAs.length&&(r.joinAs=this.joinAs),s.defaults(r,this.__misc),r}},{key:\"selectAsObject\",value:function e(){throw Error(\"abstract\")}},{key:\"selectAsArray\",value:function e(){throw Error(\"abstract\")}},{key:\"selectAsStore\",value:function e(t){throw Error(\"abstract\")}},{key:\"select\",value:function e(t){throw Error(\"abstract\")}},{key:\"selectSingle\",value:function e(){throw Error(\"abstract\")}},{key:\"selectScalar\",value:function e(){throw Error(\"abstract\")}},{key:\"selectById\",value:function e(t){throw Error(\"abstract\")}},{key:\"misc\",value:function e(t){return s.assign(this.__misc,t),this}},{key:\"withTotal\",value:function e(){return this.options.totalRequired=!0,this}}]),e}();h.prototype.getRunListItem=h.prototype.ubql,h.prototype.ubRequest=h.prototype.ubql,h.prototype.WhereCondition={gt:\"more\",\">\":\"more\",more:\"more\",lt:\"less\",\"<\":\"less\",less:\"less\",eq:\"equal\",\"=\":\"equal\",equal:\"equal\",ge:\"moreEqual\",geq:\"moreEqual\",\">=\":\"moreEqual\",moreEqual:\"moreEqual\",le:\"lessEqual\",leq:\"lessEqual\",\"<=\":\"lessEqual\",lessEqual:\"lessEqual\",ne:\"notEqual\",neq:\"notEqual\",\"<>\":\"notEqual\",\"!=\":\"notEqual\",\"!==\":\"notEqual\",notEqual:\"notEqual\",contains:\"like\",like:\"like\",notContains:\"notLike\",notLike:\"notLike\",isNull:\"isNull\",null:\"isNull\",notNull:\"notIsNull\",notIsNull:\"notIsNull\",isNotNull:\"notIsNull\",beginWith:\"startWith\",startWith:\"startWith\",startsWith:\"startWith\",startswith:\"startWith\",notBeginWith:\"notStartWith\",notStartWith:\"notStartWith\",notStartsWith:\"notStartWith\",includes:\"in\",in:\"in\",notIncludes:\"notIn\",notIn:\"notIn\",match:\"match\",subquery:\"subquery\",exists:\"subquery\",notExists:\"subquery\",custom:\"custom\"},e.exports=h},function(e,t,r){\"use strict\";function n(e,t){var r=void 0;return r=s[e]?s[e]:s[e]=new Promise(function(r,n){var o=null,u=/\\.css(?:\\?|$)/.test(e);u?(o=document.createElement(\"link\"),o.rel=\"stylesheet\",o.async=!0):(o=document.createElement(\"script\"),o.type=\"text/javascript\",t&&(o.charset=t),o.async=!0),o.onerror=function(t){var r=\"Required \"+(t.target.href||t.target.src)+\" is not accessible\";delete s[e],o.onerror=o.onload=o.onreadystatechange=null,n(Error(r))},o.onload=function(){o.onerror=o.onload=o.onreadystatechange=null,setTimeout(function(){var e=o;r(),e.parentNode&&!e.rel&&(e.parentNode.removeChild(o),o=null)},0)},a.appendChild(o),u?o.href=i(e):o.src=i(e)})}function o(e){var t=c.test(e)?c.exec(e)[1]:\"_web\";return u&&u[t]?\"?ubver=\"+u[t]:\"\"}function i(e){var t=o(e);return t?e+t:e}var s={},a=\"undefined\"!=typeof document&&document.getElementsByTagName(\"head\")[0],u=\"undefined\"!=typeof window&&window.__ubVersion,c=RegExp(\"models/(.+?)/\");e.exports={inject:n,addResourceVersion:i}},function(e,t,r){\"use strict\";function n(e){var t=this,r=0;if(t.getMessageId=function(){return\"m\"+ ++r},t._cfg=Object.assign({},e),++n.prototype.idCounter,t.id=\"UBPlugin\"+n.prototype.idCounter,t.pendingMessages={},!t._cfg.host)throw Error(\"Host not defined in UBNativeMessage feature config\");if(u.call(t),c.assign(t,u.prototype),t.featureVersion=\"\",t.callTimeOut=3e4,s.isSecureBrowser)t.eventElm={},u.call(t.eventElm),c.assign(t.eventElm,u.prototype),t.eventElm.addEventListener=t.eventElm.addListener;else if(t.eventElm=document.getElementById(\"ubExtensionPageMessageObj\"),!(t.eventElm||window.parent&&window.parent!==window))throw Error('Message exchange element with id=\"ubExtensionPageMessageObj\" not found');t.onContentMessage=function(e){var r=e.detail;if(r&&r.hasOwnProperty(\"msgType\")&&r.hasOwnProperty(\"messageID\")&&r.hasOwnProperty(\"clientID\")||console.error(\"Empty or invalid content message\"),r.clientID===t.id){var n=r.messageID,o=r.msgType,i=r.data,a=t.pendingMessages[n];if(a&&clearTimeout(a.timerID),\"disconnected\"===o)a&&(delete t.pendingMessages[n],a.deffer.resolve(i)),t.doOnDisconnect(i);else if(\"notify\"===o)!a&&t.onMessage?t.onMessage(i):(a.timerID=setTimeout(function(){t.onMsgTimeOut(n)},a.timeoutValue),t.emit(\"notify\",t,i,n));else if(a)if(\"resolve\"===o)if(r.hasOwnProperty(\"part\")&&r.hasOwnProperty(\"totalParts\")){var u=r.totalParts,l=r.part;if(a.partials){if(u!==a.partials.length||l>=u)throw a.deffer.reject(\"Invalid part count\"),delete t.pendingMessages[n],Error(\"Invalid part count\")}else{if(u>100)throw a.deffer.reject(new s.UBError(\"unknownError\",\"UBNativeMessage. Result exceed 100Mb limit\")),delete t.pendingMessages[n],Error(new s.UBError(\"unknownError\",\"UBNativeMessage. Result exceed 100Mb limit\"));a.partials=Array(u)}a.partials[l]=i,-1===c.indexOf(a.partials,void 0)?(i=a.partials.join(\"\"),delete t.pendingMessages[n],\"{\"!==i.charAt(0)&&\"[\"!==i.charAt(0)||(i=JSON.parse(i)),a.deffer.resolve(i)):a.timerID=setTimeout(function(){t.onMsgTimeOut(n)},a.timeoutValue)}else delete t.pendingMessages[n],a.deffer.resolve(i);else{if(\"reject\"!==o)throw Error(\"UBNativeMessage. Invalid msgType type in: \"+r);delete t.pendingMessages[n];var h=!1;/<<<.*>>>/.test(i)&&(i=i.match(/<<<(.*)>>>/)[1],h=!0);var f=h?new s.UBError(i):new s.UBError(\"unknownError\",i);a.deffer.reject(f)}else console.error(\"UBNativeMessage. unknown messageID:\"+n)}},t.eventElm.addEventListener(\"UBExtensionMsg\",t.onContentMessage),t.onDisconnected=null,t.onMessage=null}function o(e){var t=e.split(\".\");if(t.length>4)throw Error(\"Invalid version number \"+e);for(var r=1,n=0,o=t.length,i=o-1;i>=0;i--)n+=parseInt(t[i],10)*r,r*=i===o-1?1e4:1e3;return n}function i(e,t,r){var n=s.format(e.installer,e.minVersion),o=\"NM\"+(r?\"Update\":\"Install\")+(\"none\"===e.host?\"Extension\"+(s.isOpera?\"Opera\":\"Chrome\"):\"Feature\");return s.format(a(o),a(e.UIName),e.minVersion,t,n)}var s=r(2),a=r(3).i18n,u=r(4),c=r(0),l={host:\"none\",UIName:\"NMUBExtension\",minVersion:\"1.0.0\",installer:\"pgffhmifenmomiabibdpnceahangimdi\"};n.prototype.invoke=function(e,t,r){var n=this;if(!n.connected&&\"__\"!==e.substr(0,2))return Promise.reject(new s.UBError(\"unknownError\",\"UBNativeMessage. Not connected. call connect() first\"));r=r||n.callTimeOut;var o=n.getMessageId(),i={clientID:n.id,messageID:o,method:e,params:t};return new Promise(function(e,t){n.pendingMessages[o]={request:null,deffer:{resolve:e,reject:t},timerID:setTimeout(function(){n.onMsgTimeOut(o)},r),partials:null,timeoutValue:r||n.callTimeOut,stTime:(new Date).getTime()},n.iFarmeMode?window.parent.postMessage({detail:i,messageType:\"UBPageMsg\"},\"*\"):n.eventElm.dispatchEvent(new CustomEvent(\"UBPageMsg\",{detail:i}))})},n.extensionExists=function(){if(s.isSecureBrowser)return!0;var e=document.getElementById(\"ubExtensionPageMessageObj\");return!(!window.parent||window.parent===window)||!!e&&\"YES\"===e.getAttribute(\"data-extensionAttached\")},n.prototype.doOnDisconnect=function(e){var t=this,r=t.pendingMessages;t.pendingMessages={},t.connected=!1,r&&c.forEach(r,function(t){t&&t.deffer&&t.deffer.reject(e)})},n.prototype.onParentWinMessage=function(e){e.data&&\"UBExtensionMsg\"===e.data.messageType&&this.onContentMessage(e.data)},n.prototype.connect=function(e){var t=this,r=void 0;return t.connected?Promise.resolve(t):n.extensionExists()?(r=window.parent&&window.parent!==window?new Promise(function(e,r){var n=void 0,o=function o(a){return a.data&&\"initUbExtensionParent\"===a.data.messageType?(clearTimeout(n),\"initUbExtensionReady\"!==a.data.detail?(r(new s.UBError(i(l,\"-\",!1))),a):(t.iFarmeMode=!0,window.removeEventListener(\"message\",o),window.addEventListener(\"message\",t.onParentWinMessage.bind(t),!1),void e(!0))):a};window.addEventListener(\"message\",o,!1),window.parent.postMessage({messageType:\"initUbExtension\"},\"*\"),n=setTimeout(function(){r(new s.UBError(i(l,\"-\",!1)))},1500)}):Promise.resolve(!0),r.then(function(){return t.invoke(\"__extensionVersion\")}).then(function(e){var t=o(e);if(t<o(l.minVersion))throw s.logDebug(\"browser extension version\",e,\"is smaller when required\",l.minVersion),new s.UBError(i(\"extension\",e,!0));return t!==o(l.minVersion)&&s.logDebug(\"Current version of extension\",e,\"is more than required\",l.minVersion),!0}).then(function(){return t.invoke(\"__connect\",{hostAppName:t._cfg.host},e).then(function(e){var r=t._cfg.minVersion;if(t.connected=!0,t.featureVersion=e,o(e)<o(r))throw new s.UBError(i(t._cfg,e,!0));return e!==r&&s.logDebug(\"Current version of feature\",t._cfg.host,e,\"greater than the required\",r),t},function(e){throw s.logError(e),new s.UBError(i(t._cfg,\"-\",!1))})}).catch(function(e){throw t.disconnect(),e})):Promise.reject(new s.UBError(i(l,\"-\",!1)))},n.prototype.disconnect=function(){var e=this;return e.connected?e.invoke(\"__disconnect\").then(function(t){return s.logDebug(\"UBNativeMessage. Disconnected with message\",t),e.connected=!1,e.eventElm&&e.eventElm.removeEventListener(\"UBExtensionMsg\",e.onContentMessage),!0}):Promise.resolve(!0)},n.prototype.onMsgTimeOut=function(e){var t=this.pendingMessages[e];t&&(t.timerID=null,delete this.pendingMessages[e],t.deffer.reject(new s.UBError(\"unknownError\",\"pluginMethodCallTimedOut\")))},n.prototype.idCounter=0,e.exports=n}])});\n\n\n// WEBPACK FOOTER //\n// ub-pub.min.js"],"mappings":"AAAA","sourceRoot":""}